define(["jquery"],function(a){return function b(c,d){function e(){var b=[],c=a("[name='itemsettings']").val();if(c>""){var d=JSON.parse(c);for(var e in d)b.push(d[e])}return b}this.questionid=a("input[name=id]").val(),this.settings=e(),this.gaptext=c,this.delimitchars=d,this.l=d.substr(0,1),this.r=d.substr(1,1),this.len=this.gaptext.length,this.startchar=this.gaptext.substring(0,1),this.endchar=this.gaptext.substring(this.len-1,this.len),this.gaptextNodelim="",this.feedback={},this.instance=0,this.feedback.correct=a("#id_corecteditable").html(),this.feedback.incorrect=a("#id_incorrecteditable").html(),b.prototype.striptags=function(a){if(void 0===a)return"";var b=/(<([^>]+)>)/gi;return a.replace(b,"")},this.stripdelim=function(){if(this.startchar===this.l&&(this.gaptextNodelim=this.gaptext.substring(1,this.len)),this.endchar===this.r){var a=this.gaptextNodelim.length;this.gaptextNodelim=this.gaptextNodelim.substring(0,a-1)}return this.gaptextNodelim};var f=[];b.prototype.getItemSettings=function(a){var b=a.id,d=b.indexOf("_");this.instance=b.substr(d+1);for(var e in this.settings)c=this.stripdelim(),this.settings[e].gaptext===c&&(f=this.settings[e]);return f},this.updateJson=function(b){var c=!1,d=b.target.id;for(var e in this.settings)this.settings[e].gaptext===this.stripdelim()&&(this.settings[e].correctfeedback=a("#id_correcteditable")[0].innerHTML,this.settings[e].incorrectfeedback=a("#id_incorrecteditable")[0].innerHTML,c=!0);if(c===!1){var f={itemid:d,questionid:a("input[name=id]").val(),correctfeedback:a("#id_correcteditable").html(),incorrectfeedback:a("#id_incorrecteditable").html(),gaptext:this.stripdelim()};this.settings.push(f)}return JSON.stringify(this.settings)}}});
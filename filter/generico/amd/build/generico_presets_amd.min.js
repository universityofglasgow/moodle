define(["jquery","core/log"],function(a,b){"use strict";return b.debug("Filter Generico Presets initialising"),{presetdata:!1,dataitems:["key","name","instructions","requirecss","requirejs","shim","defaults","amd","body","bodyend","script","style","dataset","datasetvars","alternate","alternateend","version"],fetchcontrols:function(a){var b={};return b.key=document.getElementById("id_s_filter_generico_templatekey_"+a),b.name=document.getElementById("id_s_filter_generico_templatename_"+a),b.instructions=document.getElementById("id_s_filter_generico_templateinstructions_"+a),b.requirecss=document.getElementById("id_s_filter_generico_templaterequire_css_"+a),b.requirejs=document.getElementById("id_s_filter_generico_templaterequire_js_"+a),b.shim=document.getElementById("id_s_filter_generico_templaterequire_js_shim_"+a),b.defaults=document.getElementById("id_s_filter_generico_templatedefaults_"+a),b.amd=document.getElementById("id_s_filter_generico_template_amd_"+a),b.body=document.getElementById("id_s_filter_generico_template_"+a),b.bodyend=document.getElementById("id_s_filter_generico_templateend_"+a),b.script=document.getElementById("id_s_filter_generico_templatescript_"+a),b.style=document.getElementById("id_s_filter_generico_templatestyle_"+a),b.dataset=document.getElementById("id_s_filter_generico_dataset_"+a),b.datasetvars=document.getElementById("id_s_filter_generico_datasetvars_"+a),b.alternate=document.getElementById("id_s_filter_generico_templatealternate_"+a),b.alternateend=document.getElementById("id_s_filter_generico_templatealternate_end_"+a),b.presetdata=document.getElementById("id_s_filter_generico_presetdata_"+a),b.version=document.getElementById("id_s_filter_generico_templateversion_"+a),b},fetchjsonbundle:function(b,c){var d={};a.each(this.dataitems,function(a,b){d[b]=c[b].value});var e=JSON.stringify(d);return e},exportbundle:function(a){var b=this.fetchcontrols(a);if(""!=b.key.value){var c=this.fetchjsonbundle(a,b),d=document.createElement("a");if(d.setAttribute("href","data:text/json;charset=utf-8,"+encodeURIComponent(c)),d.setAttribute("download",b.key.value+".txt"),document.createEvent){var e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),d.dispatchEvent(e)}else d.click()}},populateform:function(b,c,d){var e=this.fetchcontrols(b);(c||d)&&(0==c&&d||(d=this.presetdata),a.each(this.dataitems,function(a,b){if(d[c].hasOwnProperty(b))e[b].value=d[c][b];else switch(b){case"amd":e[b].value=0;break;default:e[b].value=""}}))},dopopulate:function(a,b){this.populateform(a,0,new Array(b))},init:function(b){if(!this.presetdata){var c="#id_s_filter_generico_presetdata_"+b.templateindex,d=a(c).get(0);this.presetdata=JSON.parse(d.value),a(c).remove()}var e=this;a("select[name='filter_generico/presets']").change(function(){e.populateform(b.templateindex,a(this).val())});var f="#id_s_filter_generico_dragdropsquare_"+b.templateindex;a(f).on("click",function(a){e.exportbundle(b.templateindex)}),a(f).on("dragover",function(b){b.preventDefault(),b.stopPropagation(),a(this).addClass("filter_generico_dragging")}),a(f).on("dragleave",function(b){b.preventDefault(),b.stopPropagation(),a(this).removeClass("filter_generico_dragging")}),a(f).on("drop",function(c){c.preventDefault();var d=c.originalEvent.dataTransfer.files;if(d.length){var f=d[0];if(f){var g=new FileReader;g.onload=function(a){var c=a.target.result,d=JSON.parse(c);d.key&&e.dopopulate(b.templateindex,d)},g.readAsText(f)}else alert("Failed to load file")}a(this).removeClass("filter_generico_dragging")})}}});
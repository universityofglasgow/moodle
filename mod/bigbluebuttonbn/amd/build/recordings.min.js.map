{"version":3,"file":"recordings.min.js","sources":["../src/recordings.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JS for the recordings page on mod_bigbluebuttonbn plugin.\n *\n * @module      mod_bigbluebuttonbn/recordings\n * @copyright   2021 Blindside Networks Inc\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as repository from './repository';\nimport {exception as displayException} from 'core/notification';\nimport {prefetchStrings} from 'core/prefetch';\nimport {get_string as getString, get_strings as getStrings} from 'core/str';\nimport {addIconToContainerWithPromise} from 'core/loadingicon';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Pending from 'core/pending';\n\nconst stringsWithKeys = {\n    first: 'view_recording_yui_first',\n    prev: 'view_recording_yui_prev',\n    next: 'view_recording_yui_next',\n    last: 'view_recording_yui_last',\n    goToLabel: 'view_recording_yui_page',\n    goToAction: 'view_recording_yui_go',\n    perPage: 'view_recording_yui_rows',\n    showAll: 'view_recording_yui_show_all',\n};\n// Load global strings.\nprefetchStrings('bigbluebuttonbn', Object.entries(stringsWithKeys).map((entry) => entry[1]));\n\nconst getStringsForYui = () => {\n    const stringMap = Object.keys(stringsWithKeys).map(key => {\n        return {\n            key: stringsWithKeys[key],\n            component: 'mod_bigbluebuttonbn',\n        };\n    });\n\n    // Return an object with the matching string keys (we want an object with {<stringkey>: <stringvalue>...}).\n    return getStrings(stringMap)\n        .then((stringArray) => Object.assign({}, ...Object.keys(stringsWithKeys).map(\n            (key, index) => ({[key]: stringArray[index]})))\n        ).catch();\n};\n\nconst getYuiInstance = lang => new Promise(resolve => {\n    // eslint-disable-next-line\n    YUI({\n        lang,\n    }).use('intl', 'datatable', 'datatable-sort', 'datatable-paginator', 'datatype-number', Y => {\n        resolve(Y);\n    });\n});\n\n/**\n * Format the supplied date per the specified locale.\n *\n * @param   {string} locale\n * @param   {number} date\n * @returns {array}\n */\nconst formatDate = (locale, date) => {\n    const realDate = new Date(date);\n    return realDate.toLocaleDateString(locale, {\n        weekday: 'long',\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric',\n    });\n};\n\n/**\n * Format response data for the table.\n *\n * @param   {string} response JSON-encoded table data\n * @returns {array}\n */\nconst getFormattedData = response => {\n    const recordingData = response.tabledata;\n    return JSON.parse(recordingData.data);\n};\n\nconst getTableNode = tableSelector => document.querySelector(tableSelector);\n\nconst fetchRecordingData = tableSelector => {\n    const tableNode = getTableNode(tableSelector);\n    if (tableNode === null) {\n        return Promise.resolve(false);\n    }\n\n    if (tableNode.dataset.importMode) {\n        return repository.fetchRecordingsToImport(\n            tableNode.dataset.bbbid,\n            tableNode.dataset.bbbSourceInstanceId,\n            tableNode.dataset.bbbSourceCourseId,\n            tableNode.dataset.tools,\n            tableNode.dataset.groupId\n        );\n    } else {\n        return repository.fetchRecordings(\n            tableNode.dataset.bbbid,\n            tableNode.dataset.tools,\n            tableNode.dataset.groupId\n        );\n    }\n};\n\n/**\n * Fetch the data table functinos for the specified table.\n *\n * @param {String} tableId in which we will display the table\n * @param {String} searchFormId The Id of the relate.\n * @param {Object} dataTable\n * @returns {Object}\n * @private\n */\nconst getDataTableFunctions = (tableId, searchFormId, dataTable) => {\n    const tableNode = getTableNode(tableId);\n    const bbbid = tableNode.dataset.bbbid;\n\n    const updateTableFromResponse = response => {\n        if (!response || !response.status) {\n            // There was no output at all.\n            return;\n        }\n\n        dataTable.get('data').reset(getFormattedData(response));\n        dataTable.set(\n            'currentData',\n            dataTable.get('data')\n        );\n\n        const currentFilter = dataTable.get('currentFilter');\n        if (currentFilter) {\n            filterByText(currentFilter);\n        }\n    };\n\n    const refreshTableData = () => fetchRecordingData(tableId).then(updateTableFromResponse);\n\n    const filterByText = value => {\n        const dataModel = dataTable.get('currentData');\n        dataTable.set('currentFilter', value);\n\n        const escapedRegex = value.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, \"\\\\$&\");\n        const rsearch = new RegExp(`<span>.*?${escapedRegex}.*?</span>`, 'i');\n\n        dataTable.set('data', dataModel.filter({asList: true}, item => {\n            const name = item.get('recording');\n            if (name && rsearch.test(name)) {\n                return true;\n            }\n\n            const description = item.get('description');\n            return description && rsearch.test(description);\n        }));\n    };\n\n    const requestAction = (element) => {\n        const getDataFromAction = (element, dataType) => {\n            const dataElement = element.closest(`[data-${dataType}]`);\n            if (dataElement) {\n                return dataElement.dataset[dataType];\n            }\n\n            return null;\n        };\n\n        const elementData = element.dataset;\n        const payload = {\n            bigbluebuttonbnid: bbbid,\n            recordingid: getDataFromAction(element, 'recordingid'),\n            additionaloptions: getDataFromAction(element, 'additionaloptions'),\n            action: elementData.action,\n        };\n        // Slight change for import, for additional options.\n        if (!payload.additionaloptions) {\n            payload.additionaloptions = {};\n        }\n        if (elementData.action === 'import') {\n            const bbbsourceid = getDataFromAction(element, 'source-instance-id');\n            const bbbcourseid = getDataFromAction(element, 'source-course-id');\n            if (!payload.additionaloptions) {\n                payload.additionaloptions = {};\n            }\n            payload.additionaloptions.sourceid = bbbsourceid ? bbbsourceid : 0;\n            payload.additionaloptions.bbbcourseid = bbbcourseid ? bbbcourseid : 0;\n        }\n        // Now additional options should be a json string.\n        payload.additionaloptions = JSON.stringify(payload.additionaloptions);\n        if (element.dataset.requireConfirmation === \"1\") {\n            // Create the confirmation dialogue.\n            return new Promise((resolve) =>\n                ModalFactory.create({\n                    title: getString('confirm'),\n                    body: recordingConfirmationMessage(payload),\n                    type: ModalFactory.types.SAVE_CANCEL\n                }).then(async(modal) => {\n                    modal.setSaveButtonText(await getString('ok', 'moodle'));\n\n                    // Handle save event.\n                    modal.getRoot().on(ModalEvents.save, () => {\n                        resolve(true);\n                    });\n\n                    // Handle hidden event.\n                    modal.getRoot().on(ModalEvents.hidden, () => {\n                        // Destroy when hidden.\n                        modal.destroy();\n                        resolve(false);\n                    });\n\n                    modal.show();\n\n                    return modal;\n                }).catch(displayException)\n            ).then((proceed) =>\n                proceed ? repository.updateRecording(payload) : () => null\n            );\n        } else {\n            return repository.updateRecording(payload);\n        }\n    };\n\n    const recordingConfirmationMessage = async(data) => {\n\n        const playbackElement = document.querySelector(`#playbacks-${data.recordingid}`);\n        const recordingType = await getString(\n            playbackElement.dataset.imported === 'true' ? 'view_recording_link' : 'view_recording',\n            'bigbluebuttonbn'\n        );\n\n        const confirmation = await getString(`view_recording_${data.action}_confirmation`, 'bigbluebuttonbn', recordingType);\n\n        if (data.action === 'import') {\n            return confirmation;\n        }\n\n        // If it has associated links imported in a different course/activity, show that in confirmation dialog.\n        const associatedLinkCount = document.querySelector(`a#recording-${data.action}-${data.recordingid}`)?.dataset?.links;\n        if (!associatedLinkCount || associatedLinkCount === 0) {\n            return confirmation;\n        }\n\n        const confirmationWarning = await getString(\n            associatedLinkCount === 1\n                ? `view_recording_${data.action}_confirmation_warning_p`\n                : `view_recording_${data.action}_confirmation_warning_s`,\n            'bigbluebuttonbn',\n            associatedLinkCount\n        );\n\n        return confirmationWarning + '\\n\\n' + confirmation;\n    };\n\n    /**\n     * Process an action event.\n     *\n     * @param   {Event} e\n     */\n    const processAction = e => {\n        const popoutLink = e.target.closest('[data-action=\"play\"]');\n        if (popoutLink) {\n            e.preventDefault();\n\n            const videoPlayer = window.open('', '_blank');\n            videoPlayer.opener = null;\n            videoPlayer.location.href = popoutLink.href;\n            // TODO send a recording viewed event when this event will be implemented.\n            return;\n        }\n\n        // Fetch any clicked anchor.\n        const clickedLink = e.target.closest('a[data-action]');\n        if (clickedLink && !clickedLink.classList.contains('disabled')) {\n            e.preventDefault();\n\n            // Create a spinning icon on the table.\n            const iconPromise = addIconToContainerWithPromise(dataTable.get('boundingBox').getDOMNode());\n\n            requestAction(clickedLink)\n                .then(refreshTableData)\n                .then(iconPromise.resolve)\n                .catch(displayException);\n        }\n    };\n\n    const processSearchSubmission = e => {\n        // Prevent the default action.\n        e.preventDefault();\n        const parentNode = e.target.closest('div[role=search]');\n        const searchInput = parentNode.querySelector('input[name=search]');\n        filterByText(searchInput.value);\n    };\n\n    const registerEventListeners = () => {\n        // Add event listeners to the table boundingBox.\n        const boundingBox = dataTable.get('boundingBox').getDOMNode();\n        boundingBox.addEventListener('click', processAction);\n\n        // Setup the search from handlers.\n        const searchForm = document.querySelector(searchFormId);\n        if (searchForm) {\n            const searchButton = document.querySelector(searchFormId + ' button');\n            searchButton.addEventListener('click', processSearchSubmission);\n        }\n    };\n\n    return {\n        filterByText,\n        refreshTableData,\n        registerEventListeners,\n    };\n};\n\n/**\n * Setup the data table for the specified BBB instance.\n *\n * @param {String} tableId in which we will display the table\n * @param {String} searchFormId The Id of the relate.\n * @param   {object} response The response from the data request\n * @returns {Promise}\n */\nconst setupDatatable = (tableId, searchFormId, response) => {\n    if (!response) {\n        return Promise.resolve();\n    }\n\n    if (!response.status) {\n        // Something failed. Continue to show the plain output.\n        return Promise.resolve();\n    }\n\n    const recordingData = response.tabledata;\n\n    const pendingPromise = new Pending('mod_bigbluebuttonbn/recordings/setupDatatable');\n    return Promise.all([getYuiInstance(recordingData.locale), getStringsForYui()])\n        .then(([yuiInstance, strings]) => {\n            // Here we use a custom formatter for date.\n            // See https://clarle.github.io/yui3/yui/docs/api/classes/DataTable.BodyView.Formatters.html\n            // Inspired from examples here: https://clarle.github.io/yui3/yui/docs/datatable/\n            // Normally formatter have the prototype: (col) => (cell) => <computed value>, see:\n            // https://clarle.github.io/yui3/yui/docs/api/files/datatable_js_formatters.js.html#l100 .\n            const dateCustomFormatter = () => (cell) => formatDate(recordingData.locale, cell.value);\n            // Add the fetched strings to the YUI Instance.\n            yuiInstance.Intl.add('datatable-paginator', yuiInstance.config.lang, {...strings});\n            yuiInstance.DataTable.BodyView.Formatters.customDate = dateCustomFormatter;\n            return yuiInstance;\n        })\n        .then(yuiInstance => {\n\n            const tableData = getFormattedData(response);\n            yuiInstance.RecordsPaginatorView = Y.Base.create('my-paginator-view', yuiInstance.DataTable.Paginator.View, [], {\n                _modelChange: function(e) {\n                    var changed = e.changed,\n                        totalItems = (changed && changed.totalItems);\n                    if (totalItems) {\n                        this._updateControlsUI(e.target.get('page'));\n                    }\n                }\n            });\n            return new yuiInstance.DataTable({\n                paginatorView: \"RecordsPaginatorView\",\n                width: \"1195px\",\n                columns: recordingData.columns,\n                data: tableData,\n                rowsPerPage: 10,\n                paginatorLocation: ['header', 'footer'],\n                autoSync: true\n            });\n        })\n        .then(dataTable => {\n            dataTable.render(tableId);\n            const {registerEventListeners} = getDataTableFunctions(\n                tableId,\n                searchFormId,\n                dataTable);\n            registerEventListeners();\n            return dataTable;\n        })\n        .then(dataTable => {\n            pendingPromise.resolve();\n            return dataTable;\n        });\n};\n\n/**\n * Initialise recordings code.\n *\n * @method init\n * @param {String} tableId in which we will display the table\n * @param {String} searchFormId The Id of the relate.\n */\nexport const init = (tableId, searchFormId) => {\n    const pendingPromise = new Pending('mod_bigbluebuttonbn/recordings:init');\n\n    fetchRecordingData(tableId)\n        .then(response => setupDatatable(tableId, searchFormId, response))\n        .then(() => pendingPromise.resolve())\n        .catch(displayException);\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","repository","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_interopRequireWildcard","_modal_factory","_modal_events","_pending","stringsWithKeys","first","prev","next","last","goToLabel","goToAction","perPage","showAll","prefetchStrings","entries","map","entry","getStringsForYui","stringMap","keys","component","getStrings","then","stringArray","assign","index","catch","getFormattedData","response","recordingData","tabledata","JSON","parse","data","getTableNode","tableSelector","document","querySelector","fetchRecordingData","tableNode","Promise","resolve","dataset","importMode","fetchRecordingsToImport","bbbid","bbbSourceInstanceId","bbbSourceCourseId","tools","groupId","fetchRecordings","getDataTableFunctions","tableId","searchFormId","dataTable","updateTableFromResponse","status","reset","currentFilter","filterByText","refreshTableData","value","dataModel","escapedRegex","replace","rsearch","RegExp","concat","filter","asList","item","name","test","description","recordingConfirmationMessage","async","_document$querySelect","_document$querySelect2","playbackElement","recordingid","recordingType","getString","get_string","imported","confirmation","action","associatedLinkCount","links","processAction","e","popoutLink","target","closest","preventDefault","videoPlayer","window","open","opener","location","href","clickedLink","classList","contains","iconPromise","addIconToContainerWithPromise","getDOMNode","element","getDataFromAction","dataType","dataElement","elementData","payload","bigbluebuttonbnid","additionaloptions","bbbsourceid","bbbcourseid","sourceid","stringify","requireConfirmation","ModalFactory","create","title","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","on","ModalEvents","save","hidden","destroy","show","displayException","proceed","updateRecording","requestAction","processSearchSubmission","searchInput","registerEventListeners","addEventListener","setupDatatable","pendingPromise","Pending","all","lang","locale","YUI","use","Y","_ref","yuiInstance","strings","Intl","add","config","DataTable","BodyView","Formatters","customDate","dateCustomFormatter","cell","formatDate","date","Date","toLocaleDateString","weekday","year","month","day","tableData","RecordsPaginatorView","Base","Paginator","View","_modelChange","changed","totalItems","this","_updateControlsUI","paginatorView","width","columns","rowsPerPage","paginatorLocation","autoSync","render","_exports","init"],"mappings":"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"}
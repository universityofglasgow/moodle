
var __cov__3A0NvTgdEoIoqXY36ZPuw = (Function('return this'))();
if (!__cov__3A0NvTgdEoIoqXY36ZPuw.__coverage__) { __cov__3A0NvTgdEoIoqXY36ZPuw.__coverage__ = {}; }
__cov__3A0NvTgdEoIoqXY36ZPuw = __cov__3A0NvTgdEoIoqXY36ZPuw.__coverage__;
if (!(__cov__3A0NvTgdEoIoqXY36ZPuw['build/moodle-atto_teamsmeeting-button/moodle-atto_teamsmeeting-button.js'])) {
   __cov__3A0NvTgdEoIoqXY36ZPuw['build/moodle-atto_teamsmeeting-button/moodle-atto_teamsmeeting-button.js'] = {"path":"build/moodle-atto_teamsmeeting-button/moodle-atto_teamsmeeting-button.js","s":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"fnMap":{"1":{"name":"(anonymous_1)","line":1,"loc":{"start":{"line":1,"column":43},"end":{"line":1,"column":62}}},"2":{"name":"(anonymous_2)","line":116,"loc":{"start":{"line":116,"column":17},"end":{"line":116,"column":28}}},"3":{"name":"(anonymous_3)","line":136,"loc":{"start":{"line":136,"column":22},"end":{"line":136,"column":33}}},"4":{"name":"(anonymous_4)","line":165,"loc":{"start":{"line":165,"column":21},"end":{"line":165,"column":32}}},"5":{"name":"(anonymous_5)","line":215,"loc":{"start":{"line":215,"column":19},"end":{"line":215,"column":30}}},"6":{"name":"(anonymous_6)","line":234,"loc":{"start":{"line":234,"column":20},"end":{"line":234,"column":39}}},"7":{"name":"(anonymous_7)","line":253,"loc":{"start":{"line":253,"column":23},"end":{"line":253,"column":47}}},"8":{"name":"(anonymous_8)","line":271,"loc":{"start":{"line":271,"column":22},"end":{"line":271,"column":34}}},"9":{"name":"(anonymous_9)","line":307,"loc":{"start":{"line":307,"column":33},"end":{"line":307,"column":47}}},"10":{"name":"(anonymous_10)","line":340,"loc":{"start":{"line":340,"column":34},"end":{"line":340,"column":55}}},"11":{"name":"(anonymous_11)","line":360,"loc":{"start":{"line":360,"column":26},"end":{"line":360,"column":41}}},"12":{"name":"(anonymous_12)","line":371,"loc":{"start":{"line":371,"column":27},"end":{"line":371,"column":39}}},"13":{"name":"(anonymous_13)","line":394,"loc":{"start":{"line":394,"column":25},"end":{"line":394,"column":36}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":444,"column":61}},"2":{"start":{"line":36,"column":0},"end":{"line":67,"column":22}},"3":{"start":{"line":68,"column":0},"end":{"line":441,"column":3}},"4":{"start":{"line":117,"column":8},"end":{"line":117,"column":54}},"5":{"start":{"line":118,"column":8},"end":{"line":118,"column":42}},"6":{"start":{"line":119,"column":8},"end":{"line":119,"column":42}},"7":{"start":{"line":121,"column":8},"end":{"line":127,"column":11}},"8":{"start":{"line":138,"column":8},"end":{"line":138,"column":65}},"9":{"start":{"line":139,"column":8},"end":{"line":141,"column":9}},"10":{"start":{"line":140,"column":12},"end":{"line":140,"column":19}},"11":{"start":{"line":143,"column":8},"end":{"line":148,"column":11}},"12":{"start":{"line":151,"column":8},"end":{"line":151,"column":64}},"13":{"start":{"line":154,"column":8},"end":{"line":154,"column":31}},"14":{"start":{"line":155,"column":8},"end":{"line":155,"column":24}},"15":{"start":{"line":167,"column":8},"end":{"line":171,"column":19}},"16":{"start":{"line":174,"column":8},"end":{"line":176,"column":9}},"17":{"start":{"line":175,"column":12},"end":{"line":175,"column":19}},"18":{"start":{"line":178,"column":8},"end":{"line":178,"column":69}},"19":{"start":{"line":179,"column":8},"end":{"line":205,"column":9}},"20":{"start":{"line":180,"column":12},"end":{"line":180,"column":40}},"21":{"start":{"line":181,"column":12},"end":{"line":181,"column":87}},"22":{"start":{"line":182,"column":12},"end":{"line":182,"column":50}},"23":{"start":{"line":183,"column":12},"end":{"line":183,"column":55}},"24":{"start":{"line":184,"column":12},"end":{"line":199,"column":13}},"25":{"start":{"line":185,"column":16},"end":{"line":185,"column":69}},"26":{"start":{"line":187,"column":16},"end":{"line":187,"column":95}},"27":{"start":{"line":188,"column":16},"end":{"line":190,"column":18}},"28":{"start":{"line":191,"column":16},"end":{"line":198,"column":19}},"29":{"start":{"line":200,"column":12},"end":{"line":204,"column":13}},"30":{"start":{"line":201,"column":16},"end":{"line":201,"column":83}},"31":{"start":{"line":203,"column":16},"end":{"line":203,"column":75}},"32":{"start":{"line":216,"column":8},"end":{"line":223,"column":9}},"33":{"start":{"line":217,"column":12},"end":{"line":217,"column":85}},"34":{"start":{"line":218,"column":12},"end":{"line":222,"column":13}},"35":{"start":{"line":219,"column":16},"end":{"line":219,"column":63}},"36":{"start":{"line":220,"column":16},"end":{"line":220,"column":54}},"37":{"start":{"line":221,"column":16},"end":{"line":221,"column":41}},"38":{"start":{"line":235,"column":8},"end":{"line":242,"column":9}},"39":{"start":{"line":236,"column":12},"end":{"line":236,"column":59}},"40":{"start":{"line":237,"column":12},"end":{"line":241,"column":13}},"41":{"start":{"line":238,"column":16},"end":{"line":239,"column":68}},"42":{"start":{"line":240,"column":16},"end":{"line":240,"column":65}},"43":{"start":{"line":254,"column":8},"end":{"line":254,"column":44}},"44":{"start":{"line":255,"column":8},"end":{"line":255,"column":36}},"45":{"start":{"line":256,"column":8},"end":{"line":261,"column":9}},"46":{"start":{"line":257,"column":12},"end":{"line":257,"column":42}},"47":{"start":{"line":258,"column":12},"end":{"line":260,"column":13}},"48":{"start":{"line":259,"column":16},"end":{"line":259,"column":51}},"49":{"start":{"line":272,"column":8},"end":{"line":273,"column":18}},"50":{"start":{"line":275,"column":8},"end":{"line":275,"column":27}},"51":{"start":{"line":276,"column":8},"end":{"line":278,"column":18}},"52":{"start":{"line":280,"column":8},"end":{"line":280,"column":42}},"53":{"start":{"line":282,"column":8},"end":{"line":282,"column":35}},"54":{"start":{"line":283,"column":8},"end":{"line":296,"column":9}},"55":{"start":{"line":286,"column":12},"end":{"line":286,"column":33}},"56":{"start":{"line":287,"column":12},"end":{"line":287,"column":68}},"57":{"start":{"line":288,"column":12},"end":{"line":290,"column":13}},"58":{"start":{"line":289,"column":16},"end":{"line":289,"column":42}},"59":{"start":{"line":293,"column":12},"end":{"line":293,"column":52}},"60":{"start":{"line":295,"column":12},"end":{"line":295,"column":31}},"61":{"start":{"line":308,"column":8},"end":{"line":312,"column":24}},"62":{"start":{"line":314,"column":8},"end":{"line":314,"column":28}},"63":{"start":{"line":315,"column":8},"end":{"line":315,"column":50}},"64":{"start":{"line":317,"column":8},"end":{"line":331,"column":9}},"65":{"start":{"line":319,"column":12},"end":{"line":319,"column":63}},"66":{"start":{"line":320,"column":12},"end":{"line":320,"column":51}},"67":{"start":{"line":323,"column":12},"end":{"line":323,"column":89}},"68":{"start":{"line":324,"column":12},"end":{"line":324,"column":71}},"69":{"start":{"line":326,"column":12},"end":{"line":326,"column":56}},"70":{"start":{"line":327,"column":12},"end":{"line":327,"column":59}},"71":{"start":{"line":330,"column":12},"end":{"line":330,"column":57}},"72":{"start":{"line":334,"column":8},"end":{"line":336,"column":9}},"73":{"start":{"line":335,"column":12},"end":{"line":335,"column":19}},"74":{"start":{"line":338,"column":8},"end":{"line":338,"column":69}},"75":{"start":{"line":340,"column":8},"end":{"line":347,"column":17}},"76":{"start":{"line":341,"column":12},"end":{"line":341,"column":53}},"77":{"start":{"line":342,"column":12},"end":{"line":346,"column":13}},"78":{"start":{"line":343,"column":16},"end":{"line":343,"column":60}},"79":{"start":{"line":345,"column":16},"end":{"line":345,"column":53}},"80":{"start":{"line":349,"column":8},"end":{"line":349,"column":28}},"81":{"start":{"line":361,"column":8},"end":{"line":362,"column":22}},"82":{"start":{"line":365,"column":8},"end":{"line":367,"column":9}},"83":{"start":{"line":366,"column":12},"end":{"line":366,"column":26}},"84":{"start":{"line":370,"column":8},"end":{"line":370,"column":18}},"85":{"start":{"line":371,"column":8},"end":{"line":375,"column":17}},"86":{"start":{"line":372,"column":12},"end":{"line":374,"column":13}},"87":{"start":{"line":373,"column":16},"end":{"line":373,"column":29}},"88":{"start":{"line":376,"column":8},"end":{"line":378,"column":9}},"89":{"start":{"line":377,"column":12},"end":{"line":377,"column":24}},"90":{"start":{"line":380,"column":8},"end":{"line":380,"column":33}},"91":{"start":{"line":381,"column":8},"end":{"line":383,"column":9}},"92":{"start":{"line":382,"column":12},"end":{"line":382,"column":25}},"93":{"start":{"line":384,"column":8},"end":{"line":384,"column":18}},"94":{"start":{"line":395,"column":8},"end":{"line":395,"column":54}},"95":{"start":{"line":397,"column":8},"end":{"line":403,"column":12}},"96":{"start":{"line":405,"column":8},"end":{"line":405,"column":78}},"97":{"start":{"line":407,"column":8},"end":{"line":407,"column":73}},"98":{"start":{"line":409,"column":8},"end":{"line":409,"column":29}}},"branchMap":{"1":{"line":139,"type":"if","locations":[{"start":{"line":139,"column":8},"end":{"line":139,"column":8}},{"start":{"line":139,"column":8},"end":{"line":139,"column":8}}]},"2":{"line":174,"type":"if","locations":[{"start":{"line":174,"column":8},"end":{"line":174,"column":8}},{"start":{"line":174,"column":8},"end":{"line":174,"column":8}}]},"3":{"line":179,"type":"if","locations":[{"start":{"line":179,"column":8},"end":{"line":179,"column":8}},{"start":{"line":179,"column":8},"end":{"line":179,"column":8}}]},"4":{"line":184,"type":"if","locations":[{"start":{"line":184,"column":12},"end":{"line":184,"column":12}},{"start":{"line":184,"column":12},"end":{"line":184,"column":12}}]},"5":{"line":200,"type":"if","locations":[{"start":{"line":200,"column":12},"end":{"line":200,"column":12}},{"start":{"line":200,"column":12},"end":{"line":200,"column":12}}]},"6":{"line":216,"type":"if","locations":[{"start":{"line":216,"column":8},"end":{"line":216,"column":8}},{"start":{"line":216,"column":8},"end":{"line":216,"column":8}}]},"7":{"line":218,"type":"if","locations":[{"start":{"line":218,"column":12},"end":{"line":218,"column":12}},{"start":{"line":218,"column":12},"end":{"line":218,"column":12}}]},"8":{"line":218,"type":"binary-expr","locations":[{"start":{"line":218,"column":16},"end":{"line":218,"column":26}},{"start":{"line":218,"column":30},"end":{"line":218,"column":71}}]},"9":{"line":235,"type":"if","locations":[{"start":{"line":235,"column":8},"end":{"line":235,"column":8}},{"start":{"line":235,"column":8},"end":{"line":235,"column":8}}]},"10":{"line":237,"type":"if","locations":[{"start":{"line":237,"column":12},"end":{"line":237,"column":12}},{"start":{"line":237,"column":12},"end":{"line":237,"column":12}}]},"11":{"line":258,"type":"if","locations":[{"start":{"line":258,"column":12},"end":{"line":258,"column":12}},{"start":{"line":258,"column":12},"end":{"line":258,"column":12}}]},"12":{"line":283,"type":"if","locations":[{"start":{"line":283,"column":8},"end":{"line":283,"column":8}},{"start":{"line":283,"column":8},"end":{"line":283,"column":8}}]},"13":{"line":288,"type":"if","locations":[{"start":{"line":288,"column":12},"end":{"line":288,"column":12}},{"start":{"line":288,"column":12},"end":{"line":288,"column":12}}]},"14":{"line":317,"type":"if","locations":[{"start":{"line":317,"column":8},"end":{"line":317,"column":8}},{"start":{"line":317,"column":8},"end":{"line":317,"column":8}}]},"15":{"line":334,"type":"if","locations":[{"start":{"line":334,"column":8},"end":{"line":334,"column":8}},{"start":{"line":334,"column":8},"end":{"line":334,"column":8}}]},"16":{"line":342,"type":"if","locations":[{"start":{"line":342,"column":12},"end":{"line":342,"column":12}},{"start":{"line":342,"column":12},"end":{"line":342,"column":12}}]},"17":{"line":365,"type":"if","locations":[{"start":{"line":365,"column":8},"end":{"line":365,"column":8}},{"start":{"line":365,"column":8},"end":{"line":365,"column":8}}]},"18":{"line":365,"type":"binary-expr","locations":[{"start":{"line":365,"column":12},"end":{"line":365,"column":19}},{"start":{"line":365,"column":23},"end":{"line":365,"column":52}}]},"19":{"line":372,"type":"if","locations":[{"start":{"line":372,"column":12},"end":{"line":372,"column":12}},{"start":{"line":372,"column":12},"end":{"line":372,"column":12}}]},"20":{"line":372,"type":"binary-expr","locations":[{"start":{"line":372,"column":16},"end":{"line":372,"column":20}},{"start":{"line":372,"column":24},"end":{"line":372,"column":65}}]},"21":{"line":376,"type":"if","locations":[{"start":{"line":376,"column":8},"end":{"line":376,"column":8}},{"start":{"line":376,"column":8},"end":{"line":376,"column":8}}]},"22":{"line":381,"type":"if","locations":[{"start":{"line":381,"column":8},"end":{"line":381,"column":8}},{"start":{"line":381,"column":8},"end":{"line":381,"column":8}}]}},"code":["(function () { YUI.add('moodle-atto_teamsmeeting-button', function (Y, NAME) {","","// This file is part of Moodle - http://moodle.org/","//","// Moodle is free software: you can redistribute it and/or modify","// it under the terms of the GNU General Public License as published by","// the Free Software Foundation, either version 3 of the License, or","// (at your option) any later version.","//","// Moodle is distributed in the hope that it will be useful,","// but WITHOUT ANY WARRANTY; without even the implied warranty of","// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the","// GNU General Public License for more details.","//","// You should have received a copy of the GNU General Public License","// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.","","/*"," * @package    atto_teamsmeeting"," * @copyright  2020 Enovation"," * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later"," */","","/**"," * @module moodle-atto_teamsmeeting-button"," */","","/**"," * Atto text editor teamsmeeting plugin."," *"," * @namespace M.atto_teamsmeeting"," * @class button"," * @extends M.editor_atto.EditorPlugin"," */","","var COMPONENTNAME = 'atto_teamsmeeting',","    CSS = {","        NEWWINDOW: 'atto_teamsmeeting_openinnewwindow',","        URLINPUT: 'atto_teamsmeeting_urlentry'","    },","    SELECTORS = {","        URLINPUT: '.atto_teamsmeeting_urlentry'","    },","    TEMPLATE = '' +","            '<form class=\"atto_form\">' +","                '<div class=\"meeting-app\">' +","                    '<label class=\"meeting-app-label\" for=\"meetingapp\">' +","                    '{{get_string \"createteamsmeeting\" component}}' +","                    '</label>' +","                    '<iframe id=\"meetingapp\" src=\"{{appurl}}?url={{clientdomain}}&locale={{locale}}\"></iframe>' +","                '</div>' +","                '<div class=\"mb-1\">' +","                    '<label for=\"{{elementid}}_atto_teamsmeeting_urlentry\">{{get_string \"meetingurl\" component}}</label>' +","                    '<input class=\"form-control fullwidth url {{CSS.URLINPUT}}\" type=\"url\" ' +","                    'id=\"{{elementid}}_atto_teamsmeeting_urlentry\" size=\"32\" disabled=\"disabled\"/>' +","                '</div>' +","                '<div class=\"form-check\">' +","                    '<input type=\"checkbox\" class=\"form-check-input newwindow\" id=\"{{elementid}}_{{CSS.NEWWINDOW}}\"/>' +","                    '<label class=\"form-check-label\" for=\"{{elementid}}_{{CSS.NEWWINDOW}}\">' +","                    '{{get_string \"openinnewwindow\" component}}' +","                    '</label>' +","                '</div>' +","                '<div class=\"mdl-align\">' +","                    '<br/>' +","                    '<button type=\"submit\" class=\"btn btn-secondary submit\">{{get_string \"addlink\" component}}</button>' +","                '</div>' +","            '</form>';","Y.namespace('M.atto_teamsmeeting').Button = Y.Base.create('button', Y.M.editor_atto.EditorPlugin, [], {","","    /**","     * A reference to the current selection at the time that the dialogue","     * was opened.","     *","     * @property _currentSelection","     * @type Range","     * @private","     */","    _currentSelection: null,","","    /**","     * A reference to the dialogue content.","     *","     * @property _content","     * @type Node","     * @private","     */","    _content: null,","","    /**","     * Moodle base url to pass for Meetings app.","     *","     * @param _clientdomain","     * @type String","     * @private","     */","    _clientdomain: null,","","    /**","     * The Meetings app url.","     *","     * @param _appurl","     * @type String","     * @private","     */","    _appurl: null,","","    /**","     * Moodle user language to pass for Meetings app.","     *","     * @param _locale","     * @type String","     * @private","     */","    _locale: null,","","    initializer: function() {","        this._clientdomain = this.get('clientdomain');","        this._appurl = this.get('appurl');","        this._locale = this.get('locale');","        // Add the teamsmeeting button first.","        this.addButton({","            icon: 'icon',","            iconComponent: 'atto_teamsmeeting',","            callback: this._displayDialogue,","            tags: 'a',","            tagMatchRequiresAll: false","        });","    },","","    /**","     * Display the teamsmeeting editor.","     *","     * @method _displayDialogue","     * @private","     */","    _displayDialogue: function() {","        // Store the current selection.","        this._currentSelection = this.get('host').getSelection();","        if (this._currentSelection === false) {","            return;","        }","","        var dialogue = this.getDialogue({","            headerContent: M.util.get_string('createteamsmeeting', COMPONENTNAME),","            width: 'auto',","            focusAfterHide: true,","            focusOnShowSelector: SELECTORS.URLINPUT","        });","","        // Set the dialogue content, and then show the dialogue.","        dialogue.set('bodyContent', this._getDialogueContent());","","        // Resolve anchors in the selected text.","        this._resolveAnchors();","        dialogue.show();","    },","","    /**","     * If there is selected text and it is part of an anchor teamsmeeting,","     * extract the url (and target) from the teamsmeeting (and set them in the form).","     *","     * @method _resolveAnchors","     * @private","     */","    _resolveAnchors: function() {","        // Find the first anchor tag in the selection.","        var selectednode = this.get('host').getSelectionParentNode(),","            anchornodes,","            anchornode,","            url,","            target;","","        // Note this is a document fragment and YUI doesn't like them.","        if (!selectednode) {","            return;","        }","","        anchornodes = this._findSelectedAnchors(Y.one(selectednode));","        if (anchornodes.length > 0) {","            anchornode = anchornodes[0];","            this._currentSelection = this.get('host').getSelectionFromNode(anchornode);","            url = anchornode.getAttribute('href');","            target = anchornode.getAttribute('target');","            if (url !== '') {","                this._content.one('.url').setAttribute('value', url);","                // Make an ajax request to db for links.","                var ajaxurl = M.cfg.wwwroot + '/lib/editor/atto/plugins/teamsmeeting/ajax.php';","                var params = {","                    url: url","                };","                Y.io(ajaxurl, {","                    context: this,","                    data: params,","                    timeout: 500,","                    on: {","                        complete: this._updateIframe","                    }","                });","            }","            if (target === '_blank') {","                this._content.one('.newwindow').setAttribute('checked', 'checked');","            } else {","                this._content.one('.newwindow').removeAttribute('checked');","            }","        }","    },","","    /**","     * The teamsmeeting iframe check to get meeting link.","     *","     * @method _meetingCheck","     * @param {EventFacade} e","     * @private","     */","    _meetingcheck: function() {","        if(document.getElementById('meetingapp').contentDocument) {","            var url = document.getElementById('meetingapp').contentDocument.location;","            if (url !== '' && url.pathname.indexOf(\"teamsmeeting\") > -1) {","                var link = this._getqueryvariable('link', url);","                var input = this._content.one('.url');","                input.set('value', link);","            }","        }","    },","","    /**","     * The teamsmeeting iframe update.","     *","     * @method _meetingCheck","     * @param {String} id","     * @param {EventFacade} e","     * @private","     */","    _updateIframe:  function(id, data) {","        if (data.status === 200) {","            var dataobject = JSON.parse(data.responseText);","            if (dataobject[2] !== null) {","                var url = dataobject[0]+'?title=' + dataobject[1] + '&link=' + encodeURIComponent(dataobject[2]) +","                    '&options=' + encodeURIComponent(dataobject[3]);","                this._content.one('#meetingapp').set('src', url);","            }","        }","    },","","    /**","     * Gets parameter from url.","     *","     * @method _getqueryvariable","     * @param {string} variable","     * @param {object} url","     * @private","     */","    _getqueryvariable: function(variable, url) {","        var query = url.search.substring(1);","        var vars = query.split('&');","        for (var i = 0; i < vars.length; i++) {","            var pair = vars[i].split('=');","            if (decodeURIComponent(pair[0]) == variable) {","                return decodeURIComponent(pair[1]);","            }","        }","    },","","    /**","     * The teamsmeeting was inserted, so make changes to the editor source.","     *","     * @method _setteamsmeeting","     * @param {EventFacade} e","     * @private","     */","    _setteamsmeeting: function(e) {","        var input,","            value;","","        e.preventDefault();","        this.getDialogue({","            focusAfterHide: null","        }).hide();","","        input = this._content.one('.url');","","        value = input.get('value');","        if (value !== '') {","","            // We add a prefix if it is not already prefixed.","            value = value.trim();","            var expr = new RegExp(/^[a-zA-Z]*\\.*\\/|^#|^[a-zA-Z]*:/);","            if (!expr.test(value)) {","                value = 'http://' + value;","            }","","            // Add the teamsmeeting.","            this._setteamsmeetingOnSelection(value);","","            this.markUpdated();","        }","    },","","    /**","     * Final step setting the anchor on the selection.","     *","     * @private","     * @method _setteamsmeetingOnSelection","     * @param  {String} url URL the teamsmeeting will point to.","     * @return {Node} The added Node.","     */","    _setteamsmeetingOnSelection: function(url) {","        var host = this.get('host'),","            teamsmeeting,","            selectednode,","            target,","            anchornodes;","","        this.editor.focus();","        host.setSelection(this._currentSelection);","","        if (this._currentSelection[0].collapsed) {","            // Firefox cannot add teamsmeetings when the selection is empty so we will add it manually.","            teamsmeeting = Y.Node.create('<a>' + url + '</a>');","            teamsmeeting.setAttribute('href', url);","","            // Add the node and select it to replicate the behaviour of execCommand.","            selectednode = host.insertContentAtFocusPoint(teamsmeeting.get('outerHTML'));","            host.setSelection(host.getSelectionFromNode(selectednode));","        } else {","            document.execCommand('unlink', false, null);","            document.execCommand('createlink', false, url);","","            // Now set the target.","            selectednode = host.getSelectionParentNode();","        }","","        // Note this is a document fragment and YUI doesn't like them.","        if (!selectednode) {","            return;","        }","","        anchornodes = this._findSelectedAnchors(Y.one(selectednode));","        // Add new window attributes if requested.","        Y.Array.each(anchornodes, function(anchornode) {","            target = this._content.one('.newwindow');","            if (target.get('checked')) {","                anchornode.setAttribute('target', '_blank');","            } else {","                anchornode.removeAttribute('target');","            }","        }, this);","","        return selectednode;","    },","","    /**","     * Look up and down for the nearest anchor tags that are least partly contained in the selection.","     *","     * @method _findSelectedAnchors","     * @param {Node} node The node to search under for the selected anchor.","     * @return {Node|Boolean} The Node, or false if not found.","     * @private","     */","    _findSelectedAnchors: function(node) {","        var tagname = node.get('tagName'),","            hit, hits;","","        // Direct hit.","        if (tagname && tagname.toLowerCase() === 'a') {","            return [node];","        }","","        // Search down but check that each node is part of the selection.","        hits = [];","        node.all('a').each(function(n) {","            if (!hit && this.get('host').selectionContainsNode(n)) {","                hits.push(n);","            }","        }, this);","        if (hits.length > 0) {","            return hits;","        }","        // Search up.","        hit = node.ancestor('a');","        if (hit) {","            return [hit];","        }","        return [];","    },","","    /**","     * Generates the content of the dialogue.","     *","     * @method _getDialogueContent","     * @return {Node} Node containing the dialogue content","     * @private","     */","    _getDialogueContent: function() {","        var template = Y.Handlebars.compile(TEMPLATE);","","        this._content = Y.Node.create(template({","            clientdomain: this._clientdomain,","            appurl: this._appurl,","            locale: this._locale,","            component: COMPONENTNAME,","            CSS: CSS","        }));","","        this._content.one('.submit').on('click', this._setteamsmeeting, this);","","        this._content.one('iframe').on('load', this._meetingcheck, this);","","        return this._content;","    }","}, {","    ATTRS: {","        /**","         * The domain of client.","         *","         * @attribute allowedmethods","         * @type String","         */","        clientdomain: {","            value: null","        },","        /**","         * The meeting app url.","         *","         * @attribute allowedmethods","         * @type String","         */","        appurl: {","            value: null","        },","        /**","         * User locale.","         *","         * @attribute allowedmethods","         * @type String","         */","        locale: {","            value: null","        }","    }","});","","","}, '@VERSION@', {\"requires\": [\"moodle-editor_atto-plugin\"]});","","}());"]};
}
__cov__3A0NvTgdEoIoqXY36ZPuw = __cov__3A0NvTgdEoIoqXY36ZPuw['build/moodle-atto_teamsmeeting-button/moodle-atto_teamsmeeting-button.js'];
__cov__3A0NvTgdEoIoqXY36ZPuw.s['1']++;YUI.add('moodle-atto_teamsmeeting-button',function(Y,NAME){__cov__3A0NvTgdEoIoqXY36ZPuw.f['1']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['2']++;var COMPONENTNAME='atto_teamsmeeting',CSS={NEWWINDOW:'atto_teamsmeeting_openinnewwindow',URLINPUT:'atto_teamsmeeting_urlentry'},SELECTORS={URLINPUT:'.atto_teamsmeeting_urlentry'},TEMPLATE=''+'<form class="atto_form">'+'<div class="meeting-app">'+'<label class="meeting-app-label" for="meetingapp">'+'{{get_string "createteamsmeeting" component}}'+'</label>'+'<iframe id="meetingapp" src="{{appurl}}?url={{clientdomain}}&locale={{locale}}"></iframe>'+'</div>'+'<div class="mb-1">'+'<label for="{{elementid}}_atto_teamsmeeting_urlentry">{{get_string "meetingurl" component}}</label>'+'<input class="form-control fullwidth url {{CSS.URLINPUT}}" type="url" '+'id="{{elementid}}_atto_teamsmeeting_urlentry" size="32" disabled="disabled"/>'+'</div>'+'<div class="form-check">'+'<input type="checkbox" class="form-check-input newwindow" id="{{elementid}}_{{CSS.NEWWINDOW}}"/>'+'<label class="form-check-label" for="{{elementid}}_{{CSS.NEWWINDOW}}">'+'{{get_string "openinnewwindow" component}}'+'</label>'+'</div>'+'<div class="mdl-align">'+'<br/>'+'<button type="submit" class="btn btn-secondary submit">{{get_string "addlink" component}}</button>'+'</div>'+'</form>';__cov__3A0NvTgdEoIoqXY36ZPuw.s['3']++;Y.namespace('M.atto_teamsmeeting').Button=Y.Base.create('button',Y.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_content:null,_clientdomain:null,_appurl:null,_locale:null,initializer:function(){__cov__3A0NvTgdEoIoqXY36ZPuw.f['2']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['4']++;this._clientdomain=this.get('clientdomain');__cov__3A0NvTgdEoIoqXY36ZPuw.s['5']++;this._appurl=this.get('appurl');__cov__3A0NvTgdEoIoqXY36ZPuw.s['6']++;this._locale=this.get('locale');__cov__3A0NvTgdEoIoqXY36ZPuw.s['7']++;this.addButton({icon:'icon',iconComponent:'atto_teamsmeeting',callback:this._displayDialogue,tags:'a',tagMatchRequiresAll:false});},_displayDialogue:function(){__cov__3A0NvTgdEoIoqXY36ZPuw.f['3']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['8']++;this._currentSelection=this.get('host').getSelection();__cov__3A0NvTgdEoIoqXY36ZPuw.s['9']++;if(this._currentSelection===false){__cov__3A0NvTgdEoIoqXY36ZPuw.b['1'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['10']++;return;}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['1'][1]++;}__cov__3A0NvTgdEoIoqXY36ZPuw.s['11']++;var dialogue=this.getDialogue({headerContent:M.util.get_string('createteamsmeeting',COMPONENTNAME),width:'auto',focusAfterHide:true,focusOnShowSelector:SELECTORS.URLINPUT});__cov__3A0NvTgdEoIoqXY36ZPuw.s['12']++;dialogue.set('bodyContent',this._getDialogueContent());__cov__3A0NvTgdEoIoqXY36ZPuw.s['13']++;this._resolveAnchors();__cov__3A0NvTgdEoIoqXY36ZPuw.s['14']++;dialogue.show();},_resolveAnchors:function(){__cov__3A0NvTgdEoIoqXY36ZPuw.f['4']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['15']++;var selectednode=this.get('host').getSelectionParentNode(),anchornodes,anchornode,url,target;__cov__3A0NvTgdEoIoqXY36ZPuw.s['16']++;if(!selectednode){__cov__3A0NvTgdEoIoqXY36ZPuw.b['2'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['17']++;return;}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['2'][1]++;}__cov__3A0NvTgdEoIoqXY36ZPuw.s['18']++;anchornodes=this._findSelectedAnchors(Y.one(selectednode));__cov__3A0NvTgdEoIoqXY36ZPuw.s['19']++;if(anchornodes.length>0){__cov__3A0NvTgdEoIoqXY36ZPuw.b['3'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['20']++;anchornode=anchornodes[0];__cov__3A0NvTgdEoIoqXY36ZPuw.s['21']++;this._currentSelection=this.get('host').getSelectionFromNode(anchornode);__cov__3A0NvTgdEoIoqXY36ZPuw.s['22']++;url=anchornode.getAttribute('href');__cov__3A0NvTgdEoIoqXY36ZPuw.s['23']++;target=anchornode.getAttribute('target');__cov__3A0NvTgdEoIoqXY36ZPuw.s['24']++;if(url!==''){__cov__3A0NvTgdEoIoqXY36ZPuw.b['4'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['25']++;this._content.one('.url').setAttribute('value',url);__cov__3A0NvTgdEoIoqXY36ZPuw.s['26']++;var ajaxurl=M.cfg.wwwroot+'/lib/editor/atto/plugins/teamsmeeting/ajax.php';__cov__3A0NvTgdEoIoqXY36ZPuw.s['27']++;var params={url:url};__cov__3A0NvTgdEoIoqXY36ZPuw.s['28']++;Y.io(ajaxurl,{context:this,data:params,timeout:500,on:{complete:this._updateIframe}});}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['4'][1]++;}__cov__3A0NvTgdEoIoqXY36ZPuw.s['29']++;if(target==='_blank'){__cov__3A0NvTgdEoIoqXY36ZPuw.b['5'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['30']++;this._content.one('.newwindow').setAttribute('checked','checked');}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['5'][1]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['31']++;this._content.one('.newwindow').removeAttribute('checked');}}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['3'][1]++;}},_meetingcheck:function(){__cov__3A0NvTgdEoIoqXY36ZPuw.f['5']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['32']++;if(document.getElementById('meetingapp').contentDocument){__cov__3A0NvTgdEoIoqXY36ZPuw.b['6'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['33']++;var url=document.getElementById('meetingapp').contentDocument.location;__cov__3A0NvTgdEoIoqXY36ZPuw.s['34']++;if((__cov__3A0NvTgdEoIoqXY36ZPuw.b['8'][0]++,url!=='')&&(__cov__3A0NvTgdEoIoqXY36ZPuw.b['8'][1]++,url.pathname.indexOf('teamsmeeting')>-1)){__cov__3A0NvTgdEoIoqXY36ZPuw.b['7'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['35']++;var link=this._getqueryvariable('link',url);__cov__3A0NvTgdEoIoqXY36ZPuw.s['36']++;var input=this._content.one('.url');__cov__3A0NvTgdEoIoqXY36ZPuw.s['37']++;input.set('value',link);}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['7'][1]++;}}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['6'][1]++;}},_updateIframe:function(id,data){__cov__3A0NvTgdEoIoqXY36ZPuw.f['6']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['38']++;if(data.status===200){__cov__3A0NvTgdEoIoqXY36ZPuw.b['9'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['39']++;var dataobject=JSON.parse(data.responseText);__cov__3A0NvTgdEoIoqXY36ZPuw.s['40']++;if(dataobject[2]!==null){__cov__3A0NvTgdEoIoqXY36ZPuw.b['10'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['41']++;var url=dataobject[0]+'?title='+dataobject[1]+'&link='+encodeURIComponent(dataobject[2])+'&options='+encodeURIComponent(dataobject[3]);__cov__3A0NvTgdEoIoqXY36ZPuw.s['42']++;this._content.one('#meetingapp').set('src',url);}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['10'][1]++;}}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['9'][1]++;}},_getqueryvariable:function(variable,url){__cov__3A0NvTgdEoIoqXY36ZPuw.f['7']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['43']++;var query=url.search.substring(1);__cov__3A0NvTgdEoIoqXY36ZPuw.s['44']++;var vars=query.split('&');__cov__3A0NvTgdEoIoqXY36ZPuw.s['45']++;for(var i=0;i<vars.length;i++){__cov__3A0NvTgdEoIoqXY36ZPuw.s['46']++;var pair=vars[i].split('=');__cov__3A0NvTgdEoIoqXY36ZPuw.s['47']++;if(decodeURIComponent(pair[0])==variable){__cov__3A0NvTgdEoIoqXY36ZPuw.b['11'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['48']++;return decodeURIComponent(pair[1]);}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['11'][1]++;}}},_setteamsmeeting:function(e){__cov__3A0NvTgdEoIoqXY36ZPuw.f['8']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['49']++;var input,value;__cov__3A0NvTgdEoIoqXY36ZPuw.s['50']++;e.preventDefault();__cov__3A0NvTgdEoIoqXY36ZPuw.s['51']++;this.getDialogue({focusAfterHide:null}).hide();__cov__3A0NvTgdEoIoqXY36ZPuw.s['52']++;input=this._content.one('.url');__cov__3A0NvTgdEoIoqXY36ZPuw.s['53']++;value=input.get('value');__cov__3A0NvTgdEoIoqXY36ZPuw.s['54']++;if(value!==''){__cov__3A0NvTgdEoIoqXY36ZPuw.b['12'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['55']++;value=value.trim();__cov__3A0NvTgdEoIoqXY36ZPuw.s['56']++;var expr=new RegExp(/^[a-zA-Z]*\.*\/|^#|^[a-zA-Z]*:/);__cov__3A0NvTgdEoIoqXY36ZPuw.s['57']++;if(!expr.test(value)){__cov__3A0NvTgdEoIoqXY36ZPuw.b['13'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['58']++;value='http://'+value;}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['13'][1]++;}__cov__3A0NvTgdEoIoqXY36ZPuw.s['59']++;this._setteamsmeetingOnSelection(value);__cov__3A0NvTgdEoIoqXY36ZPuw.s['60']++;this.markUpdated();}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['12'][1]++;}},_setteamsmeetingOnSelection:function(url){__cov__3A0NvTgdEoIoqXY36ZPuw.f['9']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['61']++;var host=this.get('host'),teamsmeeting,selectednode,target,anchornodes;__cov__3A0NvTgdEoIoqXY36ZPuw.s['62']++;this.editor.focus();__cov__3A0NvTgdEoIoqXY36ZPuw.s['63']++;host.setSelection(this._currentSelection);__cov__3A0NvTgdEoIoqXY36ZPuw.s['64']++;if(this._currentSelection[0].collapsed){__cov__3A0NvTgdEoIoqXY36ZPuw.b['14'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['65']++;teamsmeeting=Y.Node.create('<a>'+url+'</a>');__cov__3A0NvTgdEoIoqXY36ZPuw.s['66']++;teamsmeeting.setAttribute('href',url);__cov__3A0NvTgdEoIoqXY36ZPuw.s['67']++;selectednode=host.insertContentAtFocusPoint(teamsmeeting.get('outerHTML'));__cov__3A0NvTgdEoIoqXY36ZPuw.s['68']++;host.setSelection(host.getSelectionFromNode(selectednode));}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['14'][1]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['69']++;document.execCommand('unlink',false,null);__cov__3A0NvTgdEoIoqXY36ZPuw.s['70']++;document.execCommand('createlink',false,url);__cov__3A0NvTgdEoIoqXY36ZPuw.s['71']++;selectednode=host.getSelectionParentNode();}__cov__3A0NvTgdEoIoqXY36ZPuw.s['72']++;if(!selectednode){__cov__3A0NvTgdEoIoqXY36ZPuw.b['15'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['73']++;return;}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['15'][1]++;}__cov__3A0NvTgdEoIoqXY36ZPuw.s['74']++;anchornodes=this._findSelectedAnchors(Y.one(selectednode));__cov__3A0NvTgdEoIoqXY36ZPuw.s['75']++;Y.Array.each(anchornodes,function(anchornode){__cov__3A0NvTgdEoIoqXY36ZPuw.f['10']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['76']++;target=this._content.one('.newwindow');__cov__3A0NvTgdEoIoqXY36ZPuw.s['77']++;if(target.get('checked')){__cov__3A0NvTgdEoIoqXY36ZPuw.b['16'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['78']++;anchornode.setAttribute('target','_blank');}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['16'][1]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['79']++;anchornode.removeAttribute('target');}},this);__cov__3A0NvTgdEoIoqXY36ZPuw.s['80']++;return selectednode;},_findSelectedAnchors:function(node){__cov__3A0NvTgdEoIoqXY36ZPuw.f['11']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['81']++;var tagname=node.get('tagName'),hit,hits;__cov__3A0NvTgdEoIoqXY36ZPuw.s['82']++;if((__cov__3A0NvTgdEoIoqXY36ZPuw.b['18'][0]++,tagname)&&(__cov__3A0NvTgdEoIoqXY36ZPuw.b['18'][1]++,tagname.toLowerCase()==='a')){__cov__3A0NvTgdEoIoqXY36ZPuw.b['17'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['83']++;return[node];}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['17'][1]++;}__cov__3A0NvTgdEoIoqXY36ZPuw.s['84']++;hits=[];__cov__3A0NvTgdEoIoqXY36ZPuw.s['85']++;node.all('a').each(function(n){__cov__3A0NvTgdEoIoqXY36ZPuw.f['12']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['86']++;if((__cov__3A0NvTgdEoIoqXY36ZPuw.b['20'][0]++,!hit)&&(__cov__3A0NvTgdEoIoqXY36ZPuw.b['20'][1]++,this.get('host').selectionContainsNode(n))){__cov__3A0NvTgdEoIoqXY36ZPuw.b['19'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['87']++;hits.push(n);}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['19'][1]++;}},this);__cov__3A0NvTgdEoIoqXY36ZPuw.s['88']++;if(hits.length>0){__cov__3A0NvTgdEoIoqXY36ZPuw.b['21'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['89']++;return hits;}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['21'][1]++;}__cov__3A0NvTgdEoIoqXY36ZPuw.s['90']++;hit=node.ancestor('a');__cov__3A0NvTgdEoIoqXY36ZPuw.s['91']++;if(hit){__cov__3A0NvTgdEoIoqXY36ZPuw.b['22'][0]++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['92']++;return[hit];}else{__cov__3A0NvTgdEoIoqXY36ZPuw.b['22'][1]++;}__cov__3A0NvTgdEoIoqXY36ZPuw.s['93']++;return[];},_getDialogueContent:function(){__cov__3A0NvTgdEoIoqXY36ZPuw.f['13']++;__cov__3A0NvTgdEoIoqXY36ZPuw.s['94']++;var template=Y.Handlebars.compile(TEMPLATE);__cov__3A0NvTgdEoIoqXY36ZPuw.s['95']++;this._content=Y.Node.create(template({clientdomain:this._clientdomain,appurl:this._appurl,locale:this._locale,component:COMPONENTNAME,CSS:CSS}));__cov__3A0NvTgdEoIoqXY36ZPuw.s['96']++;this._content.one('.submit').on('click',this._setteamsmeeting,this);__cov__3A0NvTgdEoIoqXY36ZPuw.s['97']++;this._content.one('iframe').on('load',this._meetingcheck,this);__cov__3A0NvTgdEoIoqXY36ZPuw.s['98']++;return this._content;}},{ATTRS:{clientdomain:{value:null},appurl:{value:null},locale:{value:null}}});},'@VERSION@',{'requires':['moodle-editor_atto-plugin']});

define(["jquery","core/modal_factory","core/templates"],function($,ModalFactory,Templates){var module={};module.instances=[];module.first=true;module.medialinstance=function($,params){var minst={};minst.params=params;minst.firsttime=true;minst.openmodal=function(evt){evt.preventDefault();minst.modal.show();if(minst.firsttime){$("#mod_helixmedia_launchframe_"+minst.params.preid+minst.params.extraid).attr("src",minst.params.launchurl);minst.firsttime=false}};minst.initmodal=async function(){minst.modal=await ModalFactory.create({title:minst.params.title,body:Templates.render("mod_helixmedia/modalinner",minst.params),large:true})};minst.bind=function(){$("#helixmedia_ltimodal_"+minst.params.preid+minst.params.extraid).click(minst.openmodal);$("#helixmedia_ltimodalimg_"+minst.params.preid+minst.params.extraid).click(minst.openmodal);minst.initmodal()};minst.unbind=function(){$("#helixmedia_ltimodal_"+minst.params.preid+minst.params.extraid).unbind("click");$("#helixmedia_ltimodalimg_"+minst.params.preid+minst.params.extraid).unbind("click")};return minst};module.init=function(frameid,launchurl,thumburl,resID,userID,statusURL,oauthConsumerKey,doStatusCheck,sessionURL,sessionFreq,resDelay,extraID,title,library){if(typeof module.instances[resID+extraID]!=="undefined"){module.instances[resID+extraID].unbind()}var params={};params.launchurl=launchurl;params.userID=userID;params.preid=resID;params.extraid=extraID;params.title=title;if(library||doStatusCheck){params.larger=true}else{params.viewonly=true}var medialhandler=module.medialinstance($,params);module.instances[resID+extraID]=medialhandler;medialhandler.bind()};return module});

{"version":3,"sources":["../src/navigation.js"],"names":["define","$","t","CSS","QUESTION_CONTENT","SELECTABLE_WORD","tableMatrix","init","questionContent","words","find","length","lineCounter","previousY","parseInt","position","top","columnCounter","rows","i","wordEle","isTable","parent","closest","currentTableColNo","currentItem","id","attr","value","text","on","e","keyCode","preventDefault","currentWordPos","getWordPosition","navigateToWord","row","col","hasClass","shiftKey","which","addClass","focusout","removeClass","currentRow","j","nextCellId","focus"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This class provides functionality for the keyboard navigation.\n *\n * @package    qtype_wordselect\n * @copyright  2019 Marcus Green\n * @author     Huong Nguyen <huongnv13@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery'], function($) {\n    /**\n     * @alias qtype_wordselect/navigation\n     */\n    var t = {\n\n        /**\n         * CSS selector.\n         */\n        CSS: {\n            QUESTION_CONTENT: '.qtext',\n            SELECTABLE_WORD: 'span.selectable'\n        },\n\n        /**\n         * List of rows and columns of words.\n         */\n        tableMatrix: [],\n\n        /**\n         * Initialise the navigation.\n         */\n        init: function() {\n            var questionContent = $(t.CSS.QUESTION_CONTENT);\n            var words = questionContent.find(t.CSS.SELECTABLE_WORD);\n            if (words.length === 0) {\n                // Question must be in read-only mode.\n                return;\n            }\n\n            var lineCounter = 0;\n            var previousY = parseInt($(words[0]).position().top, 10);\n            var columnCounter = 0;\n            var rows = [];\n\n            for (var i = 0; i < words.length; i++) {\n                var wordEle = $(words[i]);\n                var isTable = wordEle.parent().closest('table').length;\n                var currentTableColNo = 0;\n                if (isTable) {\n                    currentTableColNo = wordEle.parent().closest('table').find('tr:first td').length;\n                }\n                if (parseInt(wordEle.position().top, 10) !== previousY || (isTable && columnCounter === currentTableColNo)) {\n                    // Next line or next row.\n                    columnCounter = 0;\n                    lineCounter++;\n                }\n                if (typeof rows[lineCounter] === 'undefined') {\n                    rows[lineCounter] = [];\n                }\n                var currentItem = [];\n                currentItem.id = wordEle.attr('id');\n                currentItem.value = wordEle.text();\n                rows[lineCounter][columnCounter] = currentItem;\n                previousY = parseInt(wordEle.position().top, 10);\n                columnCounter++;\n            }\n            t.tableMatrix = rows;\n\n            $(t.CSS.SELECTABLE_WORD).on('keydown', function(e) {\n                if (e.keyCode === 37 || e.keyCode === 38 || e.keyCode === 39 || e.keyCode === 40) {\n                    e.preventDefault();\n                    var currentWordPos = t.getWordPosition($(this).attr('id'));\n                    t.navigateToWord(currentWordPos.row, currentWordPos.col, e.keyCode);\n                }\n            });\n\n            $(t.CSS.SELECTABLE_WORD).on('keyup', function(e) {\n                // Handle keyboard focus.\n                if ($(this).hasClass('selected') && (\n                    e.keyCode === 9 || (e.shiftKey && (e.which === 9)) ||\n                    e.keyCode === 37 || e.keyCode === 38 || e.keyCode === 39 || e.keyCode === 40)) {\n                    e.preventDefault();\n                    $(this).addClass('keyboard_focus');\n                }\n            });\n\n            $(t.CSS.SELECTABLE_WORD).focusout(function() {\n                if ($(this).hasClass('selected') && $(this).hasClass('keyboard_focus')) {\n                    $(this).removeClass('keyboard_focus');\n                }\n            });\n        },\n\n        /**\n         *\n         * Get the given word position.\n         *\n         * @param {String} id Id of word need to get the position\n         * @returns {boolean|{col: number, row: number}}\n         */\n        getWordPosition: function(id) {\n            for (var i = 0; i < t.tableMatrix.length; i++) {\n                var currentRow = t.tableMatrix[i];\n                for (var j = 0; j < currentRow.length; j++) {\n                    if (currentRow[j].id === id) {\n                        return {\n                            'row': i,\n                            'col': j\n                        };\n                    }\n                }\n            }\n            return false;\n        },\n\n        /**\n         *\n         * Calculate and set keyboard focus to specific word.\n         *\n         * @param {int} row Current focus row index\n         * @param {int} col Current focus column index\n         * @param {int} keyCode Code of keypress\n         */\n        navigateToWord: function(row, col, keyCode) {\n            if (typeof t.tableMatrix[row] !== 'undefined' && typeof t.tableMatrix[row][col] !== 'undefined') {\n                var nextCellId = '';\n                if (keyCode === 37) {\n                    // Left arrow.\n                    if (typeof t.tableMatrix[row][col - 1] !== 'undefined') {\n                        nextCellId = t.tableMatrix[row][col - 1].id;\n                    } else if (typeof t.tableMatrix[row - 1] !== 'undefined' &&\n                        typeof t.tableMatrix[row - 1][t.tableMatrix[row - 1].length - 1] !== 'undefined') {\n                        // Previous line, last word.\n                        nextCellId = t.tableMatrix[row - 1][t.tableMatrix[row - 1].length - 1].id;\n                    }\n                } else if (keyCode === 38) {\n                    // Up arrow.\n                    if (typeof t.tableMatrix[row - 1] !== 'undefined' && typeof t.tableMatrix[row - 1][0] !== 'undefined') {\n                        nextCellId = t.tableMatrix[row - 1][0].id;\n                    }\n                } else if (keyCode === 39) {\n                    // Right arrow.\n                    if (typeof t.tableMatrix[row][col + 1] !== 'undefined') {\n                        nextCellId = t.tableMatrix[row][col + 1].id;\n                    } else if (typeof t.tableMatrix[row + 1] !== 'undefined' && typeof t.tableMatrix[row + 1][0] !== 'undefined') {\n                        // Next line, first word.\n                        nextCellId = t.tableMatrix[row + 1][0].id;\n                    }\n                } else if (keyCode === 40) {\n                    // Down arrow.\n                    if (typeof t.tableMatrix[row + 1] !== 'undefined' && typeof t.tableMatrix[row + 1][0] !== 'undefined') {\n                        // Next line, first word.\n                        nextCellId = t.tableMatrix[row + 1][0].id;\n                    }\n                }\n                $(\"span[name='\" + nextCellId + \"']\").focus();\n            }\n        }\n    };\n\n    return t;\n});\n"],"file":"navigation.min.js"}
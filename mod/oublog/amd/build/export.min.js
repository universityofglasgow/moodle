/**
 * JavaScript to manage export feature.
 *
 * @package mod_oublog
 * @copyright 2018 The Open University
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_oublog/export",["jquery"],(function($){var t;return t={CSS:{SELECTALLPOST:'button[name="oublog-export-select-all"]',SELECTNONE:'button[name="oublog-export-select-none"]',CHECKBOXS:'.oublog-posts-table input[type="checkbox"]',EXPORTSELECTED:'button[name="oublog-export-selected"]',EXPORTTYPE:"#oublog-export-type"},mconfig:null,contentIds:[],init:function(options){t.mconfig=options,null!==sessionStorage.getItem("contentIds")&&!0!==t.mconfig.newsession&&(t.contentIds=JSON.parse(sessionStorage.getItem("contentIds"))),$(t.CSS.SELECTALLPOST).on("click",t.selectAll.bind(t)),$(t.CSS.SELECTNONE).on("click",t.selectNone.bind(t)),$(t.CSS.CHECKBOXS).on("click",t.selectPost.bind(t)),$(t.CSS.EXPORTSELECTED).on("click",t.exportSelected.bind(t)),t.initSelectedPost(),t.initButtonState()},selectAll:function(){$(t.CSS.CHECKBOXS).prop("checked",!0),$(t.CSS.SELECTALLPOST).prop("disabled",!0),$(t.CSS.SELECTALLPOST).blur(),$(t.CSS.SELECTNONE).prop("disabled",!1),$(t.CSS.EXPORTSELECTED).prop("disabled",!1),$(t.CSS.CHECKBOXS).each((function(){$(this).prop("checked")&&t.addPost($(this).val())}))},selectNone:function(){$(t.CSS.CHECKBOXS).prop("checked",!1),$(t.CSS.SELECTALLPOST).prop("disabled",!1),$(t.CSS.SELECTNONE).prop("disabled",!0),$(t.CSS.SELECTNONE).blur(),$(t.CSS.EXPORTSELECTED).prop("disabled",!0),$(t.CSS.CHECKBOXS).each((function(){$(this).prop("checked")||t.removePost($(this).val())}))},selectPost:function(event){1==event.target.checked?t.addPost(event.target.value):t.removePost(event.target.value),t.initButtonState()},initSelectedPost:function(){$(t.CSS.CHECKBOXS).each((function(){-1!==t.contentIds.indexOf($(this).val())&&$(this).prop("checked",!0)}))},exportSelected:function(){if(t.contentIds.length>0){var exportUrl=$(t.CSS.EXPORTSELECTED).data("url"),exportType=$(t.CSS.EXPORTTYPE).val();exportUrl=this.updateQueryStringParameter(exportUrl,"instance",String(exportType)),exportUrl=this.updateQueryStringParameter(exportUrl,"ca_postids",t.contentIds.join("|")),sessionStorage.removeItem("contentIds"),t.contentIds=[],window.location.href=exportUrl}},removePost:function(postId){var index=t.contentIds.indexOf(postId);-1!==index&&(t.contentIds.splice(index,1),sessionStorage.setItem("contentIds",JSON.stringify(t.contentIds)))},addPost:function(postId){-1===t.contentIds.indexOf(postId)&&(t.contentIds.push(postId),sessionStorage.setItem("contentIds",JSON.stringify(t.contentIds)))},initButtonState:function(){var uncheckBoxes=0,boxquantity=0;$(t.CSS.CHECKBOXS).each((function(){0==$(this).prop("checked")&&uncheckBoxes++,boxquantity++})),$(t.CSS.SELECTALLPOST).prop("disabled",0==uncheckBoxes),$(t.CSS.SELECTNONE).prop("disabled",uncheckBoxes==boxquantity),$(t.CSS.EXPORTSELECTED).prop("disabled",0==t.contentIds.length)},updateQueryStringParameter:function(uri,key,value){var re=new RegExp("([?&])"+key+"=.*?(&|$)","i"),separator=-1!==uri.indexOf("?")?"&":"?";return uri.match(re)?uri.replace(re,"$1"+key+"="+value+"$2"):uri+separator+key+"="+value}}}));

//# sourceMappingURL=export.min.js.map
/**
 * This class provides functionality for the keyboard navigation.
 *
 * @copyright  2019 Marcus Green
 * @author     Huong Nguyen <huongnv13@gmail.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_wordselect/navigation",["jquery"],(function($){var t={CSS:{QUESTION_CONTENT:".qtext",SELECTABLE_WORD:"span.selectable"},tableMatrix:[],init:function(){var words=$(t.CSS.QUESTION_CONTENT).find(t.CSS.SELECTABLE_WORD);if(0!==words.length){for(var lineCounter=0,previousY=parseInt($(words[0]).position().top,10),columnCounter=0,rows=[],i=0;i<words.length;i++){var wordEle=$(words[i]),isTable=wordEle.parent().closest("table").length,currentTableColNo=0;isTable&&(currentTableColNo=wordEle.parent().closest("table").find("tr:first td").length),(parseInt(wordEle.position().top,10)!==previousY||isTable&&columnCounter===currentTableColNo)&&(columnCounter=0,lineCounter++),void 0===rows[lineCounter]&&(rows[lineCounter]=[]);var currentItem=[];currentItem.id=wordEle.attr("id"),currentItem.value=wordEle.text(),rows[lineCounter][columnCounter]=currentItem,previousY=parseInt(wordEle.position().top,10),columnCounter++}t.tableMatrix=rows,$(t.CSS.SELECTABLE_WORD).on("keydown",(function(e){if(37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode){e.preventDefault();var currentWordPos=t.getWordPosition($(this).attr("id"));t.navigateToWord(currentWordPos.row,currentWordPos.col,e.keyCode)}})),$(t.CSS.SELECTABLE_WORD).on("keyup",(function(e){$(this).hasClass("selected")&&(9===e.keyCode||e.shiftKey&&9===e.which||37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode)&&(e.preventDefault(),$(this).addClass("keyboard_focus"))})),$(t.CSS.SELECTABLE_WORD).focusout((function(){$(this).hasClass("selected")&&$(this).hasClass("keyboard_focus")&&$(this).removeClass("keyboard_focus")}))}},getWordPosition:function(id){for(var i=0;i<t.tableMatrix.length;i++)for(var currentRow=t.tableMatrix[i],j=0;j<currentRow.length;j++)if(currentRow[j].id===id)return{row:i,col:j};return!1},navigateToWord:function(row,col,keyCode){if(void 0!==t.tableMatrix[row]&&void 0!==t.tableMatrix[row][col]){var nextCellId="";37===keyCode?void 0!==t.tableMatrix[row][col-1]?nextCellId=t.tableMatrix[row][col-1].id:void 0!==t.tableMatrix[row-1]&&void 0!==t.tableMatrix[row-1][t.tableMatrix[row-1].length-1]&&(nextCellId=t.tableMatrix[row-1][t.tableMatrix[row-1].length-1].id):38===keyCode?void 0!==t.tableMatrix[row-1]&&void 0!==t.tableMatrix[row-1][0]&&(nextCellId=t.tableMatrix[row-1][0].id):39===keyCode?void 0!==t.tableMatrix[row][col+1]?nextCellId=t.tableMatrix[row][col+1].id:void 0!==t.tableMatrix[row+1]&&void 0!==t.tableMatrix[row+1][0]&&(nextCellId=t.tableMatrix[row+1][0].id):40===keyCode&&void 0!==t.tableMatrix[row+1]&&void 0!==t.tableMatrix[row+1][0]&&(nextCellId=t.tableMatrix[row+1][0].id),$("span[name='"+nextCellId+"']").focus()}}};return t}));

//# sourceMappingURL=navigation.min.js.map
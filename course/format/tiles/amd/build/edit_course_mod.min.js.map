{"version":3,"file":"edit_course_mod.min.js","sources":["../src/edit_course_mod.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/* eslint space-before-function-paren: 0 */\n\n/**\n * Javascript Module to handle edit actions on course modules.\n *\n * @module      format_tiles/edit_course_mod\n * @copyright   2018 David Watson {@link http://evolutioncode.uk}\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since       Moodle 3.3\n */\n\ndefine([\"jquery\", \"core/ajax\", \"core/templates\", \"core/notification\", \"core/str\", \"core/url\", \"core/config\"],\n    function ($, ajax, Templates, Notification, str, url, config) {\n        \"use strict\";\n\n        /**\n         * Keep references for all modals we have already added to the page,\n         * so that we can relaunch then if needed without asking server\n         * @type {{}}\n         */\n        var stringStore = {};\n\n        var body = $(\"html,body\");\n        var page = $(\"#page\");\n\n        var Selector = {\n            MENU_ACTION: \".menu-action-text\",\n            SUBTILE: \".subtile\",\n            SPACER: \".spacer\",\n            AVAIL_INFO: \".availabilityinfo\",\n            ACTIVITY_INSTANCE: \".subtile-activityinstance\",\n            INSTANCE_NAME: \".instancename\",\n            SECTION_CM_EDIT_ACTIONS: \".section-cm-edit-actions\",\n            EDITING_MOVE: \".editing_move\",\n            CM_EDIT_ACTION: \".cm-edit-action\",\n            ACTIVITY_ICON: \".activityicon\",\n            EDITING_DELETE: \".editing_delete\",\n            SECTION_MAIN: \".section.main\",\n            STEALTH_UNAVAIL_LINK: '.editing_makeunavailable'\n        };\n\n        var ClassNames = {\n            SHOW: \"show\",\n            HIDE: \"hide\",\n            FA_EYE_SLASH: \"fa-eye-slash\",\n            FA_EYE: \"fa-eye\",\n            DIMMED: \"dimmed\",\n            EDITING: \"editing_\",\n            ACTIVITY: \"activity\",\n            LABEL: \"label\",\n            SECTION_DRAGGABLE: \"sectiondraggable\"\n        };\n\n        var Event = {\n            CLICK: \"click\",\n            MODULE_ADDED: \"filter-content-updated\",\n            MOUSEDOWN: \"mousedown\"\n        };\n\n        /**\n         * This dates from before the change to using AJAX for editing teacher content.\n         * Once the new functionality is no longer experimental, this can be removed.\n         *\n         *  If an editing user clicks a show/hide menu item on a course module\n         * @param {object} clickEvent\n         */\n        var legacyToggleHideCourseMod = function (clickEvent) {\n            var clickedLink = $(clickEvent.currentTarget);\n            var actions;\n            if (clickedLink.attr(\"data-action\") === \"tiles-hide\") {\n                actions = {changeTo: ClassNames.HIDE, old: ClassNames.SHOW};\n                $(Selector.STEALTH_UNAVAIL_LINK).hide();\n            } else if (clickedLink.attr(\"data-action\") === \"tiles-show\") {\n                actions = {changeTo: ClassNames.SHOW, old: ClassNames.HIDE};\n            }\n            if (actions) {\n                clickEvent.preventDefault();\n                clickedLink.attr(\"data-action\", \"tiles-\" + actions.old);\n                var promises = ajax.call([{\n                    methodname: \"core_course_edit_module\",\n                    args: {\n                        id: clickedLink.attr(\"data-cmid\"),\n                        action: actions.changeTo\n                    }\n                }], true);\n                promises[0].done(function (HTMLresult) {\n                    // This core web service returns the new HTML for the course module.\n                    // However we don't want to use it, as we are using different templates for the CM.\n                    // To save re-implementing the core function, we replace elements in the old HTML instead of new.\n                    // TODO - consider if it is preferable to re-implement the core function or re-render CM.\n\n                    clickedLink.removeClass(ClassNames.EDITING + actions.old).addClass(ClassNames.EDITING + actions.changeTo);\n                    clickedLink.attr(\n                        \"href\", clickedLink.attr(\"href\").replace(\"&\" + actions.old + \"=\", \"&\" + actions.changeTo + \"=\")\n                    );\n                    // Replace the string on the menu item to \"Hide\" or \"Show\", and icon, as appropriate to reflect new state.\n                    var menuActionText = clickedLink.find(Selector.MENU_ACTION);\n                    var subtile = clickedLink.closest(Selector.SUBTILE);\n                    if (actions.changeTo === ClassNames.SHOW) {\n                        menuActionText.html(menuActionText.html().replace(stringStore.show, stringStore.hide));\n                        clickedLink.find(\"i\").removeClass(ClassNames.FA_EYE_SLASH).addClass(ClassNames.FA_EYE);\n                        subtile.removeClass(ClassNames.DIMMED); // Dim the related sub-tile.\n                    } else if (actions.changeTo === ClassNames.HIDE) {\n                        menuActionText.html(menuActionText.html().replace(stringStore.hide, stringStore.show));\n                        clickedLink.find(\"i\").removeClass(ClassNames.FA_EYE).addClass(ClassNames.FA_EYE_SLASH); // Replace the icon.\n                        subtile.addClass(ClassNames.DIMMED);\n                    }\n                    // Now replace the availability info displayed on the sub tile.\n                    var newAvailabilityInfo = $(HTMLresult).find(Selector.AVAIL_INFO);\n                    var oldAvailabilityInfo = subtile.find(Selector.AVAIL_INFO);\n                    if (newAvailabilityInfo) {\n                        if (oldAvailabilityInfo.length) {\n                            oldAvailabilityInfo.replaceWith(newAvailabilityInfo);\n                        } else {\n                            newAvailabilityInfo.appendTo(subtile.find(Selector.ACTIVITY_INSTANCE));\n                        }\n                    } else {\n                        oldAvailabilityInfo.hide();\n                    }\n                });\n                promises[0].fail(function () {\n                    // We failed to use JS to handle so refer user to the original PHP URL instead.\n                    window.location.replace(clickedLink.attr(\"href\"));\n                });\n            }\n        };\n\n        /**\n         * This dates from before the change to using AJAX for editing teacher content.\n         * Once the new functionality is no longer experimental, this can be removed.\n         *\n         * When a new item is added to course by drag drop, we have to convert it to subtile format\n         * For this we need to know which class to add to it (e.g. ppt) so that it has the correct icon\n         * and colouring on the sub tile.  The easiest way to work this out is to use the icon URL\n         * from the standard activity\n         * @param {string} iconURL the icon URL oe.g. [wwwroot]/theme/image.php/boost/core/1535409577/f/pdf-24\n         * @returns {string} the type e.g. 'pdf'\n         */\n        var legacyFileTypeFromIconURL = function (iconURL) {\n            var extensions = {\n                powerpoint: \"ppt\",\n                document: \"doc\",\n                spreadsheet: \"xls\",\n                archive: \"zip\",\n                pdf: \"pdf\",\n                mp3: \"mp3\",\n                mpeg: \"mp4\",\n                jpeg: \"jpeg\",\n                text: \"txt\",\n                html: \"html\"\n            };\n            // Return the type corresponding to the last item in the URL, excluding anything after '-'.\n            return extensions[iconURL.split(\"/\").slice(-1)[0].split(\"-\")[0]];\n        };\n\n        /**\n         * This dates from before the change to using AJAX for editing teacher content.\n         * Once the new functionality is no longer experimental, this can be removed.\n         *\n         * When a new course module is dragged and dropped into the course\n         * we need its attributes so that we can convert it into a sub tile if needed\n         * This assembles them ready to be sent to the mustache template\n         *\n         * @param {object} cmObject the jquery object added\n         * @param {string} modResourceType type of module e.g. 'page'\n         * @param {string} displayname e.g. \"Spreadsheet\"\n         * @returns {object} promise for the module attributes\n         */\n        var legacyCourseModGetSubtileAttributes = function (cmObject, modResourceType, displayname) {\n            // TODO would be better to handle this whole function with a web service for cm data?\n            if (displayname === undefined || displayname === \"\") {\n                // Failed to get string for this type\n                displayname = stringStore.other; // Use \"other\" instead of proper word.\n            }\n            // We take the course module edit menu from the new CM which core added to the course.\n            // We remove the data-action attributes from the hide menu item, as we dont want it to call JS.\n            // if it called JS, the result would not only hide the item (good) but re-render it using standard core template (bad).\n            cmObject.find('a.cm-edit-action').each(function (index, editItem) {\n                $(editItem).attr('data-action', '');\n            });\n            cmObject.find('a.editing_moveright').remove(); // We do not use this with subtiles (indent).\n            var returnData = {\n                cmid: cmObject.attr(\"id\").split(\"-\").slice(-1)[0], // Last item.\n                activityname: cmObject.find(Selector.INSTANCE_NAME).html().split(\"<\")[0],\n                cmeditmenu: cmObject.find(Selector.SECTION_CM_EDIT_ACTIONS)[0].outerHTML.replace(/\\n/g, \"\"),\n                cmmove: cmObject.find(Selector.EDITING_MOVE)[0].outerHTML,\n                modname: \"resource\",\n                modResourceType: modResourceType,\n                modnameDisplay: displayname,\n                useSubtiles: 1,\n                isEmbeddedResource: 0,\n                clickable: 1,\n                isediting: 1,\n                visible: 1\n            };\n            returnData.isPdf = returnData.modResourceType === \"pdf\";\n            return returnData;\n        };\n\n        /**\n         * This dates from before the change to using AJAX for editing teacher content.\n         * Once the new functionality is no longer experimental, this can be removed.\n         * @param {number} courseId\n         * @param {object} addedCourseModule\n         * @param {object} sectionAddedTo\n         * @param {string} msg\n         */\n        var legacyHandleCmAddedToPage = function(courseId, addedCourseModule, sectionAddedTo, msg) {\n            if (sectionAddedTo.hasClass(ClassNames.SECTION_DRAGGABLE)\n                && window.location.href.indexOf('expand=') === -1) {\n                // An item has been dragged into a section when we are on the multi tile screen.\n                // However the section is not yet expanded.\n                // Therefore expand the section it has been dragged into so teacher can see it.\n                window.location = config.wwwroot + '/course/view.php?id=' + courseId\n                    + \"&expand=\" + sectionAddedTo.attr(\"data-section\")\n                    + \"#section-\" + sectionAddedTo.attr(\"data-section\");\n            } else if (addedCourseModule.hasClass(ClassNames.LABEL)\n                && addedCourseModule.closest('ul').hasClass('subtiles')) {\n                // The mod type is probably an image (being dragged in to the course.\n                // When this happens, core adds a label and puts it in.\n                // So allow this to happen, then reload the page.\n                // This ensures the image displays correctly (only bother if we are using subtiles).\n                window.location.reload();\n            } else if (\n                addedCourseModule.hasClass(ClassNames.ACTIVITY) && addedCourseModule.closest('ul').hasClass('subtiles')\n            ) {\n                // Only course modules and not (for example) user tours modal.\n                // If we are not using sub tiles in section zero, don't bother changing it there.\n                addedCourseModule.children().hide();\n                addedCourseModule.append($(\"<img/>\")\n                    .attr(\"src\", url.imageUrl(\"loading\", \"format_tiles\"))\n                    .addClass(\"loading-subtile\").attr('title', stringStore.loading));\n                var previousNonSpacer = addedCourseModule.prevAll(Selector.SUBTILE).not(Selector.SPACER).first();\n                addedCourseModule.prevUntil(previousNonSpacer, Selector.SPACER).hide();\n\n                // Get cmid, activityname, modnameDisplay, cmeditmenu of ite just added to course by AJAX.\n                // Re-render it in the correct style for this format (as sub tile).\n                var modResourceType = legacyFileTypeFromIconURL(addedCourseModule.find(Selector.ACTIVITY_ICON).attr(\"src\"));\n                if (modResourceType === undefined) {\n                    // We have probably dragged an image into the course and chosen to add it as a file resource.\n                    window.location.reload();\n                }\n                var stringKey = \"displaytitle_mod_\" + modResourceType;\n                if (stringStore[stringKey] === undefined) {\n                    str.get_string(stringKey, \"format_tiles\")\n                        .done(function (string) {\n                            if (string.substring(0, 2) !== \"[[\") {\n                                // The [[ means unknown string.\n                                stringStore[stringKey] = string;\n                            } else {\n                                string = \"\";\n                            }\n                            var cmAttributes = legacyCourseModGetSubtileAttributes(\n                                addedCourseModule, modResourceType, string\n                            );\n                            Templates.render(\n                                \"format_tiles/course_module\",\n                                cmAttributes\n                            ).done(function (html) {\n                                addedCourseModule.replaceWith(html);\n                                // Flash the new item to bring attention to it.\n                                var newItem = $(\"#\" + $(msg).attr(\"id\"));\n                                body.animate({scrollTop: newItem.offset().top - 130}, \"fast\");\n                                for (var x = 0; x < 3; x++) {\n                                    newItem.fadeOut(300).fadeIn(300);\n                                }\n                                // The move cm icon will not work, so if is clicked, we refresh page so it works.\n                                $('#module-' + cmAttributes.cmid).find('.editing_move')\n                                    .attr('data-action', '')\n                                    .on(Event.MOUSEDOWN, function() {\n                                        window.location.reload();\n                                    });\n                            });\n                        });\n                } else {\n                    var cmAttributes = legacyCourseModGetSubtileAttributes(\n                        addedCourseModule, modResourceType, stringStore[stringKey]\n                    );\n                    Templates.render(\"format_tiles/course_module\", cmAttributes).done(function (html) {\n                        addedCourseModule.replaceWith(html);\n                        // The move cm icon will not work, so if is clicked, we refresh page so it works.\n                        $('#module-' + cmAttributes.cmid).find('.editing_move')\n                            .attr('data-action', '')\n                            .on(Event.MOUSEDOWN, function() {\n                                window.location.reload();\n                            });\n                    });\n                }\n            } else {\n                // We are leaving the course module in the old style as added by core drag-drop.\n                // Adjust the inner div styling slightly to make it consistent with the others.\n                addedCourseModule.find('div.mod-indent-outer')\n                    .css('position', 'absolute').css('top', '0')\n                    .css('width', '100%').css('padding-left', '0');\n            }\n        };\n\n        return {\n            init: function (courseId) {\n                $(document).ready(function () {\n                    // This is to cover something which can happen when dragging and dropping a course module.\n                    // In course/amd/src/action.js is a method called M.course.coursebase.register_module.\n                    // This is called on each drag drop and results in tbe course module which is drag dropped,\n                    // and refreshed afterwards, changing  it in the process to a non tiles format.  This stops that.\n                    // Ugly but seems to work and can't see another easy way to stop it firing.\n                    Y.use(\"moodle-course-coursebase\", function () {\n                        // Clear existing instance variable to stop it - delay is to ensure page is loaded.\n                        if (typeof M.course !== \"undefined\") {\n                            setTimeout(function () {\n                                M.course.coursebase.registermodules = [];\n                            }, 500);\n                        }\n                    });\n\n                    // If user clicks show/hide on a course module.\n                    page.on(\"click\", Selector.CM_EDIT_ACTION, function (e) {\n                        legacyToggleHideCourseMod(e);\n                    });\n\n                    // Listen for new items being added to course by drag drop and convert them to subtile format.\n                    // Otherwise the core JS will add them to the page in standard \"list\" format.\n                    // This can be moved to edit_course once legacy functions are removed.\n                    $(document).on(Event.MODULE_ADDED, function (event, msg) {\n                        var addedCourseModule = $(\"#\" + $(msg).attr(\"id\"));\n                        var sectionAddedTo = addedCourseModule.closest(Selector.SECTION_MAIN);\n                        if (sectionAddedTo.length >= 1) {\n                            legacyHandleCmAddedToPage(courseId, addedCourseModule, sectionAddedTo, msg);\n                        }\n                    });\n\n                    // If the teacher deletes a subtile, we need to hide any \"spacer\" subtiles directly before it.\n                    // We want none between what was the previous activity to the one we just deleted, and the next.\n                    page.on(Event.CLICK, Selector.EDITING_DELETE, function (e) {\n                        var deletedItem = $(e.currentTarget).closest(\"li\" + ClassNames.ACTIVITY);\n                        var previousNonSpacer = deletedItem.prevAll(Selector.SUBTILE).not(Selector.SPACER).first();\n                        if (deletedItem.hasClass(ClassNames.LABEL)) {\n                            deletedItem.prevUntil(previousNonSpacer, Selector.SPACER).hide();\n                        }\n                    });\n\n                    str.get_strings([\n                        {key: \"yes\"},\n                        {key: \"no\"},\n                        {key: \"show\"},\n                        {key: \"hide\"},\n                        {key: \"areyousure\"},\n                        {key: \"complete\", component: \"format_tiles\"},\n                        {key: \"fileaddedtobottom\", component: \"format_tiles\"},\n                        {key: \"loading\", component: \"format_tiles\"}\n                    ]).done(function (s) {\n                        stringStore = {\n                            \"yes\": s[0],\n                            \"no\": s[1],\n                            \"show\": s[2],\n                            \"hide\": s[3],\n                            \"areyousure\": s[4],\n                            \"complete\": s[5],\n                            \"fileaddedtobottom\": s[6],\n                            \"loading\": s[7]\n                        };\n                    });\n                });\n            }\n        };\n    }\n);"],"names":["define","$","ajax","Templates","Notification","str","url","config","stringStore","body","page","Selector","ClassNames","Event","legacyCourseModGetSubtileAttributes","cmObject","modResourceType","displayname","undefined","other","find","each","index","editItem","attr","remove","returnData","cmid","split","slice","activityname","html","cmeditmenu","outerHTML","replace","cmmove","modname","modnameDisplay","useSubtiles","isEmbeddedResource","clickable","isediting","visible","isPdf","init","courseId","document","ready","Y","use","M","course","setTimeout","coursebase","registermodules","on","e","clickEvent","actions","clickedLink","currentTarget","changeTo","old","hide","preventDefault","promises","call","methodname","args","id","action","done","HTMLresult","removeClass","addClass","menuActionText","subtile","closest","show","newAvailabilityInfo","oldAvailabilityInfo","length","replaceWith","appendTo","fail","window","location","legacyToggleHideCourseMod","event","msg","addedCourseModule","sectionAddedTo","hasClass","href","indexOf","wwwroot","reload","children","append","imageUrl","loading","previousNonSpacer","prevAll","not","first","prevUntil","powerpoint","spreadsheet","archive","pdf","mp3","mpeg","jpeg","text","stringKey","get_string","string","substring","cmAttributes","render","newItem","animate","scrollTop","offset","top","x","fadeOut","fadeIn","css","legacyHandleCmAddedToPage","deletedItem","get_strings","key","component","s"],"mappings":"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"}
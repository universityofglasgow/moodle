YUI.add("moodle-atto_helixatto-button",function(e,t){var n="atto_helixatto",r='<form class="atto_form"><div id="{{elementid}}_{{innerform}}" class="mdl-align"><iframe style="border:0px;background:#ffffff;width:{{width}}px;height:{{height}}px;" src="{{iframesrc}}"></iframe><button id="medial_insert" class="{{CSS.INPUTSUBMIT}}">{{get_string "insert" component}}</button></div></form>',i={INPUTSUBMIT:"atto_media_urlentrysubmit",INPUTCANCEL:"atto_media_urlentrycancel"},s=-1,o=!1,u="",a=null,f="",l=null,c=935,h=435,p=!1;e.namespace("M.atto_helixatto").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){if(this.get("disabled"))return;this.addButton({icon:"ed/helixadd",iconComponent:"atto_helixatto",buttonName:"helixadd",callback:this._displayDialogue}),window.addEventListener("message",this._receiveMessage,!1),u=this.get("baseurl")+"/mod/helixmedia/launch.php",f=this},_receiveMessage:function(e){var t=e.data.indexOf("preid_");t==0&&(s=e.data.substring(6),a=setTimeout(f._checkStatus,5e3))},_checkStatus:function(){var e=null;typeof window.ActiveXObject!="undefined"?e=new ActiveXObject("Microsoft.XMLHTTP"):e=new XMLHttpRequest;var t="resource_link_id="+s+"&user_id="+f.get("userid");e.open("POST",f.get("statusurl"),!1),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(t);if(l!=null&&l.get("visible")==0){p=!1;return}e.responseText=="IN"&&(p=!0),e.responseText=="OUT"&&p==1?(p=!1,f._doInsert()):a=setTimeout(f._checkStatus,2e3)},_displayDialogue:function(t){t.preventDefault(),o=!1;var r=1e3,i=550;typeof window.innerWidth=="number"?(r=window.innerWidth-20,i=window.innerHeight-55):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)&&(r=document.documentElement.clientWidth-20,i=document.documentElement.clientHeight-55),r>1e3&&(r=1e3),i>1400&&(i=1400),c=r-50,h=i-90,l=this.getDialogue({headerContent:M.util.get_string("dialogtitle",n),width:r+"px",height:i+"px",draggable:!1}),l.width!==r+"px"&&l.set("width",r+"px");var s=this._getFormContent(),u=e.Node.create("<div></div>");u.append(s),l.set("bodyContent",u),l.show(),this.markUpdated(),f.get("hideinsert")=="1"&&(document.getElementById("medial_insert").style.visibility="hidden")},_getFormContent:function(){var t=e.Handlebars.compile(r),s=e.Node.create(t({elementid:this.get("host").get("elementid"),component:n,CSS:i,iframesrc:u+"?type=15",width:c,height:h}));return this._form=s,this._form.one("."+i.INPUTSUBMIT).on("click",this._doInsert,this),s},_doInsert:function(e){typeof e!="undefined"&&e.preventDefault();if(o)return;o=!0,this.getDialogue({focusAfterHide:null}).hide(),this.editor.focus();var t=u+"?type=10&l="+s,n='<p><iframe style="overflow:hidden;border:0px none;background:#ffffff;width:680px;height:570px;" src="'+t+'" id="hmlvid-'+s+'"></iframe>\n'+"</p>";this.get("host").insertContentAtFocusPoint(n),this.markUpdated()}},{ATTRS:{disabled:{value:!1},usercontextid:{value:null},baseurl:{value:""},statusurl:{value:""},userid:{value:""},hideinsert:{value:""},insertdelay:{value:""}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});

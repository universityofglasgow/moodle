define("block_newgu_spdetails/assessmentsummary",["exports","core/log","core/ajax","core/chartjs","core/notification","core/templates","block_newgu_spdetails/sorting"],(function(_exports,Log,ajax,_chartjs,_notification,_templates,_sorting){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,Log=_interopRequireWildcard(Log),ajax=_interopRequireWildcard(ajax),_templates=_interopRequireDefault(_templates),_sorting=_interopRequireDefault(_sorting);const Selectors_SUMMARY_BLOCK="#assessmentSummaryContainer",Selectors_COURSECONTENTS_BLOCK="#courseTab-container",Selectors_ASSESSMENTSDUE_BLOCK="#assessmentsDue-container",Selectors_ASSESSMENTSDUE_CONTENTS="#assessmentsdue_content",viewAssessmentSummaryByChartType=function(event,legendItem,legend){if(Log.debug("viewAssessmentSummaryByChartType called"),!document.querySelector("#student_dashboard")){const chartType=legendItem?legendItem.index:legend;let containerBlock=document.querySelector(Selectors_COURSECONTENTS_BLOCK);containerBlock&&containerBlock.checkVisibility()&&containerBlock.classList.add("hidden-container");let assessmentsDueBlock=document.querySelector(Selectors_ASSESSMENTSDUE_BLOCK),assessmentsDueContents=document.querySelector(Selectors_ASSESSMENTSDUE_CONTENTS);assessmentsDueBlock.children.length>0&&(assessmentsDueContents.innerHTML=""),assessmentsDueBlock.classList.remove("hidden-container"),assessmentsDueContents.insertAdjacentHTML("afterbegin","<div class='loader d-flex justify-content-center'>\n<div class='spinner-border' role='status'><span class='hidden'>Loading...</span></div></div>"),ajax.call([{methodname:"block_newgu_spdetails_get_assessmentsummarybytype",args:{charttype:chartType}}])[0].done((function(response){document.querySelector(".loader").remove();let assessmentdata=JSON.parse(response.result);_templates.default.renderForPromise("block_newgu_spdetails/assessmentsdue",{data:assessmentdata}).then((_ref=>{let{html:html,js:js}=_ref;_templates.default.appendNodeContents(assessmentsDueContents,html,js),returnToAssessmentsHandler();let sortColumns=document.querySelectorAll("#assessment_data_table .th-sortable");return sortingEventHandler(sortColumns),!0})).catch((error=>(0,_notification.exception)(error)))})).fail((function(response){if(response){document.querySelector(".loader").remove();let errorContainer=document.createElement("div");if(errorContainer.classList.add("alert","alert-danger"),response.hasOwnProperty("message")){let errorMsg=document.createElement("p");errorMsg.innerHTML=response.message,errorContainer.appendChild(errorMsg),errorMsg.classList.add("errormessage")}if(response.hasOwnProperty("moreinfourl")){let errorLinkContainer=document.createElement("p"),errorLink=document.createElement("a");errorLink.setAttribute("href",response.moreinfourl),errorLink.setAttribute("target","_blank"),errorLink.innerHTML="More information about this error",errorContainer.appendChild(errorLinkContainer),errorLinkContainer.appendChild(errorLink),errorLinkContainer.classList.add("errorcode")}assessmentsDueContents.prepend(errorContainer)}}))}},sortingEventHandler=rows=>{rows.length>0&&rows.forEach((element=>{element.addEventListener("click",(()=>(0,_sorting.default)(element.cellIndex,element.getAttribute("data-sortby"),"assessment_data_table")))}))},returnToAssessmentsHandler=()=>{document.querySelector("#assessments-due-return")&&(document.querySelector("#assessments-due-return").addEventListener("click",(()=>{let containerBlock=document.querySelector(Selectors_COURSECONTENTS_BLOCK);document.querySelector(Selectors_ASSESSMENTSDUE_BLOCK).classList.add("hidden-container"),containerBlock.classList.remove("hidden-container")})),document.querySelector("#assessments-due-return").addEventListener("keyup",(function(event){let element=document.activeElement;13===event.keyCode&&element.hasAttribute("tabindex")&&(event.preventDefault(),element.click())})))};_exports.init=()=>{(()=>{_chartjs.Chart.register(_chartjs.DoughnutController);let tempPanel=document.querySelector(Selectors_SUMMARY_BLOCK);tempPanel.insertAdjacentHTML("afterbegin","<div class='loader d-flex justify-content-center'>\n<div class='spinner-border' role='status'><span class='hidden'>Loading...</span></div></div>"),ajax.call([{methodname:"block_newgu_spdetails_get_assessmentsummary",args:{}}])[0].done((function(response){document.querySelector(".loader").remove();let legendPosition="right";document.querySelector("#block-region-side-pre")&&document.querySelector("#block-region-side-pre").querySelector(".block_newgu_spdetails")&&(legendPosition="bottom");let tmpFontColour="#000";document.querySelector(".hillhead40-night")&&(tmpFontColour="#95B7E6",document.querySelector(".alert.alert-info a").style.color="#95B7E6"),document.querySelector(".hillhead40-contrast-wb")&&(tmpFontColour="#eee",document.querySelector(".alert.alert-info a").style.color="#eee"),document.querySelector(".hillhead40-contrast-yb")&&(tmpFontColour="#ee6",document.querySelector(".alert.alert-info a").style.color="#ee6"),document.querySelector(".hillhead40-contrast-by")&&(document.querySelector(".alert.alert-info a").style.color="#000"),document.querySelector(".hillhead40-contrast-wg")&&(tmpFontColour="#eee",document.querySelector(".alert.alert-info a").style.color="#eee"),document.querySelector(".hillhead40-contrast-br")&&(document.querySelector(".alert.alert-info a").style.color="#000"),document.querySelector(".hillhead40-contrast-bb")&&(document.querySelector(".alert.alert-info a").style.color="#000"),document.querySelector(".hillhead40-contrast-bw")&&(document.querySelector(".alert.alert-info a").style.color="#000");let tmpFontFamily="'Hillhead', 'Ubuntu', 'Trebuchet MS', 'Arial', sans-serif",tmpFontSize=20;document.querySelector(".hillhead40-font-modern")&&(tmpFontFamily="'Helvetica Neue', 'Helvetica', 'Arial', sans-serif"),document.querySelector(".hillhead40-font-classic")&&(tmpFontFamily="'Palatino', 'Times New Roman', serif"),document.querySelector(".hillhead40-font-comic")&&(tmpFontFamily="'Hillhead Comic', 'Chalkboard', 'Comic Sans', 'Comic Sans MS', sans-serif"),document.querySelector(".hillhead40-font-mono")&&(tmpFontFamily="'Hillhead Mono', 'Menlo', 'Courier New', monospace"),document.querySelector(".hillhead40-font-dyslexic")&&(tmpFontFamily="'OpenDyslexic', 'Helvetica', 'Arial', sans-serif"),document.querySelector(".hillhead40-size-120")&&(tmpFontSize="20%"),document.querySelector(".hillhead40-size-140")&&(tmpFontSize="25%"),document.querySelector(".hillhead40-size-160")&&(tmpFontSize="30%"),document.querySelector(".hillhead40-size-180")&&(tmpFontSize="35%");let tmpFontWeight="normal";document.querySelector(".hillhead40-bold")&&(tmpFontWeight="bolder");let tmpLineHeight="";document.querySelector(".hillhead40-spacing")&&(tmpLineHeight="2rem"),tempPanel.insertAdjacentHTML("afterbegin","<canvas id='assessmentSummaryChart'\n width='400' height='300' aria-label='Assessments overview. A chart displaying assessments to be submitted, overdue, submitted and graded.' role='img' tabindex='0'>\n<p>The 'Assessments Overview' chart displays information relating to assessments that are to be submitted, are overdue, have been submitted, and those that have been graded. Links to further information about these assessments also form part of this chart.</p>\n</canvas>");const data=[{labeltitle:"To be submitted",value:response[0].tobe_sub},{labeltitle:"Overdue",value:response[0].overdue},{labeltitle:"Submitted",value:response[0].sub_assess},{labeltitle:"Graded",value:response[0].assess_marked}],ctw=document.getElementById("assessmentSummaryChart"),chart=new _chartjs.Chart(ctw,{type:"doughnut",options:{responsive:!0,onHover:(event,chartElement)=>{document.querySelector("#student_dashboard")||(event.native.target.style.cursor=chartElement[0]?"pointer":"default")},plugins:{legend:{display:!0,position:legendPosition,onClick:(event,legendItem,legend)=>{document.querySelector("#student_dashboard")||viewAssessmentSummaryByChartType(0,legendItem,legend)},onHover:event=>{document.querySelector("#student_dashboard")||(event.native.target.style.cursor="pointer")},onLeave:event=>{event.native.target.style.cursor="default"},labels:{usePointStyle:!0,font:{size:tmpFontSize,family:tmpFontFamily,weight:tmpFontWeight,lineHeight:tmpLineHeight},generateLabels:chart=>{const datasets=chart.data.datasets;return datasets[0].data.map(((data,i)=>({text:`${chart.data.labels[i]} ${data}`,borderRadius:0,datasetIndex:i,fillStyle:datasets[0].backgroundColor[i],fontColor:tmpFontColour,hidden:!1,lineCap:"",lineDash:[],lineDashOffset:0,lineJoin:"",lineWidth:0,strokeStyle:datasets[0].backgroundColor[i],pointStyle:"rectRounded",rotation:0,index:i})))}}}},radius:"100%",maintainAspectRatio:!1},data:{labels:data.map((row=>row.labeltitle)),datasets:[{data:data.map((row=>row.value)),backgroundColor:["rgba(255,153,0)","rgba(255,0,0)","rgba(0,153,0)","rgba(129,187,255)"],hoverOffset:4}]}});document.getElementById("assessmentSummaryChart").onclick=evt=>{const points=chart.getElementsAtEventForMode(evt,"nearest",{intersect:!0},!0);if(points.length){const firstPoint=points[0];viewAssessmentSummaryByChartType(0,null,firstPoint.index)}}})).fail((function(err){document.querySelector(".loader").remove(),tempPanel.insertAdjacentHTML("afterbegin","<div class='d-flex justify-content-center'>\n"+err.message+"</div>"),Log.debug(err)}))})()}}));

//# sourceMappingURL=assessmentsummary.min.js.map
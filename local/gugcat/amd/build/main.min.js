function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function _arrayWithHoles(a){if(Array.isArray(a))return a}define ("local_gugcat/main",["jquery","core/str","core/modal_factory","local_gugcat/modal_gcat","core/sessionstorage","core/ajax"],function(a,b,c,d,e,f){var g=function(a){var b=window.location.pathname;return b.match(a)},h=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0,c=document.getElementsByName("grademax")[0].value;if(b){var d=document.getElementById(a.id.slice(0,10)+"pt_"+a.id.slice(10));d.value=a.value&&!isNaN(a.value)?i(a.value/100*c):""}else{var e=document.getElementById(a.id.slice(0,10)+a.id.slice(13));e.value=a.value&&!isNaN(a.value)?i(100*(a.value/c)):""}},i=function(a){var b=parseInt("1"+"0".repeat(2));a=a*b;return Math.round(a)/b},j=function(){var a=document.querySelectorAll(".input-prc,.input-pt");a.forEach(function(a){var b=a.lastElementChild.firstElementChild,c="id_schedA_pt_1"==b.id||"id_schedA_1"==b.id||"id_schedB_1"==b.id||"id_schedB_pt_1"==b.id;if(!c){b.value=""}})},k=function(a){var b=document.querySelectorAll(".input-reason");b.forEach(function(b){b.value=a})},l=function(){var a=document.getElementById("btn-identities"),c=document.querySelectorAll(".blind-marking");if(a&&0<c.length){a.textContent="...";c.forEach(function(a){return a.classList.add("hide-names")});var d="true"==e.get("blind-marking");b.get_strings([{key:"showidentities",component:"local_gugcat"},{key:"hideidentities",component:"local_gugcat"}]).then(function(b){a.textContent=d?b[0]:b[1];c.forEach(function(a){if(d){a.classList.add("hide-names")}else{a.classList.remove("hide-names")}})})}},m=function(){var a=document.querySelectorAll(".btn-colexp");if(0<a.length){a.forEach(function(a){a.addEventListener("click",function(b){var c=b.target.getAttribute("data-categoryid"),d=document.querySelectorAll("[data-category=\"".concat(c,"\"]")),e=a.querySelector(".i-colexp");d.forEach(function(a){a.classList.toggle("hidden");if(a.classList.contains("hidden")){e.classList.add("fa-plus");e.classList.remove("fa-minus")}else{e.classList.remove("fa-plus");e.classList.add("fa-minus")}});var f=document.querySelectorAll(".catid-".concat(c));f.forEach(function(a){return a.classList.toggle("hidden")})})})}},n=function(){var a=document.getElementById("btn-switch-display"),c=new URLSearchParams(window.location.search),d=c.get("id");if(a){a.textContent="...";var e=f.call([{methodname:"local_gugcat_display_assessments",args:{courseid:d}}]);e[0].done(function(c){var d=c.result;b.get_strings([{key:"switchoffdisplay",component:"local_gugcat"},{key:"switchondisplay",component:"local_gugcat"}]).then(function(b){a.textContent=d?b[0]:b[1]})}).fail(function(){a.style.display="none"})}},o=function(a){var b,c,d,e,f,g,h,j,k=0;b=document.getElementById("gcat-table");d=!0;j="asc";while(d){d=!1;c=b.rows;for(e=1;e<c.length-1;e++){h=!1;f=c[e].getElementsByTagName("TD")[a];g=c[e+1].getElementsByTagName("TD")[a];if("asc"==j){if(f.innerHTML.toLowerCase()>g.innerHTML.toLowerCase()){h=!0;break}}else if("desc"==j){if(f.innerHTML.toLowerCase()<g.innerHTML.toLowerCase()){h=!0;break}}}if(h){c[e].parentNode.insertBefore(c[e+1],c[e]);d=!0;k++}else{if(0==k&&"asc"==j){j="desc";d=!0}}}},p=function(a,e,f){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:"cancelmodal";b.get_strings([{key:e,component:"local_gugcat"},{key:g,component:"local_gugcat"},{key:f,component:"local_gugcat"}]).then(function(b){var e={bodycontent:b[0],strcancel:b[1],strconfirm:b[2],dataaction:a};c.create({type:d.TYPE,templateContext:e}).done(function(a){return a.show()})})},q=function(){var a=document.getElementById("table-schedulea"),b=document.getElementById("table-scheduleb");a.classList.toggle("hidden");b.classList.toggle("hidden")},r=function(a){var b=new URLSearchParams(window.location.search),c=document.getElementById("select-category"),d=document.getElementById("select-activity"),e=document.getElementById("select-child-act"),h=document.querySelector(".multi-select-reason > select"),l=document.getElementById("select-scale"),m=document.getElementById("select-template"),n=document.getElementById("select-alt-grade"),o=document.getElementById("id_reasons");switch(a.target){case c:b.delete("activityid");b.delete("childactivityid");b.delete("page");if("null"===c.value){b.delete("categoryid")}else{b.set("categoryid",c.value)}if(g("gugcat/add")){b.delete("studentid");var p=window.location.pathname;p=p.replace("gugcat/add","gugcat")+"?"+b;window.location.replace(p);return}window.location.search=b;break;case d:b.set("activityid",d.value);b.delete("childactivityid");b.delete("page");window.location.search=b;break;case e:b.set("childactivityid",e.value);b.delete("page");window.location.search=b;break;case h:var r=a.target.value,s=document.querySelector(".togglemultigrd > input");k(r);if("Other"===r){k("");s.style.display="block"}else{s.style.display="none"}break;case o:var t=a.target.value,u=document.getElementById("id_otherreason");if("9"==t){u.value="";u.focus()}break;case l:q();break;case m:if(0!=m.value){var v=m.value,w=f.call([{methodname:"local_gugcat_get_converter_template",args:{templateid:v}}]);w[0].done(function(a){var b=a.result;if(b){b=JSON.parse(b);j();if(l.value!=b.scaletype){q()}l.value=b.scaletype;var c=2!=b.scaletype?"schedA[*]":"schedB[*]",d=2!=b.scaletype?"schedA_pt[*]":"schedB_pt[*]",e=document.getElementsByName("grademax")[0].value,f=b.conversion;for(var p in f){var g=f[p],h=c.replace("*",g.grade),k=d.replace("*",g.grade),m=document.querySelector(".input-prc > div > input[name=\"".concat(h,"\"]")),n=document.querySelector(".input-pt > div > input[name=\"".concat(k,"\"]")),o=parseFloat(g.lowerboundary);m.value=o;n.value=i(o/100*e)}}}).fail(function(){})}break;case n:var x=document.querySelectorAll(".merit-lbl, .gpa-lbl");if(0!=n.value){var y=document.querySelectorAll(".merit-lbl"),z=document.querySelectorAll(".gpa-lbl");if(1==n.value){if(0<y.length){y.forEach(function(a){return a.classList.remove("hidden")})}if(0<z.length){z.forEach(function(a){return a.classList.add("hidden")})}}else if(2==n.value){if(0<y.length){y.forEach(function(a){return a.classList.add("hidden")})}if(0<z.length){z.forEach(function(a){return a.classList.remove("hidden")})}}}else{if(0<x.length){x.forEach(function(a){return a.classList.add("hidden")})}}break;default:break;}},s=function(b){var c=document.getElementById("btn-saveadd"),d=document.getElementById("btn-multisave"),f=document.getElementById("btn-release"),g=document.getElementById("btn-import"),h=document.getElementById("btn-identities"),i=document.getElementById("btn-coursegradeform"),k=document.getElementById("btn-download"),m=document.getElementById("btn-finalrelease"),o=document.getElementById("btn-switch-display"),q=document.getElementById("btn-blkimport"),r=document.getElementsByName("percentpoints"),s=document.querySelector("[name=\"savealtbutton\"]");switch(b.target){case c:a(".togglemultigrd").toggle();d.classList.toggle("hidden");break;case d:if(0==document.querySelectorAll("input.is-invalid").length){document.getElementById("multiadd-submit").click()}break;case f:p("release","modalreleaseprovisionalgrade","confirmreleaseprovisionalgrade");break;case g:if(!a(".gradeitems").text().includes("Moodle Grade[Date]")){p("importgrades","modalimportgrades","confirmimport")}else{document.getElementById("importgrades-submit").click()}break;case i:var t=document.querySelectorAll(".input-percent"),u=0;if(0<t.length){t.forEach(function(a){var b=a.querySelector("input");u+=parseInt(b.value);var c=a.querySelector("input.is-invalid");if(null!==c){a.querySelector("[data-fieldtype=\"text\"]").classList.add("no-after")}else{a.querySelector("[data-fieldtype=\"text\"]").classList.remove("no-after")}})}var v=document.querySelector("textarea#id_notes"),w=document.getElementById("id_error_notes");if(""==v.value){w.innerHTML="- You must supply a value here.";w.style.display="block"}else{w.innerHTML="";w.style.display="none";if(100!=u){p("adjustweight","modaladjustweights","confirmchanges")}else{document.getElementById("coursegradeform-submit").click()}}break;case m:p("finalrelease","modalreleasefinalgrades","confirmfinalrelease");break;case k:document.getElementById("downloadcsv-submit").click();break;case h:var x="true"==e.get("blind-marking");e.set("blind-marking",!x);l();break;case o:n();break;case q:if(!a(".gradeitems").text().includes("Moodle Grade[Date]")){p("bulkimportgrades","modalimportgrades","confirmimport")}else{document.getElementById("bulk-submit").click()}break;case r[0]:case r[1]:j();break;case s:var y=document.getElementById("select-alt-grade");if(1==y.value){var t=document.querySelectorAll(".input-percent"),u=0;if(0<t.length){t.forEach(function(a){var b=a.querySelector("input");u+=parseInt(b.value);var c=a.querySelector("input.is-invalid");if(null!==c){a.querySelector("input").classList.add("is-invalid");a.querySelector("[data-fieldtype=\"text\"]").classList.add("no-after")}else{a.querySelector("input").classList.remove("is-invalid");a.querySelector("[data-fieldtype=\"text\"]").classList.remove("no-after")}})}var z=document.querySelectorAll("input.is-invalid");if(0==z.length){if(100!=u){p("hiddensubmit","modalmeritweights","confirmchanges")}else{document.querySelector("[name=\"hiddensubmitform\"]").click()}}}else{document.querySelector("[name=\"hiddensubmitform\"]").click()}break;default:break;}};return{init:function init(){var b=document.querySelector(".gcat-container");if(b){b.addEventListener("change",r);b.addEventListener("click",s);if(document.getElementById("btn-identities")&&!e.get("blind-marking")){e.set("blind-marking",!1)}l();m();var c=document.querySelector(".togglemultigrd > input");if(c){c.addEventListener("input",function(a){k(a.target.value)})}var d=document.getElementById("select-scale");if(d){if(1!=d.value){q()}}var f=document.querySelectorAll(".input-search");if(0<f.length){f.forEach(function(a){a.addEventListener("keydown",function(a){var b=a.keyCode?a.keyCode:a.which;if(13===b){document.getElementById("search-submit").click()}})})}var i=document.querySelectorAll(".input-prc,.input-pt");if(0<i.length){i.forEach(function(a){var b=a.querySelector("input");if(b.value){h(b,a.classList.contains("input-prc"))}a.addEventListener("change",function(b){h(b.target,a.classList.contains("input-prc"))})})}var j=document.querySelectorAll(".input-gradept");if(0<j.length){j.forEach(function(a){a.addEventListener("input",function(b){var c=b.target.value,d=b.target.getAttribute("data-grademax");if(c&&!/^([mM][vV]|[0-9]|[nN][sS])+$/.test(c)){a.classList.add("is-invalid")}else{if(Number.isInteger(parseInt(c))&&parseInt(c)>parseInt(d)){a.classList.add("is-invalid")}else{a.classList.remove("is-invalid")}}})})}var n=document.querySelectorAll(".input-percent"),p=document.querySelector(".total-weight")?document.querySelector(".total-weight"):document.querySelector("#fitem_id_totalweight .form-inline");if(0<n.length&&p){var t=0;n.forEach(function(a){var b=a.querySelector("input");t+=parseInt(b.value);b.addEventListener("input",function(){var a=0;n.forEach(function(b){a+=parseInt(b.querySelector("input").value)});p.innerHTML="".concat(a,"%")});b.addEventListener("focus",function(b){var c=b.target.value;if(""!==c&&null===c.match(/^[0-9]+$/)){a.querySelector("[data-fieldtype=\"text\"]").classList.add("no-after");a.querySelector("input").classList.add("is-invalid")}else{a.querySelector("[data-fieldtype=\"text\"]").classList.remove("no-after");a.querySelector("input").classList.remove("is-invalid")}});b.addEventListener("blur",function(b){var c=b.target.value;if(""!==c&&null===c.match(/^[0-9]+$/)){a.querySelector("[data-fieldtype=\"text\"]").classList.add("no-after");a.querySelector("input").classList.add("is-invalid")}else{a.querySelector("[data-fieldtype=\"text\"]").classList.remove("no-after");a.querySelector("input").classList.remove("is-invalid")}})});p.innerHTML="".concat(t,"%")}var u=document.querySelector(".template-name input");if(u){u.addEventListener("input",function(a){k(a.target.value)})}var v=document.querySelectorAll(".sortable");if(0<v.length){var w=!0,x=!1,y=void 0;try{for(var z=function(){var a=_slicedToArray(B.value,2),b=a[0],c=a[1];c.addEventListener("keyup",function(a){if(13===a.keyCode){a.preventDefault();c.click()}});c.addEventListener("click",function(){return o(b)})},A=v.entries()[Symbol.iterator](),B;!(w=(B=A.next()).done);w=!0){z()}}catch(a){x=!0;y=a}finally{try{if(!w&&null!=A.return){A.return()}}finally{if(x){throw y}}}}var C=document.querySelectorAll(".fa-search");if(0<C.length){C.forEach(function(a){a.addEventListener("keyup",function(b){if(13===b.keyCode){b.preventDefault();a.click()}});a.addEventListener("click",function(a){a.currentTarget.blur();var b=a.target.nextSibling;b.classList.toggle("visible");if(b.classList.contains("visible")){b.style.display="block"}else{b.style.display="none"}})})}var D=document.querySelectorAll("td .grade-discrepancy");if(0<D.length){document.getElementById("btn-grddisc").style.display="inline-block"}var E=document.querySelectorAll("input.checkbox-field");if(0<E.length){E.forEach(function(a){a.addEventListener("change",function(a){if(!a.currentTarget.checked){var b=a.target.getAttribute("data-itemid"),c=document.querySelector(".input-percent input[name=\"weights[".concat(b,"]\"]"));c.value=0}})})}if(g("gugcat/overview")){document.querySelector("#btn-overviewtab").classList.add("active");document.querySelector("#btn-assessmenttab").classList.remove("active")}else if(g("gugcat/index")){document.getElementById("btn-release").style.display=!a(".gradeitems").text().includes("Moodle Grade[Date]")?"inline-block":"none";var F=Array.from(document.querySelectorAll(".gradeitems"));if(F.find(function(a){return"Moodle Grade<br>[Date]"!==a.innerHTML})){document.getElementById("btn-saveadd").style.display="inline-block";var G=document.querySelectorAll(".addnewgrade");G.forEach(function(a){a.style.display="block"});var H=document.querySelectorAll(".hide-show-grade");H.forEach(function(a){a.style.display="block"})}}}}}});
//# sourceMappingURL=main.min.js.map

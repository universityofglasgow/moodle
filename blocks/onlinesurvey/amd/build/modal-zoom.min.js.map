{"version":3,"file":"modal-zoom.min.js","sources":["../src/modal-zoom.js"],"sourcesContent":["define(['core/templates', 'core/str'], function(templates) {\r\n\r\n    var modalTitle = '';\r\n    var modalZoomSelector = '#block_onlinesurvey_surveys_content';\r\n\r\n    var popupinfotitle = '';\r\n    var popupinfocontent = '';\r\n    var userlogintime = 0;\r\n\r\n    var doRefresh = function() {\r\n        var myElement = document.getElementById(\"block_onlinesurvey_contentframe\");\r\n        if (myElement) {\r\n            var oldsrc = myElement.src;\r\n            myElement.src = '';\r\n            myElement.src = oldsrc;\r\n        }\r\n    };\r\n\r\n    var handleClickSmallModal = function(e) {\r\n        e.preventDefault();\r\n\r\n        var modalZoomElem = e.target;\r\n\r\n        var originalIframe = modalZoomElem.querySelector('iframe');\r\n\r\n        var templatePromise = null;\r\n\r\n        if (originalIframe !== null) {\r\n            // Open from Moodle page, i.e., onlinesurvey iframe exists.\r\n            templatePromise = templates.render('block_onlinesurvey/modal-iframe', {\r\n                // Copy iframe target URL from block, but inform that now in modalZoom window.\r\n                src: originalIframe.src + \"&modalZoom=1\",\r\n                title: modalTitle\r\n            });\r\n        } else {\r\n            // Open from iframe, i.e., needs to switch to parent Moodle page.\r\n            originalIframe = parent.document.querySelector('iframe');\r\n            templatePromise = templates.render('block_onlinesurvey/modal-iframe', {\r\n                // Copy iframe target URL from block, but inform that now in modalZoom window.\r\n                src: originalIframe.src + \"&modalZoom=1\",\r\n                title: modalTitle\r\n            });\r\n        }\r\n\r\n        templatePromise.done(function(source) {\r\n\r\n            var div = document.createElement('div');\r\n            div.innerHTML = source;\r\n\r\n            var modalContainer = div.firstChild;\r\n\r\n            document.body.insertBefore(modalContainer, document.body.firstChild);\r\n            document.body.className += ' block_onlinesurvey_custom-modal-open';\r\n\r\n            var closeCallback = function() {\r\n\r\n                document.body.className = document.body.className.replace(' block_onlinesurvey_custom-modal-open', '');\r\n\r\n                doRefresh();\r\n\r\n                modalContainer.className += ' fading';\r\n\r\n                setTimeout(function() {\r\n                    if (modalContainer.parentNode !== null) {\r\n                        modalContainer.parentNode.removeChild(modalContainer);\r\n                    }\r\n                }, 250);\r\n            };\r\n\r\n            modalContainer.querySelector('.block_onlinesurvey_custom-modal_close-button')\r\n                .addEventListener('click', function(e) {\r\n                    e.preventDefault();\r\n                    return closeCallback(e);\r\n                });\r\n\r\n            modalContainer.addEventListener('click', function(e) {\r\n                e.preventDefault();\r\n\r\n                return e.target !== modalContainer ?\r\n                    false : closeCallback(e);\r\n            });\r\n        });\r\n    };\r\n\r\n    return {\r\n        init: function(popuptitle, popupcontent, currentlogin) {\r\n\r\n            popupinfotitle = popuptitle;\r\n            popupinfocontent = popupcontent;\r\n            userlogintime = currentlogin;\r\n\r\n            var zoomContainer = document.querySelectorAll(modalZoomSelector);\r\n\r\n            for (var i = 0; i < zoomContainer.length; i++) {\r\n                zoomContainer[i].addEventListener('click', handleClickSmallModal);\r\n            }\r\n\r\n            // Namespace in window for EVASYS-functions etc.\r\n            window.EVASYS = {\r\n                // Define \"global\" functions in namespace -> later \"external\" access from iframe possible.\r\n                generatepopupinfo: this.generatepopupinfo\r\n            };\r\n            window.evasysGeneratePopupinfo = this.generatepopupinfo;\r\n        },\r\n        generatepopupinfo: function() {\r\n\r\n            // Get saved data from sessionStorage.\r\n            var popupinfo = sessionStorage.getItem('onlinesurvey_popupinfo');\r\n\r\n            if (popupinfo == false || popupinfo === null || popupinfo != userlogintime) {\r\n\r\n                // Save data to sessionStorage.\r\n                sessionStorage.setItem('onlinesurvey_popupinfo', userlogintime);\r\n\r\n                var templatePromise = templates.render('block_onlinesurvey/popupinfo', {\r\n                    title: popupinfotitle,\r\n                    content: popupinfocontent\r\n                });\r\n\r\n                templatePromise.done(function(source) {\r\n\r\n                    var div = document.createElement('div');\r\n                    div.innerHTML = source;\r\n\r\n                    var modalContainer = div.firstChild;\r\n\r\n                    document.body.insertBefore(modalContainer, document.body.firstChild);\r\n                    document.body.className += ' block_onlinesurvey_custom-modal-open popupinfo';\r\n\r\n                    var closeCallback = function() {\r\n\r\n                        document.body.className = document.body.className.replace(' block_onlinesurvey_custom-modal-open', '');\r\n\r\n                        modalContainer.className += ' fading';\r\n\r\n                        setTimeout(function() {\r\n                            if (modalContainer.parentNode !== null) {\r\n                                modalContainer.parentNode.removeChild(modalContainer);\r\n                            }\r\n                        }, 250);\r\n                    };\r\n\r\n                    modalContainer.querySelector('.block_onlinesurvey_custom-modal_close-button')\r\n                    .addEventListener('click', function(e) {\r\n                        e.preventDefault();\r\n                        return closeCallback(e);\r\n                    });\r\n\r\n                    modalContainer.addEventListener('click', function(e) {\r\n                        e.preventDefault();\r\n\r\n                        return e.target !== modalContainer ?\r\n                                false : closeCallback(e);\r\n                    });\r\n                });\r\n            }\r\n        }\r\n    };\r\n});\r\n"],"names":["define","templates","popupinfotitle","popupinfocontent","userlogintime","handleClickSmallModal","e","preventDefault","originalIframe","target","querySelector","parent","document","render","src","title","done","source","div","createElement","innerHTML","modalContainer","firstChild","body","insertBefore","className","closeCallback","replace","myElement","getElementById","oldsrc","doRefresh","setTimeout","parentNode","removeChild","addEventListener","init","popuptitle","popupcontent","currentlogin","zoomContainer","querySelectorAll","i","length","window","EVASYS","generatepopupinfo","this","evasysGeneratePopupinfo","popupinfo","sessionStorage","getItem","setItem","content"],"mappings":"AAAAA,uCAAO,CAAC,iBAAkB,aAAa,SAASC,eAKxCC,eAAiB,GACjBC,iBAAmB,GACnBC,cAAgB,EAWhBC,sBAAwB,SAASC,GACjCA,EAAEC,qBAIEC,eAFgBF,EAAEG,OAEaC,cAAc,UAI1B,OAAnBF,iBASAA,eAAiBG,OAAOC,SAASF,cAAc,WAP7BT,UAAUY,OAAO,kCAAmC,CAElEC,IAAKN,eAAeM,IAAM,eAC1BC,MA9BK,KA0CGC,MAAK,SAASC,YAEtBC,IAAMN,SAASO,cAAc,OACjCD,IAAIE,UAAYH,WAEZI,eAAiBH,IAAII,WAEzBV,SAASW,KAAKC,aAAaH,eAAgBT,SAASW,KAAKD,YACzDV,SAASW,KAAKE,WAAa,4CAEvBC,cAAgB,WAEhBd,SAASW,KAAKE,UAAYb,SAASW,KAAKE,UAAUE,QAAQ,wCAAyC,IA/C/F,eACRC,UAAYhB,SAASiB,eAAe,sCACpCD,UAAW,KACPE,OAASF,UAAUd,IACvBc,UAAUd,IAAM,GAChBc,UAAUd,IAAMgB,QA4CZC,GAEAV,eAAeI,WAAa,UAE5BO,YAAW,WAC2B,OAA9BX,eAAeY,YACfZ,eAAeY,WAAWC,YAAYb,kBAE3C,MAGPA,eAAeX,cAAc,iDACxByB,iBAAiB,SAAS,SAAS7B,UAChCA,EAAEC,iBACKmB,mBAGfL,eAAec,iBAAiB,SAAS,SAAS7B,UAC9CA,EAAEC,iBAEKD,EAAEG,SAAWY,gBACRK,6BAKjB,CACHU,KAAM,SAASC,WAAYC,aAAcC,cAErCrC,eAAiBmC,WACjBlC,iBAAmBmC,aACnBlC,cAAgBmC,qBAEZC,cAAgB5B,SAAS6B,iBAxFb,uCA0FPC,EAAI,EAAGA,EAAIF,cAAcG,OAAQD,IACtCF,cAAcE,GAAGP,iBAAiB,QAAS9B,uBAI/CuC,OAAOC,OAAS,CAEZC,kBAAmBC,KAAKD,mBAE5BF,OAAOI,wBAA0BD,KAAKD,mBAE1CA,kBAAmB,eAGXG,UAAYC,eAAeC,QAAQ,0BAEtB,GAAbF,WAAoC,OAAdA,WAAsBA,WAAa7C,gBAGzD8C,eAAeE,QAAQ,yBAA0BhD,eAE3BH,UAAUY,OAAO,+BAAgC,CACnEE,MAAOb,eACPmD,QAASlD,mBAGGa,MAAK,SAASC,YAEtBC,IAAMN,SAASO,cAAc,OACjCD,IAAIE,UAAYH,WAEZI,eAAiBH,IAAII,WAEzBV,SAASW,KAAKC,aAAaH,eAAgBT,SAASW,KAAKD,YACzDV,SAASW,KAAKE,WAAa,sDAEvBC,cAAgB,WAEhBd,SAASW,KAAKE,UAAYb,SAASW,KAAKE,UAAUE,QAAQ,wCAAyC,IAEnGN,eAAeI,WAAa,UAE5BO,YAAW,WAC2B,OAA9BX,eAAeY,YACfZ,eAAeY,WAAWC,YAAYb,kBAE3C,MAGPA,eAAeX,cAAc,iDAC5ByB,iBAAiB,SAAS,SAAS7B,UAChCA,EAAEC,iBACKmB,mBAGXL,eAAec,iBAAiB,SAAS,SAAS7B,UAC9CA,EAAEC,iBAEKD,EAAEG,SAAWY,gBACJK"}
define ("block_xp/cm-resource-selector",["jquery","core/ajax","block_xp/throttler","block_xp/resource-selector"],function(a,b,c,d){function e(a,b){d.prototype.constructor.apply(this,[a,this.filterFunction.bind(this),b]);this.resources=[];this.courseId=null;this.throttler=new c(100);this.setMinChars(0)}e.prototype=Object.create(d.prototype);e.prototype.constructor=e;e.prototype.initForCourse=function(a){if(this.courseId==a){this.displayResults(this.resources);return}this.displaySearching();this.courseId=a;this.fetchAllForCourse(a).then(function(b){if(this.courseId!=a){return}this.resources=b;this.displayResults(this.resources)}.bind(this)).fail(function(){this.resources=[];this.displayEmptyResults()}.bind(this))};e.prototype.fetchAllForCourse=function(a){return b.call([{methodname:"block_xp_search_modules",args:{courseid:a,query:"*"}}])[0].then(function(a){return a.reduce(function(a,b){return a.concat(b.modules.map(function(a){return{_iscm:!0,subname:b.name,name:a.name,cm:a}}))},[])})};e.prototype.filterFunction=function(a){a=(a||"").toLowerCase();if(!a){return this.resources}return this.resources.filter(function(b){return-1<b.name.toLowerCase().indexOf(a)})};return e});
//# sourceMappingURL=cm-resource-selector.min.js.map

{"version":3,"sources":["../src/filter.js"],"names":["define","$","ModalFactory","Templates","str","ajax","notification","init","duedate","document","on","group","val","show","not","hide","assignmentid","data","userid","fullname","daycount","get_strings","key","component","then","result","create","title","body","render","modal","inc","is","html","_doextension","oldextension","days","newextension","call","methodname","args","date","done","userdate","fail","exception","flags","extensionduedate"],"mappings":"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","sourcesContent":["define(['jquery', 'core/modal_factory', 'core/templates', 'core/str', 'core/ajax', 'core/notification'],\n    function($, ModalFactory, Templates, str, ajax, notification) {\n\n    return {\n        init: function(duedate) {\n\n            $(document).on('change', '#groupfilter', function() {\n                var group = $(this).val();\n                $('.group_' + group).show();\n                $('.group_0').not('.group_' + group).hide();\n            });\n\n\n            $(\".doextension\").on(\"click\", function() {\n                var assignmentid = $(this).data('assignmentid');\n                var userid = $(this).data('userid');\n                var fullname = $(this).data('fullname');\n                var daycount = 0;\n                var strings = [\n                    {key: 'extensionpopuptitle', component: 'report_assign'}\n                ];\n                str.get_strings(strings)\n                .then(function(result) {\n                    return ModalFactory.create({\n                        title: result[0],\n                        body: Templates.render('report_assign/extensionpopup', {\n                            assignmentid: assignmentid,\n                            userid: userid,\n                            fullname: fullname\n                        }),\n                    });\n                })\n                .then(function(modal) {\n                    modal.show();\n\n                    // handle modal buttons\n                    $(\".extensioninc, .extensiondec\").on(\"click\", function() {\n                        var inc = $(this).is('.extensioninc');\n                        if (inc && (daycount < 7)) {\n                            daycount++;\n                        }\n                        if (!inc && (daycount > 0)) {\n                            daycount--;\n                        }\n                        $(\".extensioncounter\").html(daycount);\n\n                        return false;\n                    });\n\n                    var _doextension = function(assignmentid, userid, oldextension, days) {\n                        if (oldextension == 0) {\n                            oldextension = duedate;\n                        }\n                        var newextension = oldextension + (days * 86400);\n                        ajax.call([{\n                            methodname: 'report_assign_save_user_extension',\n                            args: {assignmentid: assignmentid, userid: userid, date: newextension},\n                            done: function(userdate) {\n                                var spanid = \"#extensionuser_\" + userid;\n                                $(spanid).html(userdate);\n                            },\n                            fail: notification.exception\n                        }]);\n                    };\n\n                    $(\".extensioncancel\").on(\"click\", function() {\n                        modal.hide();\n\n                        return false;\n                    });\n\n                    $(\".extensionsave\").on(\"click\", function() {\n                        var assignmentid = $(this).data(\"assignmentid\");\n                        var userid = $(this).data(\"userid\");\n                        ajax.call([{\n                            methodname: 'report_assign_get_user_flags',\n                            args: {assignmentid: assignmentid, userid: userid},\n                            done: function(flags) {\n                                _doextension(assignmentid, userid, flags.extensionduedate, daycount);\n                                modal.hide();\n                            },\n                            fail: notification.exception\n                        }]);\n\n                        return false;\n                    });\n\n                });\n                return false;\n            });\n\n\n        }\n    };\n});\n"],"file":"filter.min.js"}
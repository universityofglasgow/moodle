function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}f(void 0)})}}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function _arrayWithHoles(a){if(Array.isArray(a))return a}define ("local_gugcat/main",["jquery","core/str","core/modal_factory","local_gugcat/modal_gcat","core/sessionstorage","core/ajax"],function(a,b,c,d,e,f){var g=function(a){var b=window.location.pathname;return b.match(a)},h=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0;grade_max=document.getElementsByName("grademax")[0].value;if(b){input_point=document.getElementById(a.id.slice(0,10)+"pt_"+a.id.slice(10));input_point.value=i(a.value/100*grade_max)}else{input_percentage=document.getElementById(a.id.slice(0,10)+a.id.slice(13));input_percentage.value=i(100*(a.value/grade_max))}},i=function(a){var b=parseInt("1"+"0".repeat(2));a=a*b;return Math.round(a)/b},j=function(a){var b=document.querySelectorAll(".input-reason");b.forEach(function(b){return b.value=a})},k=function(){var a=document.getElementById("btn-identities"),c=document.querySelectorAll(".blind-marking");if(a&&0<c.length){a.textContent="...";c.forEach(function(a){return a.classList.add("hide-names")});var d="true"==e.get("blind-marking");b.get_strings([{key:"showidentities",component:"local_gugcat"},{key:"hideidentities",component:"local_gugcat"}]).then(function(b){a.textContent=d?b[0]:b[1];c.forEach(function(a){d?a.classList.add("hide-names"):a.classList.remove("hide-names")})})}},l=function(){var a=document.querySelectorAll(".btn-colexp");if(0<a.length){a.forEach(function(a){a.addEventListener("click",function(b){var c=b.target.getAttribute("data-categoryid"),d=document.querySelectorAll("[data-category=\"".concat(c,"\"]")),e=a.querySelector(".i-colexp");d.forEach(function(a){a.classList.toggle("hidden");if(a.classList.contains("hidden")){e.classList.add("fa-plus");e.classList.remove("fa-minus")}else{e.classList.remove("fa-plus");e.classList.add("fa-minus")}});var f=document.querySelectorAll(".catid-".concat(c));f.forEach(function(a){return a.classList.toggle("hidden")})})})}},m=function(){var a=document.getElementById("btn-switch-display"),c=new URLSearchParams(window.location.search),d=c.get("id");if(a){a.textContent="...";var e=f.call([{methodname:"local_gugcat_display_assessments",args:{courseid:d}}]);e[0].done(function(c){var d=c.result;b.get_strings([{key:"switchoffdisplay",component:"local_gugcat"},{key:"switchondisplay",component:"local_gugcat"}]).then(function(b){a.textContent=d?b[0]:b[1]})}).fail(function(){a.style.display="none"})}},n=function(a){var b,c,d,e,f,g,h,j,k=0;b=document.getElementById("gcat-table");d=!0;j="asc";while(d){d=!1;c=b.rows;for(e=1;e<c.length-1;e++){h=!1;f=c[e].getElementsByTagName("TD")[a];g=c[e+1].getElementsByTagName("TD")[a];if("asc"==j){if(f.innerHTML.toLowerCase()>g.innerHTML.toLowerCase()){h=!0;break}}else if("desc"==j){if(f.innerHTML.toLowerCase()<g.innerHTML.toLowerCase()){h=!0;break}}}if(h){c[e].parentNode.insertBefore(c[e+1],c[e]);d=!0;k++}else{if(0==k&&"asc"==j){j="desc";d=!0}}}},o=function(a,e,f){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:"cancelmodal";b.get_strings([{key:e,component:"local_gugcat"},{key:g,component:"local_gugcat"},{key:f,component:"local_gugcat"}]).then(function(b){var e={bodycontent:b[0],strcancel:b[1],strconfirm:b[2],dataaction:a};c.create({type:d.TYPE,templateContext:e}).done(function(a){return a.show()})})},p=function(){var a=document.getElementById("table-schedulea"),b=document.getElementById("table-scheduleb");a.classList.toggle("hidden");b.classList.toggle("hidden")},q=function(a){var b=new URLSearchParams(window.location.search),c=document.getElementById("select-category"),d=document.getElementById("select-activity"),e=document.getElementById("select-child-act"),h=document.querySelector(".multi-select-reason > select"),k=document.getElementById("select-scale"),l=document.getElementById("select-template"),m=document.getElementById("id_reasons");switch(a.target){case c:b.delete("activityid");b.delete("childactivityid");b.delete("page");if("null"===c.value){b.delete("categoryid")}else{b.set("categoryid",c.value)}if(g("gugcat/add")){b.delete("studentid");var n=window.location.pathname;n=n.replace("gugcat/add","gugcat")+"?"+b;window.location.replace(n);return}window.location.search=b;break;case d:b.set("activityid",d.value);b.delete("childactivityid");b.delete("page");window.location.search=b;break;case e:b.set("childactivityid",e.value);b.delete("page");window.location.search=b;break;case h:var o=a.target.value,q=document.querySelector(".togglemultigrd > input");j(o);if("Other"===o){j("");q.style.display="block"}else{q.style.display="none"}break;case m:var r=a.target.value,s=document.getElementById("id_otherreason");s.value=r;if(r="8"){s.value="";s.required=!0}else s.required=!1;s.focus();break;case k:p();break;case l:if(0!=l.value){var t=l.value,u=f.call([{methodname:"local_gugcat_get_converter_template",args:{templateid:t}}]);u[0].done(function(a){var b=a.result;if(b){b=JSON.parse(b);var c=document.querySelectorAll(".input-pt > div > input");if(0<c.length){c.forEach(function(a){a.value=""})}if(k.value!=b.scaletype){p()}k.value=b.scaletype;var d=2!=b.scaletype?"schedA[*]":"schedB[*]",e=2!=b.scaletype?"schedA_pt[*]":"schedB_pt[*]",f=document.getElementsByName("grademax")[0].value,g=b.conversion;for(var q in g){var h=g[q],j=d.replace("*",h.grade),l=e.replace("*",h.grade),m=document.querySelector(".input-prc > div > input[name=\"".concat(j,"\"]")),n=document.querySelector(".input-pt > div > input[name=\"".concat(l,"\"]")),o=parseFloat(h.lowerboundary);m.value=o;n.value=i(o/100*f)}}}).fail(function(a){console.log(a)})}break;default:break;}},r=function(b){var c=document.getElementById("btn-saveadd"),d=document.getElementById("btn-multisave"),f=document.getElementById("btn-release"),g=document.getElementById("btn-import"),h=document.getElementById("btn-identities"),i=document.getElementById("btn-coursegradeform"),j=document.getElementById("btn-download"),l=document.getElementById("btn-finalrelease"),n=document.getElementById("btn-switch-display"),p=document.getElementById("btn-blkimport"),q=document.getElementById("id_convertbutton"),r=document.getElementsByName("percentpoints");switch(b.target){case c:a(".togglemultigrd").toggle();d.classList.toggle("hidden");break;case d:if(0==document.querySelectorAll("input.is-invalid").length){document.getElementById("multiadd-submit").click()}break;case f:o("release","modalreleaseprovisionalgrade","confirmreleaseprovisionalgrade");break;case g:if(!a(".gradeitems").text().includes("Moodle Grade[Date]")){o("importgrades","modalimportgrades","confirmimport")}else{document.getElementById("importgrades-submit").click()}break;case i:var s=document.querySelectorAll(".input-percent"),t=0;if(0<s.length){s.forEach(function(a){var b=a.querySelector("input");t+=parseInt(b.value);var c=a.querySelector("input.is-invalid");if(null!=c){a.querySelector("div.felement").classList.add("no-after")}else{a.querySelector("div.felement").classList.remove("no-after")}})}if(100!=t){o("adjustweight","modaladjustweights","confirmchanges")}else{document.getElementById("coursegradeform-submit").click()}break;case l:var u=document.getElementById("isconvertsubcat");o("finalrelease",1!=u.value?"modalreleasefinalgrades":"modalreleasefinalconvertedgrades","confirmfinalrelease");break;case j:document.getElementById("downloadcsv-submit").click();break;case h:var v="true"==e.get("blind-marking");e.set("blind-marking",!v);k();break;case n:m();break;case p:if(!a(".gradeitems").text().includes("Moodle Grade[Date]")){o("bulkimportgrades","modalimportgrades","confirmimport")}else{document.getElementById("bulk-submit").click()}break;case q:o("convertgrades","modalconvertgrades","continueconvertgrade");break;case r[0]:case r[1]:var w=document.querySelectorAll(".input-prc,.input-pt");w.forEach(function(a){input=a.lastElementChild.firstElementChild;is_input_H="id_schedA_pt_1"==input.id||"id_schedA_1"==input.id||"id_schedB_1"==input.id||"id_schedB_pt_1"==input.id;if(!is_input_H){input.value=""}});default:break;}};return{init:function init(){var c=document.querySelector(".gcat-container");if(c){c.addEventListener("change",q);c.addEventListener("click",r);if(document.getElementById("btn-identities")&&!e.get("blind-marking")){e.set("blind-marking",!1)}k();l();var d=document.querySelector(".togglemultigrd > input");if(d){d.addEventListener("input",function(a){j(a.target.value)})}var f=document.getElementById("select-scale");if(f){if(1!=f.value){p()}}var i=document.querySelectorAll(".input-search");if(0<i.length){i.forEach(function(a){a.addEventListener("keydown",function(a){var b=a.keyCode?a.keyCode:a.which;if(13===b){document.getElementById("search-submit").click()}})})}var m=document.querySelectorAll(".input-prc,.input-pt");if(0<m.length){m.forEach(function(a){a.addEventListener("change",function(b){h(b.target,a.classList.contains("input-prc"))})})}var o=document.querySelectorAll(".input-gradept");if(0<o.length){o.forEach(function(a){a.addEventListener("input",function(b){var c=b.target.value,d=b.target.getAttribute("data-grademax");if(c&&!/^([mM][vV]|[0-9]|[nN][sS])+$/.test(c)){a.classList.add("is-invalid")}else{if(Number.isInteger(parseInt(c))&&parseInt(c)>parseInt(d)){a.classList.add("is-invalid")}else{a.classList.remove("is-invalid")}}})})}var s=document.querySelectorAll(".input-percent");if(0<s.length){var t=0,u=document.querySelector("#fitem_id_totalweight .form-inline");s.forEach(function(a){var b=a.querySelector("input");t+=parseInt(b.value);b.addEventListener("input",function(){var a=0;s.forEach(function(b){return a+=parseInt(b.querySelector("input").value)});u.innerHTML="".concat(a,"%")});b.addEventListener("focus",function(b){var c=b.target.value;if(""!==c&&null===c.match(/^[0-9]+$/)){a.querySelector("div.felement").classList.add("no-after")}else{a.querySelector("div.felement").classList.remove("no-after")}});b.addEventListener("blur",function(b){var c=b.target.value;if(""!==c&&null===c.match(/^[0-9]+$/)){a.querySelector("div.felement").classList.add("no-after")}else{a.querySelector("div.felement").classList.remove("no-after")}})});u.innerHTML="".concat(t,"%")}var v=document.querySelectorAll(".sortable");if(0<v.length){var w=!0,x=!1,y=void 0;try{for(var z=function(){var a=_slicedToArray(B.value,2),b=a[0],c=a[1];c.addEventListener("click",function(){return n(b)})},A=v.entries()[Symbol.iterator](),B;!(w=(B=A.next()).done);w=!0){z()}}catch(a){x=!0;y=a}finally{try{if(!w&&null!=A.return){A.return()}}finally{if(x){throw y}}}}var C=document.querySelectorAll(".fa-search");if(0<C.length){C.forEach(function(a){a.addEventListener("click",function(a){a.currentTarget.blur();var b=a.target.nextSibling;b.classList.toggle("visible");if(b.classList.contains("visible")){b.style.display="block"}else{b.style.display="none"}})})}var D=document.querySelectorAll("td .grade-discrepancy");if(0<D.length){document.getElementById("btn-grddisc").style.display="inline-block"}if(g("gugcat/overview")){document.querySelector("#btn-overviewtab").classList.add("active");document.querySelector("#btn-assessmenttab").classList.remove("active");var E=document.getElementById("id_notes");if(E){_asyncToGenerator(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return b.get_string("specifyreason","local_gugcat");case 2:E.placeholder=a.sent;E.required=!0;case 4:case"end":return a.stop();}}},a)}))()}}else if(g("gugcat/index")){document.getElementById("btn-release").style.display=!a(".gradeitems").text().includes("Moodle Grade[Date]")?"inline-block":"none";var F=Array.from(document.querySelectorAll(".gradeitems")),G=document.getElementById("isconverted");if(F.find(function(a){return"Moodle Grade<br>[Date]"!==a.innerHTML})){document.getElementById("btn-saveadd").style.display="inline-block";var H=document.querySelectorAll(".addnewgrade");H.forEach(function(a){a.style.display="block"});var I=document.querySelectorAll(".hide-show-grade");I.forEach(function(a){a.style.display="block"})}if(0!=G.value){document.getElementById("btn-release").style.display="none"}}else if(g("gugcat/add")||g("gugcat/edit")){var J=document.getElementById("id_otherreason"),E=document.getElementById("id_notes");_asyncToGenerator(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return b.get_string("pleasespecify","local_gugcat");case 2:J.placeholder=a.sent;a.next=5;return b.get_string("specifyreason","local_gugcat");case 5:E.placeholder=a.sent;E.required=!0;case 7:case"end":return a.stop();}}},a)}))()}}}}});
//# sourceMappingURL=main.min.js.map

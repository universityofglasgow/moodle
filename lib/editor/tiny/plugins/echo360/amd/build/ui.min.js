define("tiny_echo360/ui",["exports","core/modal_factory","core/ajax","tiny_echo360/modal","editor_tiny/options","core/config"],(function(_exports,_modal_factory,_ajax,_modal,_options,_config){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Tiny Echo360 UI.
   *
   * @module      tiny_echo360/ui
   * @copyright   2023 Echo360 Inc.
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.handleAction=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_ajax=_interopRequireDefault(_ajax),_modal=_interopRequireDefault(_modal),_config=_interopRequireDefault(_config);let instanceOpeningSelection=null,instanceEditor=null,instanceModal=null;_exports.handleAction=editor=>{instanceEditor=editor,instanceOpeningSelection=editor.selection.getBookmark(),displayDialogue(editor)};const echoEventListeners=[],receiveEchoMessage=(e,cmid)=>{if(e.data){let media=null,filterLaunchUrl=_config.default.wwwroot+"/filter/echo360tiny/lti_launch.php",queryParameters=(data=>{try{if(null!==data&&"string"==typeof data){let jsonData=decodeURI(data.split("?")[1]).replace(/"/g,'\\"').replace(/&/g,'","').replace(/[=]/g,'":"').replace(/\\/g,"\\\\"),queryParams=JSON.parse('{"'+jsonData+'"}');return queryParams.hasOwnProperty("url")?(queryParams.url=decodeURIComponent(queryParams.url),queryParams.title=queryParams.title||queryParams.url,queryParams):null}}catch(err){return null}})(e.data);if(queryParameters){switch(queryParameters.return_type){case"iframe":media='<iframe src="'+queryParameters.url+'" height="'+queryParameters.height+'" width="'+queryParameters.width+'" title="'+queryParameters.title+'" allowfullscreen="allowfullscreen" webkitallowfullscreen="webkitallowfullscreen" mozallowfullscreen="mozallowfullscreen"></iframe> ';break;case"url":media='<a href="'+queryParameters.url+'" target="_blank">'+queryParameters.title+"</a> ";break;case"lti_launch_url":if("link"===queryParameters.link_type){media='<a href="'+(filterLaunchUrl+"?url="+encodeURIComponent(queryParameters.url)+"&cmid="+cmid)+'" target="_blank">'+queryParameters.title+"</a> "}else{media='<a href="'+(filterLaunchUrl+"?url="+encodeURIComponent(queryParameters.url)+"&cmid="+cmid+"&width="+queryParameters.width+"&height="+queryParameters.height)+'" target="_blank">'+queryParameters.title+"</a> "}break;case"homework":media='<a href="'+(filterLaunchUrl+"?url="+encodeURIComponent(queryParameters.url)+"&cmid="+cmid+"&width=640&height=360")+'" target="_blank">'+queryParameters.title+"</a> ";break}null!==media&&""!=media&&(media=>{instanceEditor.selection.moveToBookmark(instanceOpeningSelection),instanceEditor.execCommand("mceInsertContent",!1,media),instanceEditor.selection.moveToBookmark(instanceOpeningSelection),instanceModal.destroy()})(media)}}},displayDialogue=async editor=>{const contextid=(0,_options.getContextId)(editor);_ajax.default.call([{methodname:"tiny_echo360_request_lti_configuration",args:{contextid:contextid}}])[0].done((function(ltiConfiguration){ltiConfiguration.element_id=editor.id,_modal_factory.default.create({type:_modal.default.TYPE,templateContext:ltiConfiguration,large:!0}).then((function(modal){instanceModal=modal,modal.show();let form=document.getElementById("echo360-form-"+editor.id);form.submit(),form.parentNode.removeChild(form)})),echoEventListeners[editor.id]||window.addEventListener("message",function(e){return e.stopPropagation(),receiveEchoMessage(e,this.resource_link_id)}.bind(ltiConfiguration),!0),echoEventListeners[editor.id]=!0}))}}));

//# sourceMappingURL=ui.min.js.map
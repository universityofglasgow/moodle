function dontmigrate(t){$("#migration_alert").hide(),t.close()}function lightBoxCloseButton(t){$("body").append('<div id="tii_close_bar"><a class="tii_close_link" href="#">'+M.str.turnitintooltwo.closebutton+"</a></div>")}function displayMigrationModal(){$("#migrate_type").data("turnitintoolid")!=$("#migrate_type").data("lastasked")&&($.colorbox({width:550,height:600,inline:!0,opacity:"0.7",href:"#migration_alert",onLoad:function(){$("#asktomigrate").show(),lightBoxCloseButton(),$(".tii_close_link").click($.proxy(dontmigrate,null,$.colorbox))},onCleanup:function(){$("#tii_close_bar").remove(),$("#migration_alert").hide()}}),$("#migration_alert").show()),2==$("#migrate_type").data("migratetype")&&($("#asktomigrate").hide(),$("#migrating").show(),migrate($("#migrate_type").data("courseid"),$("#migrate_type").data("turnitintoolid")))}function migrate(t,o){$.ajax({dataType:"json",type:"POST",url:M.cfg.wwwroot+"/mod/turnitintooltwo/ajax.php",data:{action:"begin_migration",courseid:t,turnitintoolid:o,sesskey:M.cfg.sesskey},success:function(t){$.colorbox&&$.colorbox.close(),$("#migration_alert").hide(),window.location.href=M.cfg.wwwroot+"/mod/turnitintooltwo/view.php?id="+t.id},error:function(t){var o=t.responseJSON;$.colorbox&&$.colorbox.close(),$("#migration_alert").hide(),$("#turnitintool_style").prepend('<div id="full-error" class="box generalbox noticebox">'+o.error+" "+o.message+"</div>"),o.hasOwnProperty("trace")&&(console.error(o.message),console.error(JSON.stringify(o.trace,null,4)))}})}$(document).ready(function(){$.ajax({dataType:"json",type:"POST",url:M.cfg.wwwroot+"/mod/turnitintooltwo/ajax.php",data:{action:"check_migrated",turnitintoolid:$("#migrate_type").data("turnitintoolid"),sesskey:M.cfg.sesskey},success:function(t){t.migrated===!0?window.location.href=M.cfg.wwwroot+"/mod/turnitintooltwo/view.php?id="+t.v2id:(displayMigrationModal(),$(".dontmigrate_link").click($.proxy(dontmigrate,null,$.colorbox)))}})}),$(".migrate_link").on("click",function(){$("#asktomigrate").hide(),$("#migrating").show(),migrate($(this).data("courseid"),$(this).data("turnitintoolid"))});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInR1cm5pdGludG9vbHR3b19taWdyYXRpb25fdG9vbC5qcyJdLCJuYW1lcyI6WyJkb250bWlncmF0ZSIsImNiIiwiJCIsImhpZGUiLCJjbG9zZSIsImxpZ2h0Qm94Q2xvc2VCdXR0b24iLCJhcHBlbmQiLCJNIiwic3RyIiwidHVybml0aW50b29sdHdvIiwiY2xvc2VidXR0b24iLCJkaXNwbGF5TWlncmF0aW9uTW9kYWwiLCJkYXRhIiwiY29sb3Jib3giLCJ3aWR0aCIsImhlaWdodCIsImlubGluZSIsIm9wYWNpdHkiLCJocmVmIiwib25Mb2FkIiwic2hvdyIsImNsaWNrIiwicHJveHkiLCJvbkNsZWFudXAiLCJyZW1vdmUiLCJtaWdyYXRlIiwiY291cnNlaWQiLCJ0dXJuaXRpbnRvb2xpZCIsImFqYXgiLCJkYXRhVHlwZSIsInR5cGUiLCJ1cmwiLCJjZmciLCJ3d3dyb290IiwiYWN0aW9uIiwic2Vzc2tleSIsInN1Y2Nlc3MiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImlkIiwiZXJyb3IiLCJyZXNwb25zZUpTT04iLCJwcmVwZW5kIiwibWVzc2FnZSIsImhhc093blByb3BlcnR5IiwiY29uc29sZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0cmFjZSIsImRvY3VtZW50IiwicmVhZHkiLCJtaWdyYXRlZCIsInYyaWQiLCJvbiIsInRoaXMiXSwibWFwcGluZ3MiOiJBQThCQSxRQUFTQSxhQUFZQyxHQUNqQkMsRUFBRSxvQkFBb0JDLE9BQ3RCRixFQUFHRyxRQUdQLFFBQVNDLHFCQUFvQkosR0FDekJDLEVBQUUsUUFBUUksT0FBTyw4REFBZ0VDLEVBQUVDLElBQUlDLGdCQUFnQkMsWUFBYyxjQUl6SCxRQUFTQyx5QkFFRFQsRUFBRSxpQkFBaUJVLEtBQUssbUJBQXFCVixFQUFFLGlCQUFpQlUsS0FBSyxlQUNyRVYsRUFBRVcsVUFBVUMsTUFBTyxJQUFLQyxPQUFRLElBQUtDLFFBQU8sRUFBTUMsUUFBUyxNQUFPQyxLQUFLLG1CQUNuRUMsT0FBUSxXQUNKakIsRUFBRSxpQkFBaUJrQixPQUNuQmYsc0JBRUFILEVBQUUsbUJBQW1CbUIsTUFBTW5CLEVBQUVvQixNQUFNdEIsWUFBYSxLQUFNRSxFQUFFVyxZQUU1RFUsVUFBVSxXQUNOckIsRUFBRSxrQkFBa0JzQixTQUNwQnRCLEVBQUUsb0JBQW9CQyxVQUk5QkQsRUFBRSxvQkFBb0JrQixRQUdvQixHQUExQ2xCLEVBQUUsaUJBQWlCVSxLQUFLLGlCQUN4QlYsRUFBRSxpQkFBaUJDLE9BQ25CRCxFQUFFLGNBQWNrQixPQUVoQkssUUFBUXZCLEVBQUUsaUJBQWlCVSxLQUFLLFlBQWFWLEVBQUUsaUJBQWlCVSxLQUFLLG9CQUk3RSxRQUFTYSxTQUFRQyxFQUFVQyxHQUN2QnpCLEVBQUUwQixNQUNFQyxTQUFZLE9BQ1pDLEtBQVEsT0FDUkMsSUFBS3hCLEVBQUV5QixJQUFJQyxRQUFVLGdDQUNyQnJCLE1BQVNzQixPQUFRLGtCQUFtQlIsU0FBVUEsRUFBVUMsZUFBZ0JBLEVBQWdCUSxRQUFTNUIsRUFBRXlCLElBQUlHLFNBQ3ZHQyxRQUFTLFNBQVN4QixHQUNWVixFQUFFVyxVQUNGWCxFQUFFVyxTQUFTVCxRQUVmRixFQUFFLG9CQUFvQkMsT0FFdEJrQyxPQUFPQyxTQUFTcEIsS0FBT1gsRUFBRXlCLElBQUlDLFFBQVUsb0NBQW9DckIsRUFBSzJCLElBRXBGQyxNQUFPLFNBQVNBLEdBQ1osR0FBSTVCLEdBQU80QixFQUFNQyxZQUNidkMsR0FBRVcsVUFDRlgsRUFBRVcsU0FBU1QsUUFFZkYsRUFBRSxvQkFBb0JDLE9BQ3RCRCxFQUFFLHVCQUNHd0MsUUFBUSx5REFBMkQ5QixFQUFLNEIsTUFBUSxJQUFNNUIsRUFBSytCLFFBQVUsVUFHdEcvQixFQUFLZ0MsZUFBZSxXQUNwQkMsUUFBUUwsTUFBTTVCLEVBQUsrQixTQUNuQkUsUUFBUUwsTUFBTU0sS0FBS0MsVUFBVW5DLEVBQUtvQyxNQUFPLEtBQU0sUUE3Ri9EOUMsRUFBRStDLFVBQVVDLE1BQU0sV0FHZGhELEVBQUUwQixNQUNFQyxTQUFZLE9BQ1pDLEtBQVEsT0FDUkMsSUFBT3hCLEVBQUV5QixJQUFJQyxRQUFVLGdDQUN2QnJCLE1BQ0lzQixPQUFRLGlCQUNSUCxlQUFnQnpCLEVBQUUsaUJBQWlCVSxLQUFLLGtCQUN4Q3VCLFFBQVM1QixFQUFFeUIsSUFBSUcsU0FFbkJDLFFBQVcsU0FBU3hCLEdBQ1pBLEVBQUt1QyxZQUFhLEVBQ2xCZCxPQUFPQyxTQUFTcEIsS0FBT1gsRUFBRXlCLElBQUlDLFFBQVUsb0NBQW9DckIsRUFBS3dDLE1BRWhGekMsd0JBRUFULEVBQUUscUJBQXFCbUIsTUFBTW5CLEVBQUVvQixNQUFNdEIsWUFBYSxLQUFNRSxFQUFFVyxpQkFNMUVYLEVBQUUsaUJBQWlCbUQsR0FBRyxRQUFTLFdBQzNCbkQsRUFBRSxpQkFBaUJDLE9BQ25CRCxFQUFFLGNBQWNrQixPQUNoQkssUUFBUXZCLEVBQUVvRCxNQUFNMUMsS0FBSyxZQUFhVixFQUFFb0QsTUFBTTFDLEtBQUsiLCJmaWxlIjoidHVybml0aW50b29sdHdvX21pZ3JhdGlvbl90b29sLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XG5cbiAgICAvLyBDaGVjayB3aGV0aGVyIHRoaXMgYXNzaWdubWVudCBoYXMgYmVlbiBtaWdyYXRlZCBpbiB0aGlzIHNlc3Npb24gYW5kIHJlZGlyZWN0IGlmIHNvLlxuICAgICQuYWpheCh7XG4gICAgICAgIFwiZGF0YVR5cGVcIjogJ2pzb24nLFxuICAgICAgICBcInR5cGVcIjogXCJQT1NUXCIsXG4gICAgICAgIFwidXJsXCI6IE0uY2ZnLnd3d3Jvb3QgKyBcIi9tb2QvdHVybml0aW50b29sdHdvL2FqYXgucGhwXCIsXG4gICAgICAgIFwiZGF0YVwiOiB7XG4gICAgICAgICAgICBhY3Rpb246IFwiY2hlY2tfbWlncmF0ZWRcIixcbiAgICAgICAgICAgIHR1cm5pdGludG9vbGlkOiAkKFwiI21pZ3JhdGVfdHlwZVwiKS5kYXRhKFwidHVybml0aW50b29saWRcIiksXG4gICAgICAgICAgICBzZXNza2V5OiBNLmNmZy5zZXNza2V5XG4gICAgICAgIH0sXG4gICAgICAgIFwic3VjY2Vzc1wiOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YS5taWdyYXRlZCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gTS5jZmcud3d3cm9vdCArIFwiL21vZC90dXJuaXRpbnRvb2x0d28vdmlldy5waHA/aWQ9XCIrZGF0YS52MmlkO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBkaXNwbGF5TWlncmF0aW9uTW9kYWwoKTtcblxuICAgICAgICAgICAgICAgICQoJy5kb250bWlncmF0ZV9saW5rJykuY2xpY2soJC5wcm94eShkb250bWlncmF0ZSwgbnVsbCwgJC5jb2xvcmJveCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59KTtcblxuJCgnLm1pZ3JhdGVfbGluaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICQoJyNhc2t0b21pZ3JhdGUnKS5oaWRlKCk7XG4gICAgJCgnI21pZ3JhdGluZycpLnNob3coKTtcbiAgICBtaWdyYXRlKCQodGhpcykuZGF0YShcImNvdXJzZWlkXCIpLCAkKHRoaXMpLmRhdGEoXCJ0dXJuaXRpbnRvb2xpZFwiKSk7XG59KTtcblxuZnVuY3Rpb24gZG9udG1pZ3JhdGUoY2IpIHtcbiAgICAkKCcjbWlncmF0aW9uX2FsZXJ0JykuaGlkZSgpO1xuICAgIGNiLmNsb3NlKCk7XG59XG5cbmZ1bmN0aW9uIGxpZ2h0Qm94Q2xvc2VCdXR0b24oY2IpIHtcbiAgICAkKCdib2R5JykuYXBwZW5kKCc8ZGl2IGlkPVwidGlpX2Nsb3NlX2JhclwiPjxhIGNsYXNzPVwidGlpX2Nsb3NlX2xpbmtcIiBocmVmPVwiI1wiPicgKyBNLnN0ci50dXJuaXRpbnRvb2x0d28uY2xvc2VidXR0b24gKyAnPC9hPjwvZGl2PicpO1xufVxuXG5cbmZ1bmN0aW9uIGRpc3BsYXlNaWdyYXRpb25Nb2RhbCgpIHtcbiAgICAvLyBPbmx5IGRpc3BsYXkgdGhlIG1vZGFsIGR1cmluZyBhIG1hbnVhbCBtaWdyYXRpb24uXG4gICAgaWYgKCQoJyNtaWdyYXRlX3R5cGUnKS5kYXRhKFwidHVybml0aW50b29saWRcIikgIT0gJChcIiNtaWdyYXRlX3R5cGVcIikuZGF0YShcImxhc3Rhc2tlZFwiKSkge1xuICAgICAgICAkLmNvbG9yYm94KHt3aWR0aDogNTUwLCBoZWlnaHQ6IDYwMCwgaW5saW5lOnRydWUsIG9wYWNpdHk6IFwiMC43XCIsIGhyZWY6XCIjbWlncmF0aW9uX2FsZXJ0XCIsXG4gICAgICAgICAgICBvbkxvYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICQoJyNhc2t0b21pZ3JhdGUnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgbGlnaHRCb3hDbG9zZUJ1dHRvbigpO1xuXG4gICAgICAgICAgICAgICAgJCgnLnRpaV9jbG9zZV9saW5rJykuY2xpY2soJC5wcm94eShkb250bWlncmF0ZSwgbnVsbCwgJC5jb2xvcmJveCkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uQ2xlYW51cDpmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkKCcjdGlpX2Nsb3NlX2JhcicpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICQoJyNtaWdyYXRpb25fYWxlcnQnKS5oaWRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJyNtaWdyYXRpb25fYWxlcnQnKS5zaG93KCk7XG4gICAgfVxuXG4gICAgaWYgKCQoJyNtaWdyYXRlX3R5cGUnKS5kYXRhKFwibWlncmF0ZXR5cGVcIikgPT0gMikge1xuICAgICAgICAkKCcjYXNrdG9taWdyYXRlJykuaGlkZSgpO1xuICAgICAgICAkKCcjbWlncmF0aW5nJykuc2hvdygpO1xuXG4gICAgICAgIG1pZ3JhdGUoJChcIiNtaWdyYXRlX3R5cGVcIikuZGF0YShcImNvdXJzZWlkXCIpLCAkKFwiI21pZ3JhdGVfdHlwZVwiKS5kYXRhKFwidHVybml0aW50b29saWRcIikpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gbWlncmF0ZShjb3Vyc2VpZCwgdHVybml0aW50b29saWQpIHtcbiAgICAkLmFqYXgoe1xuICAgICAgICBcImRhdGFUeXBlXCI6ICdqc29uJyxcbiAgICAgICAgXCJ0eXBlXCI6IFwiUE9TVFwiLFxuICAgICAgICB1cmw6IE0uY2ZnLnd3d3Jvb3QgKyBcIi9tb2QvdHVybml0aW50b29sdHdvL2FqYXgucGhwXCIsXG4gICAgICAgIFwiZGF0YVwiOiB7YWN0aW9uOiBcImJlZ2luX21pZ3JhdGlvblwiLCBjb3Vyc2VpZDogY291cnNlaWQsIHR1cm5pdGludG9vbGlkOiB0dXJuaXRpbnRvb2xpZCwgc2Vzc2tleTogTS5jZmcuc2Vzc2tleX0sXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgIGlmICgkLmNvbG9yYm94KSB7XG4gICAgICAgICAgICAgICAgJC5jb2xvcmJveC5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJCgnI21pZ3JhdGlvbl9hbGVydCcpLmhpZGUoKTtcblxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBNLmNmZy53d3dyb290ICsgXCIvbW9kL3R1cm5pdGludG9vbHR3by92aWV3LnBocD9pZD1cIitkYXRhLmlkO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0gZXJyb3IucmVzcG9uc2VKU09OO1xuICAgICAgICAgICAgaWYgKCQuY29sb3Jib3gpIHtcbiAgICAgICAgICAgICAgICAkLmNvbG9yYm94LmNsb3NlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkKCcjbWlncmF0aW9uX2FsZXJ0JykuaGlkZSgpO1xuICAgICAgICAgICAgJCgnI3R1cm5pdGludG9vbF9zdHlsZScpXG4gICAgICAgICAgICAgICAgLnByZXBlbmQoJzxkaXYgaWQ9XCJmdWxsLWVycm9yXCIgY2xhc3M9XCJib3ggZ2VuZXJhbGJveCBub3RpY2Vib3hcIj4nICsgZGF0YS5lcnJvciArICcgJyArIGRhdGEubWVzc2FnZSArICc8L2Rpdj4nKTtcblxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgd2UgaGF2ZSBhIHN0YWNrIHRyYWNlIGluY2x1ZGVkLlxuICAgICAgICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoJ3RyYWNlJykpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGRhdGEubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihKU09OLnN0cmluZ2lmeShkYXRhLnRyYWNlLCBudWxsLCA0KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbiJdfQ==

define(["jquery","core/log","core/yui","theme_snap/pm_course_cards","theme_snap/util","theme_snap/ajax_notification"],function(a,b,c,d,e,f){var g=function(){var c=this,g=!1;this.update=function(){if(g){var c=M.cfg.wwwroot+"/user/policy.php";return void(window.location=c)}d.reqCourseInfo(d.getCourseIds()),a("#snap-pm").focus();var h=function(c){var d=a("#snap-personal-menu-"+c);if(a(d).length){var g=M.cfg.sesskey+"personal-menu-"+c;try{if(e.supportsSessionStorage()&&window.sessionStorage[g]){b.info("using locally stored "+c);var h=window.sessionStorage[g];a(d).html(h)}b.info("fetching "+c),a.ajax({type:"GET",async:!0,url:M.cfg.wwwroot+"/theme/snap/rest.php?action=get_"+c+"&contextid="+M.cfg.context,success:function(h){f.ifErrorShowBestMsg(h).done(function(f){f||(b.info("fetched "+c),e.supportsSessionStorage()&&"undefined"!=typeof h.html&&(window.sessionStorage[g]=h.html),a(d).attr("data-content-loaded","1"),a(d).html(h.html))})}})}catch(i){sessionStorage.clear(),b.error(i)}}};h("deadlines"),h("graded"),h("grading"),h("messages"),h("forumposts"),a(document).trigger("snapUpdatePersonalMenu")};var h=function(){var b=function(b){var c=a("#snap-pm-content section"),d=a(c).outerWidth(),e=a(b),f=a("#snap-pm-updates section > div").index(e)+1,g=d*f,h=a(b).outerHeight()+200;"#snap-pm-courses"==b&&(g=0);var i=a(window).height();return h<i&&(h=i),{left:g,height:h}};a(window).on("resize",function(){if(window.innerWidth>=992)return void a("#snap-pm-content").removeAttr("style");var c=a("#snap-pm-mobilemenu a.state-active");if(c&&c.length){var d=c.attr("href"),e=b(d);a("#snap-pm-content").css("left","-"+e.left+"px"),a("#snap-pm-content").css("height",e.height+"px")}}),a(document).on("click","#snap-pm-mobilemenu a",function(c){var d=this.getAttribute("href"),e=b(d);a("html, body").animate({scrollTop:0},0),a("#snap-pm-content").animate({left:"-"+e.left+"px",height:e.height+"px"},"700","swing",function(){}),a("#snap-pm-mobilemenu a").removeClass("state-active"),a(this).addClass("state-active"),c.preventDefault()})},i=function(){a(document).on("click",".js-snap-pm-trigger",function(b){a("body").toggleClass("snap-pm-open"),a(".snap-pm-open #snap-pm").is(":visible")&&c.update(),b.preventDefault()}),h()};this.init=function(a){g=a,i(),g||d.init()}};return new g});
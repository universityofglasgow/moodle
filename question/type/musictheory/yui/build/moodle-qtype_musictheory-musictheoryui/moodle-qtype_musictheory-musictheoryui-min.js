YUI.add("moodle-qtype_musictheory-musictheoryui",function(e,t){M.qtype_musictheory=M.qtype_musictheory||{},M.qtype_musictheory.musictheoryui={init:function(){}},MusThGUI=function(e,t,n){this.callBack=function(e){return function(t){e(t)}},this.UI=new MusThGUI.Control.Controller(e,t,this.callBack(n))},MusThGUI.GUIState={},MusThGUI.Render={},MusThGUI.Render.Renderer=function(e,t,n,r){this.can=e,this.state=t,this.coordMgr=n,this.glyphProvider=r},MusThGUI.Render.Renderer.prototype.draw=function(){var e=new MusThGUI.Render.StaffSystemRend(this.can,this.coordMgr,this.glyphProvider,this.state.staffSystem,this.state.accCarryOver);e.draw();var t;for(t=0;t<this.state.toolbars.length;t++){var n=new MusThGUI.Render.ToolbarRend(this.can,this.coordMgr,this.glyphProvider,this.state.toolbars[t]);n.draw(t)}},MusThGUI.Control={},MusThGUI.Control.Controller=function(t,n,r){this.canID=t,this.canNode=e.one("#"+t),this.html5Can=this.canNode.getDOMNode(),this.ctx=this.html5Can.getContext("2d"),this.stateXML=e.XML.parse(n),this.state=new MusThGUI.GUIState.State,this.state.setState(this.stateXML),this.coordMgr=new MusThGUI.Render.CoordManager(this.state),this.html5Can.width=this.coordMgr.canvasWidth,this.html5Can.height=this.coordMgr.canvasHeight,this.callBack=r,this.inputDialog=null,this.bindEventListeners(),this.ghostNote=null,this.ghostAcc=null;var i=this;this.glyphProvider=new MusThGUI.Render.GlyphProvider(function(){i.onImagesLoaded()})},MusThGUI.Control.Controller.prototype.onImagesLoaded=function(){this.renderer=new MusThGUI.Render.Renderer(this.html5Can,this.state,this.coordMgr,this.glyphProvider),this.drawState()},MusThGUI.Control.Controller.prototype.getLocalCoord=function(e){var t={x:this.canNode.getXY()[0],y:this.canNode.getXY()[1]};return{x:e.pageX-t.x,y:e.pageY-t.y}},MusThGUI.Control.Controller.prototype.bindEventListeners=function(){if(!this.state.editable)return;var e=this;this.canNode.detachAll(),this.canNode.on("click",function(t){var n=e.getLocalCoord(t);e.onMouseClick({x:n.x,y:n.y})}),this.canNode.on("mousemove",function(t){var n=e.getLocalCoord(t);e.onMouseMove({x:n.x,y:n.y})}),this.canNode.on("mouseleave",function(){e.removeGhostNote(),e.removeGhostAcc(),e.clearToolbarOverlays(),e.drawState()})},MusThGUI.Control.Controller.prototype.onMouseClick=function(t){var n=this.getElementFromPoint(t),r,i;if(n.elemType!==null){if(n.elemType==="note"){var s=this.state.staffSystem.staves[n.staffID],o=s.noteColumns[n.colID];r=n.noteName.substr(0,1),i=parseInt(n.noteName.substr(1,1),10);var u=this.state.hasToolbar("acc")?this.state.getToolbar("acc").selectedSymbol():"n",a=this.state.hasToolbar("noteVal")?this.state.getToolbar("noteVal").selectedSymbol():"whole",f=new MusThGUI.GUIState.Note(r,i,u,a,!0,!1);o.noteAddible(f)?(this.removeGhostNote(),o.addNote(f),this.callBack(this.state.getState())):o.noteRemovable(f)&&(o.removeNote(f),this.callBack(this.state.getState()))}else if(n.elemType==="keysign"&&this.state.hasToolbar("acc")){var l=this.state.staffSystem.staves[n.staffID].keySign,c=n.colID>l.totalAccColumns-1?l.totalAccColumns:n.colID;r=n.noteName.substr(0,1),i=parseInt(n.noteName.substr(1,1),10);if(l.containsEditableAccidental(r,i,c))l.removeAccidental(c),this.callBack(this.state.getState());else if(!l.isFull()&&!l.columnIsFull(c)&&this.state.hasToolbar("acc")){var h=this.state.getToolbar("acc").selectedSymbol();if(h==="#"||h==="b"){var p=new MusThGUI.GUIState.KeySignAcc(this.state.getToolbar("acc").selectedSymbol(),r,i,!0,!1);this.removeGhostAcc(),l.addAccidental(p),this.callBack(this.state.getState())}}}else if(n.elemType==="toolbar")this.state.getToolbar(n.toolbarName).select(n.buttonID);else if(n.elemType==="textInput"){var d=this;e.Array.each(this.state.staffSystem.staves,function(e){var t=e.noteColumns[n.colID].textInput;t!==null&&(typeof d.inputDialog=="undefined"&&(d.inputDialog=new MusThGUI.Control.InputDialog(d,d.parsedXML)),d.inputDialog.colID=n.colID,d.inputDialog.show())})}this.drawState()}},MusThGUI.Control.Controller.prototype.onMouseMove=function(e){this.removeGhostNote(),this.removeGhostAcc(),this.clearToolbarOverlays();var t,n,r=this.getElementFromPoint(e);if(r.elemType!==null)if(r.elemType==="note"){var i=this.state.staffSystem.staves[r.staffID],s=i.noteColumns[r.colID];t=r.noteName.substr(0,1),n=r.noteName.substr(1,1);var o=this.state.hasToolbar("acc")?this.state.getToolbar("acc").selectedSymbol():"n",u=this.state.hasToolbar("noteVal")?this.state.getToolbar("noteVal").selectedSymbol():"whole",a=new MusThGUI.GUIState.Note(t,n,o,u,!0,!0);s.noteAddible(a)&&(s.addNote(a),this.ghostNote={note:a,staffID:r.staffID,colID:r.colID})}else if(r.elemType==="keysign"&&this.state.hasToolbar("acc")){var f=this.state.staffSystem.staves[r.staffID].keySign,l=r.colID>f.totalAccColumns-1?f.totalAccColumns:r.colID;t=r.noteName.substr(0,1),n=parseInt(r.noteName.substr(1,1),10);if(!f.isFull()&&!f.columnIsFull(l)&&this.state.hasToolbar("acc")){var c=this.state.getToolbar("acc").selectedSymbol();if(c==="#"||c==="b"){var h=new MusThGUI.GUIState.KeySignAcc(this.state.getToolbar("acc").selectedSymbol(),t,n,!0,!0);f.addAccidental(h),this.ghostAcc={staffID:r.staffID}}}}else r.elemType==="toolbar"&&r.buttonID!==this.state.getToolbar(r.toolbarName).selectedID()&&this.state.getToolbar(r.toolbarName).setMouseOverlay(r.buttonID);else this.clearToolbarOverlays();this.drawState()},MusThGUI.Control.Controller.prototype.getElementFromPoint=function(t){var n=[];e.Array.each(this.state.staffSystem.staves,function(e){n.push(e.clef)});var r=this.state.staffSystem.staves[0].noteColumns.length,i=this.state.staffSystem.staves[0].keySign.totalAccColumns,s=this.coordMgr.getElementByPos(t,n,r,i,this.state.toolbars,this.state.staffSystem.hasTextInput());return s},MusThGUI.Control.Controller.prototype.removeGhostNote=function(){if(this.ghostNote!==null&&typeof (this.ghostNote!=="undefined")){var e=this.state.staffSystem.staves[this.ghostNote.staffID];e.noteColumns[this.ghostNote.colID].removeGhostNote(),this.ghostNote=null}},MusThGUI.
Control.Controller.prototype.removeGhostAcc=function(){if(this.ghostAcc!==null&&typeof this.ghostAcc!="undefined"){var e=this.state.staffSystem.staves[this.ghostAcc.staffID];if(e.keySign.accidentals.length>0){var t=e.keySign.accidentals.length-1;e.keySign.accidentals[t].isGhost&&e.keySign.removeAccidental(t)}}},MusThGUI.Control.Controller.prototype.clearToolbarOverlays=function(){if(this.state.toolbars.length>0){var e;for(e=0;e<this.state.toolbars.length;e++)this.state.toolbars[e].setMouseOverlay(null)}},MusThGUI.Control.Controller.prototype.drawState=function(){typeof this.renderer!="undefined"&&this.renderer!==null&&(this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.coordMgr.canvasWidth,this.coordMgr.canvasHeight),this.renderer.draw())},MusThGUI.Control.Controller.prototype.setColTextInput=function(t,n){var r=this;e.Array.each(this.state.staffSystem.staves,function(e){var i=e.noteColumns[t].textInput;i!==null&&(i.value=n,r.callBack(r.state.getState()),r.drawState())})},MusThGUI.Render.CoordManager=function(e){this.state=e,this.PADDING_BETWEEN_STAVES=10,this.CANVAS_PADDING_Y=20,this.CANVAS_PADDING_X=20,this.STAFF_END_PADDING=10,this.TEXT_INPUT_PORTION_HEIGHT=40,this.TOOLBARBUTTON_SIZE=36,this.STAFF_LINE_DISTANCE=10,this.CLEF_COL_WIDTH=40,this.KEY_SIGN_ACC_COL_WIDTH=12,this.max_num_ledger_lines=this.state.staffSystem.maxLedgerLines,this.staff_ledger_line_portion_height=(this.max_num_ledger_lines+1)*this.STAFF_LINE_DISTANCE;var t=0,n;for(n=0;n<this.state.staffSystem.staves[0].noteColumns.length;n++){var r=this.state.staffSystem.staves[0].noteColumns[n];t=Math.max(r.maxNotes,t)}this.note_col_width=this.getColWidth(t),this.textInputWidth=this.note_col_width-10,this.textInputHeight=this.TEXT_INPUT_PORTION_HEIGHT/2,this.canvasWidth=this.getCanvasWidth(this.state.staffSystem.staves[0].noteColumns.length,this.state.staffSystem.staves[0].keySign.totalAccColumns,this.state.toolbars.length),this.canvasHeight=this.getCanvasHeight(this.state.staffSystem.staves.length,this.state.getMaxNumToolbarButtons(),this.state.staffSystem.hasTextInput()),this.notes=this.noteArrayBuild(),this.noteLedgerLines=this.setLedgerLines();var i=this.notes.F5+this.max_num_ledger_lines*2+1,s=this.notes.A3+this.max_num_ledger_lines*2+1,o=this.notes.G4+this.max_num_ledger_lines*2+1,u=this.notes.E4+this.max_num_ledger_lines*2+1;this.topNotes={treble:this.notes[i],bass:this.notes[s],alto:this.notes[o],tenor:this.notes[u]}},MusThGUI.Render.CoordManager.prototype.getCanvasWidth=function(e,t,n){var r=this.getStaffWidth(e,t);return r+=n*this.TOOLBARBUTTON_SIZE,r+=this.CANVAS_PADDING_X*Math.max(n-1,0),r+this.CANVAS_PADDING_X*2},MusThGUI.Render.CoordManager.prototype.getCanvasHeight=function(e,t,n){var r=this.getStaffSystemHeight(e)+this.CANVAS_PADDING_Y*2,i=t*this.TOOLBARBUTTON_SIZE,s=Math.max(r,i);return n&&(s+=this.TEXT_INPUT_PORTION_HEIGHT),s},MusThGUI.Render.CoordManager.prototype.getColWidth=function(e){if(typeof this.note_col_width!="undefined"&&this.note_col_width!==null)return this.note_col_width;switch(e){case 0:return 0;case 1:return 50;case 2:return 80;case 3:return 100;case 4:return 126;default:return 150}},MusThGUI.Render.CoordManager.prototype.noteArrayBuild=function(){var e=[],t=[];t[0]="C",t[1]="D",t[2]="E",t[3]="F",t[4]="G",t[5]="A",t[6]="B";var n=0;e.A0=n,e[n]="A0",n++,e.B0=n,e[n]="B0";var r,i;for(r=1;r<=7;r++)for(i=0;i<=6;i++)n++,e[t[i]+r]=n,e[n]=t[i]+r;return n++,e.C8=n,e[n]="C8",e},MusThGUI.Render.CoordManager.prototype.setLedgerLines=function(){var e=[],t=new Array("treble","bass","alto","tenor"),n=new Array(this.notes.F5,this.notes.A3,this.notes.G4,this.notes.E4),r=new Array(this.notes.E4,this.notes.G2,this.notes.F3,this.notes.D3),i,s,o,u,a,f;for(i=0;i<this.notes.length;i++){u=this.notes[i];for(s=0;s<t.length;s++)o=t[s],i<r[s]-1?(a=Math.abs(r[s]-i),f=Math.floor(a/2),e[o+"-"+u]={numLines:f,loc:"below"}):i>=r[s]-1&&i<=n[s]+1?e[o+"-"+u]={numLines:0,loc:null}:(a=Math.abs(i-n[s]),f=Math.floor(a/2),e[o+"-"+u]={numLines:f,loc:"above"})}return e},MusThGUI.Render.CoordManager.prototype.getStaffWidth=function(e,t){var n=this.CLEF_COL_WIDTH,r=t*this.KEY_SIGN_ACC_COL_WIDTH,i=e*this.note_col_width;return n+r+i+this.STAFF_END_PADDING},MusThGUI.Render.CoordManager.prototype.getStaffHeight=function(e){var t;return e?t=this.STAFF_LINE_DISTANCE*4+(this.max_num_ledger_lines+1)*this.STAFF_LINE_DISTANCE*2:t=t=this.STAFF_LINE_DISTANCE*4,t},MusThGUI.Render.CoordManager.prototype.getStaffSystemHeight=function(e){return this.getStaffHeight(!0)*e+this.PADDING_BETWEEN_STAVES*(e-1)},MusThGUI.Render.CoordManager.prototype.getStaffSystemOrigin=function(){return{x:this.CANVAS_PADDING_X,y:this.CANVAS_PADDING_Y}},MusThGUI.Render.CoordManager.prototype.getStaffOrigin=function(e){var t=this.getStaffSystemOrigin().y+this.staff_ledger_line_portion_height+e*(this.getStaffHeight(!0)+this.PADDING_BETWEEN_STAVES);return{x:this.getStaffSystemOrigin().x,y:t}},MusThGUI.Render.CoordManager.prototype.getStaffLinePos=function(e,t){var n=this.getStaffOrigin(e),r=n.y+t*this.STAFF_LINE_DISTANCE;return{x:n.x,y:r}},MusThGUI.Render.CoordManager.prototype.getClefPos=function(e){var t=this.getStaffOrigin(e),n=t.x+this.CLEF_COL_WIDTH/2;return{x:n,y:t.y}},MusThGUI.Render.CoordManager.prototype.getKeySignAccPos=function(e,t,n,r,i){var s=this.getKeySignColCenterX(e,n),o=this.getLetterNameY(e,t,r,i);return{x:s,y:o}},MusThGUI.Render.CoordManager.prototype.getKeySignColCenterX=function(e,t){return this.getStaffOrigin(e).x+this.CLEF_COL_WIDTH+t*this.KEY_SIGN_ACC_COL_WIDTH+this.KEY_SIGN_ACC_COL_WIDTH/2},MusThGUI.Render.CoordManager.prototype.getTopNoteY=function(e){var t=this.getStaffOrigin(e).y-this.staff_ledger_line_portion_height+this.STAFF_LINE_DISTANCE/2;return t},MusThGUI.Render.CoordManager.prototype.getLetterNameY=function(e,t,n,r){var i=this.getStepwiseNoteDist(this.topNotes[t],n+r),s=this.getTopNoteY(e),o=s+i*(this.STAFF_LINE_DISTANCE/2);return o},MusThGUI.Render.CoordManager.prototype.getStepwiseNoteDist=function(e,t){return Math.abs(this.notes[e]-this.notes[
t])},MusThGUI.Render.CoordManager.prototype.getNoteColCenterX=function(e,t,n){var r=this.note_col_width;return this.getStaffOrigin(e).x+this.CLEF_COL_WIDTH+n*this.KEY_SIGN_ACC_COL_WIDTH+t*r+r/2},MusThGUI.Render.CoordManager.prototype.getNotePos=function(e,t,n,r,i,s){var o=this.getNoteColCenterX(n,i,s),u=this.getLetterNameY(n,r,e,t);return{x:o,y:u}},MusThGUI.Render.CoordManager.prototype.getLedgerLinesY=function(e,t,n,r){var i=this.getStaffLinePos(e,0).y,s=i+this.getStaffHeight(!1),o=this.noteLedgerLines[t+"-"+n+r].numLines,u=this.noteLedgerLines[t+"-"+n+r].loc,a=[];if(o===0)return a;var f,l=u==="above"?i-o*this.STAFF_LINE_DISTANCE:s+o*this.STAFF_LINE_DISTANCE;if(u==="above")for(f=0;f<o;f++)a.push(l+f*this.STAFF_LINE_DISTANCE);else for(f=0;f<o;f++)a.push(l-f*this.STAFF_LINE_DISTANCE);return a},MusThGUI.Render.CoordManager.prototype.getIntervalSize=function(e,t){return Math.abs(this.notes[t]-this.notes[e])+1},MusThGUI.Render.CoordManager.prototype.getElementByPos=function(e,t,n,r,i,s){var o,u;for(o=0;o<t.length;o++){u=this.pointToStaffNote(e,o,t[o],n,r);if(u!==undefined&&u!==null&&u.elemType!==null)return u;u=this.pointToKeySignAcc(e,o,t[o],r);if(u!==undefined&&u!==null&&u.elemType!==null)return u}for(o=0;o<i.length;o++){u=this.pointToToolbarBtn(e,o,i[o].name,i[o].buttons.length);if(u.elemType!==null)return u}if(s){u=this.pointToTextInput(e,n,r);if(u.elemType!==null)return u}return{elemType:null}},MusThGUI.Render.CoordManager.prototype.pointToTextInput=function(e,t,n){var r,i,s,o,u;for(r=0;r<t;r++){i=this.getNoteColCenterX(0,r,n)-this.textInputWidth/2,s=i+this.textInputWidth,o=this.canvasHeight-this.TEXT_INPUT_PORTION_HEIGHT/2-this.textInputHeight/2,u=o+this.textInputHeight;if(e.x>=i&&e.x<=s&&e.y>=o&&e.y<=u)return{elemType:"textInput",colID:r}}return{elemType:null}},MusThGUI.Render.CoordManager.prototype.pointToStaffNote=function(e,t,n,r,i){var s=this.getStaffOrigin(t),o={x:s.x+this.CLEF_COL_WIDTH+this.KEY_SIGN_ACC_COL_WIDTH*i,y:s.y-this.staff_ledger_line_portion_height+this.STAFF_LINE_DISTANCE*.25},u={x:s.x+this.CLEF_COL_WIDTH+this.KEY_SIGN_ACC_COL_WIDTH*i+r*this.note_col_width-1,y:s.y+this.getStaffHeight(!1)+this.staff_ledger_line_portion_height-this.STAFF_LINE_DISTANCE*.25};if(this.pointWithin(e,o,u)){var a=Math.floor(Math.abs(e.x-o.x)/this.note_col_width),f=this.getNoteFromY(t,n,e.y);return{elemType:"note",staffID:t,colID:a,noteName:f}}return{elemType:null}},MusThGUI.Render.CoordManager.prototype.pointToKeySignAcc=function(e,t,n,r){var i=this.getStaffOrigin(t),s={x:i.x+this.CLEF_COL_WIDTH,y:i.y-this.STAFF_LINE_DISTANCE*.75},o={x:i.x+this.CLEF_COL_WIDTH+r*this.KEY_SIGN_ACC_COL_WIDTH-1,y:i.y+this.getStaffHeight(!1)+this.STAFF_LINE_DISTANCE*.75};if(this.pointWithin(e,s,o)){var u=this.getNoteFromY(t,n,e.y),a=Math.floor(Math.abs(e.x-s.x)/this.KEY_SIGN_ACC_COL_WIDTH);return{elemType:"keysign",staffID:t,colID:a,noteName:u}}return{elemType:null}},MusThGUI.Render.CoordManager.prototype.pointToToolbarBtn=function(e,t,n,r){var i=this.canvasWidth-this.TOOLBARBUTTON_SIZE*(t+1)-this.CANVAS_PADDING_X*t,s={x:i,y:this.getToolbarY(r)},o={x:i+this.TOOLBARBUTTON_SIZE,y:this.getToolbarY(r)+r*this.TOOLBARBUTTON_SIZE};if(this.pointWithin(e,s,o)){var u=Math.floor((e.y-this.getToolbarY(r))/this.TOOLBARBUTTON_SIZE);return{elemType:"toolbar",toolbarName:n,buttonID:u}}return{elemType:null}},MusThGUI.Render.CoordManager.prototype.getNoteFromY=function(e,t,n){var r=this.getTopNoteY(e)-this.STAFF_LINE_DISTANCE/2/2,i=Math.abs(r-n),s=Math.floor(i/(this.STAFF_LINE_DISTANCE/2)),o=this.notes[this.notes[this.topNotes[t]]-s];return o},MusThGUI.Render.CoordManager.prototype.pointWithin=function(e,t,n){return e.x>=t.x&&e.x<=n.x&&e.y>=t.y&&e.y<=n.y?!0:!1},MusThGUI.Render.CoordManager.prototype.getToolbarBtnSize=function(){return{width:this.TOOLBARBUTTON_SIZE,height:this.TOOLBARBUTTON_SIZE}},MusThGUI.Render.CoordManager.prototype.getToolbarX=function(e){return this.canvasWidth-this.TOOLBARBUTTON_SIZE*(e+1)-this.CANVAS_PADDING_X*e},MusThGUI.Render.CoordManager.prototype.getToolbarY=function(e){var t=this.TOOLBARBUTTON_SIZE*e,n=(this.canvasHeight-t)/2;return n},MusThGUI.GUIState.StaffSystem=function(){this.staves=[],this.maxLedgerLines=3},MusThGUI.GUIState.StaffSystem.prototype.addStaff=function(e){this.staves.push(e)},MusThGUI.GUIState.StaffSystem.prototype.hasTextInput=function(){var e=!1,t,n,r;for(t=0;t<this.staves.length;t++){var i=this.staves[t];for(n=0;n<i.noteColumns.length;n++){r=i.noteColumns[n];if(r.textInput!==null)if(r.textInput.editable||r.textInput.value!==""){e=!0;break}}}return e},MusThGUI.GUIState.Staff=function(e,t){this.clef=e,this.keySign=t,this.noteColumns=[]},MusThGUI.GUIState.Staff.prototype.addNoteColumn=function(e){this.noteColumns.push(e)},MusThGUI.GUIState.NoteCol=function(e,t){if(arguments.length===0)return;this.notes=[],this.maxNotes=parseInt(e,10),this.textInput=t},MusThGUI.GUIState.NoteCol.prototype.addNote=function(e){this.notes.push(e),this.notes.sort(function(e,t){var n=-MusThGUI.GUIState.Note.compare(e,t);return n})},MusThGUI.GUIState.NoteCol.prototype.removeNote=function(e){var t=e.letter,n=e.register,r;for(r=0;r<this.notes.length;r++)if(this.notes[r].letter===t&&this.notes[r].register===n)break;this.notes.splice(r,1)},MusThGUI.GUIState.NoteCol.prototype.removeGhostNote=function(){var e;for(e=0;e<this.notes.length;e++)if(this.notes[e].isGhost)break;this.notes.splice(e,1)},MusThGUI.GUIState.NoteCol.prototype.inColumn=function(e){var t=null,n=e.letter,r=e.register,i;for(i=0;i<this.notes.length;i++)if(this.notes[i].letter===n&&this.notes[i].register===r&&this.notes[i].isGhost===!1){t=this.notes[i];break}return t},MusThGUI.GUIState.NoteCol.prototype.isFull=function(){var e=0,t=0;for(e=0;e<this.notes.length;e++)this.notes[e].isGhost||t++;return t>=this.maxNotes?!0:!1},MusThGUI.GUIState.NoteCol.prototype.noteAddible=function(e){return this.inColumn(e)===null&&!this.isFull()?!0:!1},MusThGUI.GUIState.NoteCol.prototype.noteRemovable=function(e){var t=this.inColumn(e);return t!==null?t.editable?!0:!1:!1}
,MusThGUI.GUIState.TwoVoiceNoteCol=function(e,t){MusThGUI.GUIState.NoteCol.call(this,2,t),this.superclass=MusThGUI.GUIState.NoteCol.prototype,this.figBass=e},MusThGUI.GUIState.TwoVoiceNoteCol.prototype=new MusThGUI.GUIState.NoteCol,MusThGUI.GUIState.TwoVoiceNoteCol.prototype.constructor=MusThGUI.GUIState.TwoVoiceNoteCol,MusThGUI.GUIState.TwoVoiceNoteCol.prototype.addNote=function(e){this.superclass.addNote.call(this,e),this.rearrangeStems()},MusThGUI.GUIState.TwoVoiceNoteCol.prototype.removeNote=function(e){var t=e.letter,n=e.register,r=null,i=0,s;for(s=0;s<this.notes.length;s++)this.notes[s].letter===t&&this.notes[s].register===n&&this.notes[s].editable&&(r===null&&(r=s),i+=1);this.notes.splice(r,i),this.rearrangeStems()},MusThGUI.GUIState.TwoVoiceNoteCol.prototype.removeGhostNote=function(){var e;for(e=0;e<this.notes.length;e++)if(this.notes[e].isGhost)break;this.notes.splice(e,1),this.rearrangeStems()},MusThGUI.GUIState.TwoVoiceNoteCol.prototype.rearrangeStems=function(){var e=typeof this.notes[0]!="undefined"?this.notes[0]:null,t=typeof this.notes[1]!="undefined"?this.notes[1]:null;if(e!==null&&t!==null&&t.isGhost&&e.letter===t.letter&&e.register===t.register){var n=t;t=e,e=n}e!==null&&t!==null?e.editable&&t.editable?(e.noteValue="quarter_stem_up",t.noteValue="quarter_stem_down"):e.editable?t.noteValue==="quarter_stem_up"?e.noteValue="quarter_stem_down":e.noteValue="quarter_stem_up":t.editable&&(e.noteValue==="quarter_stem_up"?t.noteValue="quarter_stem_down":t.noteValue="quarter_stem_up"):e!==null?e.editable&&(e.noteValue="quarter_stem_up"):t!==null&&t.editable&&(t.noteValue="quarter_stem_up")},MusThGUI.GUIState.TwoVoiceNoteCol.prototype.noteAddible=function(e){if(this.isFull())return!1;if(this.lengthWithoutGhost()===0)return!0;var t=this.getFirstNonGhost();if(!t.editable){var n=MusThGUI.GUIState.Note.compare(e,t);return t.noteValue==="quarter_stem_up"?n<=0:n>=0}return!0},MusThGUI.GUIState.TwoVoiceNoteCol.prototype.noteRemovable=function(e){var t=this.inColumn(e);return t!==null?!0:!1},MusThGUI.GUIState.TwoVoiceNoteCol.prototype.lengthWithoutGhost=function(){var e=0,t;for(t=0;t<this.notes;t++)this.notes[t].isGhost||(e+=1);return e},MusThGUI.GUIState.TwoVoiceNoteCol.prototype.getFirstNonGhost=function(){var e;for(e=0;e<this.notes.length;e++)if(!this.notes[e].isGhost)return this.notes[e];return null},MusThGUI.GUIState.KeySign=function(e){this.accidentals=[],this.totalAccColumns=e},MusThGUI.GUIState.KeySign.prototype.addAccidental=function(e){this.accidentals.push(e)},MusThGUI.GUIState.KeySign.prototype.removeAccidental=function(e){this.accidentals.splice(e,1)},MusThGUI.GUIState.KeySign.prototype.containsEditableAccidental=function(e,t,n){if(!(n<this.accidentals.length))return!1;if(!this.accidentals[n].isGhost&&this.accidentals[n].letter===e&&this.accidentals[n].register===t&&this.accidentals[n].editable===!0)return!0},MusThGUI.GUIState.KeySign.prototype.isFull=function(){var e,t=0;for(e=0;e<this.accidentals.length;e++)this.accidentals[e].isGhost||t++;return t>=this.totalAccColumns},MusThGUI.GUIState.KeySign.prototype.columnIsFull=function(e){var t=!1;return e<this.accidentals.length&&(this.accidentals[e].isGhost||(t=!0)),t},MusThGUI.GUIState.KeySignAcc=function(e,t,n,r,i){this.type=e,this.letter=t,this.register=parseInt(n,10),this.editable=r,this.isGhost=i},MusThGUI.GUIState.Note=function(e,t,n,r,i,s){this.letter=e,this.register=parseInt(t,10),this.accidental=n,this.noteValue=r,this.editable=i,this.isGhost=s},MusThGUI.GUIState.Note.compare=function(e,t){var n=[];return n.C=0,n.D=1,n.E=2,n.F=3,n.G=4,n.A=5,n.B=6,e.register>t.register?1:e.register===t.register?n[e.letter]>n[t.letter]?1:n[e.letter]===n[t.letter]?0:-1:-1},MusThGUI.GUIState.State=function(){this.staffSystem=null,this.toolbars=[]},MusThGUI.GUIState.State.prototype.setState=function(e){this.stateXML=e;var t=this.stateXML.getElementsByTagName("MusThGUI");this.editable=t[0].getAttribute("canvasEditable")==="true",this.accCarryOver=t[0].getAttribute("accidentalCarryOver")==="true",this.staffSystem=new MusThGUI.GUIState.StaffSystem;var n,r,i,s,o,u,a=this.stateXML.getElementsByTagName("StaffSystem");for(n=0;n<a.length;n++){this.staffSystem.maxLedgerLines=parseInt(a[n].getAttribute("maxLedgerLines"),10);var f=a[n].getElementsByTagName("Staff");for(r=0;r<f.length;r++){var l=f[r].getAttribute("clef"),c=f[r].getElementsByTagName("KeySign")[0],h=c.getAttribute("totalAccColumns"),p=new MusThGUI.GUIState.KeySign(parseInt(h,10)),d=c.getElementsByTagName("Accidental");for(i=0;i<d.length;i++)o=d[i].getAttribute("editable")==="true",u=new MusThGUI.GUIState.KeySignAcc(d[i].getAttribute("type"),d[i].getAttribute("letter"),parseInt(d[i].getAttribute("register"),10),o,!1),p.addAccidental(u);var v=new MusThGUI.GUIState.Staff(l,p),m=f[r].getElementsByTagName("NoteColumn");for(i=0;i<m.length;i++){var g=parseInt(m[i].getAttribute("maxNotes"),10),y=null,b=m[i].getElementsByTagName("TextInput");for(s=0;s<b.length;s++)o=b[s].getAttribute("editable")==="true",y=new MusThGUI.GUIState.TextInput(b[s].getAttribute("value"),o);var w=m[i].getAttribute("type"),E;if(w==="two-voice"){var S=new MusThGUI.GUIState.FiguredBass,x,T=m[i].getElementsByTagName("Row");for(s=0;s<T.length;s++)x=new MusThGUI.GUIState.FiguredBassRow(T[s].getAttribute("text")),S.addRow(x);E=new MusThGUI.GUIState.TwoVoiceNoteCol(S,y)}else E=new MusThGUI.GUIState.NoteCol(g,y);var N=m[i].getElementsByTagName("Note");for(s=0;s<N.length;s++){o=N[s].getAttribute("editable")==="true",u=N[s].getAttribute("accidental")===""?"n":N[s].getAttribute("accidental");var C=new MusThGUI.GUIState.Note(N[s].getAttribute("letter"),N[s].getAttribute("register"),u,N[s].getAttribute("noteValue"),o,!1);E.addNote(C)}v.addNoteColumn(E)}this.staffSystem.addStaff(v)}}var k,L,A,O=this.stateXML.getElementsByTagName("AccidentalToolbar")[0];if(typeof O!="undefined"&&O!==null&&this.editable&&O.childNodes.length>0){this.toolbars.push(new MusThGUI.GUIState.Toolbar("acc")),k=this.toolbars[this.toolbars.length-1],A=O.getElementsByTagName
("Button");for(n=0;n<A.length;n++)L=new MusThGUI.GUIState.ToolbarBtn(A[n].getAttribute("symbol")),k.addButton(L);k.buttons[0].selected=!0}var M=this.stateXML.getElementsByTagName("NoteValueToolbar")[0];if(typeof M!="undefined"&&M!==null&&this.editable&&M.childNodes.length>0){this.toolbars.push(new MusThGUI.GUIState.Toolbar("noteVal")),k=this.toolbars[this.toolbars.length-1],A=M.getElementsByTagName("Button");for(n=0;n<A.length;n++)L=new MusThGUI.GUIState.ToolbarBtn(A[n].getAttribute("symbol")),k.addButton(L);k.buttons[0].selected=!0}},MusThGUI.GUIState.State.prototype.getState=function(){var t='<MusThGUI canvasEditable="'+this.editable+'" accidentalCarryOver="'+this.accCarryOver+'">\n';t+='    <StaffSystem maxLedgerLines="'+this.staffSystem.maxLedgerLines+'">\n',e.Array.each(this.staffSystem.staves,function(n){t+='        <Staff clef="'+n.clef+'">\n',t+='            <KeySign totalAccColumns="'+n.keySign.totalAccColumns+'">\n',e.Array.each(n.keySign.accidentals,function(e){e.isGhost||(t+='                <Accidental type="'+e.type+'" letter="'+e.letter+'" register="'+e.register+'" editable="'+e.editable+'" />\n')}),t+="            </KeySign>\n",t+="            <NoteColumns>\n",e.Array.each(n.noteColumns,function(n){n instanceof MusThGUI.GUIState.TwoVoiceNoteCol?t+='                <NoteColumn type="two-voice" maxNotes="'+n.maxNotes+'" >\n':t+='                <NoteColumn maxNotes="'+n.maxNotes+'" >\n',e.Array.each(n.notes,function(e){e.isGhost||(t+='                    <Note letter="'+e.letter+'" register="'+e.register+'" accidental="'+e.accidental+'" noteValue="'+e.noteValue+'" editable="'+e.editable+'" />\n')}),n instanceof MusThGUI.GUIState.TwoVoiceNoteCol&&n.figBass.rows.length>0&&(t+="                    <FiguredBass>\n",e.Array.each(n.figBass.rows,function(e){t+='                        <Row text="'+e.rowText+'" />\n'}),t+="                    </FiguredBass>\n"),n.textInput!==null&&(t+='                    <TextInput value="'+n.textInput.value+'" editable="'+n.textInput.editable+'" />\n'),t+="                </NoteColumn>\n"}),t+="            </NoteColumns>\n",t+="        </Staff>\n"}),t+="    </StaffSystem>\n";var n,r=this.stateXML.getElementsByTagName("AccidentalToolbar")[0];typeof r!="undefined"&&r!==null&&(n=e.XML.format(r),t+=n+"\n");var i=this.stateXML.getElementsByTagName("NoteValueToolbar")[0];typeof i!="undefined"&&i!==null&&(n=e.XML.format(i),t+=n+"\n");var s=this.stateXML.getElementsByTagName("InputDialog")[0];if(typeof s!="undefined"&&s!==null){var o=e.XML.format(s);t+=o+"\n"}return t+="</MusThGUI>",t},MusThGUI.GUIState.State.prototype.hasToolbar=function(e){var t;for(t=0;t<this.toolbars.length;t++)if(this.toolbars[t].name===e)return!0;return!1},MusThGUI.GUIState.State.prototype.getToolbar=function(e){var t;for(t=0;t<this.toolbars.length;t++)if(this.toolbars[t].name===e)return this.toolbars[t];return null},MusThGUI.GUIState.State.prototype.getMaxNumToolbarButtons=function(){var t=0;return e.Array.each(this.toolbars,function(e){t=Math.max(t,e.buttons.length)}),t},MusThGUI.Render.StaffSystemRend=function(e,t,n,r,i){this.can=e,this.staffSystem=r,this.coordMgr=t,this.glyphProvider=n,this.accCarryOver=i},MusThGUI.Render.StaffSystemRend.prototype.draw=function(){var e=this,t;for(t=0;t<this.staffSystem.staves.length;t++){var n=this.staffSystem.staves[t],r=new MusThGUI.Render.StaffRend(e.can,e.coordMgr,e.glyphProvider,n,t,e.accCarryOver);r.draw()}var i=this.coordMgr.getStaffWidth(this.staffSystem.staves[0].noteColumns.length,this.staffSystem.staves[0].keySign.totalAccColumns),s=this.coordMgr.getStaffOrigin(0).x,o=this.coordMgr.getStaffOrigin(0).y,u=this.coordMgr.getStaffOrigin(this.staffSystem.staves.length-1).y+this.coordMgr.getStaffHeight(!1),a=this.can.getContext("2d");a.beginPath(),a.moveTo(s,o),a.lineTo(s,u),a.stroke(),s+=i,a.beginPath(),a.moveTo(s,o),a.lineTo(s,u),a.stroke()},MusThGUI.Render.StaffRend=function(e,t,n,r,i,s){this.can=e,this.staff=r,this.coordMgr=t,this.staffID=i,this.glyphProvider=n,this.accCarryOver=s},MusThGUI.Render.StaffRend.prototype.draw=function(){this.drawLines(),this.drawClef(),this.drawKeySign(),this.drawNoteColumns()},MusThGUI.Render.StaffRend.prototype.drawLines=function(){var e=this.coordMgr.getStaffWidth(this.staff.noteColumns.length,this.staff.keySign.totalAccColumns),t,n=this.can.getContext("2d");n.lineWidth=1;var r,i;for(t=0;t<5;t++)r=this.coordMgr.getStaffLinePos(this.staffID,t).x,i=this.coordMgr.getStaffLinePos(this.staffID,t).y,n.beginPath(),n.moveTo(r,i),n.lineTo(r+e,i),n.stroke()},MusThGUI.Render.StaffRend.prototype.drawClef=function(){var e=this.coordMgr.getClefPos(this.staffID),t,n,r=this.can.getContext("2d"),i=this.glyphProvider.getClef(this.staff.clef);this.staff.clef==="treble"?(t=parseInt(e.x-i.width/2,10),n=e.y-17,r.drawImage(i,t,n)):this.staff.clef==="bass"&&(t=parseInt(e.x-i.width/2,10),n=e.y,r.drawImage(i,t,n)),this.staff.clef==="alto"&&(t=parseInt(e.x-i.width/2,10),n=e.y+1,r.drawImage(i,t,n)),this.staff.clef==="tenor"&&(t=parseInt(e.x-i.width/2,10),n=e.y-9,r.drawImage(i,t,n))},MusThGUI.Render.StaffRend.prototype.drawKeySign=function(){var e=new MusThGUI.Render.KeySignRend(this.can,this.coordMgr,this.glyphProvider,this.staffID,this.staff.clef,this.staff.keySign);e.draw()},MusThGUI.Render.StaffRend.prototype.drawNoteColumns=function(){var e=this,t,n;for(n=0;n<this.staff.noteColumns.length;n++)t=new MusThGUI.Render.NoteColRend(e.can,e.coordMgr,e.glyphProvider,e.staff,e.staffID,n,e.accCarryOver),t.draw()},MusThGUI.Render.KeySignRend=function(e,t,n,r,i,s){this.keySign=s,this.clef=i,this.staffID=r,this.coordMgr=t,this.can=e,this.glyphProvider=n},MusThGUI.Render.KeySignRend.prototype.draw=function(){var e=this,t=this.can.getContext("2d"),n=null,r,i;for(i=0;i<this.keySign.accidentals.length;i++){var s=this.keySign.accidentals[i];n=e.coordMgr.getKeySignAccPos(e.staffID,e.clef,i,s.letter,s.register),s.isGhost===!0?t.globalAlpha=.5:t.globalAlpha=1,r=e.glyphProvider.getAccidental(s.type,s.editable,!1),s.type==="#"?t.drawImage(r,n.x-r.width/2
,n.y-14):s.type==="b"&&t.drawImage(r,n.x+2-r.width/2,n.y-17.5),t.globalAlpha=1}},MusThGUI.Render.NoteColRend=function(e,t,n,r,i,s,o){this.can=e,this.coordMgr=t,this.noteCol=r.noteColumns[s],this.noteColID=s,this.staff=r,this.staffID=i,this.accCarryOver=o,this.clef=r.clef,this.keySign=r.keySign,this.maxNotes=this.noteCol.maxNotes,this.glyphProvider=n},MusThGUI.Render.NoteColRend.prototype.draw=function(){var e=this,t,n=null,r,i,s=[],o,u,a,f=!1,l=null,c=null;for(o=0;o<this.noteCol.notes.length;o++)u=this.noteCol.notes[o],o<this.noteCol.notes.length-1&&(c=this.noteCol.notes[o+1]),r=u.letter+u.register,this.accCarryOver?a=e.displayAccidental(u,l,c):u.accidental!=="n"?a=!0:(a=e.displayAccidental(u,l,c),a&&(f=!0)),a&&(n===null?(i=0,n=r):e.coordMgr.getIntervalSize(n,r)<=6?i++:(i=0,n=r)),t=new MusThGUI.Render.NoteRend(e.can,e.coordMgr,e.glyphProvider,u,e.noteColID,e.staffID,e.clef,e.keySign.totalAccColumns,a,i,f),s.push(t),l=u;var h,p;for(o=s.length-1;o>=0;o--)u=s[o],r=s[o].note.letter+s[o].note.register,o===s.length-1?(h=r,p=!1,u.draw(p)):this.coordMgr.getIntervalSize(r,h)===2?(h=r,p=!p,u.draw(p)):(h=r,p=!1,u.draw(p));if(this.noteCol.textInput!==null){var d=this.coordMgr.textInputHeight,v=this.coordMgr.getNoteColCenterX(this.staffID,this.noteColID,this.keySign.totalAccColumns),m=this.can.height-d,g=this.can.getContext("2d"),y=this.coordMgr.textInputWidth;this.noteCol.textInput.editable&&(g.beginPath(),g.rect(v-y/2,m-d/2,y,d),g.fillStyle="#eaeaea",g.fill(),g.lineWidth=.5,g.strokeStyle="black",g.stroke()),g.font="11px Verdana",g.textAlign="center",g.fillStyle="black",g.fillText(this.noteCol.textInput.value,v,m+4)}if(this.noteCol instanceof MusThGUI.GUIState.TwoVoiceNoteCol){var b=new MusThGUI.GUIState.FiguredBassRend(this.can,this.coordMgr,this.glyphProvider,this.noteCol.figBass,this.staffID,this.noteColID,this.keySign.totalAccColumns);b.draw()}},MusThGUI.Render.NoteColRend.prototype.displayAccidental=function(e,t,n){var r=null,i,s;for(i=0;i<this.keySign.accidentals.length;i++){s=this.keySign.accidentals[i];if(s.letter===e.letter){r=s.type;break}}var o,u;for(i=0;i<this.noteColID;i++)for(o=0;o<this.staff.noteColumns[i].notes.length;o++)u=this.staff.noteColumns[i].notes[o],u.letter===e.letter&&u.register===e.register&&(r=u.accidental);return t!==null&&e.letter===t.letter&&e.register===t.register&&e.accidental!==t.accidental?!0:n!==null&&e.letter===n.letter&&e.register===n.register&&e.accidental!==n.accidental?!0:t!==null&&e.letter===t.letter&&e.register===t.register&&e.accidental===t.accidental?!1:r===null&&e.accidental==="n"?!1:r===e.accidental?!1:!0},MusThGUI.Render.NoteRend=function(e,t,n,r,i,s,o,u,a,f,l){this.can=e,this.coordMgr=t,this.note=r,this.noteColID=i,this.staffID=s,this.clef=o,this.keySignTotalAccColumns=u,this.displayAcc=a,this.accPos=f,this.displayAccPar=l,this.accColWidth=15,this.glyphProvider=n},MusThGUI.Render.NoteRend.prototype.draw=function(e){var t=this.coordMgr.getNotePos(this.note.letter,this.note.register,this.staffID,this.clef,this.noteColID,this.keySignTotalAccColumns);t.x-=8;var n=this.can.getContext("2d");this.note.isGhost===!0?n.globalAlpha=.5:n.globalAlpha=1;var r,i,s,o,u=this.glyphProvider.getNoteValue(this.note.noteValue,this.note.editable,!1);this.note.noteValue==="whole"?(r=u.width,o=e?15:0,i=t.x+o+1,s=t.y-u.height/2,n.drawImage(u,i,s)):this.note.noteValue==="quarter_stem_up"?(r=u.width,o=e?11:0,i=t.x+1+o,s=t.y-u.height/2-13,n.drawImage(u,i,s)):this.note.noteValue==="quarter_stem_down"&&(r=u.width,o=e?11:0,i=t.x+1+o,s=t.y-u.height/2+13,n.drawImage(u,i,s));var a=this.coordMgr.getLedgerLinesY(this.staffID,this.clef,this.note.letter,this.note.register);this.note.editable?n.strokeStyle="#415ded":n.strokeStyle="black",n.lineWidth=1;var f;for(f=0;f<a.length;f++){var l=a[f];if(f===0||!e)n.beginPath(),n.moveTo(t.x-4,l),n.lineTo(t.x+r+o+5,l),n.stroke()}n.strokeStyle="black",u=this.glyphProvider.getAccidental(this.note.accidental,this.note.editable,!1,this.displayAccPar),this.displayAcc&&(this.note.accidental==="#"?n.drawImage(u,t.x-u.width-6-this.accPos*this.accColWidth,t.y-14):this.note.accidental==="b"?n.drawImage(u,t.x-u.width-7-this.accPos*this.accColWidth,t.y-17):this.note.accidental==="bb"?n.drawImage(u,t.x-u.width-5-this.accPos*this.accColWidth,t.y-17):this.note.accidental==="x"?n.drawImage(u,t.x-u.width-7-this.accPos*this.accColWidth,t.y-5):this.note.accidental==="n"&&n.drawImage(u,t.x-u.width-4-this.accPos*this.accColWidth,t.y-15)),n.globalAlpha=1},MusThGUI.GUIState.Toolbar=function(e){this.buttons=[],this.name=e},MusThGUI.GUIState.Toolbar.prototype.addButton=function(e){this.buttons.push(e)},MusThGUI.GUIState.Toolbar.prototype.select=function(e){var t;for(t=0;t<this.buttons.length;t++){var n=this.buttons[t];t===e?n.selected=!0:n.selected=!1}},MusThGUI.GUIState.Toolbar.prototype.setMouseOverlay=function(e){var t;for(t=0;t<this.buttons.length;t++){var n=this.buttons[t];e!==null?t===e&&(n.mouseOverlay=!0):n.mouseOverlay=!1}},MusThGUI.GUIState.Toolbar.prototype.selectedSymbol=function(){var e;for(e=0;e<this.buttons.length;e++)if(this.buttons[e].selected===!0)return this.buttons[e].symbol},MusThGUI.GUIState.Toolbar.prototype.selectedID=function(){var e;for(e=0;e<this.buttons.length;e++)if(this.buttons[e].selected===!0)return e},MusThGUI.GUIState.ToolbarBtn=function(e){this.selected=!1,this.mouseOverlay=!1,this.symbol=e},MusThGUI.Render.ToolbarRend=function(e,t,n,r){this.can=e,this.toolbar=r,this.coordMgr=t,this.glyphProvider=n},MusThGUI.Render.ToolbarRend.prototype.draw=function(e){var t=this,n=this.coordMgr.getToolbarBtnSize(),r=this.coordMgr.getToolbarX(e),i=this.coordMgr.getToolbarY(this.toolbar.buttons.length),s,o;for(o=0;o<this.toolbar.buttons.length;o++){var u=this.toolbar.buttons[o];s=new MusThGUI.Render.ToolbarBtnRend(t.can,t.glyphProvider,u,r,i+o*n.height,n.width,n.height),s.draw()}},MusThGUI.Render.ToolbarBtnRend=function(e,t,n,r,i,s,o){this.can=e,this.button=n,this.x=r,this.y=i,this.width=s,this.height=o,this.glyphProvider=t},MusThGUI.Render.ToolbarBtnRend.prototype
.draw=function(){var e=this.can.getContext("2d");e.beginPath(),e.rect(this.x,this.y,this.width,this.height),this.button.selected===!0?e.fillStyle="#d2d2d2":this.button.mouseOverlay===!0?e.fillStyle="#eaeaea":e.fillStyle="#f6f6f6",e.fill(),e.lineWidth=.5,e.strokeStyle="black",e.stroke();var t;this.button.symbol==="n"?(t=this.glyphProvider.getAccidental(this.button.symbol,!1),e.drawImage(t,this.x+this.width/2-t.width/2,this.y+this.height/2-t.height/2)):this.button.symbol==="#"?(t=this.glyphProvider.getAccidental(this.button.symbol,!1),e.drawImage(t,this.x+this.width/2-t.width/2-1,this.y+this.height/2-t.height/2)):this.button.symbol==="b"?(t=this.glyphProvider.getAccidental(this.button.symbol,!1),e.drawImage(t,this.x+this.width/2-t.width/2,this.y+this.height/2-t.height/2)):this.button.symbol==="x"?(t=this.glyphProvider.getAccidental(this.button.symbol,!1),e.drawImage(t,this.x+this.width/2-t.width/2,this.y+this.height/2-t.height/2+1)):this.button.symbol==="bb"?(t=this.glyphProvider.getAccidental(this.button.symbol,!1),e.drawImage(t,this.x+this.width/2-t.width/2+1,this.y+this.height/2-t.height/2)):this.button.symbol==="whole"?(t=this.glyphProvider.getNoteValue(this.button.symbol,!1,!1),e.drawImage(t,this.x+this.width/2-t.width/2,this.y+this.height/2-t.height/2+1)):this.button.symbol==="quarter_stem_up"?(t=this.glyphProvider.getNoteValue(this.button.symbol,!1,!0),e.drawImage(t,this.x+this.width/2-t.width/2,this.y+this.height/2-t.height/2)):this.button.symbol==="quarter_stem_down"&&(t=this.glyphProvider.getNoteValue(this.button.symbol,!1,!0),e.drawImage(t,this.x+this.width/2-t.width/2,this.y+this.height/2-t.height/2+1))},MusThGUI.GUIState.FiguredBass=function(){this.rows=[]},MusThGUI.GUIState.FiguredBass.prototype.addRow=function(e){this.rows.push(e)},MusThGUI.GUIState.FiguredBassRow=function(e){this.cols=[],this.rowText=e;var t;for(t=0;t<e.length;t++)this.cols.push(e.substr(t,1))},MusThGUI.GUIState.FiguredBassRend=function(e,t,n,r,i,s,o){this.can=e,this.coordMgr=t,this.figBass=r,this.staffID=i,this.colID=s,this.totalAccCols=o,this.glyphProvider=n},MusThGUI.GUIState.FiguredBassRend.prototype.draw=function(){var e=this.coordMgr.getNotePos("A",3,this.staffID,"treble",this.colID,this.totalAccCols),t=this.can.getContext("2d");t.font="bold 13px Times New Roman",t.textAlign="left",t.fillStyle="black";var n,r,i,s,o,u,a=!1;for(n=0;n<this.figBass.rows.length;n++){o=0;for(r=0;r<this.figBass.rows[n].cols.length;r++){var f=this.figBass.rows[n].cols[r];f==="/"?a=!0:f==="#"?(u=this.glyphProvider.getAccidental(f,!1,!0),t.drawImage(u,e.x+1+o*8,e.y+n*17-12),o+=1):f==="b"?(u=this.glyphProvider.getAccidental(f,!1,!0),t.drawImage(u,e.x+1+o*8,e.y+n*17-13),o+=1):f==="n"?(u=this.glyphProvider.getAccidental(f,!1,!0),t.drawImage(u,e.x+1+o*8,e.y+n*17-12),o+=1):(i=e.x+1+o*8,s=e.y+n*17,t.fillText(f,i,s),o+=1,a&&(t.beginPath(),t.moveTo(i-2,s),t.lineTo(i+10,s-9),t.lineWidth=.75,t.stroke(),a=!1))}}},MusThGUI.GUIState.TextInput=function(e,t){this.value=e,this.editable=t},MusThGUI.Render.GlyphProvider=function(e){this.imagesLoadedCallback=e,this.numImagesLoaded=0;var t=this;this.wholeNote=new Image,this.wholeNote.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAABEAAAAKCAQAAAD4dX0pAAAAv0lEQVQY01XNPUpDQRQG0PMekoASxUbEJiCCWLgBm5QWLsNScBGCYpc6G5C0QXegnUrAxs7Cn8agjbFTb4p383jeab755sxMoZoNew6s2rKg682NkVuveap04VMYaIGedyFMDCqwYiyEP+35Hdsi14cWJ7m505zDGg35yvjwj7S9zFFZl7s6DfJjnOm31K/r4wYJ00xXLLvPJyd2si7wJIRHS9W/Z4mmeon6QjjVqXwhrDmyr2vdtWebFl069w0ziIFGBFp4rmoAAAAASUVORK5CYII=",this.wholeNote.onload=function(){t.imgLoaded()},this.wholeNoteColor=new Image,this.wholeNoteColor.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAABEAAAAKCAYAAABSfLWiAAABHElEQVQoz3XSv0tWURgH8M+9RFAgUaciW8IQokFoinCJOyn0BzjI3QSHUAz/B3UI3B07bkIQuZ9AN0FXXUM3b0PooJRvy3nhdvD9jt9fz+E5T6WHpu2eYxof8BCTuIMXOMM+vuEgxXA6zFU5XGMbszm8haUUw3XW32MHT3LuHF9TDItQNW33AD/wJhsGuJdiuCpe+QrH/scvjNdY7RXAYVkAKYYTLBT0I3yp8akQ7hqNbZwW3Fx9i3GqabuxESV/cFRwf2ts3mJeHlEywEXB7db4jMNCWGna7nWx2CrFcIN3PfoY83WK4Xe+jfWe+BgH+WuHix00bbeJiUyt4W2K4bLqTRk0bfcUHzGTD+wZ9vATL3Ef37GRYrgcDvgHQYtR/HvclQsAAAAASUVORK5CYII=",this.wholeNoteColor.onload=function(){t.imgLoaded()},this.qNoteStemUp=new Image,this.qNoteStemUp.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAsAAAAkCAQAAAD1XwhOAAAAgklEQVQoz+3OoQ0CQRAF0McGdwJBgkEQFF0gKAB1kgJQNIWCDlCECjgJCoNBEAwGzCIIlyO7JdwfM3n5mQxpBk4ZNRSDbFpu+S/deutZmXrZ2P+oby3WcxWhcG/gdxTOCb6ZJxjdgmXmkR1V7kRwTLozGHs0mhcT6GBkoRQcbFWe8AGFfUDrkMtAfAAAAABJRU5ErkJggg==",this.qNoteStemUp.onload=function(){t.imgLoaded()},this.qNoteStemUpColor=new Image,this.qNoteStemUpColor.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAsAAAAkCAYAAABfVsDFAAAAtElEQVQ4y+3UMU7DQBAF0OcVqVIgYSkFFOkCp0AyuUJKTE3FIThB7uAKbkC1AlEDR0BIKa2koEFu0tiIwsAeYKd+M9r5I20hoaq6neEpSKsJTlMxyDjjjDPGwcjvc4gbnOMLd4hQ/EAl1rgcGbrBSdHDKT5w9Oebe/jyH0QXsMQiYb9twHViGA8Bxwmwi015FfCagC+Go9xi9wt6x1lsyufvnKu6nff5rvoBj7jHW2zKz6FzDxqCIyfsYg9VAAAAAElFTkSuQmCC",this.qNoteStemUpColor.onload=function(){t.imgLoaded()},this.qNoteStemUpToolbar=new Image,this.qNoteStemUpToolbar.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAkAAAAbCAQAAAAEhm0LAAAAcklEQVQoz+3IsRHBcBjG4UeS1pnApTGLAVhFZ4uUBjBBdApqhQFUHKXeXbhPQZF/cmcCv6/53oe0zKUjcpHp9acf1C+K7zNWGnq4fWZhZu3q6a4WDCy8ROtMkxmCbQc2nBI4m7Bswd6c3FFjpHGwUtnxBmZsNrKFQDp/AAAAAElFTkSuQmCC",this.qNoteStemUpToolbar.onload=function(){t.imgLoaded()},this.qNoteStemDown=new Image,this.qNoteStemDown.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAsAAAAkCAQAAAD1XwhOAAAAgUlEQVQoz+3OsQkCQRAF0HcXCIIaiQ2YWYFgFRZwFRymNmNmFZqYWIJgBWtmYOIlgmewIKe7Hej/2WOYmULM0Fxl5mFv4xJxIWjfvZvAskOxR6aahNtSre87V27prJUMnsnxGJqPNVujuD7oqR3srLvHg0HyiVI2f/5dLvJ88kz5Beo8SqCGCGcrAAAAAElFTkSuQmCC",this.qNoteStemDown.onload=function(){t.imgLoaded()},this.qNoteStemDownColor=new Image,this.qNoteStemDownColor.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAsAAAAkCAYAAABfVsDFAAAAtUlEQVQ4y+3RMWoCURSG0fMGm0DEYkqraJcVCEJgliCppwmkyi7cgqXlq9LY2ziNO7DIBrRzAjYKBkKaBCRB89KG+erD5YcbnFSUdRsDlLjFG+aYVjHfhBM4xDO6frbHTfiEI8xcbhmKsu5jhatfsAxPKRDbDA/SGmfoJMCXKuaTLPHq3dfmA3ZnUESnivkWWnhFD4+4xxELTKqYH3z72roo6+uULambG9zgBv97HP6CV3hPwR/6KieA6EyktQAAAABJRU5ErkJggg=="
,this.qNoteStemDownColor.onload=function(){t.imgLoaded()},this.qNoteStemDownToolbar=new Image,this.qNoteStemDownToolbar.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAkAAAAcCAQAAAAZg12zAAAAXklEQVQoz2NggIAchoMM9xiOMRRBuOoMvxj+w2E5A4MUEhcCGdahCfxiZPjNwMKADOIZ0NScYWBgYPjO8A/K/cswBaLwLAMDQy3DdIYIhN6zDGiAiYFhVIgGQs/QhQAJby5DVGAeeQAAAABJRU5ErkJggg==",this.qNoteStemDownToolbar.onload=function(){t.imgLoaded()},this.tClef=new Image,this.tClef.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAABwAAABKCAYAAACo2jR+AAAFQElEQVRo3r2Zf2iVVRjHP7t36q5m5DRjtcpZK3HSpB9Ds2TpSjPsh5SYKRhIRFBmRf9EVNSKSowKs5KKjFLoB6UWVAtaP9yWRjHtd+lgZqZbuWXbnbV7+6PvW4fDOe99773v9sBh5915zvm+z3Oe9/l1kxRHC4AlwDdAH0NM1wJpIAt8CUwcSrCLJVHWGE8CpUMBNgY4aoEFY+5QAL7jAcsC7wMj4wRbHAIWjFlxArY5AF4HbgfWS9VtcYHNBboNoD6gXoZSIp5ntXai75BEHoAXAuWa/wEsBz4E/hYIwDYgAywtVrpjgDcN6R708NVIrc3FAlYALQLryqGFo0Cnz1qjqvQ44BTN7w/hO0P3mTTUXxDgCCCl+VshfPUCKwOqizWaBPAb0OFZnwBMl4QJYHQxgIGafs8hXSBVGvjOxRTV2XZJsp8868cCy4BRes4ItGCaAHwE7PGsz7G8z7fFfvhdwPcejZTKw9gusGi6TW+fMu41sFrbv14aB+BCYFDqs1/CHD1xOe9TgQPAY3qeJ59qA66MMzz9COwAJslqbbBdwNg4ATcqOnR4gu+iuNOLG0Ii/TN5eq6cdD6w3wPWGneaOAP42QP2uRFJYqEaRw4ajB1xG8mkkDv7DBgfJ9hk+UQX2F/AdYUcmghx1s8BZzrWdilMnR6XZElgrUeyQ7LGT4HNiuxF0xIPWCdQJZ61UvdJcZi/C+wIcKVVF2aBqcWAlauwdAHeavFO1f8XFAP4kFIDG+xVB2+lHPndhRgIwBSg0ZFL7gYu8lh3PTBNecw5suzgvP5cGdlNDsm69SKuun6jVdgEI600/y7FT29F+4Fj82qHVOuAwxFqxKxUPs8FON7BvNt6w1HAhohA9lhlA860GAaBNRbP8gLBnEnVamuxHzjXWC8D9nqSpV81vxN4KcT3HjA19qi1aDd4VjoOaJaXadRzpcqz44HL9TImf8ZIvnjEWtxiAb5rrW831i7T/xY7Uv+d1r6dQGUC+NNi3mc9TzPmB5VqBNRkNIpM6gWut86aAlQnHHWA/TzOmN9nrQ0APwBne8LYemV5wedXnlCoMWm29fy1Md/uOLhJ9+nqXKzTS/2XTCd0we2WIzDpY2OecRy6RVpwBeseq04cm9BnsNUqLE163JhXOQ5tkYXWejxZpzFvT0jH2xTNA9/aYDB1AA9rfo9VOQVS7LOMC4dWDtsdkJeNb+YVR9ukVetrHIduUsHq6lwc0r424ARzYbo8QlZJ70xH9dSs9c1GKAJYoaz8NGtPnRzJIHCvS/ylRivrbXWgbLoDeM0yklrtOc/ifcEIBmN84eoaq8vr69vYGUC3ip3gfi+RU8kAZ+UKyFcZkjZFyBzG6fN5Xvur5JWywPx8MrivpP+9eh4dkqo8xb/N9mUC6lDqkReVArfIw6SB91TXz5eR1cqtXQ28IaBeXUWFT31EVFmNEqo6WeyAHPIXMq5fFGhvlkuLhYIW2AiNkfqbBE6W6hsZRmpRlMi7eiqU2uXiksMF2Kq/s4YLsFnf74wwsw+jlNrPKXn63hz8e+RZagsBnA3cqKbrRDmBrUobwijj8cGhdIGkyTqS5A059vaT588IKbVDwjLphpD9aRU7kY1mspV546mgfM2IhLqMkQGrI2jB10xYJM+zKR/AXJbo+3Umpch/BPgknzssU2rnu78+RwAuUVTJAlcU4qAXqttkAg3IddU5CtpV4ik4SiQV9YNybD/wAP//LoEysBVG9fyEtV4QVQBPG3XjQWP0GG3nOVHdZNQAXC6JGyRFiVLJF/XNRqZ/APf0/Zema8OiAAAAAElFTkSuQmCC",this.tClef.onload=function(){t.imgLoaded()},this.bClef=new Image,this.bClef.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAABsAAAAgCAQAAABJYMuwAAAB6ElEQVQ4y5XUT0hUURTH8c+Mjpn9FQwjLReSCAlFUBlJEEHUIkhwEVKQixZCi9omLYqwXavauIho0yKUKAzaBbUzQaIsWxRk/lklRtZU6m3h6+mMM/r8PXicd8/93nvuPeedlEVtVq1FoyYZ7/3yzCdTZhRQKnoHF11R7pEh49apc0KbrAG97ppVRL2Cc0qjZRaWOioI5n21txCS0Sc4VsBzWFYQ/HUmHitTCWndggtFojgvCIJZB6IYnhrWxjYTJt3ywwdd1udhVYYi8Bs4JAhGaYmGF57nNuaBD2LfdaQMmtRJdw4W3MjD2mPPCxXYYidpZctOk6vB2Kq3HdNGSevPm1aR9/0ztrba9N9Me2c8Z9r9ggUBQVjq6PQnjn98IStLtCv2TWnKdZ3yxJjP7mhYlrn6GBtRk+8skVEqXSDhp2PspQ1SzupRXho558wVqZP9sTVsRrWH2JO2slIOxnYf5iHvEguoxkgU4mQ00qjDqmqNT9ZuDXodQR+X5G9VLd7i8eRQlbEIeiyTHLsXQVklyaHWGGpIDjVHXeR7wR5TRPv8jvY6khw6aSLqGM3JoZvRTq/UJr/y/qildiVFKl0yJZjWY3fOX72COnwRBLftSJalWlfNyBpyLXndpVxWZ8Bbb9ZS4f8AkCq9FpfsQ28AAAAASUVORK5CYII=",this.bClef.onload=function(){t.imgLoaded()},this.cClef=new Image,this.cClef.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAABgAAAAmCAQAAAB0DpOuAAACIUlEQVQ4y5XVS4iOURgH8N/HNzOIJCXl0kwuoYhpopmFGBs2g71y2UlZIMYl5ZoGSzYWUjakkA0l1+QuFE3kmiRyK5fBfF6L78zL9zlHed7Fc/7/9/2/T+e5nFOQKdtaO5QstyfgPsZrNUJJp9Oe+Vmme4nbZBct9cghx9W54YIxPa+y8LSjZBkYJ5Pp0hS+adXtm8Z0hL2gTkfAZzxQ66YJKcHz4D/lzAGwX01csNptvLUzZy6DJqOLUcFr0/T1w9ecKYUUzS0msvTd9wp8KfiJqbSmbFxKUFCI8ldSgpUaKvCw4J+kBFuNqMAjgz8RF4xVZ3YFMxA88CIu2IV2vf9gWsEan2OCejNCQ/QJTI0lWO9YvDUWGACmu6cNE5wz2Hzbobpw3zTaEtZzvbPONm+dN0tXvL13exPwkfC+troifwq6c/TesHjpUnXIFPLh/YegYJ8PYFC+k5rKSNURrpoTVou0anbYDWe15wmOzvSGnHsU0npLZl5aUO+jTOZ8/t+iNzIrUpt+6nZoh57cdzuK3eb9LShveRU2h7Es20mwUb9qwUtw3SenIvwUw1N12OVVJDJtqUNgcxXuDL6hmKx03Kb+76lxPxWhVl8/fMlxS/DX4hGGuOyDJ6bmTDGcf2fjgg6NGGJDzjSDux7HBT2HSv+cWRiGt6u6l2YmL5SsjOKb7jTZQXcN1aJokk2uWOxhWsAdLUaZoV5Jp6bfl+Iv+S6xhZ7Q1G4AAAAASUVORK5CYII=",this.cClef.onload=function(){t.imgLoaded()},this.sharp=new Image,this.sharp.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAkAAAAcCAQAAAAZg12zAAAAxElEQVQoz6XQMUpDQRCA4W8TBUEwjZWxEAyrRDyFjdhJLmDrKeIFPIu3iFpbCAqmiIKQREHB1xjWYo0vT1IomWlmfgbmnwGWwaELqIEbu1jVLNGOFZBKVIn/o4mExtJ3+yo6sufBkJZjqZI+foGhn7IwVjizQfLo06noxFXeGGyq67nzLsxKhD+rpnz2VHVN1LZlZMy2ruRZMdUJeXgmBirmLzqaPLk1cS46cJkH15Hso+M6S4xAfZFHz0Fv+mVzLyLkJV//bUd1gpAvqQAAAABJRU5ErkJggg==",this.sharp.onload=function(){t.imgLoaded()},this.sharpColor=new Image,this.sharpColor.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAkAAAAcCAYAAACzipU4AAABLElEQVQ4y8XSv0ocURQG8N+uI1EirDBFBBUMSv4UsnVsZDofQATB6S208wEUfABbu8B0gZAXME7nA2gngoIowjoKK4iNbJo7OCy7SwrF09zvu+fjnnO+ewiRpMVwBS8lafGn5HUvcZKkxbeAP2Kyl+grRiq800vUN95e9Fz2lKRFo1YZu4MZfMAWVtFCK0rSYg7zQXvR9eIYPkc4xuiAlm7rPQRPuAvnDppRSFxhApv4iwWs51m8DfU8i2t5Fk9hCEd5Fp/iAbV+FtRe3cxO9YO7zVzEDVawgQhFlKTFLNaC9hcaXSsTRzirXHzqUfpyUOP3WMaPCNdo4wv2sI9p7OZZ/Lucrpln8feAfwYzx6uT1/Msvq2UGHqf9f0vURvnJYkqiTM8BnyAwzLxDz5LRoo+XtMwAAAAAElFTkSuQmCC",this.sharpColor.onload=function(){t.imgLoaded()},this.sharpFigBass=new Image,this.sharpFigBass.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAcAAAAPCAMAAAAf3yWMAAAA/1BMVEVOTk4AAAAiIiLw8PDPz8+Hh4fMzMwjIyNTU1MJCQlhYWGcnJwCAgIUFBQTExMWFhYcHBz4+Pjv7++EhIQkJCT6+vrX19f39/d/f3/R0dH8/PzW1tb29vY2NjbNzc2GhoZQUFBGRkagoKCdnZ1UVFSoqKirq6uVlZVKSkqvr696enqWlpZkZGSOjo6NjY3+/v5dXV1JSUlISEgqKirm5ubU1NRFRUX09PTd3d1eXl59fX0SEhLg4OD19fViYmK5ublEREQyMjKxsbGJiYkeHh6AgIAEBAQ6OjodHR22trb9/f3p6em+vr6IiIiKiopBQUFzc3PQ0NBSUlLc3NzGxsappTWHAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfdChgTJA0sUEKyAAAAg0lEQVQIHQF4AIf/AAAHAAAHAAAAAAcAAAcAAAAABwAABwAAAAAHAAAzBwcABwEBAQcHBwAHB0ZBBwAAAAAHAAAHAAAAAAcAAAcAAAAABwAABwAAAAAHUDAOAQcABw8BAQcBBwAHB0c6BwAAAAAHAAAHAAAAAAcAAAcAAAAABwAABwAAojUC3ILbwfkAAAAASUVORK5CYII=",this.sharpFigBass.onload=function(){t.imgLoaded()},this
.flat=new Image,this.flat.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAgAAAAYCAQAAABt0HSbAAAAkUlEQVQY083OsQpBARhA4e/eJK9gttoUs8kjGIwWm8HDeANZlAxKmU3KbLAahYi68RukLk/gbOdMh6WKLy4aeU09xHf44Z/CU8dWOOgrcLMVNjIhDAgrZUU9mbDnqgmabsI9lbmAqiIWqUSCkpYUU07qaLgLM8kn7IT5++SoZiSMkcDZRBgqfF5D6Obn19p5fQFtRC8aqop0JQAAAABJRU5ErkJggg==",this.flat.onload=function(){t.imgLoaded()},this.flatColor=new Image,this.flatColor.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAgAAAAYCAYAAADH2bwQAAAA6ElEQVQoz+3RoUpEURDG8d9eLrrFoNdkVDAJRq0HBMFgMCl6mtVkUxB8A4tgEYSLCzbBIIJwn0Cw+gSmg0Usuq7Bs7As6z6BHwwzMH+Y+WaEmB5DTAv+UIFVzI4DuuiNA8bqH/hVmfN3iGkXJ1jEG05xXmIC17nxjC9M4wxlgTYS5rCCgwzBYYkPHDd19QohppcMlJgp8In3gb2W8lh4KNDKIcTUxvqAu9thm8tYy/UdrsohoINJ3Dd1tdk/VA/dEFMH87hp6mojxNTqAwWOsIML7EFTV73+Jaewhf2mri5H/eIJ26Oa8AMrMTaLY1mrzwAAAABJRU5ErkJggg==",this.flatColor.onload=function(){t.imgLoaded()},this.flatFigBass=new Image,this.flatFigBass.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAYAAAAPCAMAAADwHU6yAAAAolBMVEWnp6ckJCQAAAAvLy/q6upoaGgnJydwcHAqKiodHR1ERESdnZ22trakpKRMTExPT0/19fXv7+/29vaurq61tbXY2NgMDAzMzMxUVFSNjY0iIiKsrKwCAgIBAQEpKSn9/f2lpaUyMjLPz88FBQWWlpbS0tLDw8PQ0NA+Pj4mJiYSEhKHh4cXFxeoqKg1NTUTExMREREZGRnf39+cnJwDAwOenp4V5r8VAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfdChgTKjDquyMtAAAAMUlEQVQI12NgZAADvBQjlAIzmA3BtCaQyaQIVsLECKIYmUAadHTAKkEkAxtEnxyYBAAquAFD8JXS1AAAAABJRU5ErkJggg==",this.flatFigBass.onload=function(){t.imgLoaded()},this.natural=new Image,this.natural.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAgAAAAeCAQAAAC7iZeGAAAAv0lEQVQY05XQMUtCcRQF8N97/InEskEIHJpyDQdBEPEjiBAEra429F36IO1tDuVUWyDRUJD5CQJ5kr2Gl+iLQt650znce+65lwuXcngw2qSxxCIv/MJ2IeTYnjhggRNNDceiINV1r+ZAORtJVTT/M12uTadePKvqc+fJqZZDDKRB5NX1T99O5hEViJ5kW5bgSNtZFqzuSs++kl24lW7WH+evss48KusEE7EbY+/enOsEQ7HEJ/gimBd9clHhw/wbjBksgn0qOpgAAAAASUVORK5CYII=",this.natural.onload=function(){t.imgLoaded()},this.naturalColor=new Image,this.naturalColor.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAgAAAAeCAYAAAARgF8NAAAA8UlEQVQoz7XSvUrEUBCG4SchiOJfkcrCSluxsBKxyAWIiAo2abRTxHvxFtILllbprCwFQQsFf7p0wrKL69okcFzcgMoOnOac98x8883I8uoky6szIyLGIXbagC56bUBr/B9IRj1keTWDuAF69eUK1rCKJUQJBtjM8uoGC5jHdFhigLn6569E9n8S+YJHPCDFdowI99itz15ZpEe4bDJEeCqL9GIo20SoIRqL1d2wi35g8SLWsR8atZzl1Tm2MIspTH4DcPrncQ+7+YbbemAbCe7qTFe4xiuecdAAx83ylkX6EXTzCUlZpJ3xLu14gXd0vgC9Azb8J/WQGQAAAABJRU5ErkJggg==",this.naturalColor.onload=function(){t.imgLoaded()},this.naturalPar=new Image,this.naturalPar.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAABMAAAAeCAYAAADOziUSAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAFxGAABcRgEUlENBAAAAB3RJTUUH3wcaDykVgP9TjAAAAm5JREFUSMel1s2LV2UUB/DPXO+MSpo6qTmMyNjAaJhoC3VhLgohwiwK3IW4kVy5dq3gRlf+AZW0cVNgviwUF0qLcKFIo0KJvViKRYQvqY05Pxd9L1wuvzvzqzlweZ5zn3PPc873+Z7zXLrLOtzASv9Bipb3I1iG5TNxthHv4ykm87TJx1jV5mw2DuN1dHoIZAs+bVvcmUiG8S7uY/MUzl7LprubC4txDucT4fYenMF3GMeceppr8RZO4O+acTPdBcFpQfRjWI0PK2f9+CCLlxofzw+Gu3AIn+AMdmT9JGbhbfSXGMBHuI3fGo6OJO2Xq1Qiy1HiWvRNGC3xKhbhKv5spDfWgtUk+jCBbwPTSIE3YnA7oE8lT7s4vZr5aIn1Uf7AXw3jCfye9H/Iye0MTlUGt+rOXolyv8b4vhgezglfxz0sxLYaCzo1nFeUGIzypBHVAxzHxdq7uV1K8FHGl4rGLnXpC22mk38ylgWeRZnl/8lAdThFAK4KfTqZ6NJJ5mW8W6YJvpkSKWthd/Aw8zVplBsyPqtBsTTzn8taCS3GCzk1eBEHs/NwiD1Y41dVjiOZ3yhxIcpwHNyrHcY72b1N+hJ1BzcL/IRfMZrdm8Zt0gnOY7iCH4uA+jmWYKhLB66IOY6vw78iqW6IzTe4WabevsK+3AFnE+nl4Dme7jAegp4JjSbxXvrf6TpP58fhpbC8TJsZaKQ2FJv90e8kqqKezgN8lr6+IvT4JRC0dY+tuQ4PVKdbx+bL3AN7eiDvY+zFqTz/1lPDaG+Pt/gcfJFGoM3Z93mmk9k42uvvwVQkrb7pn6mzh+msj7r9OjwHDDOOLnjafMoAAAAASUVORK5CYII=",this.naturalPar.onload=function(){t.imgLoaded()},this.naturalParColor=new Image,this.naturalParColor.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAABMAAAAeCAYAAADOziUSAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3wcaEBAyPAuPEAAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAC1UlEQVRIx5XVS4gdVRAG4O82d5wYdSLpiaL4wCxCDCiIoqKodMxGESQBV9Ki4saFiru4EFyIoiBkqQtRaEQxBAwIJtm0QQQRGR/4gIiCSALRnFmMMeqM5rpItZ7puddcC5o+dR7/qVP1V9VAT6o6wb14Dbe1TfmVKaXogWibEi7DHNafDaA7B8Mxi1diBaP4JgFcghNtU65UddI25RnLOqWq0zM4jF+meNFbeDx7zRmwANqKR/HhOIt7MsIn2F3Vadsan+FBXITXMftfSG1TjrAP89he1WlQ1emMBVWdtuC+uPEwHo5zf2V+KnBFBOczHMWPeBZ726Y8XlR1GuAObMbbbVMuZ0+5uqpTXdXpCbyBvTiIXQH2PjZgZxfNWdwVAIciUiPMYA/OxTnxdXJV25R/VnX6IvSH8PIQ63B3TH7cc8+mCW47Hf8fcAo3VnW6sMAtYd1RLE0RxVyO4KcY3z/EjlAWg6x9OYmEr8OKndnaiViHHUNcE8rP6Jw/iP9zEd1FfI6bMv8K8O7MtUOUYzjX0WJf25QLGT1ms4u6Szt9rsB1Y542CP8Uppf5YoKfJlWGicmP0wW+PRtYl8jBy0nWLg3xPbZl3MmtWKzqdHE4/eYIwLrens7SY0N8insiEDPZphl8EMw/L0AGvQs3RIbAQoFDoVya3TrK5ubjwGDM0zbh/Bi/VwR/lmNhzv+Ty7Exxge6aO6PiesnlPMVLEThzGVzuOCjtikXC/yRPXVXRO4bfBdl5xHcHh3rRfwWdBnihjj36j9pE8VxP7bigkiT9WHRclRWVZ224108HxX5ywDf0jbl0jB4dKSq0zvYjVvbpjyYJXA/MzrZGD5+smtARcbuPVGGn5qy3z4Wlh3oLC86drdNeRwv4PcpI3kSL7VNeWxVd8qsewUPTAE0Cpe82e/qa9r8msV/5++s6nSqqtPT4/YWY5J51bgnCb9mBXHV3r8BTYTpIcgiIbUAAAAASUVORK5CYII=",this.naturalParColor.onload=function(){t.imgLoaded()},this.naturalFigBass=new Image,this.naturalFigBass.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAYAAAAPCAMAAADwHU6yAAAAilBMVEWVlZUSEhIAAACsrKw4ODizs7OWlpavr6+tra329vb7+/siIiJHR0cpKSkCAgKXl5fS0tKysrLa2to2NjYuLi74+PgLCwtQUFA+Pj7k5OQwMDCRkZEhISFiYmKgoKC8vLze3t6Dg4PJycmjo6MGBgZfX18zMzOUlJQmJia9vb1gYGD+/v5ubm4EBAQYyJtoAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfdChgTGQlB1c4VAAAALUlEQVQI12NgZAADDIqJkZuBkYkJQqkogiiQBAYlzcCNrJIJJMgAkQMBbhgPADXrASb/uuETAAAAAElFTkSuQmCC",this.naturalFigBass.onload=function(){t.imgLoaded()},this.doubleSharp=new Image,this.doubleSharp.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAQAAAAnOwc2AAAAdUlEQVQI11XOoQ3CYBiE4ae0Bo0sSccoYQoMIzTFoNiEMaowKCZgDBKCQKCKa/Ihfpq0J+7yirscIYQDqBMtTBUpCgNyS1BhoLATVs6eep3GSzYW90JoE4ybX7w9EuRqpa2LjZurD9b+l07gOL/Ug/t8M5u4Hy58IZKVjiCmAAAAAElFTkSuQmCC",this.doubleSharp.onload=function(){t.imgLoaded()},this.doubleSharpColor=new Image,this.doubleSharpColor.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAn0lEQVQY03XQIQ7CUBAE0PehBl08xwDbG2CQlSSgMJwEBboOywFq6TFICIKkrjgSML/hh6RrZpKZ3Z3dUJTtx6+2dZUfoSjbOa69MDJc6QAZ3pGPMUm0WcR3b1zG7hyHomzv6HDGGg+EkI4vynYVDbCpq/w0lPEV8YlbKoR43SdmOmOBKS7YoUHI0hdgX1d5E2PscBha3SW8SYV/YxjgvqQXJ1gHIRdPAAAAAElFTkSuQmCC"
,this.doubleSharpColor.onload=function(){t.imgLoaded()},this.doubleFlat=new Image,this.doubleFlat.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAA4AAAAXCAQAAACRmLYJAAAA/klEQVQoz83SvyvEcRgH8Nf98CM5m0vpNt0gZ7Io/4AYmA0Gf4JRSTGKusmg3HDKbLzIopRkc4NNSnR+lStX+H4Mvs7dcrP39H6ed8/T+/lBxZBfbFrWgrQJGfdxNCjbLkZCMwotHEkd8M/Fvk6jFHy1L4GGnHEZt3pEmDLs04UbaorqguBDUHEmCIJneYK6bUtqcfLEon2R4IiGabAqCE7jA7wLoqS6a5AHVTAqhcskEug12+J+UheK6dj1nH6RFwl0W0DVYTqu3JCyJSuFFWPezHvlUc6BYAclewqCBwM/DZ+UBWug5NidcyOtrzEf893mMDGuzDT5urLeP+kbi0lPkzNfV2AAAAAASUVORK5CYII=",this.doubleFlat.onload=function(){t.imgLoaded()},this.doubleFlatColor=new Image,this.doubleFlatColor.src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAA4AAAAXCAYAAAA7kX6CAAABdklEQVQ4y+3TPWhUURAF4G/XVYM/hT4VIWojWIixskgwzQvapdBASCEPRCzsUwpCQLARCwtBLC/RdIKFohavslIsU6QTC0V9RNQiwurazMJl2U2xtVMNM5xzz8ycq6yaV2XVHDUQZdXcLatm2Yjo4Bz24/NA7zCObAf8i96QXm9EHbSNGf+BYwL3jHuOKfzZzgCwVVbNcZwNF33E7jCHsmpmMYku3tWp+NAqq+YrnuAa9gZRN0hfB9F09tgmpts4FKBHuI5vmZKL2MJVPI6ZD+BBB7+xWKfiRciaxEoA39SpKKP+HAuYwFwbv7CRSTmV5etZfho7In/f32orWCcwP2LrM9gZ+f3OwJYvYV9sczMj3IUrmYpnnfxF3A459+IT96XdxBn8xOU6Fd/b2R3XcBIP61Qsx/F7ZdVM4Ra+4Fidio3+DC3cwRJW6lTcyKSfwEu8xfk6FT9y5xwM/Qt1Kp5moC7m4iSzw7y6jvkBEHzCKi4M8+o/M7lkrKLCiyoAAAAASUVORK5CYII=",this.doubleFlatColor.onload=function(){t.imgLoaded()}},MusThGUI.Render.GlyphProvider.prototype.imgLoaded=function(){this.numImagesLoaded+=1,this.numImagesLoaded===26&&this.imagesLoadedCallback()},MusThGUI.Render.GlyphProvider.prototype.getAccidental=function(e,t,n,r){switch(e){case"n":return n?this.naturalFigBass:r?t?this.naturalParColor:this.naturalPar:t?this.naturalColor:this.natural;case"#":return n?this.sharpFigBass:t?this.sharpColor:this.sharp;case"b":return n?this.flatFigBass:t?this.flatColor:this.flat;case"x":return t?this.doubleSharpColor:this.doubleSharp;case"bb":return t?this.doubleFlatColor:this.doubleFlat}},MusThGUI.Render.GlyphProvider.prototype.getNoteValue=function(e,t,n){switch(e){case"whole":return t?this.wholeNoteColor:this.wholeNote;case"quarter_stem_up":return n?this.qNoteStemUpToolbar:t?this.qNoteStemUpColor:this.qNoteStemUp;case"quarter_stem_down":return n?this.qNoteStemDownToolbar:t?this.qNoteStemDownColor:this.qNoteStemDown}},MusThGUI.Render.GlyphProvider.prototype.getClef=function(e){switch(e){case"treble":return this.tClef;case"bass":return this.bClef;case"alto":case"tenor":return this.cClef}},MusThGUI.Control.InputDialog=function(e,t){this.controller=e,this.parsedXML=t,this.panel=null,this.colID=null,this.dialogNode=this.parsedXML.getElementsByTagName("InputDialog")[0],typeof this.dialogNode!="undefined"&&this.dialogNode!==null&&(this.formDivContentXML=this.dialogNode.getElementsByTagName("div")[0],this.dialogID=this.formDivContentXML.getAttribute("id"),this.width=this.dialogNode.getAttribute("width"),this.height=this.dialogNode.getAttribute("height"),this.btnTxtOK=this.dialogNode.getAttribute("OKButtonText"),this.btnTxtCancel=this.dialogNode.getAttribute("cancelButtonText"))},MusThGUI.Control.InputDialog.prototype.init=function(){e.one("body").addClass("yui3-skin-sam");var t=this;this.panel=new e.Panel({bodyContent:e.XML.format(this.formDivContentXML),headerContent:this.dialogNode.getAttribute("headerContent"),zIndex:6,centered:!0,modal:!0,visible:!1,render:!0,plugins:[e.Plugin.Drag],buttons:[{value:this.btnTxtOK,section:e.WidgetStdMod.FOOTER,action:function(e){e.preventDefault();var n="",r=t.Y.one("#"+t.dialogID),i=r.all("select");i.each(function(e){n+=e.get("value")}),t.callBack(n),this.hide()}},{value:this.btnTxtCancel,section:e.WidgetStdMod.FOOTER,action:function(e){e.preventDefault(),this.hide()}}]})},MusThGUI.Control.InputDialog.prototype.show=function(){typeof this.panel=="undefined"&&this.init(),this.resetDialogForm(),this.panel.show()},MusThGUI.Control.InputDialog.prototype.resetDialogForm=function(){var t=e.one("#"+this.dialogID),n=t.all("select");n.each(function(e){e.set("value","")})},MusThGUI.Control.InputDialog.prototype.callBack=function(e){this.controller.setColTextInput(this.colID,e)}},"@VERSION@",{requires:["base","node","datatype","panel","dd-plugin"]});

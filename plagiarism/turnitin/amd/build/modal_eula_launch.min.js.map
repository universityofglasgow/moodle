{"version":3,"file":"modal_eula_launch.min.js","sources":["../src/modal_eula_launch.js"],"sourcesContent":["/**\n * Javascript controller for Eula launcher\n *\n * @copyright Turnitin\n * @author 2019 David Winn <dwinn@turnitin.com>\n * @module plagiarism_turnitin/modal_eula_launch\n */\n\ndefine(\n    [\n        'jquery',\n        'core/ajax',\n        'core/notification',\n        'core/custom_interaction_events',\n        'core/modal',\n        'core/modal_registry',\n        'core/modal_events'\n    ],\n    function($, Ajax, Notification, CustomEvents, Modal, ModalRegistry, ModalEvents) {\n\n        var registered = false;\n        var SELECTORS = {\n            HIDE_BUTTON: '[data-action=\"hide\"]',\n            MODAL: '[data-region=\"modal\"]'\n        };\n\n        /**\n         * Constructor for the Modal.\n         *\n         * @param {object} root The root jQuery element for the modal\n         */\n        var ModalEulaLaunch = function(root) {\n            Modal.call(this, root);\n        };\n\n        ModalEulaLaunch.TYPE = 'plagiarism_turnitin-modal_eula_launch';\n        ModalEulaLaunch.prototype = Object.create(Modal.prototype);\n        ModalEulaLaunch.prototype.constructor = ModalEulaLaunch;\n\n        /**\n         * Set up all of the event handling for the modal.\n         *\n         * @method registerEventListeners\n         */\n        ModalEulaLaunch.prototype.registerEventListeners = function() {\n            // Apply parent event listeners.\n            Modal.prototype.registerEventListeners.call(this);\n\n            processEula();\n\n            // On clicking the X, then hide the modal.\n            this.getModal().on(CustomEvents.events.activate, SELECTORS.HIDE_BUTTON, function(e, data) {\n                var cancelEvent = $.Event(ModalEvents.cancel);\n                this.getRoot().trigger(cancelEvent, this);\n\n                if (!cancelEvent.isDefaultPrevented()) {\n                    this.hide();\n                    data.originalEvent.preventDefault();\n                }\n            }.bind(this));\n        };\n\n        // Get the rubrics belonging to a user from Turnitin and refresh menu accordingly.\n        /**\n         * Method for processing the EULA.\n         */\n        function processEula() {\n            $(window).on(\"message\", function(ev) {\n                var message = typeof ev.data === 'undefined' ? ev.originalEvent.data : ev.data;\n\n                // Only make ajax request if message is one of the expected responses.\n                if (message === 'turnitin_eula_declined' || message === 'turnitin_eula_accepted') {\n                    $.ajax({\n                        type: \"POST\",\n                        url: M.cfg.wwwroot + \"/plagiarism/turnitin/ajax.php\",\n                        dataType: \"json\",\n                        data: {\n                            action: \"actionuseragreement\",\n                            message: message,\n                            sesskey: M.cfg.sesskey\n                        },\n                        success: function() {\n                            window.location.reload();\n                        },\n                        error: function() {\n                            window.location.reload();\n                        }\n                    });\n                }\n            });\n        }\n\n        // Automatically register with the modal registry the first time this module is imported so that\n        // you can create modals of this type using the modal factory.\n        if (!registered) {\n            ModalRegistry.register(ModalEulaLaunch.TYPE, ModalEulaLaunch, 'plagiarism_turnitin/modal_eula_launch');\n            registered = true;\n        }\n\n        return ModalEulaLaunch;\n    }\n);"],"names":["define","$","Ajax","Notification","CustomEvents","Modal","ModalRegistry","ModalEvents","registered","SELECTORS","ModalEulaLaunch","root","call","this","TYPE","prototype","Object","create","constructor","registerEventListeners","window","on","ev","message","data","originalEvent","ajax","type","url","M","cfg","wwwroot","dataType","action","sesskey","success","location","reload","error","getModal","events","activate","e","cancelEvent","Event","cancel","getRoot","trigger","isDefaultPrevented","hide","preventDefault","bind","register"],"mappings":"AAQAA,+CACI,CACI,SACA,YACA,oBACA,iCACA,aACA,sBACA,sBAEJ,SAASC,EAAGC,KAAMC,aAAcC,aAAcC,MAAOC,cAAeC,iBAE5DC,YAAa,EACbC,sBACa,uBASbC,gBAAkB,SAASC,MAC3BN,MAAMO,KAAKC,KAAMF,cAGrBD,gBAAgBI,KAAO,yCACvBJ,gBAAgBK,UAAYC,OAAOC,OAAOZ,MAAMU,YACtBG,YAAcR,gBAOxCA,gBAAgBK,UAAUI,uBAAyB,WAE/Cd,MAAMU,UAAUI,uBAAuBP,KAAKC,MAqB5CZ,EAAEmB,QAAQC,GAAG,WAAW,SAASC,QACzBC,aAA6B,IAAZD,GAAGE,KAAuBF,GAAGG,cAAcD,KAAOF,GAAGE,KAG1D,2BAAZD,SAAoD,2BAAZA,SACxCtB,EAAEyB,KAAK,CACHC,KAAM,OACNC,IAAKC,EAAEC,IAAIC,QAAU,gCACrBC,SAAU,OACVR,KAAM,CACFS,OAAQ,sBACRV,QAASA,QACTW,QAASL,EAAEC,IAAII,SAEnBC,QAAS,WACLf,OAAOgB,SAASC,UAEpBC,MAAO,WACHlB,OAAOgB,SAASC,oBAlC3BE,WAAWlB,GAAGjB,aAAaoC,OAAOC,SAAUhC,sBAAuB,SAASiC,EAAGlB,UAC5EmB,YAAc1C,EAAE2C,MAAMrC,YAAYsC,aACjCC,UAAUC,QAAQJ,YAAa9B,MAE/B8B,YAAYK,4BACRC,OACLzB,KAAKC,cAAcyB,mBAEzBC,KAAKtC,QAmCNL,aACDF,cAAc8C,SAAS1C,gBAAgBI,KAAMJ,gBAAiB,yCAC9DF,YAAa,GAGVE"}
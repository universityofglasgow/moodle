{"version":3,"sources":["../src/modal_rubric_manager_launch.js"],"names":["define","$","Ajax","Notification","CustomEvents","Modal","ModalRegistry","ModalEvents","registered","SELECTORS","HIDE_BUTTON","MODAL","ModalRubricManagerLaunch","root","call","TYPE","prototype","Object","create","constructor","registerEventListeners","getModal","on","events","activate","e","data","cancelEvent","Event","cancel","getRoot","trigger","isDefaultPrevented","hide","originalEvent","preventDefault","refreshRubricSelect","bind","click","target","closest","length","currentRubric","val","ajax","action","assignment","modulename","course","success","empty","each","i","isNumeric","optgroup","attr","j","rubric","option","text","append","value","register"],"mappings":"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","sourcesContent":["/**\n * Javascript controller for the Rubric Manager launcher\n *\n * @package   turnitin\n * @copyright Turnitin\n * @author 2019 David Winn <dwinn@turnitin.com>\n * @module plagiarism_turnitin/modal_rubric_manager_launch\n */\n\ndefine(\n    [\n        'jquery',\n        'core/ajax',\n        'core/notification',\n        'core/custom_interaction_events',\n        'core/modal',\n        'core/modal_registry',\n        'core/modal_events'\n    ],\n    function($, Ajax, Notification, CustomEvents, Modal, ModalRegistry, ModalEvents) {\n\n        var registered = false;\n        var SELECTORS = {\n            HIDE_BUTTON: '[data-action=\"hide\"]',\n            MODAL: '[data-region=\"modal\"]'\n        };\n\n        /**\n         * Constructor for the Modal.\n         *\n         * @param {object} root The root jQuery element for the modal\n         */\n        var ModalRubricManagerLaunch = function(root) {\n            Modal.call(this, root);\n        };\n\n        ModalRubricManagerLaunch.TYPE = 'plagiarism_turnitin-modal_rubric_manager_launch';\n        ModalRubricManagerLaunch.prototype = Object.create(Modal.prototype);\n        ModalRubricManagerLaunch.prototype.constructor = ModalRubricManagerLaunch;\n\n        /**\n         * Set up all of the event handling for the modal.\n         *\n         * @method registerEventListeners\n         */\n        ModalRubricManagerLaunch.prototype.registerEventListeners = function() {\n            // Apply parent event listeners.\n            Modal.prototype.registerEventListeners.call(this);\n\n            // On cancel, then hide the modal.\n            this.getModal().on(CustomEvents.events.activate, SELECTORS.HIDE_BUTTON, function(e, data) {\n                var cancelEvent = $.Event(ModalEvents.cancel);\n                this.getRoot().trigger(cancelEvent, this);\n\n                if (!cancelEvent.isDefaultPrevented()) {\n                    this.hide();\n                    data.originalEvent.preventDefault();\n\n                    refreshRubricSelect();\n                }\n            }.bind(this));\n\n            // On clicking outside the modal, refresh the Rubrics.\n            this.getRoot().click(function(e) {\n                if (!$(e.target).closest(SELECTORS.MODAL).length) {\n                    refreshRubricSelect();\n                }\n            }.bind(this));\n        };\n\n        // Get the rubrics belonging to a user from Turnitin and refresh menu accordingly.\n        function refreshRubricSelect() {\n            var currentRubric = $('#id_plagiarism_rubric').val();\n            $.ajax({\n                \"dataType\": 'json',\n                \"type\": \"POST\",\n                \"url\": \"../plagiarism/turnitin/ajax.php\",\n                \"data\": {\n                    action: \"refresh_rubric_select\", assignment: $('input[name=\"instance\"]').val(),\n                    modulename: $('input[name=\"modulename\"]').val(), course: $('input[name=\"course\"]').val()\n                },\n                success: function (data) {\n                    $($('#id_plagiarism_rubric')).empty();\n                    var options = data;\n                    $.each(options, function (i, val) {\n                        if (!$.isNumeric(i) && i !== \"\") {\n\n                            var optgroup = $('<optgroup>');\n                            optgroup.attr('label', i);\n\n                            $.each(val, function (j, rubric) {\n                                var option = $(\"<option></option>\");\n                                option.val(j);\n                                option.text(rubric);\n\n                                optgroup.append(option);\n                            });\n\n                            $('#id_plagiarism_rubric').append(optgroup);\n\n                        } else {\n                            $($('#id_plagiarism_rubric')).append($('<option>', {\n                                value: i,\n                                text: val\n                            }));\n                        }\n                    });\n\n                    $('#id_plagiarism_rubric' + ' option[value=\"' + currentRubric + '\"]').attr(\"selected\", \"selected\");\n                }\n            });\n        }\n\n        // Automatically register with the modal registry the first time this module is imported so that\n        // you can create modals of this type using the modal factory.\n        if (!registered) {\n            ModalRegistry.register(ModalRubricManagerLaunch.TYPE,\n                ModalRubricManagerLaunch,\n                'plagiarism_turnitin/modal_rubric_manager_launch');\n            registered = true;\n        }\n\n        return ModalRubricManagerLaunch;\n    }\n);"],"file":"modal_rubric_manager_launch.min.js"}
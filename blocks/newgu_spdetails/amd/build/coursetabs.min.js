define("block_newgu_spdetails/coursetabs",["exports","core/log","../../../../lib/amd/src/ajax","core/notification","core/templates","block_newgu_spdetails/sorting"],(function(_exports,Log,Ajax,_notification,_templates,_sorting){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,Log=_interopRequireWildcard(Log),Ajax=_interopRequireWildcard(Ajax),_templates=_interopRequireDefault(_templates),_sorting=_interopRequireDefault(_sorting);const loadAssessments=function(activetab,page,sortby,sortorder){let subcategory=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,coursefilter=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"creditcourses",containerBlock=document.querySelector("#course_contents_container"),whichTemplate=null===subcategory?"coursecategory":"coursesubcategory";containerBlock.children.length>0&&(containerBlock.innerHTML=""),containerBlock.insertAdjacentHTML("afterbegin","<div class='loader d-flex justify-content-center'>\n<div class='spinner-border m-5' role='status'><span class='hidden'>Loading...</span></div></div>");let promise=Ajax.call([{methodname:"block_newgu_spdetails_get_assessments",args:{activetab:activetab,page:page,sortby:sortby,sortorder:sortorder,subcategory:subcategory,coursefilter:coursefilter}}]);promise[0].done((function(response){document.querySelector(".loader").remove();let coursedata=JSON.parse(response.result);coursedata[`${coursefilter}`]=!0,_templates.default.renderForPromise("block_newgu_spdetails/"+whichTemplate,{data:coursedata}).then((_ref=>{let{html:html,js:js}=_ref;_templates.default.appendNodeContents(containerBlock,html,js),showPastCourseNotification(activetab),hideStatusColumn(activetab);let subCategories=document.querySelectorAll(".subcategory-row"),sortColumns=document.querySelectorAll("#category_table .th-sortable");return subCategoryEventHandler(subCategories),subCategoryReturnHandler(coursedata.parent),sortingEventHandler(sortColumns),courseFilterEventHandler(activetab,page,sortby,sortorder,subcategory),sessionStorage.setItem("activeTab",activetab),subcategory?(sessionStorage.setItem("activeCategoryId",subcategory),document.querySelector("#courseNav-container").classList.add("hidden-container")):(sessionStorage.removeItem("activeCategoryId"),document.querySelector("#courseNav-container").classList.remove("hidden-container")),!0})).catch((error=>(0,_notification.exception)(error)))})).fail((function(response){if(response){document.querySelector(".loader").remove();let errorContainer=document.createElement("div");if(errorContainer.classList.add("alert","alert-danger"),response.hasOwnProperty("message")){let errorMsg=document.createElement("p");errorMsg.innerHTML=response.message,errorContainer.appendChild(errorMsg),errorMsg.classList.add("errormessage"),Log.debug(errorMsg)}if(response.hasOwnProperty("moreinfourl")){let errorLinkContainer=document.createElement("p"),errorLink=document.createElement("a");errorLink.setAttribute("href",response.moreinfourl),errorLink.setAttribute("target","_blank"),errorLink.innerHTML="More information about this error",errorContainer.appendChild(errorLinkContainer),errorLinkContainer.appendChild(errorLink),errorLinkContainer.classList.add("errorcode")}containerBlock.prepend(errorContainer)}}))},hideStatusColumn=activetab=>{"past"==activetab&&document.querySelector("#sortby_status")&&document.querySelector("#sortby_status").classList.add("hidden")},showPastCourseNotification=activetab=>{if("past"==activetab){let containerDiv=document.createElement("div");containerDiv.classList.add("border","rounded","my-2","p-2");let div=document.createElement("div"),strong=document.createElement("strong");div.classList.add("alert","alert-info","m-0","text-center"),strong.append("Past provisional assessment grades will be displayed only for Academic Year 2024/25 onwards. Any before this, can be accessed from the MyCourses tab on Moodle or your individual course Moodle page."),div.appendChild(strong),containerDiv.appendChild(div),document.querySelector("#course_contents_container").prepend(containerDiv)}},subCategoryEventHandler=rows=>{rows.length>0&&rows.forEach((element=>{element.addEventListener("click",(()=>showSubcategoryDetails(element)))}))},showSubcategoryDetails=object=>{let id=object.parentElement.getAttribute("data-id");if(null!==id){document.querySelector("#courseNav-container").classList.add("hidden-container");let activetab="";activetab=document.querySelector("#current_tab").classList.contains("active")?"current":"past";let coursefilter=null!==sessionStorage.getItem("coursefilter")?sessionStorage.getItem("coursefilter"):"creditcourses";loadAssessments(activetab,0,"duedate","asc",id,coursefilter)}},subCategoryReturnHandler=id=>{document.querySelector("#subcategory-return-assessment")&&(document.querySelector("#subcategory-return-assessment").addEventListener("click",(()=>{0!=id&&null!==id||(id=null,document.querySelector("#courseNav-container").classList.remove("hidden-container"));let activetab="";activetab=document.querySelector("#current_tab").classList.contains("active")?"current":"past";let coursefilter=null!==sessionStorage.getItem("coursefilter")?sessionStorage.getItem("coursefilter"):"creditcourses";loadAssessments(activetab,0,"shortname","asc",id,coursefilter)})),document.querySelector("#subcategory-return-assessment").addEventListener("keyup",(function(event){let element=document.activeElement;13===event.keyCode&&element.hasAttribute("tabindex")&&(event.preventDefault(),element.click())})))},sortingEventHandler=rows=>{rows.length>0&&rows.forEach((element=>{element.addEventListener("click",(()=>(0,_sorting.default)(element.cellIndex,element.getAttribute("data-sortby"),"category_table")))}))},courseFilterEventHandler=(activetab,page,sortby,sortorder,subcatId)=>{window.console.log("courseFilterEventHandler called");let selector=document.querySelectorAll('#course_contents_container [data-region="filter"] ul li');selector.forEach((element=>{element.addEventListener("click",(e=>{window.console.log("e:",e);const option=e.target;if(option.classList.contains("active"))return;sessionStorage.removeItem("coursefilter");const coursefilter=option.getAttribute("data-value");sessionStorage.setItem("coursefilter",coursefilter),loadAssessments(activetab,page,sortby,sortorder,subcatId,coursefilter),e.preventDefault()}))})),selector.forEach((element=>{element.addEventListener("keyup",(function(event){let element=document.activeElement;13===event.keyCode&&(event.preventDefault(),element.click())}))}))},handleTabChange=function(event){event.preventDefault();let currentTab=document.querySelector("#current_tab"),pastTab=document.querySelector("#past_tab"),activetab="";switch(event.target){case currentTab:activetab="current",currentTab.classList.add("active"),pastTab.classList.remove("active");break;case pastTab:activetab="past",currentTab.classList.remove("active"),pastTab.classList.add("active")}let coursefilter=null!==sessionStorage.getItem("coursefilter")?sessionStorage.getItem("coursefilter"):"creditcourses";loadAssessments(activetab,0,"shortname","asc",null,coursefilter)};_exports.init=()=>{(()=>{let activetab="current",subcatId=null,activeTab=sessionStorage.getItem("activeTab"),activeCategoryId=sessionStorage.getItem("activeCategoryId"),coursefilter=null!==sessionStorage.getItem("coursefilter")?sessionStorage.getItem("coursefilter"):"creditcourses";if(activeTab){activetab=activeTab;let currentTab=document.querySelector("#current_tab"),pastTab=document.querySelector("#past_tab");switch(activetab){case"current":currentTab.classList.add("active"),pastTab.classList.remove("active");break;case"past":currentTab.classList.remove("active"),pastTab.classList.add("active")}}activeCategoryId&&(subcatId=activeCategoryId),loadAssessments(activetab,0,"shortname","asc",subcatId,coursefilter),document.querySelectorAll("#courses-Tab button").forEach((triggerEl=>{triggerEl.addEventListener("click",handleTabChange),triggerEl.addEventListener("keyup",(function(event){let element=document.activeElement;13===event.keyCode&&element.hasAttribute("tabindex")&&(event.preventDefault(),element.click())}))}))})()}}));

//# sourceMappingURL=coursetabs.min.js.map
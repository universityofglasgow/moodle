{"version":3,"file":"manager.min.js","sources":["../src/manager.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny Media Manager plugin class for Moodle.\n *\n * @module      tiny_media/manager\n * @copyright   2022, Stevani Andolo <stevani@hotmail.com.au>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Templates from 'core/templates';\nimport {get_string as getString} from 'core/str';\nimport * as Modal from 'core/modal_factory';\nimport * as ModalEvents from 'core/modal_events';\nimport {getData} from './options';\nimport Config from 'core/config';\n\nexport const MediaManager = class {\n\n    editor = null;\n    area = null;\n\n    constructor(editor) {\n        this.editor = editor;\n        const data = getData(editor);\n        this.area = data.params.area;\n        this.area.itemid = data.fpoptions.image.itemid;\n    }\n\n    displayDialogue = () => {\n        Modal.create({\n            type: Modal.types.DEFAULT,\n            large: true,\n            title: getString('mediamanagerproperties', 'tiny_media'),\n            body: Templates.render('tiny_media/mm_iframe', {\n                src: this.getIframeURL()\n            })\n        }).then(modal => {\n            modal.getRoot().on(ModalEvents.bodyRendered, () => {\n                this.selectFirstElement();\n            });\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n            });\n            modal.show();\n            document.querySelector('.modal-lg').style.cssText = `max-width: 850px`;\n            return modal;\n        }).catch();\n    };\n\n    // It will select the first element in the file manager.\n    selectFirstElement = () => {\n        const iframe = document.getElementById('mm-iframe');\n        iframe.addEventListener('load', function() {\n            let intervalId = setInterval(function() {\n                const iDocument = iframe.contentWindow.document;\n                if (iDocument.querySelector('.filemanager')) {\n                    const firstFocusableElement = iDocument.querySelector('.fp-navbar a:not([disabled])');\n                    if (firstFocusableElement) {\n                        firstFocusableElement.focus();\n                    }\n                    clearInterval(intervalId);\n                }\n            }, 200);\n        });\n    };\n\n    getIframeURL = () => {\n        const url = new URL(`${Config.wwwroot}/lib/editor/tiny/plugins/media/manage.php`);\n        url.searchParams.append('elementid', this.editor.getElement().id);\n        for (const key in this.area) {\n            url.searchParams.append(key, this.area[key]);\n        }\n        return url.toString();\n    };\n};\n"],"names":["_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_interopRequireWildcard","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_interopRequireDefault","_defineProperty","value","arg","input","hint","prim","Symbol","toPrimitive","undefined","res","TypeError","String","Number","_toPrimitive","_toPropertyKey","enumerable","configurable","writable","_templates","Modal","ModalEvents","_config","_exports","MediaManager","constructor","editor","create","type","types","DEFAULT","large","title","getString","body","Templates","render","src","this","getIframeURL","then","modal","getRoot","on","bodyRendered","selectFirstElement","hidden","destroy","show","document","querySelector","style","cssText","catch","iframe","getElementById","addEventListener","intervalId","setInterval","iDocument","contentWindow","firstFocusableElement","focus","clearInterval","url","URL","concat","Config","wwwroot","searchParams","append","getElement","id","area","toString","data","getData","params","itemid","fpoptions","image"],"mappings":"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"}
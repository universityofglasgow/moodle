define(["jquery","core/ajax","core/notification","core/templates","theme_snap/ajax_notification"],function(a,b,c,d,e){var f=function(c){var f=c.unavailablesections.map(Number),g=c.unavailablemods.map(Number);a(document).on("snapModuleCompletionChange",function(){b.call([{methodname:"theme_snap_course_completion",args:{courseshortname:c.shortname,unavailablesections:f.join(","),unavailablemods:g.join(",")},done:function(b){var c=function(b,c){if(Object.keys(b).length)for(var d in b){var e=b[d],f=e.id?e.id:e.number,g=e.html,h="#"+c+"-"+f;a(h).replaceWith(g)}};c(b.changedsectionhtml,"section"),c(b.changedmodhtml,"module"),d.render("theme_snap/course_toc",b.toc).done(function(b){a("#course-toc").html(a(b).html()),a(document).trigger("snapTOCReplaced")}),f=b.unavailablesections.split(",").map(Number),g=b.unavailablemods.split(",").map(Number)},fail:function(a){e.ifErrorShowBestMsg(a)}}],!0,!0)})};return f});
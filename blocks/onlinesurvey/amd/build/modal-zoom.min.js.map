{"version":3,"sources":["../src/modal-zoom.js"],"names":["define","templates","popupinfotitle","popupinfocontent","userlogintime","doRefresh","myElement","document","getElementById","oldsrc","src","handleClickSmallModal","e","preventDefault","modalZoomElem","target","originalIframe","querySelector","templatePromise","render","title","parent","done","source","div","createElement","innerHTML","modalContainer","firstChild","body","insertBefore","className","closeCallback","replace","setTimeout","parentNode","removeChild","addEventListener","init","popuptitle","popupcontent","currentlogin","zoomContainer","querySelectorAll","i","length","window","EVASYS","generatepopupinfo","evasysGeneratePopupinfo","popupinfo","sessionStorage","getItem","setItem","content"],"mappings":"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","sourcesContent":["define(['core/templates', 'core/str'], function(templates) {\n\n    var modalTitle = '';\n    var modalZoomSelector = '#block_onlinesurvey_surveys_content';\n\n    var popupinfotitle = '';\n    var popupinfocontent = '';\n    var userlogintime = 0;\n\n    var doRefresh = function() {\n        var myElement = document.getElementById(\"block_onlinesurvey_contentframe\");\n        if (myElement) {\n            var oldsrc = myElement.src;\n            myElement.src = '';\n            myElement.src = oldsrc;\n        }\n    };\n\n    var handleClickSmallModal = function(e) {\n        e.preventDefault();\n\n        var modalZoomElem = e.target;\n\n        var originalIframe = modalZoomElem.querySelector('iframe');\n\n        var templatePromise = null;\n\n        if (originalIframe !== null) {\n            // Open from Moodle page, i.e., onlinesurvey iframe exists.\n            templatePromise = templates.render('block_onlinesurvey/modal-iframe', {\n                // Copy iframe target URL from block, but inform that now in modalZoom window.\n                src: originalIframe.src + \"&modalZoom=1\",\n                title: modalTitle\n            });\n        } else {\n            // Open from iframe, i.e., needs to switch to parent Moodle page.\n            originalIframe = parent.document.querySelector('iframe');\n            templatePromise = templates.render('block_onlinesurvey/modal-iframe', {\n                // Copy iframe target URL from block, but inform that now in modalZoom window.\n                src: originalIframe.src + \"&modalZoom=1\",\n                title: modalTitle\n            });\n        }\n\n        templatePromise.done(function(source) {\n\n            var div = document.createElement('div');\n            div.innerHTML = source;\n\n            var modalContainer = div.firstChild;\n\n            document.body.insertBefore(modalContainer, document.body.firstChild);\n            document.body.className += ' block_onlinesurvey_custom-modal-open';\n\n            var closeCallback = function() {\n\n                document.body.className = document.body.className.replace(' block_onlinesurvey_custom-modal-open', '');\n\n                doRefresh();\n\n                modalContainer.className += ' fading';\n\n                setTimeout(function() {\n                    if (modalContainer.parentNode !== null) {\n                        modalContainer.parentNode.removeChild(modalContainer);\n                    }\n                }, 250);\n            };\n\n            modalContainer.querySelector('.block_onlinesurvey_custom-modal_close-button')\n                .addEventListener('click', function(e) {\n                    e.preventDefault();\n                    return closeCallback(e);\n                });\n\n            modalContainer.addEventListener('click', function(e) {\n                e.preventDefault();\n\n                return e.target !== modalContainer ?\n                    false : closeCallback(e);\n            });\n        });\n    };\n\n    return {\n        init: function(popuptitle, popupcontent, currentlogin) {\n\n            popupinfotitle = popuptitle;\n            popupinfocontent = popupcontent;\n            userlogintime = currentlogin;\n\n            var zoomContainer = document.querySelectorAll(modalZoomSelector);\n\n            for (var i = 0; i < zoomContainer.length; i++) {\n                zoomContainer[i].addEventListener('click', handleClickSmallModal);\n            }\n\n            // Namespace in window for EVASYS-functions etc.\n            window.EVASYS = {\n                // Define \"global\" functions in namespace -> later \"external\" access from iframe possible.\n                generatepopupinfo: this.generatepopupinfo\n            };\n            window.evasysGeneratePopupinfo = this.generatepopupinfo;\n        },\n        generatepopupinfo: function() {\n\n            // Get saved data from sessionStorage.\n            var popupinfo = sessionStorage.getItem('onlinesurvey_popupinfo');\n\n            if (popupinfo == false || popupinfo === null || popupinfo != userlogintime) {\n\n                // Save data to sessionStorage.\n                sessionStorage.setItem('onlinesurvey_popupinfo', userlogintime);\n\n                var templatePromise = templates.render('block_onlinesurvey/popupinfo', {\n                    title: popupinfotitle,\n                    content: popupinfocontent\n                });\n\n                templatePromise.done(function(source) {\n\n                    var div = document.createElement('div');\n                    div.innerHTML = source;\n\n                    var modalContainer = div.firstChild;\n\n                    document.body.insertBefore(modalContainer, document.body.firstChild);\n                    document.body.className += ' block_onlinesurvey_custom-modal-open popupinfo';\n\n                    var closeCallback = function() {\n\n                        document.body.className = document.body.className.replace(' block_onlinesurvey_custom-modal-open', '');\n\n                        modalContainer.className += ' fading';\n\n                        setTimeout(function() {\n                            if (modalContainer.parentNode !== null) {\n                                modalContainer.parentNode.removeChild(modalContainer);\n                            }\n                        }, 250);\n                    };\n\n                    modalContainer.querySelector('.block_onlinesurvey_custom-modal_close-button')\n                    .addEventListener('click', function(e) {\n                        e.preventDefault();\n                        return closeCallback(e);\n                    });\n\n                    modalContainer.addEventListener('click', function(e) {\n                        e.preventDefault();\n\n                        return e.target !== modalContainer ?\n                                false : closeCallback(e);\n                    });\n                });\n            }\n        }\n    };\n});\n"],"file":"modal-zoom.min.js"}
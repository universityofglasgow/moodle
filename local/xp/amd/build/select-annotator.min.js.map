{"version":3,"file":"select-annotator.min.js","sources":["../src/select-annotator.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Select annotator.\n *\n * Adds annotation as per the value chosen in a select field.\n *\n * @copyright  2022 Frédéric Massart\n * @author     Frédéric Massart <fred@branchup.tech>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([], function () {\n\n    /**\n     * Init.\n     * @param {fieldId} fieldId The field ID.\n     * @param {Array} data The data being an array of objects.\n     */\n    function init(fieldId, data) {\n        const node = document.getElementById(fieldId);\n        if (!node) {\n            return;\n        }\n        node.style.width = 'auto';\n\n        const wrapper = document.createElement('div');\n        wrapper.className = 'block_xp';\n        wrapper.style.display = 'inline-block';\n\n        const container = document.createElement('div');\n        container.className = 'xp-ml-2';\n        wrapper.appendChild(container);\n\n        /**\n         * Updator.\n         *\n         * @param {String} value The value.\n         */\n        function updator(value) {\n            value = value || '';\n            var item = data.find(function(item) {\n                return item.value == value;\n            });\n\n            container.childNodes.forEach(function(child) {\n                child.remove();\n            });\n            if (!item || !item.annotation) {\n                return;\n            }\n\n            container.innerHTML = item.annotation;\n        }\n\n        node.parentNode.appendChild(wrapper);\n        node.addEventListener('change', function(e) {\n            updator(e.target.value);\n        });\n\n        updator(node.value);\n    }\n\n    /**\n     * Init with JSON.\n     *\n     * @param {String} fieldId The field ID.\n     * @param {String} jsonSelector The JSON selector.\n     */\n    function initWithJson(fieldId, jsonSelector) {\n        try {\n            const node = document.querySelector(jsonSelector);\n            const data = node ? JSON.parse(node.textContent) : null;\n            if (!Array.isArray(data)) {\n                throw new Error('That\\'s a bit strange.');\n            }\n            init(fieldId, data);\n        } catch (err) {\n            // Nothing.\n        }\n    }\n\n    return {\n        'init': init,\n        'initWithJson': initWithJson\n    };\n});"],"names":["define","init","fieldId","data","node","document","getElementById","style","width","wrapper","createElement","className","display","container","updator","value","item","find","childNodes","forEach","child","remove","annotation","innerHTML","appendChild","parentNode","addEventListener","e","target","jsonSelector","querySelector","JSON","parse","textContent","Array","isArray","Error","err"],"mappings":";;;;;;;;;AAyBAA,mCAAO,IAAI,oBAOEC,KAAKC,QAASC,YACbC,KAAOC,SAASC,eAAeJ,aAChCE,YAGLA,KAAKG,MAAMC,MAAQ,aAEbC,QAAUJ,SAASK,cAAc,OACvCD,QAAQE,UAAY,WACpBF,QAAQF,MAAMK,QAAU,qBAElBC,UAAYR,SAASK,cAAc,gBAShCI,QAAQC,OACbA,MAAQA,OAAS,OACbC,KAAOb,KAAKc,MAAK,SAASD,aACnBA,KAAKD,OAASA,SAGzBF,UAAUK,WAAWC,SAAQ,SAASC,OAClCA,MAAMC,YAELL,MAASA,KAAKM,aAInBT,UAAUU,UAAYP,KAAKM,YArB/BT,UAAUF,UAAY,UACtBF,QAAQe,YAAYX,WAuBpBT,KAAKqB,WAAWD,YAAYf,SAC5BL,KAAKsB,iBAAiB,UAAU,SAASC,GACrCb,QAAQa,EAAEC,OAAOb,UAGrBD,QAAQV,KAAKW,aAsBV,MACKd,2BAdUC,QAAS2B,wBAEjBzB,KAAOC,SAASyB,cAAcD,cAC9B1B,KAAOC,KAAO2B,KAAKC,MAAM5B,KAAK6B,aAAe,SAC9CC,MAAMC,QAAQhC,YACT,IAAIiC,MAAM,yBAEpBnC,KAAKC,QAASC,MAChB,MAAOkC"}
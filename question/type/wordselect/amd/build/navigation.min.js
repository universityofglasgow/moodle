define(["jquery"],function(a){var b={CSS:{QUESTION_CONTENT:".qtext",SELECTABLE_WORD:"span.selectable"},tableMatrix:[],init:function(){var c=a(b.CSS.QUESTION_CONTENT),d=c.find(b.CSS.SELECTABLE_WORD);if(0!==d.length){for(var e=0,f=parseInt(a(d[0]).position().top,10),g=0,h=[],i=0;i<d.length;i++){var j=a(d[i]),k=j.parent().closest("table").length,l=0;k&&(l=j.parent().closest("table").find("tr:first td").length),(parseInt(j.position().top,10)!==f||k&&g===l)&&(g=0,e++),"undefined"==typeof h[e]&&(h[e]=[]);var m=[];m.id=j.attr("id"),m.value=j.text(),h[e][g]=m,f=parseInt(j.position().top,10),g++}b.tableMatrix=h,a(b.CSS.SELECTABLE_WORD).on("keydown",function(c){if(37===c.keyCode||38===c.keyCode||39===c.keyCode||40===c.keyCode){c.preventDefault();var d=b.getWordPosition(a(this).attr("id"));b.navigateToWord(d.row,d.col,c.keyCode)}}),a(b.CSS.SELECTABLE_WORD).on("keyup",function(b){a(this).hasClass("selected")&&(9===b.keyCode||b.shiftKey&&9===b.which||37===b.keyCode||38===b.keyCode||39===b.keyCode||40===b.keyCode)&&(b.preventDefault(),a(this).addClass("keyboard_focus"))}),a(b.CSS.SELECTABLE_WORD).focusout(function(){a(this).hasClass("selected")&&a(this).hasClass("keyboard_focus")&&a(this).removeClass("keyboard_focus")})}},getWordPosition:function(a){for(var c=0;c<b.tableMatrix.length;c++)for(var d=b.tableMatrix[c],e=0;e<d.length;e++)if(d[e].id===a)return{row:c,col:e};return!1},navigateToWord:function(c,d,e){if("undefined"!=typeof b.tableMatrix[c]&&"undefined"!=typeof b.tableMatrix[c][d]){var f="";37===e?"undefined"!=typeof b.tableMatrix[c][d-1]?f=b.tableMatrix[c][d-1].id:"undefined"!=typeof b.tableMatrix[c-1]&&"undefined"!=typeof b.tableMatrix[c-1][b.tableMatrix[c-1].length-1]&&(f=b.tableMatrix[c-1][b.tableMatrix[c-1].length-1].id):38===e?"undefined"!=typeof b.tableMatrix[c-1]&&"undefined"!=typeof b.tableMatrix[c-1][0]&&(f=b.tableMatrix[c-1][0].id):39===e?"undefined"!=typeof b.tableMatrix[c][d+1]?f=b.tableMatrix[c][d+1].id:"undefined"!=typeof b.tableMatrix[c+1]&&"undefined"!=typeof b.tableMatrix[c+1][0]&&(f=b.tableMatrix[c+1][0].id):40===e&&"undefined"!=typeof b.tableMatrix[c+1]&&"undefined"!=typeof b.tableMatrix[c+1][0]&&(f=b.tableMatrix[c+1][0].id),a("span[name='"+f+"']").focus()}}};return b});
define(["jquery","core/templates","core/str","block_xp/dialogue-base"],function(a,b,c,d){function e(a){this.initWithCourse=a||null,d.prototype.constructor.apply(this,[])}function f(b){a(g).on("click",i,function(c){c.preventDefault();var d=a(c.target).closest(h);if(d){var f=new e(b);f.on("cm-selected",function(a,b){var c=b.cm,e=b.course;d.find(".cm-rule-contextid").val(c.contextid),d.find(".cm-selected").text(M.util.get_string("rulecmdescwithcourse","block_xp",{contextname:c.name,coursename:e.shortname})),d.addClass("has-cm")}),f.show()}})}var g=".block-xp-filters",h=".block_xp-cm-rule-widget",i=".block_xp-cm-rule-widget button",j=".block_xp-cm-selector-widget";return e.prototype=Object.create(d.prototype),e.prototype.constructor=e,e.prototype._render=function(){var a=JSON.stringify(this.initWithCourse);return c.get_string("cmselector","block_xp").then(function(c){return b.render("block_xp/cm-selector",{initwithcoursejson:a}).then(function(a,d){this.setTitle(c),this._setDialogueContent(a),b.runTemplateJS(d),this.center(),this.find(j).on("cm-selected",function(a,b){this.trigger("cm-selected",b),this.close()}.bind(this))}.bind(this))}.bind(this))},{init:f}});
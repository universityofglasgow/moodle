function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("mod_board/movenotesdialog",["exports","core/modal_factory","core/modal_events","core/notification","jquery","core/str"],(function(_exports,_modal_factory,_modal_events,_notification,_jquery,Str){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_notification=_interopRequireDefault(_notification),_jquery=_interopRequireDefault(_jquery),Str=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Str);var getDestinationsList=function(moveNoteControl){var editableColumns=document.querySelectorAll('.board_column[data-locked="false"]'),wrapper=document.createElement("div"),movingNote=moveNoteControl.closest(".board_note"),movingNoteId=movingNote.dataset.ident,movingNoteColumn=movingNote.dataset.column;return editableColumns.forEach((function(column){var list=document.createElement("ul");list.classList.add("move-dialog-destinations","list-unstyled");var columnName=column.querySelector(".mod_board_column_name").innerText;Str.get_string("move_to_firstitemcolumn","mod_board",columnName).then((function(stringColumn){var li=document.createElement("li");li.classList.add("move-dialog-destination");var link=moveLink(column.dataset.ident,movingNoteId,0,movingNoteColumn,0,stringColumn);li.appendChild(link),list.appendChild(li);var destinations=column.querySelectorAll(".move_note"),count=0;return destinations.forEach((function(destination){count++;var li=document.createElement("li");li.classList.add("move-dialog-destination","ml-2");var targetNote=(0,_jquery.default)(destination.closest(".board_note")),noteTitle=targetNote.find(".mod_board_note_heading").html();""===noteTitle&&(noteTitle=count);var sortOrder=targetNote.data("sortorder"),noteId=targetNote.data("ident");noteId!=movingNoteId&&Str.get_string("move_to_afterpost","mod_board",noteTitle).then((function(stringPost){var link=moveLink(column.dataset.ident,movingNoteId,noteId,movingNoteColumn,sortOrder+1,stringPost);return li.appendChild(link),list.appendChild(li),""})).catch(_notification.default.exception)})),wrapper.appendChild(list),""})).catch(_notification.default.exception)})),wrapper},moveLink=function(columnId,movingNoteId,targetNoteId,movingNoteColumn,sortOrder,linkString){var link=document.createElement("a");return link.setAttribute("href","#"),link.dataset.columnid=columnId,link.dataset.movingnoteid=movingNoteId,link.dataset.targetnoteid=targetNoteId,link.dataset.movingnotecolumn=movingNoteColumn,link.dataset.sortorder=sortOrder,link.innerText=linkString,link},displayMoveModal=function(moveNoteControl){var modalTitle=moveNoteControl.getAttribute("aria-label");_modal_factory.default.create({type:_modal_factory.default.types.CANCEL,title:modalTitle,body:getDestinationsList(moveNoteControl)}).then((function(modal){return modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),document.addEventListener("closemovedialog",(function(){modal.destroy()})),modal.show(),modal})).catch(_notification.default.exception)},_default={init:function(ownerId,moveNote){var body=document.querySelector("body");body.classList.contains("move-dialog-initialized")||(document.addEventListener("click",(function(e){var moveNoteControl=e.target.closest(".mod_board_note_controls .move_note");moveNoteControl&&displayMoveModal(moveNoteControl);var moveDestination=e.target.closest(".move-dialog-destination a");if(moveDestination){e.preventDefault();var payload={id:parseInt(moveDestination.dataset.movingnoteid),columnid:parseInt(moveDestination.dataset.columnid),ownerid:ownerId,sortorder:parseInt(moveDestination.dataset.sortorder)},movingNoteColumn=parseInt(moveDestination.dataset.movingnotecolumn),movingNote=document.querySelector('.board_note[data-ident="'.concat(moveDestination.dataset.movingnoteid,'"]')),toColumn=document.querySelector('.board_column[data-ident="'.concat(moveDestination.dataset.columnid,'"] .board_column_content'));if(0==moveDestination.dataset.sortorder)toColumn.prepend(movingNote);else{var targetNote=document.querySelector('.board_note[data-ident="'.concat(moveDestination.dataset.targetnoteid,'"]'));targetNote?toColumn.insertBefore(movingNote,targetNote.nextSibling):toColumn.appendChild(movingNote)}moveNote(movingNoteColumn,payload,!1),document.dispatchEvent(new Event("closemovedialog"))}})),document.addEventListener("keypress",(function(e){var moveNoteControl=e.target.closest(".mod_board_note_controls .move_note");moveNoteControl&&displayMoveModal(moveNoteControl)})),body.classList.add("move-dialog-initialized"))}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=movenotesdialog.min.js.map
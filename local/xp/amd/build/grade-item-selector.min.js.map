{"version":3,"file":"grade-item-selector.min.js","sources":["../src/grade-item-selector.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Grade item selector.\n *\n * @copyright  2019 Frédéric Massart\n * @author     Frédéric Massart <fred@branchup.tech>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'block_xp/course-resource-selector', 'local_xp/grade-item-resource-selector'], function(\n    $,\n    CourseResourceSelector,\n    GradeItemResourceSelector\n) {\n    var lastUsedCourse = null;\n\n    /**\n     * Initialise the module.\n     *\n     * @param {Jquery|String} selector The selector.\n     * @param {Object} [initWithCourse] The course to initialise with.\n     */\n    function init(selector, initWithCourse) {\n        initWithCourse = initWithCourse || lastUsedCourse;\n        var container = $(selector);\n        var currentCourse = null;\n        var searchResultsContents = container.find('.search-result-contents');\n        var courseSearchField = container.find('.search-term-course');\n        var giSearchField = container.find('.search-term-grade-item');\n\n        var cs = new CourseResourceSelector(searchResultsContents, courseSearchField);\n        cs.onResourceSelected(function(e, resource) {\n            if (!resource._iscourse) {\n                return;\n            }\n            selectCourse(resource.course);\n        });\n\n        var gis = new GradeItemResourceSelector(searchResultsContents, giSearchField);\n        gis.onResourceSelected(function(e, resource) {\n            if (!resource._isgradeitem) {\n                return;\n            }\n            container.trigger('grade-item-selected', {\n                gradeitem: resource.gradeitem,\n                course: currentCourse\n            });\n        });\n\n        container.find('.course-selection-change').on('click', function() {\n            reset();\n        });\n\n        /**\n         * Reset.\n         */\n        function reset() {\n            courseSearchField.val('');\n            giSearchField.val('');\n            cs.clear();\n            container.find('.cm-search').hide();\n            container.find('.course-search .course-not-selected').show();\n            container.find('.course-search .course-selected').hide();\n            currentCourse = null;\n            courseSearchField.focus();\n        }\n\n        /**\n         * Select a course.\n         *\n         * @param {Object} course The course.\n         */\n        function selectCourse(course) {\n            currentCourse = course;\n            lastUsedCourse = course;\n            container.find('.course-search .course-selected span').text(course.fullname);\n            container.find('.course-search .course-selected').show();\n            container.find('.course-search .course-not-selected').hide();\n            container.find('.cm-search').show();\n            cs.clear();\n\n            gis.initForCourse(course.id);\n            giSearchField.val('');\n            giSearchField.focus();\n        }\n\n        if (initWithCourse) {\n            selectCourse(initWithCourse);\n        } else {\n            reset();\n        }\n    }\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","CourseResourceSelector","GradeItemResourceSelector","lastUsedCourse","init","selector","initWithCourse","container","currentCourse","searchResultsContents","find","courseSearchField","giSearchField","cs","onResourceSelected","e","resource","_iscourse","selectCourse","course","gis","reset","val","clear","hide","show","focus","text","fullname","initForCourse","id","_isgradeitem","trigger","gradeitem","on"],"mappings":";;;;;;;AAuBAA,sCAAO,CAAC,SAAU,oCAAqC,0CAA0C,SAC7FC,EACAC,uBACAC,+BAEIC,eAAiB,WA+Ed,CACHC,cAxEUC,SAAUC,gBACpBA,eAAiBA,gBAAkBH,mBAC/BI,UAAYP,EAAEK,UACdG,cAAgB,KAChBC,sBAAwBF,UAAUG,KAAK,2BACvCC,kBAAoBJ,UAAUG,KAAK,uBACnCE,cAAgBL,UAAUG,KAAK,2BAE/BG,GAAK,IAAIZ,uBAAuBQ,sBAAuBE,mBAC3DE,GAAGC,oBAAmB,SAASC,EAAGC,UACzBA,SAASC,WAGdC,aAAaF,SAASG,eAGtBC,IAAM,IAAIlB,0BAA0BO,sBAAuBG,wBAkBtDS,QACLV,kBAAkBW,IAAI,IACtBV,cAAcU,IAAI,IAClBT,GAAGU,QACHhB,UAAUG,KAAK,cAAcc,OAC7BjB,UAAUG,KAAK,uCAAuCe,OACtDlB,UAAUG,KAAK,mCAAmCc,OAClDhB,cAAgB,KAChBG,kBAAkBe,iBAQbR,aAAaC,QAClBX,cAAgBW,OAChBhB,eAAiBgB,OACjBZ,UAAUG,KAAK,wCAAwCiB,KAAKR,OAAOS,UACnErB,UAAUG,KAAK,mCAAmCe,OAClDlB,UAAUG,KAAK,uCAAuCc,OACtDjB,UAAUG,KAAK,cAAce,OAC7BZ,GAAGU,QAEHH,IAAIS,cAAcV,OAAOW,IACzBlB,cAAcU,IAAI,IAClBV,cAAcc,QA5ClBN,IAAIN,oBAAmB,SAASC,EAAGC,UAC1BA,SAASe,cAGdxB,UAAUyB,QAAQ,sBAAuB,CACrCC,UAAWjB,SAASiB,UACpBd,OAAQX,mBAIhBD,UAAUG,KAAK,4BAA4BwB,GAAG,SAAS,WACnDb,WAoCAf,eACAY,aAAaZ,gBAEbe"}
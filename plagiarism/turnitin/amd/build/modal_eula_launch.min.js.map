{"version":3,"sources":["../src/modal_eula_launch.js"],"names":["define","$","Ajax","Notification","CustomEvents","Modal","ModalRegistry","ModalEvents","registered","SELECTORS","HIDE_BUTTON","MODAL","ModalEulaLaunch","root","call","TYPE","prototype","Object","create","constructor","registerEventListeners","processEula","getModal","on","events","activate","e","data","cancelEvent","Event","cancel","getRoot","trigger","isDefaultPrevented","hide","originalEvent","preventDefault","bind","window","ev","message","ajax","type","url","M","cfg","wwwroot","dataType","action","sesskey","success","location","reload","error","register"],"mappings":"AASAA,OAAM,yCACF,CACI,QADJ,CAEI,WAFJ,CAGI,mBAHJ,CAII,gCAJJ,CAKI,YALJ,CAMI,qBANJ,CAOI,mBAPJ,CADE,CAUF,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAAgCC,CAAhC,CAA8CC,CAA9C,CAAqDC,CAArD,CAAoEC,CAApE,CAAiF,IAEzEC,CAAAA,CAAU,GAF+D,CAGzEC,CAAS,CAAG,CACZC,WAAW,CAAE,wBADD,CAEZC,KAAK,CAAE,yBAFK,CAH6D,CAazEC,CAAe,CAAG,SAASC,CAAT,CAAe,CACjCR,CAAK,CAACS,IAAN,CAAW,IAAX,CAAiBD,CAAjB,CACH,CAf4E,CAiB7ED,CAAe,CAACG,IAAhB,CAAuB,uCAAvB,CACAH,CAAe,CAACI,SAAhB,CAA4BC,MAAM,CAACC,MAAP,CAAcb,CAAK,CAACW,SAApB,CAA5B,CACAJ,CAAe,CAACI,SAAhB,CAA0BG,WAA1B,CAAwCP,CAAxC,CAOAA,CAAe,CAACI,SAAhB,CAA0BI,sBAA1B,CAAmD,UAAW,CAE1Df,CAAK,CAACW,SAAN,CAAgBI,sBAAhB,CAAuCN,IAAvC,CAA4C,IAA5C,EAEAO,CAAW,GAGX,KAAKC,QAAL,GAAgBC,EAAhB,CAAmBnB,CAAY,CAACoB,MAAb,CAAoBC,QAAvC,CAAiDhB,CAAS,CAACC,WAA3D,CAAwE,SAASgB,CAAT,CAAYC,CAAZ,CAAkB,CACtF,GAAIC,CAAAA,CAAW,CAAG3B,CAAC,CAAC4B,KAAF,CAAQtB,CAAW,CAACuB,MAApB,CAAlB,CACA,KAAKC,OAAL,GAAeC,OAAf,CAAuBJ,CAAvB,CAAoC,IAApC,EAEA,GAAI,CAACA,CAAW,CAACK,kBAAZ,EAAL,CAAuC,CACnC,KAAKC,IAAL,GACAP,CAAI,CAACQ,aAAL,CAAmBC,cAAnB,EACH,CACJ,CARuE,CAQtEC,IARsE,CAQjE,IARiE,CAAxE,CASH,CAhBD,CAmBA,QAAShB,CAAAA,CAAT,EAAuB,CACnBpB,CAAC,CAACqC,MAAD,CAAD,CAAUf,EAAV,CAAa,SAAb,CAAwB,SAASgB,CAAT,CAAa,CACjC,GAAIC,CAAAA,CAAO,CAAsB,WAAnB,QAAOD,CAAAA,CAAE,CAACZ,IAAV,CAAiCY,CAAE,CAACJ,aAAH,CAAiBR,IAAlD,CAAyDY,CAAE,CAACZ,IAA1E,CAGA,GAAgB,wBAAZ,GAAAa,CAAO,EAA6C,wBAAZ,GAAAA,CAA5C,CAAkF,CAC9EvC,CAAC,CAACwC,IAAF,CAAO,CACHC,IAAI,CAAE,MADH,CAEHC,GAAG,CAAEC,CAAC,CAACC,GAAF,CAAMC,OAAN,CAAgB,+BAFlB,CAGHC,QAAQ,CAAE,MAHP,CAIHpB,IAAI,CAAE,CACFqB,MAAM,CAAE,qBADN,CAEFR,OAAO,CAAEA,CAFP,CAGFS,OAAO,CAAEL,CAAC,CAACC,GAAF,CAAMI,OAHb,CAJH,CASHC,OAAO,CAAE,kBAAW,CAChBZ,MAAM,CAACa,QAAP,CAAgBC,MAAhB,EACH,CAXE,CAYHC,KAAK,CAAE,gBAAW,CACdf,MAAM,CAACa,QAAP,CAAgBC,MAAhB,EACH,CAdE,CAAP,CAgBH,CACJ,CAtBD,CAuBH,CAID,GAAI,CAAC5C,CAAL,CAAiB,CACbF,CAAa,CAACgD,QAAd,CAAuB1C,CAAe,CAACG,IAAvC,CAA6CH,CAA7C,CAA8D,uCAA9D,EACAJ,CAAU,GACb,CAED,MAAOI,CAAAA,CACV,CAzFC,CAAN","sourcesContent":["/**\n * Javascript controller for Eula launcher\n *\n * @package   turnitin\n * @copyright Turnitin\n * @author 2019 David Winn <dwinn@turnitin.com>\n * @module plagiarism_turnitin/modal_eula_launch\n */\n\ndefine(\n    [\n        'jquery',\n        'core/ajax',\n        'core/notification',\n        'core/custom_interaction_events',\n        'core/modal',\n        'core/modal_registry',\n        'core/modal_events'\n    ],\n    function($, Ajax, Notification, CustomEvents, Modal, ModalRegistry, ModalEvents) {\n\n        var registered = false;\n        var SELECTORS = {\n            HIDE_BUTTON: '[data-action=\"hide\"]',\n            MODAL: '[data-region=\"modal\"]'\n        };\n\n        /**\n         * Constructor for the Modal.\n         *\n         * @param {object} root The root jQuery element for the modal\n         */\n        var ModalEulaLaunch = function(root) {\n            Modal.call(this, root);\n        };\n\n        ModalEulaLaunch.TYPE = 'plagiarism_turnitin-modal_eula_launch';\n        ModalEulaLaunch.prototype = Object.create(Modal.prototype);\n        ModalEulaLaunch.prototype.constructor = ModalEulaLaunch;\n\n        /**\n         * Set up all of the event handling for the modal.\n         *\n         * @method registerEventListeners\n         */\n        ModalEulaLaunch.prototype.registerEventListeners = function() {\n            // Apply parent event listeners.\n            Modal.prototype.registerEventListeners.call(this);\n\n            processEula();\n\n            // On clicking the X, then hide the modal.\n            this.getModal().on(CustomEvents.events.activate, SELECTORS.HIDE_BUTTON, function(e, data) {\n                var cancelEvent = $.Event(ModalEvents.cancel);\n                this.getRoot().trigger(cancelEvent, this);\n\n                if (!cancelEvent.isDefaultPrevented()) {\n                    this.hide();\n                    data.originalEvent.preventDefault();\n                }\n            }.bind(this));\n        };\n\n        // Get the rubrics belonging to a user from Turnitin and refresh menu accordingly.\n        function processEula() {\n            $(window).on(\"message\", function(ev) {\n                var message = typeof ev.data === 'undefined' ? ev.originalEvent.data : ev.data;\n\n                // Only make ajax request if message is one of the expected responses.\n                if (message === 'turnitin_eula_declined' || message === 'turnitin_eula_accepted') {\n                    $.ajax({\n                        type: \"POST\",\n                        url: M.cfg.wwwroot + \"/plagiarism/turnitin/ajax.php\",\n                        dataType: \"json\",\n                        data: {\n                            action: \"actionuseragreement\",\n                            message: message,\n                            sesskey: M.cfg.sesskey\n                        },\n                        success: function() {\n                            window.location.reload();\n                        },\n                        error: function() {\n                            window.location.reload();\n                        }\n                    });\n                }\n            });\n        }\n\n        // Automatically register with the modal registry the first time this module is imported so that\n        // you can create modals of this type using the modal factory.\n        if (!registered) {\n            ModalRegistry.register(ModalEulaLaunch.TYPE, ModalEulaLaunch, 'plagiarism_turnitin/modal_eula_launch');\n            registered = true;\n        }\n\n        return ModalEulaLaunch;\n    }\n);"],"file":"modal_eula_launch.min.js"}
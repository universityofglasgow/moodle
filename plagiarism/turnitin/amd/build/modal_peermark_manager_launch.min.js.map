{"version":3,"file":"modal_peermark_manager_launch.min.js","sources":["../src/modal_peermark_manager_launch.js"],"sourcesContent":["/**\n * Javascript controller for the Peermark Manager launcher\n *\n * @copyright Turnitin\n * @author 2019 David Winn <dwinn@turnitin.com>\n * @module plagiarism_turnitin/modal_peermark_manager_launch\n */\n\ndefine(\n    [\n        'jquery',\n        'core/ajax',\n        'core/notification',\n        'core/custom_interaction_events',\n        'core/modal',\n        'core/modal_registry',\n        'core/modal_events'\n    ],\n    function($, Ajax, Notification, CustomEvents, Modal, ModalRegistry, ModalEvents) {\n\n        var registered = false;\n        var SELECTORS = {\n            HIDE_BUTTON: '[data-action=\"hide\"]',\n            MODAL: '[data-region=\"modal\"]'\n        };\n\n        /**\n         * Constructor for the Modal.\n         *\n         * @param {object} root The root jQuery element for the modal\n         */\n        var ModalPeermarkManagerLaunch = function(root) {\n            Modal.call(this, root);\n        };\n\n        ModalPeermarkManagerLaunch.TYPE = 'plagiarism_turnitin-modal_peermark_manager_launch';\n        ModalPeermarkManagerLaunch.prototype = Object.create(Modal.prototype);\n        ModalPeermarkManagerLaunch.prototype.constructor = ModalPeermarkManagerLaunch;\n\n        /**\n         * Set up all of the event handling for the modal.\n         *\n         * @method registerEventListeners\n         */\n        ModalPeermarkManagerLaunch.prototype.registerEventListeners = function() {\n            // Apply parent event listeners.\n            Modal.prototype.registerEventListeners.call(this);\n\n            // On cancel, then hide the modal.\n            this.getModal().on(CustomEvents.events.activate, SELECTORS.HIDE_BUTTON, function(e, data) {\n                var cancelEvent = $.Event(ModalEvents.cancel);\n                this.getRoot().trigger(cancelEvent, this);\n\n                if (!cancelEvent.isDefaultPrevented()) {\n                    this.hide();\n                    data.originalEvent.preventDefault();\n\n                    refreshPeermarkAssignments();\n                }\n            }.bind(this));\n\n            // On clicking outside the modal, refresh the Peermark assignments.\n            this.getRoot().click(function(e) {\n                if (!$(e.target).closest(SELECTORS.MODAL).length) {\n                    refreshPeermarkAssignments();\n                }\n            }.bind(this));\n        };\n\n        /**\n         * Method to refresh peermark assignments.\n         */\n        function refreshPeermarkAssignments() {\n            $.ajax({\n                type: \"POST\",\n                url: M.cfg.wwwroot + \"/plagiarism/turnitin/ajax.php\",\n                dataType: \"json\",\n                data: {\n                    action: \"refresh_peermark_assignments\",\n                    cmid: $('input[name=\"coursemodule\"]').val(),\n                    sesskey: M.cfg.sesskey\n                }\n            });\n        }\n\n        // Automatically register with the modal registry the first time this module is imported so that\n        // you can create modals of this type using the modal factory.\n        if (!registered) {\n            ModalRegistry.register(ModalPeermarkManagerLaunch.TYPE,\n                ModalPeermarkManagerLaunch,\n                'plagiarism_turnitin/modal_peermark_manager_launch');\n            registered = true;\n        }\n\n        return ModalPeermarkManagerLaunch;\n    }\n);"],"names":["define","$","Ajax","Notification","CustomEvents","Modal","ModalRegistry","ModalEvents","registered","SELECTORS","ModalPeermarkManagerLaunch","root","call","this","refreshPeermarkAssignments","ajax","type","url","M","cfg","wwwroot","dataType","data","action","cmid","val","sesskey","TYPE","prototype","Object","create","constructor","registerEventListeners","getModal","on","events","activate","e","cancelEvent","Event","cancel","getRoot","trigger","isDefaultPrevented","hide","originalEvent","preventDefault","bind","click","target","closest","length","register"],"mappings":"AAQAA,2DACI,CACI,SACA,YACA,oBACA,iCACA,aACA,sBACA,sBAEJ,SAASC,EAAGC,KAAMC,aAAcC,aAAcC,MAAOC,cAAeC,iBAE5DC,YAAa,EACbC,sBACa,uBADbA,gBAEO,wBAQPC,2BAA6B,SAASC,MACtCN,MAAMO,KAAKC,KAAMF,gBAwCZG,6BACLb,EAAEc,KAAK,CACHC,KAAM,OACNC,IAAKC,EAAEC,IAAIC,QAAU,gCACrBC,SAAU,OACVC,KAAM,CACFC,OAAQ,+BACRC,KAAMvB,EAAE,8BAA8BwB,MACtCC,QAASR,EAAEC,IAAIO,kBA7C3BhB,2BAA2BiB,KAAO,qDAClCjB,2BAA2BkB,UAAYC,OAAOC,OAAOzB,MAAMuB,YACtBG,YAAcrB,2BAOnDA,2BAA2BkB,UAAUI,uBAAyB,WAE1D3B,MAAMuB,UAAUI,uBAAuBpB,KAAKC,WAGvCoB,WAAWC,GAAG9B,aAAa+B,OAAOC,SAAU3B,sBAAuB,SAAS4B,EAAGf,UAC5EgB,YAAcrC,EAAEsC,MAAMhC,YAAYiC,aACjCC,UAAUC,QAAQJ,YAAazB,MAE/ByB,YAAYK,4BACRC,OACLtB,KAAKuB,cAAcC,iBAEnBhC,+BAENiC,KAAKlC,YAGF4B,UAAUO,MAAM,SAASX,GACrBpC,EAAEoC,EAAEY,QAAQC,QAAQzC,iBAAiB0C,QACtCrC,8BAENiC,KAAKlC,QAqBNL,aACDF,cAAc8C,SAAS1C,2BAA2BiB,KAC9CjB,2BACA,qDACJF,YAAa,GAGVE"}
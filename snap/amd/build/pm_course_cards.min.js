define(["jquery","core/log","core/templates","theme_snap/pm_course_favorites","theme_snap/model_view","theme_snap/ajax_notification","theme_snap/util","theme_snap/appear"],function(a,b,c,d,e,f,g,h){var i=function(){var i=this;this.applyCourseInfo=function(d){c.render("theme_snap/course_cards",[]).done(function(){for(var c in d){var f=d[c];b.debug("applying course data for courseid "+f.course);var g=a('.coursecard[data-courseid="'+f.course+'"]');e(g,"theme_snap/course_cards"),a(g).trigger("modelUpdate",f)}})},this.reqCourseInfo=function(c){if(0!==c.length){var d="courseids="+c.join(","),e=M.cfg.sesskey+"coursecard";b.debug("fetching course data"),a.ajax({type:"GET",async:!0,url:M.cfg.wwwroot+"/theme/snap/rest.php?action=get_courseinfo&contextid="+M.cfg.context,data:d,success:function(a){f.ifErrorShowBestMsg(a).done(function(c){c||(a.info?(b.debug("fetched coursedata",a.info),g.supportsSessionStorage()&&(window.sessionStorage[e]=JSON.stringify(a.info)),i.applyCourseInfo(a.info)):b.warn("fetched coursedata with error: JSON data object is missing info property",a))})}})}},this.getCourseIds=function(){var b=[];return a(".coursecard").each(function(){b.push(a(this).attr("data-courseid"))}),b},this.applyAppearForImages=function(){function b(){var a,b=document.createElement("fakeelement"),c={Animation:"Animationend",OAnimation:"oAnimationEnd",MozAnimation:"Animationend",WebkitAnimation:"webkitAnimationEnd"};for(a in c)if(void 0!==b.style[a])return c[a]}h(document.body).on("appear",".coursecard",function(b,c){c.each(function(){var b=a(this).data("image-url");if(void 0!==b){var c=a(this);a('<img src="'+b.trim()+'" />').on("load",function(){a(c).css("background-image","url("+b.trim()+")")})}})}),a("#snap-pm-courses .nav-tabs .nav-link").on("click",function(){var c=a(this).attr("href");a(c)[0].addEventListener(b(),function(){a.force_appear()},!1)});var c={appeartopoffset:100,appearleftoffset:100};a(".coursecard").appear(c),h.force_appear()},this.init=function(){a(document).ready(function(){d();var a=i.getCourseIds(),b=M.cfg.sesskey+"coursecard";if(a.length>0)if(i.applyAppearForImages(),g.supportsSessionStorage()&&window.sessionStorage[b]){var c=JSON.parse(window.sessionStorage[b]);i.applyCourseInfo(c)}else i.reqCourseInfo(a)}),a(document).on("click",".coursecard[data-href]",function(b){var c=a(b.target),d="_self";a(c).closest("a").length||(window.open(a(this).data("href"),d),b.preventDefault())})}};return new i});
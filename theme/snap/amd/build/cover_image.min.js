define(["jquery","core/log","core/ajax","core/notification","theme_snap/ajax_notification"],function(a,b,c,d,e){var f=function(b,c){var d=M.util.get_string("closebuttontitle","moodle");a(b).length||a("#snap-coverimagecontrol").before('<div id="'+b+'" class="snap-alert-cover-image alert alert-warning" role="alert">'+c+'<button type="button" class="close" data-dismiss="alert" aria-label="'+d+'"><span aria-hidden="true">&times;</span></button></div>')},g=function(a){var b=Math.floor(Math.log(a)/Math.log(1024));return 1*(a/Math.pow(1024,b)).toFixed(2)+" "+["B","kB","MB","GB","TB"][b]},h=function(){a("#snap-changecoverimageconfirmation .ok").removeClass("ajaxing"),a("#snap-alert-cover-image-size").remove(),a("#snap-alert-cover-image-bytes").remove(),a('label[for="snap-coverfiles"]').removeClass("ajaxing"),a("#snap-changecoverimageconfirmation").removeClass("state-visible"),a('label[for="snap-coverfiles"]').addClass("state-visible"),a("#snap-coverfiles").val("")},i=function(){a("#snap-alert-cover-image-upload-failed").remove(),a("#snap-changecoverimageconfirmation").removeClass("disabled"),a('label[for="snap-coverfiles"]').removeClass("state-visible"),a("#snap-changecoverimageconfirmation").addClass("state-visible"),a("body").removeClass("cover-image-change")},j=function(b,d){a("#page-header").data("servercoverfile",a("#page-header").css("background-image")),a("#changecoverimage").click(function(b){b.preventDefault(),a(this).removeClass("state-visible"),a('label[for="snap-coverfiles"]').addClass("state-visible")});var j,k;a("#snap-coverfiles").on("change",function(c){a("body").addClass("cover-image-change");var d=c.target.files;if(d.length&&(j=d[0],j.type.match("image.*"))){var e=new FileReader;a('label[for="snap-coverfiles"]').addClass("ajaxing"),e.onload=function(c){return function(d){k=d.target.result,a(".path-course-view #page-header").addClass("mast-image");var e=b;if(c.size>e){h();var j=g(e),l=M.util.get_string("error:coverimageexceedsmaxbytes","theme_snap",j);return void f("snap-alert-cover-image-bytes",l)}a("#snap-alert-cover-image-bytes").remove();var m=a("<img />");m=m.get(0),m.src=k,a(m).on("load",function(){m.width<1024?f("snap-alert-cover-image-size",M.util.get_string("error:coverimageresolutionlow","theme_snap")):a("#snap-alert-cover-image-size").remove()}),a("#page-header").css("background-image","url("+k+")"),a("#page-header").data("localcoverfile",c.name),i()}}(j),e.readAsDataURL(j)}}),a("#snap-changecoverimageconfirmation .ok").click(function(){if(!a(this).parent().hasClass("disabled")){a("#snap-alert-cover-image-size").remove(),a("#snap-alert-cover-image-bytes").remove(),a("#snap-changecoverimageconfirmation .ok").addClass("ajaxing"),a("#snap-changecoverimageconfirmation").addClass("disabled");var b=k.split("base64,")[1];d.imagedata=b,d.imagefilename=j.name,c.call([{methodname:"theme_snap_cover_image",args:{params:d},done:function(a){h(),!a.success&&a.warning&&f("snap-alert-cover-image-upload-failed",a.warning)},fail:function(a){h(),e.ifErrorShowBestMsg(a)}}],!0,!0)}}),a("#snap-changecoverimageconfirmation .cancel").click(function(){a(this).parent().hasClass("disabled")||(a("#page-header").css("background-image",a("#page-header").data("servercoverfile")),h())}),a("#snap-coverimagecontrol").addClass("snap-js-enabled")},k=function(a,b){var c={imagefilename:null,imagedata:null,categoryid:a,courseshortname:null};j(b,c)},l=function(a,b){var c={imagefilename:null,imagedata:null,categoryid:null,courseshortname:a};j(b,c)};return{courseImage:l,categoryImage:k}});
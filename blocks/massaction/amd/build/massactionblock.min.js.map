{"version":3,"file":"massactionblock.min.js","sources":["../src/massactionblock.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Main module for the massaction block.\n *\n * @module     block_massaction/massactionblock\n * @copyright  2022 ISB Bayern\n * @author     Philipp Memmel\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as checkboxmanager from './checkboxmanager';\nimport * as Str from 'core/str';\nimport Log from 'core/log';\nimport Notification from 'core/notification';\nimport Pending from 'core/pending';\nimport {getCurrentCourseEditor} from 'core_courseformat/courseeditor';\n\nexport const usedMoodleCssClasses = {\n    ACTIVITY_ITEM: '.activity-item',\n    SECTION_NAME: 'sectionname',\n    MODULE_ID_PREFIX: 'module-',\n};\n\nexport const cssIds = {\n    SELECT_ALL_LINK: 'block-massaction-control-selectall',\n    DESELECT_ALL_LINK: 'block-massaction-control-deselectall',\n    HIDE_LINK: 'block-massaction-action-hide',\n    SHOW_LINK: 'block-massaction-action-show',\n    MAKE_AVAILABLE_LINK: 'block-massaction-action-makeavailable',\n    DUPLICATE_LINK: 'block-massaction-action-duplicate',\n    DELETE_LINK: 'block-massaction-action-delete',\n    SHOW_DESCRIPTION_LINK: 'block-massaction-action-showdescription',\n    HIDE_DESCRIPTION_LINK: 'block-massaction-action-hidedescription',\n    CONTENT_CHANGED_NOTIFICATION_LINK: 'block-massaction-action-contentchangednotification',\n    MOVELEFT_LINK: 'block-massaction-action-moveleft',\n    MOVERIGHT_LINK: 'block-massaction-action-moveright',\n    MOVETO_ICON_LINK: 'block-massaction-action-moveto',\n    DUPLICATETO_ICON_LINK: 'block-massaction-action-duplicateto',\n    DUPLICATE_TO_COURSE_ICON_LINK: 'block-massaction-action-duplicatetocourse',\n    SECTION_SELECT: 'block-massaction-control-section-list-select',\n    MOVETO_SELECT: 'block-massaction-control-section-list-moveto',\n    DUPLICATETO_SELECT: 'block-massaction-control-section-list-duplicateto',\n    BOX_ID_PREFIX: 'block-massaction-module-selector-',\n    CHECKBOX_CLASS: 'block-massaction-checkbox',\n    HIDDEN_FIELD_REQUEST_INFORMATION: 'block-massaction-control-request',\n    ACTION_FORM: 'block-massaction-control-form',\n};\n\nexport const constants = {\n    SECTION_SELECT_DESCRIPTION_VALUE: 'description',\n    SECTION_NUMBER_ALL_PLACEHOLDER: 'all',\n    CHECKBOX_DESCRIPTION_SUFFIX: ' Checkbox'\n};\n\nconst actions = {\n    HIDE: 'hide',\n    SHOW: 'show',\n    MAKE_AVAILABLE: 'makeavailable',\n    DUPLICATE: 'duplicate',\n    DELETE: 'delete',\n    SHOW_DESCRIPTION: 'showdescription',\n    HIDE_DESCRIPTION: 'hidedescription',\n    MOVE_LEFT: 'moveleft',\n    MOVE_RIGHT: 'moveright',\n    CONTENT_CHANGED_NOTIFICATION: 'contentchangednotification',\n    MOVE_TO: 'moveto',\n    DUPLICATE_TO: 'duplicateto',\n    DUPLICATE_TO_COURSE: 'duplicatetocourse',\n};\n\n/**\n * Initialize the mass-action block.\n */\nexport const init = async() => {\n    const pendingPromise = new Pending('block_massaction/init');\n\n    const editor = getCurrentCourseEditor();\n    // Initialize the checkbox manager as soon as the courseeditor is ready.\n    editor.stateManager.getInitialPromise()\n        .then(() => checkboxmanager.initCheckboxManager())\n        .catch(error => Log.debug(error));\n\n    document.getElementById(cssIds.SELECT_ALL_LINK)?.addEventListener('click',\n        () => checkboxmanager.setSectionSelection(true, constants.SECTION_NUMBER_ALL_PLACEHOLDER), false);\n\n    document.getElementById(cssIds.DESELECT_ALL_LINK)?.addEventListener('click',\n        () => checkboxmanager.setSectionSelection(false, constants.SECTION_NUMBER_ALL_PLACEHOLDER), false);\n\n    document.getElementById(cssIds.HIDE_LINK)?.addEventListener('click',\n        () => submitAction(actions.HIDE), false);\n\n    document.getElementById(cssIds.SHOW_LINK)?.addEventListener('click',\n        () => submitAction(actions.SHOW), false);\n\n    document.getElementById(cssIds.MAKE_AVAILABLE_LINK)?.addEventListener('click',\n        () => submitAction(actions.MAKE_AVAILABLE), false);\n\n    document.getElementById(cssIds.DUPLICATE_LINK)?.addEventListener('click',\n        () => submitAction(actions.DUPLICATE), false);\n\n    document.getElementById(cssIds.DELETE_LINK)?.addEventListener('click',\n        () => submitAction(actions.DELETE), false);\n\n    document.getElementById(cssIds.SHOW_DESCRIPTION_LINK)?.addEventListener('click',\n        () => submitAction(actions.SHOW_DESCRIPTION), false);\n\n    document.getElementById(cssIds.HIDE_DESCRIPTION_LINK)?.addEventListener('click',\n        () => submitAction(actions.HIDE_DESCRIPTION), false);\n\n    document.getElementById(cssIds.CONTENT_CHANGED_NOTIFICATION_LINK)?.addEventListener('click',\n        () => submitAction(actions.CONTENT_CHANGED_NOTIFICATION), false);\n\n    document.getElementById(cssIds.MOVELEFT_LINK)?.addEventListener('click',\n        () => submitAction(actions.MOVE_LEFT), false);\n\n    document.getElementById(cssIds.MOVERIGHT_LINK)?.addEventListener('click',\n        () => submitAction(actions.MOVE_RIGHT), false);\n\n    document.getElementById(cssIds.MOVETO_ICON_LINK)?.addEventListener('click',\n        () => submitAction(actions.MOVE_TO), false);\n\n    document.getElementById(cssIds.DUPLICATETO_ICON_LINK)?.addEventListener('click',\n        () => submitAction(actions.DUPLICATE_TO), false);\n\n    document.getElementById(cssIds.DUPLICATE_TO_COURSE_ICON_LINK)?.addEventListener('click',\n        () => submitAction(actions.DUPLICATE_TO_COURSE), false);\n\n    pendingPromise.resolve();\n};\n\n/**\n * Submit the selected action to server.\n *\n * @param {string} action\n * @return {boolean} true if action was successful, false otherwise\n */\nconst submitAction = (action) => {\n    const submitData = {\n        'action': action,\n        'moduleIds': []\n    };\n\n    submitData.moduleIds = checkboxmanager.getSelectedModIds();\n\n    // Verify that at least one checkbox is checked.\n    if (submitData.moduleIds.length === 0) {\n        displayError(Str.get_string('noitemselected', 'block_massaction'));\n        return false;\n    }\n\n    // Prep the submission.\n    switch (action) {\n        case actions.HIDE:\n        case actions.SHOW:\n        case actions.MAKE_AVAILABLE:\n        case actions.DUPLICATE:\n        case actions.DUPLICATE_TO_COURSE:\n        case actions.CONTENT_CHANGED_NOTIFICATION:\n        case actions.MOVE_LEFT:\n        case actions.MOVE_RIGHT:\n        case actions.DELETE:\n        case actions.SHOW_DESCRIPTION:\n        case actions.HIDE_DESCRIPTION:\n            break;\n\n        case actions.MOVE_TO:\n            // Get the target section.\n            submitData.moveToTarget = document.getElementById(cssIds.MOVETO_SELECT).value;\n            if (submitData.moveToTarget.trim() === '') {\n                displayError(Str.get_string('nomovingtargetselected', 'block_massaction'));\n                return false;\n            }\n            break;\n\n        case actions.DUPLICATE_TO:\n            // Get the target section.\n            submitData.duplicateToTarget = document.getElementById(cssIds.DUPLICATETO_SELECT).value;\n            if (submitData.duplicateToTarget.trim() === '') {\n                displayError(Str.get_string('nomovingtargetselected', 'block_massaction'));\n                return false;\n            }\n            break;\n        default:\n            displayError('Unknown action: ' + action + '. Coding error.');\n            return false;\n    }\n    // Set the form value and submit.\n    document.getElementById(cssIds.HIDDEN_FIELD_REQUEST_INFORMATION).value = JSON.stringify(submitData);\n    document.getElementById(cssIds.ACTION_FORM).submit();\n    return true;\n};\n\nconst displayError = (errorText) => {\n    Promise.resolve([Str.get_string('error', 'core'), errorText, Str.get_string('back', 'core')])\n        .then(text => Notification.alert(text[0], text[1], text[2]))\n        .catch(error => Log.debug(error));\n};\n"],"names":["ACTIVITY_ITEM","SECTION_NAME","MODULE_ID_PREFIX","cssIds","SELECT_ALL_LINK","DESELECT_ALL_LINK","HIDE_LINK","SHOW_LINK","MAKE_AVAILABLE_LINK","DUPLICATE_LINK","DELETE_LINK","SHOW_DESCRIPTION_LINK","HIDE_DESCRIPTION_LINK","CONTENT_CHANGED_NOTIFICATION_LINK","MOVELEFT_LINK","MOVERIGHT_LINK","MOVETO_ICON_LINK","DUPLICATETO_ICON_LINK","DUPLICATE_TO_COURSE_ICON_LINK","SECTION_SELECT","MOVETO_SELECT","DUPLICATETO_SELECT","BOX_ID_PREFIX","CHECKBOX_CLASS","HIDDEN_FIELD_REQUEST_INFORMATION","ACTION_FORM","constants","SECTION_SELECT_DESCRIPTION_VALUE","SECTION_NUMBER_ALL_PLACEHOLDER","CHECKBOX_DESCRIPTION_SUFFIX","actions","async","pendingPromise","Pending","stateManager","getInitialPromise","then","checkboxmanager","initCheckboxManager","catch","error","Log","debug","document","getElementById","addEventListener","setSectionSelection","submitAction","resolve","action","submitData","moduleIds","getSelectedModIds","length","displayError","Str","get_string","moveToTarget","value","trim","duplicateToTarget","JSON","stringify","submit","errorText","Promise","text","Notification","alert"],"mappings":"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"}
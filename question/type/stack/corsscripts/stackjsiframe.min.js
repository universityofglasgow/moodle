"use strict";let DISABLE_CHANGES={};let INPUT_PROMISES={};let FETCH_PROMISES={};let do_connect=null;let is_connected=false;const CONNECTED=new Promise((resolve,reject)=>{do_connect=resolve});CONNECTED.then((b)=>{is_connected=true});const pinger=setInterval(()=>{if(!is_connected){const msg={version:'STACK-JS:1.0.0',type:'ping',src:FRAME_ID};window.parent.postMessage(JSON.stringify(msg),'*');}},10);window.addEventListener("message",(e)=>{if(!(typeof e.data==='string'||e.data instanceof String)){return;}
let msg=null;try{msg=JSON.parse(e.data);}catch(e){return;}
if(!(('version'in msg)&&msg.version.startsWith('STACK-JS'))){return;}
if(!(('tgt'in msg)&&('type'in msg)&&(msg.tgt===FRAME_ID))){return;}
switch(msg.type){case'initial-input':const element=document.getElementById(msg.name);DISABLE_CHANGES[msg.name]=true;element.value=msg.value;DISABLE_CHANGES[msg.name]=false;INPUT_PROMISES[msg.name](element.id);delete INPUT_PROMISES[msg.name];break;case'changed-input':const input=document.getElementById(msg.name);DISABLE_CHANGES[msg.name]=true;input.value=msg.value;const c=new Event('change');input.dispatchEvent(c);DISABLE_CHANGES[msg.name]=false;break;case'xfer-content':if(msg.target in FETCH_PROMISES){FETCH_PROMISES[msg.target](msg.content);delete FETCH_PROMISES[msg.target];}
break;case'ping':clearInterval(pinger);do_connect(true);break;case'error':default:let errmesg='Unknown message-type "'+msg.type+'"';if(msg.type==='error'){errmesg=msg.msg;}
const p=document.createElement('p');p.appendChild(document.createTextNode(errmesg));const div=document.getElementById('error');if(div){div.appendChild(p);}else{const div=document.createElement('div');div.id='error';div.style.color='red';const h1=document.createElement('h1');h1.appendChild(document.createTextNode('Error'));div.appendChild(h1);div.appendChild(p);document.body.replaceChildren(div);}
break;}});export const stack_js={request_access_to_input:function(inputname,inputevents){const input=document.createElement('input');input.type='hidden';input.id=inputname;DISABLE_CHANGES[inputname]=false;document.body.appendChild(input);input.addEventListener('change',(e)=>{if(!DISABLE_CHANGES[inputname]){const msg={version:'STACK-JS:1.0.0',type:'changed-input',name:inputname,value:input.value,src:FRAME_ID};CONNECTED.then(()=>{window.parent.postMessage(JSON.stringify(msg),'*');});}});CONNECTED.then((whatever)=>{const msg={version:'STACK-JS:1.0.0',type:'register-input-listener',name:inputname,src:FRAME_ID};if(inputevents===true){msg['track-input']=true;}
window.parent.postMessage(JSON.stringify(msg),'*');});return new Promise((resolve,reject)=>{INPUT_PROMISES[inputname]=resolve;setTimeout(()=>{if(inputname in INPUT_PROMISES){reject('No response to input registration of "'+inputname+'" in 5s.');}},5000);});},toggle_visibility:function(elementid,show){const msg={version:'STACK-JS:1.0.0',type:'toggle-visibility',target:elementid,set:show?'show':'hide',src:FRAME_ID};CONNECTED.then(()=>{window.parent.postMessage(JSON.stringify(msg),'*');});},switch_content:function(elementid,newcontent){const msg={version:'STACK-JS:1.0.1',type:'change-content',target:elementid,content:newcontent,src:FRAME_ID};CONNECTED.then(()=>{window.parent.postMessage(JSON.stringify(msg),'*');});},get_content:function(elementid){if(elementid in FETCH_PROMISES){return FETCH_PROMISES[elementid];}
const msg={version:'STACK-JS:1.1.0',type:'get-content',target:elementid,src:FRAME_ID};CONNECTED.then(()=>{window.parent.postMessage(JSON.stringify(msg),'*');});return new Promise((resolve,reject)=>{FETCH_PROMISES[elementid]=resolve;setTimeout(()=>{if(elementid in FETCH_PROMISES){reject('No response to content fetch of "'+elementid+'" in 5s.');}},5000);});},resize_containing_frame:function(width,height){const msg={version:'STACK-JS:1.0.0',type:'resize-frame',width:width,height:height,src:FRAME_ID};CONNECTED.then(()=>{window.parent.postMessage(JSON.stringify(msg),'*');});},display_error(errmesg){const p=document.createElement('p');p.appendChild(document.createTextNode(errmesg));const div=document.getElementById('error');if(div){div.appendChild(p);}else{const div=document.createElement('div');div.id='error';div.style.color='red';const h1=document.createElement('h1');h1.appendChild(document.createTextNode('Error'));div.appendChild(h1);div.appendChild(p);document.body.replaceChildren(div);}}};export default stack_js;
define(["jquery","core/ajax","core/notification","core/log","theme_snap/model_view","theme_snap/ajax_notification"],function(a,b,c,d,e,f){return function(){d.enableAll(!0);var c=function(b,c){var d=a.Deferred();e(c,"theme_snap/course_cards");var f=function(){var b=a(c).find(".favoritetoggle");a(b).removeClass("ajaxing"),a(b).focus()};return a(c).trigger("modelUpdate",[b,f]),a(c).on("modelUpdated",function(a){d.resolve(a)}),d.promise()},g=function(b){return parseInt(a(b).find(".coursecard-body").data("courseid"))},h=function(b,c){void 0===c&&(c=!0);var d=a(b).find(".coursecard-coursename").html();return c&&(d=d.toLowerCase()),d},i=function(a,b){if(0===b.length)return-1;var c=[],d={};return b.each(function(){d={title:h(this),card:this},c.push(d)}),d={title:h(a),card:a},c.push(d),c.sort(function(a,b){var c=g(a.card),d=g(b.card);return a.title===b.title?c===d?0:c>d?1:-1:a.title>b.title?1:-1}),c.indexOf(d)},j=function(b,c,e,f,g){var h=a(c),j=i(b,h),k=j+1;d.debug("Moving card element into position "+k+" of list (size = "+h.length+") : "+c),k>0?k<=h.length?(d.debug("Moving card before position "+k+"  using selector "+c),a(c).eq(j).before(b)):(d.debug("Moving card after position "+h.length+" using selector "+c),a(c).eq(h.length-1).after(b)):(d.debug("Destination "+c+" empty"),f?(d.debug("prepending to "+e),a(e).prepend(b)):(d.debug("appending to "+e),a(e).append(b))),"function"==typeof g&&g()},k=function(b,c){var d,e=a('#snap-pm-courses-current .coursecard:not([data-hidden="true"])').length;a(b).data("hidden")===!0&&e>0?(d="#snap-pm-courses-hidden-cards",a("#snap-pm-courses-hidden").addClass("state-visible"),a("#snap-pm-courses-hidden-cards").collapse("show")):(window.console.log("not a hidden card"),d="#snap-pm-courses-current-cards"),j(b,d+" .coursecard:not(.favorited)",d,!1,c)},l=function(d){if(!a(d).hasClass("ajaxing")){a(d).addClass("ajaxing");var e="true"===a(d).attr("aria-pressed")?0:1,g=a(a(d).parents(".coursecard")[0]),h=a(g).data("shortname"),i=function(i){return b.call([{methodname:"theme_snap_course_card",args:{courseshortname:h,favorited:e},fail:function(b){a(d).removeClass("ajaxing"),f.ifErrorShowBestMsg(b)}}],!0,!0)[0].then(function(a){return c(a,g)}).then(function(){M.util.js_complete(i)})};if(1===e){var l="favourite_"+(new Date).getTime().toString(16)+Math.floor(1e3*Math.random());M.util.js_pending(l),j(g,"#snap-pm-courses-current-cards .coursecard.favorited","#snap-pm-courses-current-cards",!0,function(){i(l)})}else{var l="unfavourite_"+(new Date).getTime().toString(16)+Math.floor(1e3*Math.random());M.util.js_pending(l),k(g,function(){i(l)})}}};a("#snap-pm").on("click",".favoritetoggle",function(a){a.preventDefault(),a.stopPropagation(),l(this)})}});
{"version":3,"file":"courseindex.min.js","sources":["../src/courseindex.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * End users have asked that course indexes be collapsed by default.\n * Because of the mechanisms involved, this script accepts an argument\n * from the drawers.mustache template that determines if the course\n * indexes should be collapsed initially, or expanded by what has been\n * stored in mdl_user_preferences and local storage.\n *\n * @module     theme_hillhead40/courseindex\n * @author     Greg Pedder <greg.pedder@glasgow.ac.uk>\n * @copyright  2023 University of Glasgow\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n//import $ from 'jquery';\nimport * as Log from 'core/log';\n\nconst Selectors = {\n    COURSE_INDEX: '[aria-controls^=\"courseindexcollapse\"]:not([aria-controls=\"courseindexcollapse0\"])'\n};\n\nconst CourseIndex = (coursindexcollapsed) => {\n    let params = (new URL(location.href)).searchParams;\n    let courseindexcollapsed = coursindexcollapsed;\n    Log.debug('CourseIndex! called with params:' + params + ' coursindexcollapsed is:' + coursindexcollapsed);\n    if (params.get('id') > 1 && courseindexcollapsed) {\n        Log.debug('CourseIndex called with params:' + params + ' coursindexcollapsed is:' + coursindexcollapsed);\n        waitForElement(Selectors.COURSE_INDEX, params.get('id'));\n    }\n\n    return;\n};\n\n/**\n * @param {HTMLElement} selector\n * @param {int} selectorId\n * @param {int} timeout\n * @returns {Promise<*|null>}\n */\nasync function waitForElement(selector, selectorId, timeout = 15000) {\n    Log.debug('waitForElement called...');\n    const start = Date.now();\n\n    while (Date.now() - start < timeout) {\n        Log.debug('searching for selector:' + selector);\n        const el = document.querySelector(selector);\n        if (el) {\n            Log.debug('Calling setCourseIndexState with selector:' + selector);\n            return setCourseIndexState(selector, selectorId);\n        }\n        await new Promise(resolve => setTimeout(resolve, 1000));\n    }\n\n    return null;\n}\n\n/**\n * This function collapses the course indexes by default. This is only ever\n * called if the user hasn't visited this course page before. Otherwise, we\n * let Moodle's JavaScript take care of things.\n * @param {HTMLElement} element\n * @param {int} courseId\n*/\nconst setCourseIndexState = (element, courseId) => {\n\n    Log.debug(`setCourseIndexState was called with element ${element} and courseId ${courseId}.`);\n\n    if (document.querySelectorAll(element).length == 0) {\n        Log.debug('Page is missing the course index section, no need to continue.');\n        return false;\n    }\n\n    const courseIndexSectionItems = document.querySelectorAll(Selectors.COURSE_INDEX);\n    Log.debug('Collapsing all course indexes except index 0...');\n    courseIndexSectionItems.forEach((indexSectionItem) => {\n        indexSectionItem.click();\n    });\n};\n\nexport const init = (coursindexcollapsed) => {\n    CourseIndex(coursindexcollapsed);\n};"],"names":["Selectors","CourseIndex","coursindexcollapsed","params","URL","location","href","searchParams","courseindexcollapsed","Log","debug","get","selector","selectorId","timeout","start","Date","now","document","querySelector","setCourseIndexState","Promise","resolve","setTimeout","waitForElement","element","courseId","querySelectorAll","length","courseIndexSectionItems","forEach","indexSectionItem","click"],"mappings":";;;;;;;;;;;;iBA+BMA,uBACY,qFAGZC,YAAeC,0BACbC,OAAU,IAAIC,IAAIC,SAASC,MAAOC,aAClCC,qBAAuBN,oBAC3BO,IAAIC,MAAM,mCAAqCP,OAAS,2BAA6BD,qBACjFC,OAAOQ,IAAI,MAAQ,GAAKH,uBACxBC,IAAIC,MAAM,kCAAoCP,OAAS,2BAA6BD,oCAa9DU,SAAUC,gBAAYC,+DAAU,KAC1DL,IAAIC,MAAM,kCACJK,MAAQC,KAAKC,WAEZD,KAAKC,MAAQF,MAAQD,SAAS,CACjCL,IAAIC,MAAM,0BAA4BE,aAC3BM,SAASC,cAAcP,iBAE9BH,IAAIC,MAAM,6CAA+CE,UAClDQ,oBAAoBR,SAAUC,kBAEnC,IAAIQ,SAAQC,SAAWC,WAAWD,QAAS,QAvBjDE,CAAexB,uBAAwBG,OAAOQ,IAAI,eAoCpDS,oBAAsB,CAACK,QAASC,eAElCjB,IAAIC,4DAAqDe,iCAAwBC,eAEhC,GAA7CR,SAASS,iBAAiBF,SAASG,cACnCnB,IAAIC,MAAM,mEACH,QAGLmB,wBAA0BX,SAASS,iBAAiB3B,wBAC1DS,IAAIC,MAAM,mDACVmB,wBAAwBC,SAASC,mBAC7BA,iBAAiBC,0BAIJ9B,sBACjBD,YAAYC"}
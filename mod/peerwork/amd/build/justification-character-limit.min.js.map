{"version":3,"sources":["../src/justification-character-limit.js"],"names":["define","$","Str","Notification","updateCharacterLimit","textareaNode","limit","node","length","val","remaining","sibling","siblings","textNode","find","text","M","util","get_string","addClass","removeClass","init","selector","then","textareaNodes","each","i","n","after","on","e","target","catch","exception"],"mappings":"w9BAuBAA,OAAM,8CAAC,CAAC,QAAD,CAAW,UAAX,CAAuB,mBAAvB,CAAD,CAA8C,SAASC,CAAT,CAAYC,CAAZ,CAAiBC,CAAjB,CAA+B,CAa/E,QAASC,CAAAA,CAAT,CAA8BC,CAA9B,CAA4CC,CAA5C,CAAmD,IACzCC,CAAAA,CAAI,CAAGN,CAAC,CAACI,CAAD,CADiC,CAEzCG,CAAM,CAAG,mBAAID,CAAI,CAACE,GAAL,EAAJ,EAAgBD,MAFgB,CAGzCE,CAAS,CAAGJ,CAAK,CAAGE,CAHqB,CAIzCG,CAAO,CAAGJ,CAAI,CAACK,QAAL,CAdK,wCAcL,CAJ+B,CAKzCC,CAAQ,CAAGF,CAAO,CAACG,IAAR,CAbC,gCAaD,CAL8B,CAO/CD,CAAQ,CAACE,IAAT,CAAcC,CAAC,CAACC,IAAF,CAAOC,UAAP,CAAkB,qBAAlB,CAAyC,cAAzC,CAAyDR,CAAzD,CAAd,EACA,GAAgB,CAAZ,CAAAA,CAAJ,CAAmB,CACfG,CAAQ,CAACM,QAAT,CAAkB,aAAlB,CACH,CAFD,IAEO,CACHN,CAAQ,CAACO,WAAT,CAAqB,aAArB,CACH,CACJ,CAkCD,MAAO,CACHC,IAAI,CA3BR,SAAcC,CAAd,CAAwBhB,CAAxB,CAA+B,CAC3B,GAAI,CAACA,CAAL,CAAY,CACR,MACH,CAEDJ,CAAG,CAACgB,UAAJ,CAAe,qBAAf,CAAsC,cAAtC,EAAsDK,IAAtD,CAA2D,UAAM,CAE7D,GAAMC,CAAAA,CAAa,CAAGvB,CAAC,CAACqB,CAAD,CAAvB,CAGAE,CAAa,CAACC,IAAd,CAAmB,SAASC,CAAT,CAAYC,CAAZ,CAAe,CAC9B,GAAIpB,CAAAA,CAAI,CAAGN,CAAC,CAAC0B,CAAD,CAAZ,CACApB,CAAI,CAACqB,KAAL,6FA1CO,+BA0CP,uBACAxB,CAAoB,CAACuB,CAAD,CAAIrB,CAAJ,CACvB,CAJD,EAOAkB,CAAa,CAACK,EAAd,CAAiB,OAAjB,CAA0B,SAASC,CAAT,CAAY,CAClC1B,CAAoB,CAAC0B,CAAC,CAACC,MAAH,CAAWzB,CAAX,CACvB,CAFD,EAIA,MAAO,KAEV,CAlBD,EAkBG0B,KAlBH,CAkBS7B,CAAY,CAAC8B,SAlBtB,CAmBH,CAEM,CAIV,CAhEK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Justification character limit.\n *\n * @copyright  2019 Coventry University\n * @author     Frédéric Massart <fred@branchup.tech>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/str', 'core/notification'], function($, Str, Notification) {\n\n    const WRAPPER_CLASS = 'justification-character-limit-wrapper';\n    const WRAPPER_SELECTOR = '.justification-character-limit-wrapper';\n    const TEXT_CLASS = 'justification-character-limit';\n    const TEXT_SELECTOR = '.justification-character-limit';\n\n    /**\n     * Update character limit.\n     *\n     * @param {Node} textareaNode The text area.\n     * @param {Number} limit The limit.\n     */\n    function updateCharacterLimit(textareaNode, limit) {\n        const node = $(textareaNode);\n        const length = [...node.val()].length; // Character-friendly length.\n        const remaining = limit - length;\n        const sibling = node.siblings(WRAPPER_SELECTOR);\n        const textNode = sibling.find(TEXT_SELECTOR);\n\n        textNode.text(M.util.get_string('charactersremaining', 'mod_peerwork', remaining));\n        if (remaining < 0) {\n            textNode.addClass('text-danger');\n        } else {\n            textNode.removeClass('text-danger');\n        }\n    }\n\n    /**\n     * Justification character limit.\n     *\n     * @param {String} selector The textarea selector.\n     * @param {Number} limit The limit.\n     */\n    function init(selector, limit) {\n        if (!limit) {\n            return;\n        }\n\n        Str.get_string('charactersremaining', 'mod_peerwork').then(() => {\n\n            const textareaNodes = $(selector);\n\n            // Append the place where we'll compute the character limit.\n            textareaNodes.each(function(i, n) {\n                var node = $(n);\n                node.after(`<div class=\"${WRAPPER_CLASS}\"><small class=\"${TEXT_CLASS}\"></small></div>`);\n                updateCharacterLimit(n, limit);\n            });\n\n            // Add the change listener.\n            textareaNodes.on('keyup', function(e) {\n                updateCharacterLimit(e.target, limit);\n            });\n\n            return null;\n\n        }).catch(Notification.exception);\n    }\n\n    return {\n        init: init\n    };\n\n});\n"],"file":"justification-character-limit.min.js"}
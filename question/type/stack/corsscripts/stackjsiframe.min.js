"use strict";let DISABLE_CHANGES={},INPUT_PROMISES={},do_connect=null,is_connected=!1;const CONNECTED=new Promise((e,t)=>{do_connect=e}),pinger=(CONNECTED.then(e=>{is_connected=!0}),setInterval(()=>{var e;is_connected||(e={version:"STACK-JS:1.0.0",type:"ping",src:FRAME_ID},window.parent.postMessage(JSON.stringify(e),"*"))},10)),stack_js=(window.addEventListener("message",e=>{if("string"==typeof e.data||e.data instanceof String){let t=null;try{t=JSON.parse(e.data)}catch(e){return}if("version"in t&&t.version.startsWith("STACK-JS")&&"tgt"in t&&"type"in t&&t.tgt===FRAME_ID)switch(t.type){case"initial-input":const i=document.getElementById(t.name);DISABLE_CHANGES[t.name]=!0,i.value=t.value,DISABLE_CHANGES[t.name]=!1,INPUT_PROMISES[t.name](i.id),delete INPUT_PROMISES[t.name];break;case"changed-input":const s=document.getElementById(t.name);DISABLE_CHANGES[t.name]=!0,s.value=t.value;var n=new Event("change");s.dispatchEvent(n),DISABLE_CHANGES[t.name]=!1;break;case"ping":clearInterval(pinger),do_connect(!0);break;default:let e='Unknown message-type "'+t.type+'"';"error"===t.type&&(e=t.msg);const r=document.createElement("p"),o=(r.appendChild(document.createTextNode(e)),document.getElementById("error"));if(o)o.appendChild(r);else{const a=document.createElement("div"),c=(a.id="error",a.style.color="red",document.createElement("h1"));c.appendChild(document.createTextNode("Error")),a.appendChild(c),a.appendChild(r),document.body.replaceChildren(a)}}}}),{request_access_to_input:function(n,i){const s=document.createElement("input");return s.type="hidden",s.id=n,DISABLE_CHANGES[n]=!1,document.body.appendChild(s),s.addEventListener("change",e=>{if(!DISABLE_CHANGES[n]){const t={version:"STACK-JS:1.0.0",type:"changed-input",name:n,value:s.value,src:FRAME_ID};CONNECTED.then(()=>{window.parent.postMessage(JSON.stringify(t),"*")})}}),CONNECTED.then(e=>{const t={version:"STACK-JS:1.0.0",type:"register-input-listener",name:n,src:FRAME_ID};!0===i&&(t["track-input"]=!0),window.parent.postMessage(JSON.stringify(t),"*")}),new Promise((e,t)=>{INPUT_PROMISES[n]=e,setTimeout(()=>{n in INPUT_PROMISES&&t('No response to input registration of "'+n+'" in 5s.')},5e3)})},toggle_visibility:function(e,t){const n={version:"STACK-JS:1.0.0",type:"toggle-visibility",target:e,set:t?"show":"hide",src:FRAME_ID};CONNECTED.then(()=>{window.parent.postMessage(JSON.stringify(n),"*")})},switch_content:function(e,t){const n={version:"STACK-JS:1.0.0",type:"change-content",target:e,content:t,src:FRAME_ID};CONNECTED.then(()=>{window.parent.postMessage(JSON.stringify(n),"*")})},resize_containing_frame:function(e,t){const n={version:"STACK-JS:1.0.0",type:"resize-frame",width:e,height:t,src:FRAME_ID};CONNECTED.then(()=>{window.parent.postMessage(JSON.stringify(n),"*")})}});export default stack_js;export{stack_js};

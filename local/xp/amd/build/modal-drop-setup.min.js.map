{"version":3,"file":"modal-drop-setup.min.js","sources":["../src/modal-drop-setup.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Modal drop setup.\n *\n * @copyright  2022 Frédéric Massart\n * @author     Frédéric Massart <fred@branchup.tech>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['core/templates', 'core/modal', 'core/modal_events', 'core/notification', 'block_xp/role-button'], function(\n    Templates,\n    Modal,\n    ModalEvents,\n    Notification,\n    RoleButton\n) {\n    // Trigger pre-loading.\n    Templates.render('local_xp/modal-drop-setup', []);\n\n    /**\n   * Show the modal.\n   *\n   * @param {Object} context The template context.\n   */\n    function show(context) {\n        Templates.render('local_xp/modal-drop-setup', context)\n            .then((html) => {\n                const modal = new Modal(html);\n\n                // Broadcast when the modal has been shown.\n                modal.getRoot().on(ModalEvents.shown, () => {\n                    const codeNode = modal.getRoot().find('[data-content=\"shortcode\"]')[0];\n                    const copyBtn = modal.getRoot().find('[data-action=\"copy\"]')[0];\n                    if (!codeNode || !copyBtn) {\n                        return;\n                    } else if (!navigator.clipboard) {\n                        copyBtn.style = 'display: none';\n                        return;\n                    }\n\n                    copyBtn.addEventListener('click', (e) => {\n                        e.preventDefault();\n                        navigator.clipboard.writeText(codeNode.textContent);\n                    });\n                });\n\n                modal.show();\n                return;\n            })\n            .catch(Notification.exception);\n    }\n\n    /**\n   * Show the modal from a node selector.\n   *\n   * @param {String} nodeSelector The node selector.\n   */\n    function showFromSelector(nodeSelector) {\n        const node = document.querySelector(nodeSelector);\n        if (!node) {\n            return;\n        }\n        showFromNode(node);\n    }\n\n    /**\n   * Show the modal from a node.\n   *\n   * @param {Node} node The node\n   */\n    function showFromNode(node) {\n        const name = node.dataset.name;\n        const shortcode = node.dataset.shortcode;\n        const editurl = node.dataset.editurl;\n        show({name, shortcode, editurl});\n    }\n\n    /**\n   * Delegate the modal.\n   *\n   * @param {String} rootSelector The root selector.\n   * @param {String} nodeSelector The node selector.\n   */\n    function delegateClick(rootSelector, nodeSelector) {\n        RoleButton.delegateClick(rootSelector, nodeSelector, (node) => {\n            showFromNode(node);\n        });\n    }\n\n    return {show, showFromNode, showFromSelector, delegateClick};\n});\n"],"names":["define","Templates","Modal","ModalEvents","Notification","RoleButton","show","context","render","then","html","modal","getRoot","on","shown","codeNode","find","copyBtn","navigator","clipboard","addEventListener","e","preventDefault","writeText","textContent","style","catch","exception","showFromNode","node","name","dataset","shortcode","editurl","showFromSelector","nodeSelector","document","querySelector","delegateClick","rootSelector"],"mappings":";;;;;;;AAuBAA,mCAAO,CAAC,iBAAkB,aAAc,oBAAqB,oBAAqB,yBAAyB,SACvGC,UACAC,MACAC,YACAC,aACAC,qBAUSC,KAAKC,SACVN,UAAUO,OAAO,4BAA6BD,SACzCE,MAAMC,aACGC,MAAQ,IAAIT,MAAMQ,MAGxBC,MAAMC,UAAUC,GAAGV,YAAYW,OAAO,WAC5BC,SAAWJ,MAAMC,UAAUI,KAAK,8BAA8B,GAC9DC,QAAUN,MAAMC,UAAUI,KAAK,wBAAwB,GACxDD,UAAaE,UAENC,UAAUC,UAKtBF,QAAQG,iBAAiB,SAAUC,IAC/BA,EAAEC,iBACFJ,UAAUC,UAAUI,UAAUR,SAASS,gBANvCP,QAAQQ,MAAQ,oBAUxBd,MAAML,UAGToB,MAAMtB,aAAauB,oBAqBnBC,aAAaC,MAIlBvB,KAAK,CAACwB,KAHOD,KAAKE,QAAQD,KAGdE,UAFMH,KAAKE,QAAQC,UAERC,QADPJ,KAAKE,QAAQE,iBAxDjChC,UAAUO,OAAO,4BAA6B,IAwEvC,CAACF,KAAAA,KAAMsB,aAAAA,aAAcM,0BAhCFC,oBAChBN,KAAOO,SAASC,cAAcF,cAC/BN,MAGLD,aAAaC,OA2B6BS,uBANvBC,aAAcJ,cACjC9B,WAAWiC,cAAcC,aAAcJ,cAAeN,OAClDD,aAAaC"}
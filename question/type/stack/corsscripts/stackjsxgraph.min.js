"use strict";var serializers={},deserializers={},initials={},objectgroups=[],objectinput={},registeredobjects={},active=!1;function _commonsetup(e){var i;e in serializers||(serializers[e]={},deserializers[e]=[],(i=document.getElementById(e)).addEventListener("input",()=>generalinputupdatehandler(e)),i.addEventListener("change",()=>generalinputupdatehandler(e)))}function registerobject(e){e.id in registeredobjects||(e.board.on("update",()=>generalobjectupdatehandlerid(e.id)),registeredobjects[e.id]=e)}function pointserializer(e){return JSON.stringify([e.X(),e.Y()])}function pointdeserializer(e,i){try{var t=JSON.parse(i);"number"==typeof t[0]&&"number"==typeof t[1]&&(e.setPosition(JXG.COORDS_BY_USER,t),e.board.update(),e.update())}catch(e){}}function pointdeserializerparsed(e,i){try{"number"==typeof i[0]&&"number"==typeof i[1]&&(e.setPosition(JXG.COORDS_BY_USER,i),e.board.update(),e.update())}catch(e){}}function sliderserializer(e){return JSON.stringify(e.Value())}function sliderdeserializer(e,i){try{e.setValue(JSON.parse(i)),e.board.update(),e.update()}catch(e){}}function generalobjectupdatehandler(e){generalobjectupdatehandlerid(e.id)}function generalobjectupdatehandlerid(e){if(!active){active=!0;try{var i=[];if(e in objectinput)for(var t=0;t<objectinput[e].length;t++){var r=objectinput[e][t];if(-1===i.indexOf(r)){i.push(r);var n=document.getElementById(r),a=serializers[r][e]();if(a===initials[r])return void(active=!1);initials[r]=null,n.value=a}}for(var s=0;s<objectgroups.length;s++){var o=objectgroups[s];if(-1!==o.indexOf(e))for(var d=0;d<o.length;d++){var u=o[d];if(u!==e&&u in objectinput)for(t=0;t<objectinput[u].length;t++){r=objectinput[u][t];-1===i.indexOf(r)&&(initials[r]=null,i.push(r),(n=document.getElementById(r)).value=serializers[r][u]())}}}for(t=0;t<i.length;t++){var n=document.getElementById(i[t]),l=new Event("change");n.dispatchEvent(l)}}catch(e){}active=!1}}function generalinputupdatehandler(e){if(e in deserializers){for(var i=document.getElementById(e),t=Object.keys(serializers[e]),r=!1,n=0;n<t.length;n++)serializers[e][t[n]]()!==i.value&&(r=!0,n=t.length+1);if(r)for(n=0;n<deserializers[e].length;n++)deserializers[e][n](i.value)}}const stack_jxg={define_group:function(e){for(var i=[],t=0;t<e.length;t++)-1===i.indexOf(e[t].id)&&i.push(e[t].id);objectgroups.push(i)},starts_moved:function(e){if(e.id in objectinput){for(var i=0;i<objectinput[e.id].length;i++)initials[objectinput[e.id][i]]=null;generalobjectupdatehandler(e)}},custom_bind:function(e,i,t,r){_commonsetup(e),initials[e]=i();var n=document.getElementById(e);n.value&&""!=n.value&&t(n.value),deserializers[e].push(t);for(var a=0;a<r.length;a++)this.register_object(e,r[a],i)},register_object:function(e,i,t){i.id in objectinput?e in objectinput[i.id]||objectinput[i.id].push(e):objectinput[i.id]=[e],serializers[e][i.id]=t,registerobject(i)},bind_point:function(e,i){this.custom_bind(e,()=>pointserializer(i),e=>pointdeserializer(i,e),[i])},bind_point_dual:function(e,i,t){this.custom_bind(e,()=>JSON.stringify([[i.X(),i.Y()],[t.X(),t.Y()]]),e=>{e=JSON.parse(e);pointdeserializerparsed(i,e[0]),pointdeserializerparsed(t,e[1])},[i,t])},bind_point_relative:function(e,i,t){this.custom_bind(e,()=>JSON.stringify([[i.X(),i.Y()],[t.X()-i.X(),t.Y()-i.Y()]]),e=>{e=JSON.parse(e);pointdeserializerparsed(i,e[0]),e[1][0]=e[1][0]+e[0][0],e[1][1]=e[1][1]+e[0][1],pointdeserializerparsed(t,e[1])},[i,t])},bind_point_direction:function(e,r,n){this.custom_bind(e,()=>JSON.stringify([[r.X(),r.Y()],[Math.atan2(n.Y()-r.Y(),n.X()-r.X()),Math.sqrt((n.X()-r.X())*(n.X()-r.X())+(n.Y()-r.Y())*(n.Y()-r.Y()))]]),e=>{var e=JSON.parse(e),i=(pointdeserializerparsed(r,e[0]),e[1][0]),t=e[1][1];e[1][0]=e[0][0]+t*Math.cos(i),e[1][1]=e[0][1]+t*Math.sin(i),pointdeserializerparsed(n,e[1])},[r,n])},bind_slider:function(e,i){this.custom_bind(e,()=>sliderserializer(i),e=>sliderdeserializer(i,e),[i])},bind_list_of:function(e,n){this.custom_bind(e,()=>{for(var e="[",i=0;i<n.length;i++)var t=n[i],e="slider"===t.getType()?e+JSON.stringify(t.Value())+",":e+pointserializer(t)+",";return(e=e.substring(0,e.length-1))+"]"},e=>{for(var i=JSON.parse(e),t=0;t<n.length&&t<i.length;t++){var r=n[t];"slider"===r.getType()?r.setValue(i[t]):pointdeserializerparsed(r,i[t])}},n)}};export default stack_jxg;export{stack_jxg};

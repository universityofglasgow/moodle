function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}f(void 0)})}}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function _arrayWithHoles(a){if(Array.isArray(a))return a}define ("local_gugcat/main",["jquery","core/str","core/modal_factory","local_gugcat/modal_gcat","core/sessionstorage","core/ajax"],function(a,b,c,d,e,f){var g=function(a){var b=window.location.pathname;return b.match(a)},h=function(a){var b=document.querySelectorAll(".input-reason");b.forEach(function(b){b.value=a})},i=function(){var a=document.getElementById("btn-identities"),c=document.querySelectorAll(".blind-marking");if(a&&0<c.length){a.textContent="...";c.forEach(function(a){return a.classList.add("hide-names")});var d="true"==e.get("blind-marking");b.get_strings([{key:"showidentities",component:"local_gugcat"},{key:"hideidentities",component:"local_gugcat"}]).then(function(b){a.textContent=d?b[0]:b[1];c.forEach(function(a){if(d){a.classList.add("hide-names")}else{a.classList.remove("hide-names")}})})}},j=function(){var a=document.getElementById("btn-switch-display"),c=new URLSearchParams(window.location.search),d=c.get("id");if(a){a.textContent="...";var e=f.call([{methodname:"local_gugcat_display_assessments",args:{courseid:d}}]);e[0].done(function(c){var d=c.result;b.get_strings([{key:"switchoffdisplay",component:"local_gugcat"},{key:"switchondisplay",component:"local_gugcat"}]).then(function(b){a.textContent=d?b[0]:b[1]})}).fail(function(){a.style.display="none"})}},k=function(a){var b,c,d,e,f,g,h,j,k=0;b=document.getElementById("gcat-table");d=!0;j="asc";while(d){d=!1;c=b.rows;for(e=1;e<c.length-1;e++){h=!1;f=c[e].getElementsByTagName("TD")[a];g=c[e+1].getElementsByTagName("TD")[a];if("asc"==j){if(f.innerHTML.toLowerCase()>g.innerHTML.toLowerCase()){h=!0;break}}else if("desc"==j){if(f.innerHTML.toLowerCase()<g.innerHTML.toLowerCase()){h=!0;break}}}if(h){c[e].parentNode.insertBefore(c[e+1],c[e]);d=!0;k++}else{if(0==k&&"asc"==j){j="desc";d=!0}}}},l=function(a,e,f){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:"cancelmodal";b.get_strings([{key:e,component:"local_gugcat"},{key:g,component:"local_gugcat"},{key:f,component:"local_gugcat"}]).then(function(b){var e={bodycontent:b[0],strcancel:b[1],strconfirm:b[2],dataaction:a};c.create({type:d.TYPE,templateContext:e}).done(function(a){return a.show()})})},m=function(a){var b=new URLSearchParams(window.location.search),c=document.getElementById("select-category"),d=document.getElementById("select-activity"),e=document.getElementById("select-grade-reason"),f=document.getElementById("input-reason"),i=document.getElementById("id_reasons");switch(a.target){case c:b.delete("activityid");b.delete("page");if("null"===c.value){b.delete("categoryid")}else{b.set("categoryid",c.value)}if(g("gugcat/add")){b.delete("studentid");var j=window.location.pathname;j=j.replace("gugcat/add","gugcat")+"?"+b;window.location.replace(j);return}window.location.search=b;break;case d:b.set("activityid",d.value);b.delete("page");window.location.search=b;break;case e:var k=a.target.value;h(k);if("Other"===k){h("");f.style.display="block"}else{f.style.display="none"}break;case i:var l=a.target.value,m=document.getElementById("id_otherreason");m.value=l;if("8"==l){m.value="";m.required=!0}else{m.required=!1}m.focus();break;default:break;}},n=function(c){var d=document.getElementById("btn-saveadd"),f=document.getElementById("btn-release"),g=document.getElementById("btn-import"),h=document.getElementById("btn-identities"),k=document.getElementById("btn-coursegradeform"),m=document.getElementById("btn-download"),n=document.getElementById("btn-finalrelease"),o=document.getElementById("btn-switch-display");switch(c.target){case d:d.classList.toggle("togglebtn");d.style.display="none";b.get_string("saveallnewgrade","local_gugcat").then(function(a){d.style.display="inline-block";if(d.classList.contains("togglebtn")){d.textContent=a}else{document.getElementById("multiadd-submit").click()}});a(".togglemultigrd").show();break;case f:l("release","modalreleaseprovisionalgrade","confirmreleaseprovisionalgrade");break;case g:if(!a(".gradeitems").text().includes("Moodle Grade[Date]")){l("importgrades","modalimportgrades","confirmimport")}else{document.getElementById("importgrades-submit").click()}break;case k:var p=document.querySelectorAll(".input-percent"),q=0;if(0<p.length){p.forEach(function(a){var b=a.querySelector("input");q+=parseInt(b.value);var c=a.querySelector("input.is-invalid");if(null!==c){a.querySelector("div.felement").classList.add("no-after")}else{a.querySelector("div.felement").classList.remove("no-after")}})}if(100!=q){l("adjustweight","modaladjustweights","confirmchanges")}else{document.getElementById("coursegradeform-submit").click()}break;case n:l("finalrelease","modalreleasefinalgrades","confirmfinalrelease");break;case m:document.getElementById("downloadcsv-submit").click();break;case h:var r="true"==e.get("blind-marking");e.set("blind-marking",!r);i();break;case o:j();break;default:break;}};return{init:function init(){var c=document.querySelector(".gcat-container");if(c){c.addEventListener("change",m);c.addEventListener("click",n);if(document.getElementById("btn-identities")&&!e.get("blind-marking")){e.set("blind-marking",!1)}i();var d=document.getElementById("input-reason");if(d){d.addEventListener("input",function(a){h(a.target.value)})}var f=document.querySelectorAll(".input-search");if(0<f.length){f.forEach(function(a){a.addEventListener("keydown",function(a){var b=a.keyCode?a.keyCode:a.which;if(13===b){document.getElementById("search-submit").click()}})})}var j=document.querySelectorAll(".input-percent");if(0<j.length){var l=0,o=document.querySelector("#fitem_id_totalweight .form-inline");j.forEach(function(a){var b=a.querySelector("input");l+=parseInt(b.value);b.addEventListener("input",function(){var a=0;j.forEach(function(b){a+=parseInt(b.querySelector("input").value)});o.innerHTML="".concat(a,"%")});b.addEventListener("focus",function(b){var c=b.target.value;if(""!==c&&null===c.match(/^[0-9]+$/)){a.querySelector("div.felement").classList.add("no-after")}else{a.querySelector("div.felement").classList.remove("no-after")}});b.addEventListener("blur",function(b){var c=b.target.value;if(""!==c&&null===c.match(/^[0-9]+$/)){a.querySelector("div.felement").classList.add("no-after")}else{a.querySelector("div.felement").classList.remove("no-after")}})});o.innerHTML="".concat(l,"%")}var p=document.querySelectorAll(".sortable");if(0<p.length){var q=!0,r=!1,s=void 0;try{for(var t=function(){var a=_slicedToArray(v.value,2),b=a[0],c=a[1];c.addEventListener("click",function(){return k(b)})},u=p.entries()[Symbol.iterator](),v;!(q=(v=u.next()).done);q=!0){t()}}catch(a){r=!0;s=a}finally{try{if(!q&&null!=u.return){u.return()}}finally{if(r){throw s}}}}var w=document.querySelectorAll(".fa-search");if(0<w.length){w.forEach(function(a){a.addEventListener("click",function(a){a.currentTarget.blur();var b=a.target.nextSibling;b.classList.toggle("visible");if(b.classList.contains("visible")){b.style.display="block"}else{b.style.display="none"}})})}var x=document.querySelectorAll("td .grade-discrepancy");if(0<x.length){document.getElementById("btn-grddisc").style.display="inline-block"}if(g("gugcat/overview")){document.querySelector("#btn-overviewtab").classList.add("active");document.querySelector("#btn-assessmenttab").classList.remove("active");var y=document.getElementById("id_notes");if(y){_asyncToGenerator(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return b.get_string("specifyreason","local_gugcat");case 2:y.placeholder=a.sent;y.required=!0;case 4:case"end":return a.stop();}}},a)}))()}}else if(g("gugcat/index")){var z=document.getElementById("btn-release");if(z){z.style.display=!a(".gradeitems").text().includes("Moodle Grade[Date]")?"inline-block":"none"}var A=Array.from(document.querySelectorAll(".gradeitems"));if(A.find(function(a){return"Moodle Grade<br>[Date]"!==a.innerHTML})){document.getElementById("btn-saveadd").style.display="inline-block";var B=document.querySelectorAll(".addnewgrade");B.forEach(function(a){a.style.display="block"});var C=document.querySelectorAll(".hide-show-grade");C.forEach(function(a){a.style.display="block"})}}else if(g("gugcat/add")||g("gugcat/edit")){var D=document.getElementById("id_otherreason"),y=document.getElementById("id_notes");_asyncToGenerator(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return b.get_string("pleasespecify","local_gugcat");case 2:D.placeholder=a.sent;a.next=5;return b.get_string("specifyreason","local_gugcat");case 5:y.placeholder=a.sent;y.required=!0;case 7:case"end":return a.stop();}}},a)}))()}}}}});
//# sourceMappingURL=main.min.js.map

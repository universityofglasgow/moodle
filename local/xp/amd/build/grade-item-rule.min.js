/**
 * Grade item rule.
 *
 * @author     Frédéric Massart <fred@branchup.tech>
 * @copyright  2019 Frédéric Massart
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define(["jquery","core/templates","core/str","block_xp/dialogue-base"],(function($,Templates,Str,DialogueBase){function Dialogue(initWithCourse,canChangeCourse){this.initWithCourse=initWithCourse||null,this.canChangeCourse=canChangeCourse,DialogueBase.prototype.constructor.apply(this,[])}return Dialogue.prototype=Object.create(DialogueBase.prototype),Dialogue.prototype.constructor=Dialogue,Dialogue.prototype._render=function(){var initWithCourseJson=JSON.stringify(this.initWithCourse);return Str.get_string("gradeitemselector","local_xp").then(function(title){return Templates.render("local_xp/grade-item-selector",{canchangecourse:this.canChangeCourse,initwithcoursejson:initWithCourseJson}).then(function(html,js){this.setTitle(title),this._setDialogueContent(html),Templates.runTemplateJS(js),this.center(),this.find(".local_xp-grade-item-selector-widget").on("grade-item-selected",function(e,resource){this.trigger("grade-item-selected",resource),this.close()}.bind(this))}.bind(this))}.bind(this))},{init:function(initWithCourse,canChangeCourse){$(".block-xp-filters").on("click",".local_xp-grade-item-rule-widget button",(function(e){e.preventDefault();var node=$(e.target).closest(".local_xp-grade-item-rule-widget");if(node){var d=new Dialogue(initWithCourse,canChangeCourse);d.on("grade-item-selected",(function(e,resource){var gradeitem=resource.gradeitem,course=resource.course,strIdentifier=canChangeCourse?"rulegradeitemdescwithcourse":"rulegradeitemdesc";node.find(".grade-item-rule-itemid").val(gradeitem.id),node.find(".grade-item-selected").text(M.util.get_string(strIdentifier,"local_xp",{gradeitemname:gradeitem.name,coursename:course.shortname})),node.addClass("has-grade-item")})),d.show()}}))}}}));

//# sourceMappingURL=grade-item-rule.min.js.map
{"version":3,"sources":["../src/revised-grades-total-calculator.js"],"names":["define","$","init","tableSelector","tableNode","fieldNodes","find","totalNode","getRevisedTotal","total","each","i","field","node","value","parseFloat","val","replace","isNaN","updateTotal","loadedTotal","text","toFixed","on"],"mappings":"AAuBAA,OAAM,gDAAC,CAAC,QAAD,CAAD,CAAa,SAASC,CAAT,CAAY,CAyC3B,MAAO,CACHC,IAAI,CAnCR,SAAsCC,CAAtC,CAAqD,IAC7CC,CAAAA,CAAS,CAAGH,CAAC,CAACE,CAAD,CADgC,CAE7CE,CAAU,CAAGD,CAAS,CAACE,IAAV,CAAe,yBAAf,CAFgC,CAG7CC,CAAS,CAAGH,CAAS,CAACE,IAAV,CAAe,sBAAf,CAHiC,CAK7CE,CAAe,CAAG,UAAM,CACxB,GAAIC,CAAAA,CAAK,CAAG,IAAZ,CACAJ,CAAU,CAACK,IAAX,CAAgB,SAASC,CAAT,CAAYC,CAAZ,CAAmB,IAC3BC,CAAAA,CAAI,CAAGZ,CAAC,CAACW,CAAD,CADmB,CAE3BE,CAAK,CAAGC,UAAU,CAACF,CAAI,CAACG,GAAL,GAAWC,OAAX,CAAmB,GAAnB,CAAwB,GAAxB,CAAD,CAFS,CAG/B,GAAI,CAACH,CAAD,EAAUI,KAAK,CAACJ,CAAD,CAAnB,CAA4B,CACxB,MACH,CACDL,CAAK,CAAG,CAACA,CAAK,EAAI,CAAV,EAAeK,CAC1B,CAPD,EAQA,MAAOL,CAAAA,CACV,CAhBgD,CAkB7CU,CAAW,CAAG,UAAM,CACpB,GAAIC,CAAAA,CAAW,CAAGZ,CAAe,EAAjC,CACA,GAAoB,IAAhB,GAAAY,CAAJ,CAA0B,CACtBb,CAAS,CAACc,IAAV,CAAeD,CAAW,CAACE,OAAZ,CAAoB,CAApB,CAAf,CACH,CAFD,IAEO,CACHf,CAAS,CAACc,IAAV,CAAe,EAAf,CACH,CACJ,CAzBgD,CA2BjDhB,CAAU,CAACkB,EAAX,CAAc,QAAd,CAAwB,UAAW,CAC/BJ,CAAW,EACd,CAFD,EAIAA,CAAW,EACd,CAEM,CAIV,CA7CK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Revised grades total calculator.\n *\n * @copyright  2019 Coventry University\n * @author     Frédéric Massart <fred@branchup.tech>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery'], function($) {\n\n    /**\n     * Revised grades total calculator.\n     *\n     * @param {String} tableSelector The table selector.\n     */\n    function revisedGradesTotalCalculator(tableSelector) {\n        var tableNode = $(tableSelector);\n        var fieldNodes = tableNode.find('input[name^=\"grade_\"]');\n        var totalNode = tableNode.find('.total-revised-grade');\n\n        var getRevisedTotal = () => {\n            let total = null;\n            fieldNodes.each(function(i, field) {\n                var node = $(field);\n                var value = parseFloat(node.val().replace(',', '.')); // Minor handling of formatted values.\n                if (!value || isNaN(value)) {\n                    return;\n                }\n                total = (total || 0) + value;\n            });\n            return total;\n        };\n\n        var updateTotal = () => {\n            var loadedTotal = getRevisedTotal();\n            if (loadedTotal !== null) {\n                totalNode.text(loadedTotal.toFixed(2));\n            } else {\n                totalNode.text('');\n            }\n        };\n\n        fieldNodes.on('change', function() {\n            updateTotal();\n        });\n\n        updateTotal();\n    }\n\n    return {\n        init: revisedGradesTotalCalculator\n    };\n\n});\n"],"file":"revised-grades-total-calculator.min.js"}
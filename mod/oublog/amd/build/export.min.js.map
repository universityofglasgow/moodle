{"version":3,"file":"export.min.js","sources":["../src/export.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript to manage export feature.\n *\n * @package mod_oublog\n * @copyright 2018 The Open University\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module mod_oublog/export\n */\n\ndefine([\n    'jquery'\n], function($) {\n    var t;\n    t = {\n        /**\n         * List out all of css selector used in export module.\n         */\n        CSS: {\n            SELECTALLPOST: 'button[name=\"oublog-export-select-all\"]',\n            SELECTNONE: 'button[name=\"oublog-export-select-none\"]',\n            CHECKBOXS: '.oublog-posts-table input[type=\"checkbox\"]',\n            EXPORTSELECTED: 'button[name=\"oublog-export-selected\"]',\n            EXPORTTYPE: '#oublog-export-type'\n        },\n\n        /**\n         * Module config. Passed from server side.\n         */\n        mconfig: null,\n\n        /**\n         * Selected post id for export.\n         */\n        contentIds: [],\n\n        /**\n         * Initialize module.\n         *\n         * @param {JSON} options  The settings for module\n         * @method init\n         */\n        init: function(options) {\n            t.mconfig = options;\n            if (sessionStorage.getItem(\"contentIds\") !== null && t.mconfig.newsession !== true) {\n                t.contentIds = JSON.parse(sessionStorage.getItem(\"contentIds\"));\n            }\n            $(t.CSS.SELECTALLPOST).on('click', t.selectAll.bind(t));\n            $(t.CSS.SELECTNONE).on('click', t.selectNone.bind(t));\n            $(t.CSS.CHECKBOXS).on('click', t.selectPost.bind(t));\n            $(t.CSS.EXPORTSELECTED).on('click', t.exportSelected.bind(t));\n            t.initSelectedPost();\n            t.initButtonState();\n        },\n\n        /**\n         * Select all posts\n         * @method selectAll\n         */\n        selectAll: function() {\n            $(t.CSS.CHECKBOXS).prop('checked', true);\n            $(t.CSS.SELECTALLPOST).prop(\"disabled\", true);\n            $(t.CSS.SELECTALLPOST).blur();\n            $(t.CSS.SELECTNONE).prop('disabled', false);\n            $(t.CSS.EXPORTSELECTED).prop('disabled', false);\n            $(t.CSS.CHECKBOXS).each(function() {\n                if ($(this).prop('checked')) {\n                    t.addPost($(this).val());\n                }\n            });\n        },\n\n        /**\n         * Remove all selected posts\n         * @method selectNone\n         */\n        selectNone: function() {\n            $(t.CSS.CHECKBOXS).prop('checked', false);\n            $(t.CSS.SELECTALLPOST).prop(\"disabled\", false);\n            $(t.CSS.SELECTNONE).prop(\"disabled\", true);\n            $(t.CSS.SELECTNONE).blur();\n            $(t.CSS.EXPORTSELECTED).prop('disabled', true);\n            $(t.CSS.CHECKBOXS).each(function() {\n                if (!$(this).prop('checked')) {\n                    t.removePost($(this).val());\n                }\n            });\n        },\n\n        /**\n         * Select a post\n         * @method selectPost\n         */\n        selectPost: function(event) {\n            if (event.target.checked == true) {\n                t.addPost(event.target.value);\n            } else {\n                t.removePost(event.target.value);\n            }\n            t.initButtonState();\n        },\n\n        /**\n         * Set checkbox state to checked if user already selected it.\n         * @method selectNone\n         */\n        initSelectedPost: function() {\n            $(t.CSS.CHECKBOXS).each(function() {\n                var index = t.contentIds.indexOf($(this).val());\n                if (index !== -1) {\n                    $(this).prop('checked', true);\n                }\n            });\n        },\n\n        /**\n         * Export selected posts\n         * @method exportSelected\n         */\n        exportSelected: function() {\n            if (t.contentIds.length > 0) {\n                var exportUrl = $(t.CSS.EXPORTSELECTED).data(\"url\");\n                var exportType = $(t.CSS.EXPORTTYPE).val();\n                exportUrl = this.updateQueryStringParameter(exportUrl, 'instance', String(exportType));\n                exportUrl = this.updateQueryStringParameter(exportUrl, 'ca_postids', t.contentIds.join('|'));\n                sessionStorage.removeItem('contentIds');\n                t.contentIds = [];\n                window.location.href = exportUrl;\n            }\n        },\n\n        /**\n         * Remove post from sessionStorage and contentIds\n         * @method removePost\n         */\n        removePost: function(postId) {\n            var index = t.contentIds.indexOf(postId);\n            if (index !== -1) {\n                t.contentIds.splice(index, 1);\n                sessionStorage.setItem(\"contentIds\", JSON.stringify(t.contentIds));\n            }\n        },\n\n        /**\n         * Add post from sessionStorage and contentIds\n         * @method addPost\n         */\n        addPost: function(postId) {\n            var index = t.contentIds.indexOf(postId);\n            if (index === -1) {\n                t.contentIds.push(postId);\n                sessionStorage.setItem(\"contentIds\", JSON.stringify(t.contentIds));\n            }\n        },\n\n        /**\n         * Init the state of all buttons.\n         * @method initButtonState\n         */\n        initButtonState: function() {\n            var uncheckBoxes = 0;\n            var boxquantity = 0;\n            $(t.CSS.CHECKBOXS).each(function() {\n                if ($(this).prop('checked') == false) {\n                    uncheckBoxes++;\n                }\n                boxquantity++;\n            });\n            $(t.CSS.SELECTALLPOST).prop('disabled', uncheckBoxes == 0);\n            $(t.CSS.SELECTNONE).prop('disabled', uncheckBoxes == boxquantity);\n            $(t.CSS.EXPORTSELECTED).prop('disabled', t.contentIds.length == 0);\n        },\n\n        /**\n         * Update or add new param to uri.\n         *\n         * @method updateQueryStringParameter\n         * @param {String} uri\n         * @param {String} key\n         * @param {String} value\n         * @returns {string|*}\n         */\n        updateQueryStringParameter: function(uri, key, value) {\n            var re = new RegExp(\"([?&])\" + key + \"=.*?(&|$)\", \"i\"),\n                separator = uri.indexOf('?') !== -1 ? \"&\" : \"?\";\n            return uri.match(re) ? uri.replace(re, '$1' + key + \"=\" + value + '$2') :\n                uri + separator + key + \"=\" + value;\n        }\n    };\n    return t;\n});\n"],"names":["define","$","t","CSS","SELECTALLPOST","SELECTNONE","CHECKBOXS","EXPORTSELECTED","EXPORTTYPE","mconfig","contentIds","init","options","sessionStorage","getItem","newsession","JSON","parse","on","selectAll","bind","selectNone","selectPost","exportSelected","initSelectedPost","initButtonState","prop","blur","each","this","addPost","val","removePost","event","target","checked","value","indexOf","length","exportUrl","data","exportType","updateQueryStringParameter","String","join","removeItem","window","location","href","postId","index","splice","setItem","stringify","push","uncheckBoxes","boxquantity","uri","key","re","RegExp","separator","match","replace"],"mappings":";;;;;;;AA2BAA,2BAAO,CACH,WACD,SAASC,OACJC,SACJA,EAAI,CAIAC,IAAK,CACDC,cAAe,0CACfC,WAAY,2CACZC,UAAW,6CACXC,eAAgB,wCAChBC,WAAY,uBAMhBC,QAAS,KAKTC,WAAY,GAQZC,KAAM,SAASC,SACXV,EAAEO,QAAUG,QACiC,OAAzCC,eAAeC,QAAQ,gBAAmD,IAAzBZ,EAAEO,QAAQM,aAC3Db,EAAEQ,WAAaM,KAAKC,MAAMJ,eAAeC,QAAQ,gBAErDb,EAAEC,EAAEC,IAAIC,eAAec,GAAG,QAAShB,EAAEiB,UAAUC,KAAKlB,IACpDD,EAAEC,EAAEC,IAAIE,YAAYa,GAAG,QAAShB,EAAEmB,WAAWD,KAAKlB,IAClDD,EAAEC,EAAEC,IAAIG,WAAWY,GAAG,QAAShB,EAAEoB,WAAWF,KAAKlB,IACjDD,EAAEC,EAAEC,IAAII,gBAAgBW,GAAG,QAAShB,EAAEqB,eAAeH,KAAKlB,IAC1DA,EAAEsB,mBACFtB,EAAEuB,mBAONN,UAAW,WACPlB,EAAEC,EAAEC,IAAIG,WAAWoB,KAAK,WAAW,GACnCzB,EAAEC,EAAEC,IAAIC,eAAesB,KAAK,YAAY,GACxCzB,EAAEC,EAAEC,IAAIC,eAAeuB,OACvB1B,EAAEC,EAAEC,IAAIE,YAAYqB,KAAK,YAAY,GACrCzB,EAAEC,EAAEC,IAAII,gBAAgBmB,KAAK,YAAY,GACzCzB,EAAEC,EAAEC,IAAIG,WAAWsB,MAAK,WAChB3B,EAAE4B,MAAMH,KAAK,YACbxB,EAAE4B,QAAQ7B,EAAE4B,MAAME,WAS9BV,WAAY,WACRpB,EAAEC,EAAEC,IAAIG,WAAWoB,KAAK,WAAW,GACnCzB,EAAEC,EAAEC,IAAIC,eAAesB,KAAK,YAAY,GACxCzB,EAAEC,EAAEC,IAAIE,YAAYqB,KAAK,YAAY,GACrCzB,EAAEC,EAAEC,IAAIE,YAAYsB,OACpB1B,EAAEC,EAAEC,IAAII,gBAAgBmB,KAAK,YAAY,GACzCzB,EAAEC,EAAEC,IAAIG,WAAWsB,MAAK,WACf3B,EAAE4B,MAAMH,KAAK,YACdxB,EAAE8B,WAAW/B,EAAE4B,MAAME,WASjCT,WAAY,SAASW,OACW,GAAxBA,MAAMC,OAAOC,QACbjC,EAAE4B,QAAQG,MAAMC,OAAOE,OAEvBlC,EAAE8B,WAAWC,MAAMC,OAAOE,OAE9BlC,EAAEuB,mBAOND,iBAAkB,WACdvB,EAAEC,EAAEC,IAAIG,WAAWsB,MAAK,YAEL,IADH1B,EAAEQ,WAAW2B,QAAQpC,EAAE4B,MAAME,QAErC9B,EAAE4B,MAAMH,KAAK,WAAW,OASpCH,eAAgB,cACRrB,EAAEQ,WAAW4B,OAAS,EAAG,KACrBC,UAAYtC,EAAEC,EAAEC,IAAII,gBAAgBiC,KAAK,OACzCC,WAAaxC,EAAEC,EAAEC,IAAIK,YAAYuB,MACrCQ,UAAYV,KAAKa,2BAA2BH,UAAW,WAAYI,OAAOF,aAC1EF,UAAYV,KAAKa,2BAA2BH,UAAW,aAAcrC,EAAEQ,WAAWkC,KAAK,MACvF/B,eAAegC,WAAW,cAC1B3C,EAAEQ,WAAa,GACfoC,OAAOC,SAASC,KAAOT,YAQ/BP,WAAY,SAASiB,YACbC,MAAQhD,EAAEQ,WAAW2B,QAAQY,SAClB,IAAXC,QACAhD,EAAEQ,WAAWyC,OAAOD,MAAO,GAC3BrC,eAAeuC,QAAQ,aAAcpC,KAAKqC,UAAUnD,EAAEQ,eAQ9DoB,QAAS,SAASmB,SAEC,IADH/C,EAAEQ,WAAW2B,QAAQY,UAE7B/C,EAAEQ,WAAW4C,KAAKL,QAClBpC,eAAeuC,QAAQ,aAAcpC,KAAKqC,UAAUnD,EAAEQ,eAQ9De,gBAAiB,eACT8B,aAAe,EACfC,YAAc,EAClBvD,EAAEC,EAAEC,IAAIG,WAAWsB,MAAK,WACW,GAA3B3B,EAAE4B,MAAMH,KAAK,YACb6B,eAEJC,iBAEJvD,EAAEC,EAAEC,IAAIC,eAAesB,KAAK,WAA4B,GAAhB6B,cACxCtD,EAAEC,EAAEC,IAAIE,YAAYqB,KAAK,WAAY6B,cAAgBC,aACrDvD,EAAEC,EAAEC,IAAII,gBAAgBmB,KAAK,WAAmC,GAAvBxB,EAAEQ,WAAW4B,SAY1DI,2BAA4B,SAASe,IAAKC,IAAKtB,WACvCuB,GAAK,IAAIC,OAAO,SAAWF,IAAM,YAAa,KAC9CG,WAAkC,IAAtBJ,IAAIpB,QAAQ,KAAc,IAAM,WACzCoB,IAAIK,MAAMH,IAAMF,IAAIM,QAAQJ,GAAI,KAAOD,IAAM,IAAMtB,MAAQ,MAC9DqB,IAAMI,UAAYH,IAAM,IAAMtB"}
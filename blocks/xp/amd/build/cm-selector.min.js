define(["jquery","core/ajax","block_xp/course-resource-selector","block_xp/cm-resource-selector"],function(a,b,c,d){function e(b,e){function g(){l.val(""),m.val(""),n.clear(),i.find(".cm-search").hide(),i.find(".course-search .course-not-selected").show(),i.find(".course-search .course-selected").hide(),j=null,l.focus()}function h(a){j=a,f=a,i.find(".course-search .course-selected span").text(a.fullname),i.find(".course-search .course-selected").show(),i.find(".course-search .course-not-selected").hide(),i.find(".cm-search").show(),n.clear(),o.initForCourse(a.id),m.val(""),m.focus()}e=e||f;var i=a(b),j=null,k=i.find(".search-result-contents"),l=i.find(".search-term-course"),m=i.find(".search-term-cm"),n=new c(k,l);n.onResourceSelected(function(a,b){b._iscourse&&h(b.course)});var o=new d(k,m);o.onResourceSelected(function(a,b){b._iscm&&i.trigger("cm-selected",{cm:b.cm,course:j})}),i.find(".course-selection-change").on("click",function(){g()}),e?h(e):g()}var f=null;return{init:e}});
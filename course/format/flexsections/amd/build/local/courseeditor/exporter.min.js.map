{"version":3,"file":"exporter.min.js","sources":["../../../src/local/courseeditor/exporter.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport Exporter from \"core_courseformat/local/courseeditor/exporter\";\n\n/**\n * Overriding default course format exporter\n *\n * @module     format_flexsections/local/courseeditor/exporter\n * @copyright  2022 Marina Glancy\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nexport default class extends Exporter {\n    // Extends: course/format/amd/src/local/courseeditor/exporter.js\n\n    /**\n     * Generate a section export data from the state.\n     *\n     * @param {Object} state the current state.\n     * @param {Object} sectioninfo the section state data.\n     * @returns {Object}\n     */\n    section(state, sectioninfo) {\n        const children = sectioninfo.children;\n        const section = super.section(state, sectioninfo);\n        section.children = [];\n        if (children && children.length) {\n            for (let i = 0; i < children.length; i++) {\n                section.children.push(this.section(state, children[i]));\n            }\n        }\n        return section;\n    }\n\n    /**\n     * Generate the course export data from the state.\n     *\n     * @param {Object} state the current state.\n     * @returns {Object}\n     */\n    course(state) {\n        const course = super.course(state);\n        course.maxsectiondepth = state.course.maxsectiondepth;\n        return course;\n    }\n\n    /**\n     * Return a sorted list of all sections and cms items in the state.\n     *\n     * @param {Object} state the current state.\n     * @returns {Array} all sections and cms items in the state.\n     */\n    allItemsArray(state) {\n        const items = [];\n        const sectionlist = state.course.sectionlist ?? [];\n\n        const addCms = (sectioninfo) => {\n            const cmlist = sectioninfo.cmlist ?? [];\n            cmlist.forEach(cmid => {\n                const cminfo = state.cm.get(cmid);\n                items.push({type: 'cm', id: cminfo.id, url: cminfo.url});\n            });\n        };\n        const addChildItems = (children) => {\n            if (children && children.length) {\n                for (let i = 0; i < children.length; i++) {\n                    const child = children[i];\n                    items.push({type: 'section', id: child.id, url: child.sectionurl});\n                    addCms(child);\n                    addChildItems(child.children);\n                }\n            }\n        };\n        sectionlist.forEach(sectionid => {\n            const sectioninfo = state.section.get(sectionid);\n            items.push({type: 'section', id: sectioninfo.id, url: sectioninfo.sectionurl});\n            addCms(sectioninfo);\n            addChildItems(sectioninfo.children);\n        });\n        return items;\n    }\n}"],"names":["Exporter","section","state","sectioninfo","children","super","length","i","push","this","course","maxsectiondepth","allItemsArray","items","sectionlist","addCms","cmlist","forEach","cmid","cminfo","cm","get","type","id","url","addChildItems","child","sectionurl","sectionid"],"mappings":";;;;;;;wKAwB6BA,kBAUzBC,QAAQC,MAAOC,mBACLC,SAAWD,YAAYC,SACvBH,QAAUI,MAAMJ,QAAQC,MAAOC,gBACrCF,QAAQG,SAAW,GACfA,UAAYA,SAASE,WAChB,IAAIC,EAAI,EAAGA,EAAIH,SAASE,OAAQC,IACjCN,QAAQG,SAASI,KAAKC,KAAKR,QAAQC,MAAOE,SAASG,YAGpDN,QASXS,OAAOR,aACGQ,OAASL,MAAMK,OAAOR,cAC5BQ,OAAOC,gBAAkBT,MAAMQ,OAAOC,gBAC/BD,OASXE,cAAcV,uCACJW,MAAQ,GACRC,0CAAcZ,MAAMQ,OAAOI,mEAAe,GAE1CC,OAAUZ,mEACGA,YAAYa,0DAAU,IAC9BC,SAAQC,aACLC,OAASjB,MAAMkB,GAAGC,IAAIH,MAC5BL,MAAML,KAAK,CAACc,KAAM,KAAMC,GAAIJ,OAAOI,GAAIC,IAAKL,OAAOK,UAGrDC,cAAiBrB,cACfA,UAAYA,SAASE,WAChB,IAAIC,EAAI,EAAGA,EAAIH,SAASE,OAAQC,IAAK,OAChCmB,MAAQtB,SAASG,GACvBM,MAAML,KAAK,CAACc,KAAM,UAAWC,GAAIG,MAAMH,GAAIC,IAAKE,MAAMC,aACtDZ,OAAOW,OACPD,cAAcC,MAAMtB,mBAIhCU,YAAYG,SAAQW,kBACVzB,YAAcD,MAAMD,QAAQoB,IAAIO,WACtCf,MAAML,KAAK,CAACc,KAAM,UAAWC,GAAIpB,YAAYoB,GAAIC,IAAKrB,YAAYwB,aAClEZ,OAAOZ,aACPsB,cAActB,YAAYC,aAEvBS"}
{"version":3,"sources":["../src/inplace_editable.js"],"names":["define","$","ajax","templates","notification","str","itemid","warningshown","handleInplaceEdit","document","querySelectorAll","forEach","td","removeEventListener","beforeDueDate","querySelector","click","stopInplaceEdit","confirmHandleInplaceEdit","message","onconfirm","onreject","get_strings","key","component","done","s","confirm","e","type","keyCode","stopImmediatePropagation","preventDefault","target","closest","dataset","addEventListener"],"mappings":"AA8BAA,OAAM,iCAAC,CAAC,QAAD,CACC,WADD,CAEC,gBAFD,CAGC,mBAHD,CAIC,UAJD,CAKC,aALD,CAMC,UAND,CAOC,wBAPD,CAQC,cARD,CAAD,CAUN,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAA6BC,CAA7B,CAA2CC,CAA3C,CAAiF,IAEzEC,CAAAA,CAFyE,CAGzEC,CAAY,GAH6D,CAQzEC,CAAiB,CAAG,UAAW,CAC/BD,CAAY,GAAZ,CAEAE,QAAQ,CAACC,gBAAT,CAA0B,uBAA1B,EAAmDC,OAAnD,CAA2D,SAASC,CAAT,CAAa,CACpEA,CAAE,CAACC,mBAAH,CAAuB,OAAvB,CAAgCC,CAAhC,KACAF,CAAE,CAACC,mBAAH,CAAuB,UAAvB,CAAmCC,CAAnC,IACH,CAHD,EAKAL,QAAQ,CAACM,aAAT,CAAuB,iBAAmBT,CAAnB,CAA4B,+BAAnD,EAAoFU,KAApF,EACH,CAjB4E,CAsBzEC,CAAe,CAAG,UAAW,CAC7B,QACH,CAxB4E,CAiCzEC,CAAwB,CAAG,SAASC,CAAT,CAAkBC,CAAlB,CAA6BC,CAA7B,CAA0C,CACrEhB,CAAG,CAACiB,WAAJ,CAAgB,CACZ,CAACC,GAAG,CAAE,kBAAN,CAA0BC,SAAS,CAAE,cAArC,CADY,CAEZ,CAACD,GAAG,CAAE,KAAN,CAAaC,SAAS,CAAE,MAAxB,CAFY,CAGZ,CAACD,GAAG,CAAE,IAAN,CAAYC,SAAS,CAAE,cAAvB,CAHY,CAAhB,EAIGC,IAJH,CAIQ,SAASC,CAAT,CAAY,CACZtB,CAAY,CAACuB,OAAb,CAAqBD,CAAC,CAAC,CAAD,CAAtB,CAA2BP,CAA3B,CAAoCO,CAAC,CAAC,CAAD,CAArC,CAA0CA,CAAC,CAAC,CAAD,CAA3C,CAAgDN,CAAhD,CAA2DC,CAA3D,CACH,CANL,CAQH,CA1C4E,CAiDzEP,CAAa,CAAG,SAASc,CAAT,CAAY,CAC5B,GAAe,UAAX,GAAAA,CAAC,CAACC,IAAF,EAAuC,EAAd,GAAAD,CAAC,CAACE,OAA/B,CAA+C,CAC3C,MACH,CAEDF,CAAC,CAACG,wBAAF,GACAH,CAAC,CAACI,cAAF,GACA1B,CAAM,CAAGsB,CAAC,CAACK,MAAF,CAASC,OAAT,CAAiB,kBAAjB,EAAqCC,OAArC,CAA6C7B,MAAtD,CAEAD,CAAG,CAACiB,WAAJ,CAAgB,CACZ,CAACC,GAAG,CAAE,qBAAN,CAA6BC,SAAS,CAAE,cAAxC,CADY,CAAhB,EAEGC,IAFH,CAEQ,SAASC,CAAT,CAAY,CAChBR,CAAwB,CAACQ,CAAC,CAAC,CAAD,CAAF,CAAOlB,CAAP,CAA0BS,CAA1B,CAA2CW,CAA3C,CAE3B,CALD,CAMH,CAhE4E,CAkE7EnB,QAAQ,CAACC,gBAAT,CAA0B,uBAA1B,EAAmDC,OAAnD,CAA2D,SAASC,CAAT,CAAa,CACpE,GAAI,CAACL,CAAL,CAAmB,CACfK,CAAE,CAACwB,gBAAH,CAAoB,OAApB,CAA6BtB,CAA7B,KACAF,CAAE,CAACwB,gBAAH,CAAoB,UAApB,CAAgCtB,CAAhC,IACH,CACD,QACH,CAND,EAQA,MAAO,EACV,CArFK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AJAX helper for the inline editing a value.\n *\n * This script is automatically included from template core/inplace_editable\n * It registers a click-listener on [data-inplaceeditablelink] link (the \"inplace edit\" icon),\n * then replaces the displayed value with an input field. On \"Enter\" it sends a request\n * to web service core_update_inplace_editable, which invokes the specified callback.\n * Any exception thrown by the web service (or callback) is displayed as an error popup.\n *\n * @module     core/inplace_editable\n * @package    core\n * @copyright  2016 Marina Glancy\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.1\n */\ndefine(['jquery',\n        'core/ajax',\n        'core/templates',\n        'core/notification',\n        'core/str',\n        'core/config',\n        'core/url',\n        'core/form-autocomplete',\n        'core/pending',\n    ],\nfunction($, ajax, templates, notification, str, cfg, url, autocomplete, Pending) {\n\n    var itemid;\n    var warningshown = false;\n\n    /**\n     * Enables inplace editing.\n     */\n    var handleInplaceEdit = function() {\n        warningshown = true;\n\n        document.querySelectorAll('.inplace-grading.cell').forEach(function(td) {\n            td.removeEventListener('click', beforeDueDate, true);\n            td.removeEventListener('keypress', beforeDueDate, true);\n        });\n\n        document.querySelector(\"[data-itemid='\" + itemid + \"'] [data-inplaceeditablelink]\").click();\n    };\n\n    /**\n     * Prevents inplace editing.\n     */\n    var stopInplaceEdit = function() {\n        return true;\n    };    \n\n    /**\n     * Displays the show confirmation to edit grade.\n     *\n     * @param {String} message confirmation message\n     * @param {function} onconfirm function to execute on confirm\n     * @param {function} onreject function to execute on reject\n     */\n    var confirmHandleInplaceEdit = function(message, onconfirm, onreject, e) {\n        str.get_strings([\n            {key: 'confirmeditgrade', component: 'mod_peerwork'},\n            {key: 'yes', component: 'core'},\n            {key: 'no', component: 'mod_peerwork'}\n        ]).done(function(s) {\n                notification.confirm(s[0], message, s[1], s[2], onconfirm, onreject);                \n            }\n        );\n    };\n\n    /**\n     * The edit link was clicked in the group list.\n     *\n     * @param {Event} e click/keypress event\n     */\n    var beforeDueDate = function(e) {\n        if (e.type === 'keypress' && e.keyCode !== 13) {\n            return;\n        }\n\n        e.stopImmediatePropagation();\n        e.preventDefault();\n        itemid = e.target.closest('.inplaceeditable').dataset.itemid;        \n\n        str.get_strings([\n            {key: 'confirmeditgradetxt', component: 'mod_peerwork'}\n        ]).done(function(s) {\n            confirmHandleInplaceEdit(s[0], handleInplaceEdit, stopInplaceEdit, e);    \n\n        });\n    };\n\n    document.querySelectorAll('.inplace-grading.cell').forEach(function(td) {\n        if (!warningshown) {\n            td.addEventListener('click', beforeDueDate, true);\n            td.addEventListener('keypress', beforeDueDate, true);\n        }\n        return false;\n    });\n\n    return {};\n});\n"],"file":"inplace_editable.min.js"}